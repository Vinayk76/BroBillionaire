<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N0Y2LBMRSW"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-N0Y2LBMRSW');
    </script>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon-96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">

    <!-- Primary Meta Tags -->
    <title>Stock Analysis Tool FREE | Technical Analysis & Fundamental Analysis | AI Stock Analyzer India 2026</title>
    <meta name="title"
        content="Free Stock Analysis Tool | Technical Analysis & Fundamental Analysis | RSI, MACD, PE Ratio | India">
    <meta name="description"
        content="Free Stock Analysis Tool with Technical Analysis (RSI, MACD, Bollinger Bands, Moving Averages) and Fundamental Analysis (PE Ratio, ROE, EPS). Analyze NSE/BSE stocks instantly with 50+ indicators, buy/sell signals, price targets. No signup required. Educational purposes only.">
    <meta name="keywords"
        content="stock analysis tool, technical analysis, fundamental analysis, RSI indicator, MACD, PE ratio, stock screener, NSE BSE analysis, free stock analyzer">
    <meta name="author" content="BroBillionaire">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <link rel="canonical" href="https://brobillionaire.com/tool-ai-stock-analyzer.html">

    <!-- Additional SEO Meta Tags -->
    <meta name="rating" content="General">
    <meta name="revisit-after" content="1 days">
    <meta name="language" content="English">
    <meta name="geo.region" content="IN">
    <meta name="geo.country" content="India">
    <meta name="target" content="all">
    <meta name="audience" content="all">
    <meta name="coverage" content="Worldwide">
    <meta name="distribution" content="Global">
    <meta name="classification" content="Finance, Stock Market, AI Tools, Trading">
    <meta http-equiv="Content-Language" content="en-IN">
    <meta name="subject" content="Stock Analysis Tool - Technical Analysis & Fundamental Analysis Free">
    <meta name="abstract"
        content="Complete stock analysis tool with technical indicators (RSI, MACD, EMA, SMA, Bollinger Bands) and fundamental analysis (PE Ratio, ROE, EPS, Debt Equity). Free instant analysis for NSE/BSE stocks with buy/sell signals and price targets.">
    <meta name="topic"
        content="Stock Analysis, Technical Analysis, Fundamental Analysis, Stock Market Analysis, Trading Tools, Stock Screener">
    <meta name="summary"
        content="Free stock analysis tool with 50+ technical indicators and fundamental metrics. Analyze any NSE/BSE stock instantly. Educational stock analyzer for Indian traders.">
    <meta name="news_keywords"
        content="stock analysis, technical analysis, fundamental analysis, RSI, MACD, PE ratio, stock screener, NSE analysis, BSE analysis, stock market India">
    <meta name="sailthru.tags"
        content="stock-analysis, technical-analysis, fundamental-analysis, trading-tools, stock-screener">
    <meta name="copyright" content="BroBillionaire 2026">
    <meta name="designer" content="BroBillionaire">
    <meta name="reply-to" content="contact@brobillionaire.com">
    <meta name="owner" content="BroBillionaire">
    <meta name="url" content="https://brobillionaire.com/tool-ai-stock-analyzer.html">
    <meta name="identifier-URL" content="https://brobillionaire.com/tool-ai-stock-analyzer.html">
    <meta name="category" content="Finance">
    <meta name="og:region" content="IN">
    <meta name="og:country-name" content="India">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="AI Stock Analyzer">
    <meta name="application-name" content="AI Stock Analyzer">
    <meta name="msapplication-TileColor" content="#c9a227">
    <meta name="theme-color" content="#0a0a0a">

    <!-- Preconnect for Performance SEO -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://query1.finance.yahoo.com">
    <link rel="dns-prefetch" href="https://query1.finance.yahoo.com">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://brobillionaire.com/tool-ai-stock-analyzer.html">
    <meta property="og:title" content="Stock Analysis Tool FREE | Technical & Fundamental Analysis | RSI MACD PE Ratio">
    <meta property="og:description"
        content="Free Stock Analysis Tool with Technical Analysis (RSI, MACD, Bollinger Bands, Moving Averages) and Fundamental Analysis (PE Ratio, ROE, EPS). Analyze NSE/BSE stocks with 50+ indicators, buy/sell signals. Educational tool.">
    <meta property="og:image" content="https://brobillionaire.com/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Stock Analysis Tool - Technical Analysis and Fundamental Analysis">
    <meta property="og:site_name" content="BroBillionaire">
    <meta property="og:locale" content="en_IN">
    <meta property="article:tag" content="Stock Analysis">
    <meta property="article:tag" content="Technical Analysis">
    <meta property="article:tag" content="Fundamental Analysis">
    <meta property="article:tag" content="Stock Screener">
    <meta property="article:tag" content="Trading Tools">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://brobillionaire.com/tool-ai-stock-analyzer.html">
    <meta name="twitter:title"
        content="Stock Analysis Tool FREE | Technical Analysis & Fundamental Analysis | India 2026">
    <meta name="twitter:description"
        content="Free Stock Analysis Tool with RSI, MACD, Bollinger Bands, PE Ratio, ROE analysis. 50+ technical indicators, buy/sell signals. Analyze NSE/BSE stocks free. Educational tool.">
    <meta name="twitter:image" content="https://brobillionaire.com/og-image.jpg">
    <meta name="twitter:image:alt" content="Stock Analysis Tool with Technical and Fundamental Analysis">
    <meta name="twitter:creator" content="@BroBillionaire">
    <meta name="twitter:site" content="@BroBillionaire">
    <meta name="twitter:label1" content="Stock Analysis Type">
    <meta name="twitter:data1" content="Technical & Fundamental">
    <meta name="twitter:label2" content="Price">
    <meta name="twitter:data2" content="Free">

    <!-- WebApplication Schema - Primary Stock Analysis Tool -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Stock Analysis Tool - Technical & Fundamental Analysis",
        "alternateName": ["Stock Analyzer", "Technical Analysis Tool", "Fundamental Analysis Tool", "Stock Screener"],
        "description": "Free Stock Analysis Tool with Technical Analysis (RSI, MACD, Bollinger Bands, Moving Averages) and Fundamental Analysis (PE Ratio, ROE, EPS). Analyze NSE/BSE stocks with 50+ indicators. Educational purposes only.",
        "url": "https://brobillionaire.com/tool-ai-stock-analyzer.html",
        "applicationCategory": "FinanceApplication",
        "applicationSubCategory": "Stock Analysis Tool",
        "operatingSystem": "Any",
        "browserRequirements": "Requires JavaScript. Requires HTML5.",
        "softwareVersion": "3.0",
        "datePublished": "2024-01-15",
        "dateModified": "2026-02-06",
        "inLanguage": ["en", "hi"],
        "isAccessibleForFree": true,
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "INR",
            "availability": "https://schema.org/InStock"
        },
        "author": {
            "@type": "Organization",
            "name": "BroBillionaire",
            "url": "https://brobillionaire.com"
        },
        "publisher": {
            "@type": "Organization",
            "name": "BroBillionaire",
            "logo": {
                "@type": "ImageObject",
                "url": "https://brobillionaire.com/logo.png"
            }
        },
        "featureList": [
            "Technical Analysis - RSI, MACD, Bollinger Bands",
            "Fundamental Analysis - PE Ratio, ROE, EPS",
            "50+ Technical Indicators",
            "Buy/Sell Signals",
            "Price Targets & Stop Loss",
            "Moving Averages - EMA, SMA",
            "Support & Resistance Levels",
            "Volume Analysis"
        ],
        "screenshot": "https://brobillionaire.com/screenshots/ai-stock-analyzer.jpg"
    }
    </script>

    <!-- Product Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org/",
        "@type": "Product",
        "name": "Stock Analysis Tool - Technical & Fundamental Analysis",
        "image": "https://brobillionaire.com/og-image.jpg",
        "description": "Free Stock Analysis Tool with Technical Analysis (RSI, MACD, Bollinger Bands) and Fundamental Analysis (PE Ratio, ROE, EPS). Analyze NSE/BSE stocks with 50+ indicators. Educational purposes only.",
        "brand": {
            "@type": "Brand",
            "name": "BroBillionaire"
        },
        "offers": {
            "@type": "Offer",
            "url": "https://brobillionaire.com/tool-ai-stock-analyzer.html",
            "priceCurrency": "INR",
            "price": "0",
            "availability": "https://schema.org/InStock"
        }
    }
    </script>

    <!-- FAQPage Schema - Comprehensive SEO FAQs for Stock Analysis -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "What is Stock Analysis and why is it important for trading?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Stock analysis is the process of evaluating stocks using technical analysis (chart patterns, indicators like RSI, MACD, Moving Averages) and fundamental analysis (PE ratio, ROE, EPS, revenue growth). It helps traders make informed buy/sell decisions. Our free stock analysis tool provides both technical and fundamental analysis for NSE/BSE stocks."
                }
            },
            {
                "@type": "Question",
                "name": "What is Technical Analysis and which indicators are most important?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Technical Analysis is the study of price charts and indicators to predict future price movements. Key technical indicators include: RSI (Relative Strength Index) for overbought/oversold levels, MACD for trend direction, Bollinger Bands for volatility, Moving Averages (EMA, SMA) for trend identification, Stochastic Oscillator, ADX for trend strength, and Support & Resistance levels. Our tool analyzes 50+ technical indicators."
                }
            },
            {
                "@type": "Question",
                "name": "What is Fundamental Analysis and what metrics should I check?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Fundamental Analysis evaluates a company's financial health and intrinsic value. Key fundamental metrics include: PE Ratio (Price to Earnings), PB Ratio (Price to Book), ROE (Return on Equity), EPS (Earnings Per Share), Debt to Equity ratio, Dividend Yield, Revenue Growth, and Profit Margins. Our stock analyzer provides comprehensive fundamental analysis for every stock."
                }
            },
            {
                "@type": "Question",
                "name": "How to use RSI indicator for stock trading?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "RSI (Relative Strength Index) is a momentum indicator ranging 0-100. RSI above 70 indicates overbought conditions (potential sell signal), RSI below 30 indicates oversold conditions (potential buy signal). RSI between 40-60 is neutral. Our stock analysis tool calculates real-time RSI and provides clear buy/sell signals based on RSI levels."
                }
            },
            {
                "@type": "Question",
                "name": "How to read MACD indicator for buy/sell signals?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "MACD (Moving Average Convergence Divergence) consists of MACD line, Signal line, and Histogram. Buy signal: MACD line crosses above Signal line (bullish crossover). Sell signal: MACD line crosses below Signal line (bearish crossover). Histogram shows momentum strength. Our tool calculates MACD with standard 12,26,9 periods."
                }
            },
            {
                "@type": "Question",
                "name": "What PE Ratio is good for stock investing?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "PE Ratio (Price to Earnings) varies by sector. Generally: PE below 15 is considered undervalued, PE 15-25 is fairly valued, PE above 25 may be overvalued. IT stocks typically have higher PE (25-40), while banking stocks have lower PE (10-20). Our fundamental analysis compares PE ratios against sector averages."
                }
            },
            {
                "@type": "Question",
                "name": "How to identify Support and Resistance levels?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Support levels are price points where buying interest prevents further decline. Resistance levels are where selling pressure prevents price rise. Key methods: Previous highs/lows, Moving Averages (20, 50, 200 EMA/SMA), Fibonacci retracement levels (23.6%, 38.2%, 50%, 61.8%), and Pivot Points. Our tool automatically calculates these levels."
                }
            },
            {
                "@type": "Question",
                "name": "What are Bollinger Bands and how to use them?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Bollinger Bands consist of a middle band (20-SMA) with upper and lower bands at 2 standard deviations. Price touching upper band suggests overbought, lower band suggests oversold. Band squeeze indicates low volatility and potential breakout. Band expansion indicates high volatility. Our analyzer includes Bollinger Bands analysis."
                }
            },
            {
                "@type": "Question",
                "name": "Is this stock analysis tool completely free?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes! Our Stock Analysis Tool is 100% FREE with no registration required. Get complete technical analysis (RSI, MACD, Moving Averages, Bollinger Bands, 50+ indicators) and fundamental analysis (PE Ratio, ROE, EPS) for any NSE/BSE stock. No hidden charges, no subscription. Educational purposes only."
                }
            },
            {
                "@type": "Question",
                "name": "Which stocks can I analyze - NSE, BSE, Nifty 50?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Analyze 2000+ stocks listed on NSE and BSE including all Nifty 50 stocks, Bank Nifty stocks, Nifty IT, Nifty Pharma, Midcap 150, Smallcap 250. Popular stocks: RELIANCE, TCS, HDFC Bank, Infosys, ICICI Bank, Bharti Airtel, ITC, and more. Real-time price data from Yahoo Finance."
                }
            },
            {
                "@type": "Question",
                "name": "How accurate is this Stock Analyzer for trading decisions?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Our stock analyzer uses real market data and calculates accurate technical indicators. However, this is an EDUCATIONAL TOOL only. Stock markets are unpredictable. Always do your own research, consult SEBI-registered advisors, and verify data from NSE/BSE official sources before trading."
                }
            },
            {
                "@type": "Question",
                "name": "What is the best Moving Average for stock trading?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Common Moving Averages: 20-EMA for short-term trend, 50-SMA for medium-term, 200-SMA for long-term trend. Golden Cross (50-SMA crosses above 200-SMA) is bullish. Death Cross (50-SMA crosses below 200-SMA) is bearish. Our tool analyzes EMA and SMA across multiple timeframes."
                }
            },
            {
                "@type": "Question",
                "name": "How to use Volume Analysis for stock trading?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Volume confirms price movements. High volume on price increase = strong buying (bullish). High volume on price decrease = strong selling (bearish). Low volume moves are weak and may reverse. Volume Ratio above 1.5x average confirms trend strength. Our tool includes OBV (On-Balance Volume) analysis."
                }
            },
            {
                "@type": "Question",
                "name": "What is Stochastic Oscillator and how to read it?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Stochastic Oscillator shows momentum by comparing closing price to price range. %K line above 80 = overbought, below 20 = oversold. Buy when %K crosses above %D in oversold zone. Sell when %K crosses below %D in overbought zone. Our technical analysis includes 14-period Stochastic."
                }
            },
            {
                "@type": "Question",
                "name": "How does ROE (Return on Equity) help in stock selection?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "ROE measures how efficiently a company uses shareholder equity to generate profits. ROE above 15% is generally good. Consistent ROE above 20% indicates excellent management. Compare ROE with industry peers. Higher ROE with low debt is ideal. Our fundamental analysis includes ROE comparison."
                }
            }
        ]
    }
    </script>

    <!-- HowTo Schema - Technical Analysis Steps -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "HowTo",
        "name": "How to Do Technical Analysis of Stocks",
        "description": "Step-by-step guide to perform technical analysis using RSI, MACD, Bollinger Bands, Moving Averages, and other indicators for NSE/BSE stocks.",
        "totalTime": "PT2M",
        "estimatedCost": {
            "@type": "MonetaryAmount",
            "currency": "INR",
            "value": "0"
        },
        "step": [
            {
                "@type": "HowToStep",
                "name": "Enter Stock Symbol",
                "text": "Type any NSE/BSE stock symbol like RELIANCE, TCS, INFY, HDFCBANK in the search box. Supports 2000+ Indian stocks.",
                "position": 1
            },
            {
                "@type": "HowToStep",
                "name": "Analyze Technical Indicators",
                "text": "View RSI for overbought/oversold levels, MACD for trend direction, Bollinger Bands for volatility, and Moving Averages (EMA, SMA) for trend identification.",
                "position": 2
            },
            {
                "@type": "HowToStep",
                "name": "Check Fundamental Metrics",
                "text": "Review PE Ratio, ROE, EPS, Debt-to-Equity ratio, and other fundamental analysis metrics to evaluate company's financial health.",
                "position": 3
            },
            {
                "@type": "HowToStep",
                "name": "Review Support & Resistance Levels",
                "text": "Identify key support and resistance levels, Fibonacci retracement levels, and pivot points for entry/exit decisions.",
                "position": 4
            },
            {
                "@type": "HowToStep",
                "name": "Get Buy/Sell Signals",
                "text": "View the AI-generated buy/sell signals based on 50+ technical and fundamental indicators combined into a single score.",
                "position": 5
            },
            {
                "@type": "HowToStep",
                "name": "Check Price Targets",
                "text": "See upside targets, downside support levels, and recommended stop loss based on technical analysis calculations.",
                "position": 6
            }
        ]
    }
    </script>

    <!-- HowTo Schema - Fundamental Analysis -->


    <!-- FinancialService Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FinancialService",
        "name": "Stock Analysis Tool - Technical & Fundamental Analysis",
        "description": "Free online stock analysis tool providing technical analysis (RSI, MACD, Moving Averages, Bollinger Bands) and fundamental analysis (PE Ratio, ROE, EPS) for NSE/BSE stocks.",
        "url": "https://brobillionaire.com/tool-ai-stock-analyzer.html",
        "areaServed": {
            "@type": "Country",
            "name": "India"
        },
        "serviceType": "Stock Analysis Tool",
        "provider": {
            "@type": "Organization",
            "name": "BroBillionaire"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "INR"
        }
    }
    </script>

    <!-- ItemList Schema for Technical Indicators -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "name": "Technical Analysis Indicators",
        "description": "Complete list of technical indicators available in our stock analysis tool",
        "numberOfItems": 15,
        "itemListElement": [
            {"@type": "ListItem", "position": 1, "name": "RSI (Relative Strength Index)", "description": "Momentum indicator showing overbought/oversold levels (0-100 scale)"},
            {"@type": "ListItem", "position": 2, "name": "MACD (Moving Average Convergence Divergence)", "description": "Trend-following momentum indicator with signal line crossovers"},
            {"@type": "ListItem", "position": 3, "name": "Bollinger Bands", "description": "Volatility indicator with upper and lower bands around 20-SMA"},
            {"@type": "ListItem", "position": 4, "name": "EMA (Exponential Moving Average)", "description": "Trend indicator with 20, 50, 200 period calculations"},
            {"@type": "ListItem", "position": 5, "name": "SMA (Simple Moving Average)", "description": "Basic trend indicator for trend identification"},
            {"@type": "ListItem", "position": 6, "name": "Stochastic Oscillator", "description": "Momentum indicator comparing closing price to price range"},
            {"@type": "ListItem", "position": 7, "name": "ADX (Average Directional Index)", "description": "Trend strength indicator (0-100 scale)"},
            {"@type": "ListItem", "position": 8, "name": "ATR (Average True Range)", "description": "Volatility indicator measuring price range"},
            {"@type": "ListItem", "position": 9, "name": "OBV (On-Balance Volume)", "description": "Volume indicator confirming price trends"},
            {"@type": "ListItem", "position": 10, "name": "Williams %R", "description": "Momentum indicator similar to Stochastic (-100 to 0 scale)"},
            {"@type": "ListItem", "position": 11, "name": "CCI (Commodity Channel Index)", "description": "Momentum oscillator for overbought/oversold detection"},
            {"@type": "ListItem", "position": 12, "name": "Support & Resistance Levels", "description": "Key price levels for trading decisions"},
            {"@type": "ListItem", "position": 13, "name": "Fibonacci Retracement", "description": "Key retracement levels at 23.6%, 38.2%, 50%, 61.8%"},
            {"@type": "ListItem", "position": 14, "name": "Pivot Points", "description": "Daily pivot levels for intraday trading"},
            {"@type": "ListItem", "position": 15, "name": "Volume Analysis", "description": "Volume ratio and trend confirmation analysis"}
        ]
    }
    </script>

    <!-- ItemList Schema for Fundamental Metrics -->


    <!-- Organization Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "BroBillionaire",
        "url": "https://brobillionaire.com",
        "logo": "https://brobillionaire.com/logo.png",
        "description": "Financial education platform with free stock analysis tools, technical analysis, and fundamental analysis resources.",
        "sameAs": [
            "https://twitter.com/BroBillionaire",
            "https://www.youtube.com/@BroBillionaire",
            "https://www.instagram.com/brobillionaire"
        ],
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "customer support",
            "availableLanguage": ["English", "Hindi"]
        }
    }
    </script>

    <!-- BreadcrumbList Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://brobillionaire.com/"},
            {"@type": "ListItem", "position": 2, "name": "Tools", "item": "https://brobillionaire.com/tools.html"},
            {"@type": "ListItem", "position": 3, "name": "Stock Analysis Tool", "item": "https://brobillionaire.com/tool-ai-stock-analyzer.html"}
        ]
    }
    </script>

    <!-- WebPage Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebPage",
        "name": "Stock Analysis Tool - Technical Analysis & Fundamental Analysis",
        "description": "Free stock analysis tool with technical analysis (RSI, MACD, Bollinger Bands, Moving Averages) and fundamental analysis (PE Ratio, ROE, EPS). Analyze NSE/BSE stocks. Educational purposes only.",
        "url": "https://brobillionaire.com/tool-ai-stock-analyzer.html",
        "datePublished": "2024-01-15",
        "dateModified": "2026-02-06",
        "inLanguage": "en-IN",
        "isPartOf": {
            "@type": "WebSite",
            "name": "BroBillionaire",
            "url": "https://brobillionaire.com"
        },
        "about": [
            {"@type": "Thing", "name": "Stock Analysis"},
            {"@type": "Thing", "name": "Technical Analysis"},
            {"@type": "Thing", "name": "Fundamental Analysis"},
            {"@type": "Thing", "name": "RSI Indicator"},
            {"@type": "Thing", "name": "MACD Indicator"},
            {"@type": "Thing", "name": "PE Ratio"},
            {"@type": "Thing", "name": "Stock Screener"}
        ],
        "mainEntity": {
            "@type": "SoftwareApplication",
            "name": "Stock Analysis Tool"
        },
        "speakable": {
            "@type": "SpeakableSpecification",
            "cssSelector": [".tool-header h1", ".tool-header p", ".ai-summary-content"]
        }
    }
    </script>

    <!-- Link to main styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="footer-styles.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="responsive.css">
    <link rel="stylesheet" href="faq-common.css">

    <style>
        /* ============================================
           AI STOCK ANALYZER - BroBillionaire Theme
           Premium Black & Gold Design
           ============================================ */

        .tool-page {
            min-height: 100vh;
            padding-top: 20px;
            background: var(--bg-primary);
        }

        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-gold);
            color: var(--gold);
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            z-index: 100;
            text-decoration: none;
        }

        .back-btn:hover {
            background: var(--gold);
            color: var(--bg-primary);
            transform: translateX(-5px);
        }

        .tool-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Premium Header */
        .tool-header {
            text-align: center;
            padding: 55px 45px;
            background: linear-gradient(145deg, rgba(18, 18, 18, 0.98), rgba(26, 26, 26, 0.95));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 24px;
            margin-bottom: 32px;
            border: 1px solid rgba(201, 162, 39, 0.2);
            position: relative;
            overflow: hidden;
            box-shadow:
                0 15px 50px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .tool-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gold-gradient);
        }

        .tool-header::after {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: linear-gradient(45deg, transparent 40%, rgba(201, 162, 39, 0.04) 50%, transparent 60%);
            animation: headerShine 6s ease-in-out infinite;
        }

        @keyframes headerShine {

            0%,
            100% {
                transform: translateX(-50%) translateY(-50%) rotate(45deg);
            }

            50% {
                transform: translateX(50%) translateY(50%) rotate(45deg);
            }
        }

        .badge-container {
            display: flex;
            justify-content: center;
            gap: 14px;
            margin-bottom: 22px;
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .premium-badge {
            display: inline-flex;
            align-items: center;
            gap: 7px;
            background: var(--gold-gradient);
            color: var(--bg-primary);
            padding: 9px 18px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 0.78rem;
            letter-spacing: 0.8px;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(201, 162, 39, 0.25);
            transition: all 0.3s ease;
        }

        .premium-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(201, 162, 39, 0.35);
        }

        .premium-badge.ai-badge {
            background: linear-gradient(135deg, #9d4edd 0%, #c77dff 100%);
            color: #fff;
            box-shadow: 0 4px 15px rgba(157, 78, 221, 0.3);
        }

        .premium-badge.ai-badge:hover {
            box-shadow: 0 6px 20px rgba(157, 78, 221, 0.4);
        }

        .premium-badge.live-badge {
            background: linear-gradient(135deg, var(--green) 0%, #5eff9e 100%);
            color: var(--bg-primary);
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.3);
        }

        .premium-badge.live-badge:hover {
            box-shadow: 0 6px 20px rgba(74, 222, 128, 0.4);
        }

        .tool-header h1 {
            font-size: clamp(2.2rem, 5vw, 3.2rem);
            font-weight: 800;
            margin-bottom: 18px;
            position: relative;
            z-index: 1;
            letter-spacing: -0.5px;
        }

        .tool-header h1 .gold-text {
            background: linear-gradient(135deg, var(--gold), #ffd700, var(--gold-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tool-header p {
            font-size: 1.15rem;
            color: var(--text-secondary);
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header-stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 1px solid var(--border-color);
            flex-wrap: wrap;
            position: relative;
            z-index: 1;
        }

        .header-stat {
            text-align: center;
        }

        .header-stat-value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--gold);
            font-family: 'JetBrains Mono', monospace;
        }

        .header-stat-label {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        /* Search Section */
        .search-section {
            background: linear-gradient(145deg, rgba(18, 18, 18, 0.98), rgba(26, 26, 26, 0.95));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 35px;
            border-radius: 20px;
            margin-bottom: 32px;
            border: 1px solid rgba(201, 162, 39, 0.15);
            position: relative;
            overflow: hidden;
            box-shadow:
                0 10px 40px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .search-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gold-gradient);
        }

        .search-section::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(201, 162, 39, 0.08), transparent 60%);
            pointer-events: none;
        }

        .search-box {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            align-items: stretch;
            position: relative;
            z-index: 1;
        }

        .search-input-wrapper {
            flex: 1;
            min-width: 280px;
            position: relative;
            z-index: 100;
        }

        .search-input-wrapper::before {
            content: 'üîç';
            position: absolute;
            left: 22px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.15rem;
            opacity: 0.6;
            pointer-events: none;
            z-index: 2;
        }

        .search-input {
            width: 100%;
            padding: 20px 22px 20px 58px;
            background: rgba(26, 26, 26, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 14px;
            color: var(--text-primary);
            font-size: 1.08rem;
            font-weight: 500;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Inter', sans-serif;
        }

        .search-input:focus {
            border-color: var(--gold);
            outline: none;
            box-shadow: 0 0 35px rgba(201, 162, 39, 0.25), inset 0 0 20px rgba(201, 162, 39, 0.05);
            background: rgba(30, 30, 30, 0.95);
        }

        .search-input::placeholder {
            color: var(--text-muted);
            transition: opacity 0.3s;
        }

        .search-input:focus::placeholder {
            opacity: 0.4;
        }

        .analyze-btn {
            padding: 20px 45px;
            background: var(--gold-gradient);
            color: var(--bg-primary);
            border: none;
            border-radius: 14px;
            font-weight: 800;
            font-size: 1.05rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            box-shadow: 0 8px 25px rgba(201, 162, 39, 0.3);
        }

        .analyze-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s;
        }

        .analyze-btn:hover::before {
            left: 100%;
        }

        .analyze-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 50px rgba(201, 162, 39, 0.45);
        }

        .analyze-btn:active {
            transform: translateY(-2px) scale(0.98);
        }

        /* Autocomplete Dropdown */
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1a1a1a;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 2px solid rgba(201, 162, 39, 0.5);
            border-top: none;
            border-radius: 0 0 14px 14px;
            max-height: 350px;
            overflow-y: auto;
            z-index: 9999;
            display: none;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
        }

        .autocomplete-dropdown.active {
            display: block;
        }

        .autocomplete-item {
            padding: 14px 20px;
            cursor: pointer;
            display: grid;
            grid-template-columns: minmax(80px, auto) 1fr auto;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            transition: all 0.2s ease;
        }

        .autocomplete-item:last-child {
            border-bottom: none;
            border-radius: 0 0 14px 14px;
        }

        .autocomplete-item:hover,
        .autocomplete-item.selected {
            background: rgba(201, 162, 39, 0.2);
            border-left: 3px solid var(--gold);
        }

        .autocomplete-symbol {
            font-weight: 700;
            color: #ffd700;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
            white-space: nowrap;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .autocomplete-name {
            font-size: 0.85rem;
            color: #ffffff;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            min-width: 0;
        }

        .autocomplete-sector {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.9);
            background: rgba(255, 255, 255, 0.15);
            padding: 4px 10px;
            border-radius: 12px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .autocomplete-empty {
            padding: 20px;
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        .stock-count-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: rgba(201, 162, 39, 0.1);
            color: var(--gold);
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .analyze-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .analyze-btn .btn-icon {
            font-size: 1.25rem;
            animation: btnIconPulse 2s ease-in-out infinite;
        }

        @keyframes btnIconPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .quick-stocks {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 22px;
            align-items: center;
            position: relative;
            z-index: 0;
        }

        .quick-stocks-label {
            color: var(--text-tertiary);
            font-size: 0.85rem;
            margin-right: 5px;
            font-weight: 500;
        }

        .quick-stock {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .quick-stock:hover {
            background: var(--gold);
            color: var(--bg-primary);
            border-color: var(--gold);
            transform: translateY(-2px);
        }

        /* Stock Info Header */
        .stock-header {
            background: linear-gradient(145deg, rgba(18, 18, 18, 0.98), rgba(26, 26, 26, 0.95));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 28px 35px;
            margin-bottom: 28px;
            border: 1px solid rgba(201, 162, 39, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .stock-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gold-gradient);
        }

        .stock-header::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(201, 162, 39, 0.1), transparent 70%);
            pointer-events: none;
        }

        .stock-info {
            display: flex;
            align-items: center;
            gap: 22px;
        }

        .stock-logo {
            width: 68px;
            height: 68px;
            background: linear-gradient(145deg, rgba(201, 162, 39, 0.15), rgba(201, 162, 39, 0.05));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--gold), #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            border: 2px solid rgba(201, 162, 39, 0.4);
            box-shadow: 0 8px 25px rgba(201, 162, 39, 0.2);
            position: relative;
        }

        .stock-logo::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 16px;
            background: linear-gradient(145deg, rgba(201, 162, 39, 0.15), rgba(201, 162, 39, 0.05));
            z-index: -1;
        }

        .stock-details h2 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 6px;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            word-break: break-word;
            line-height: 1.3;
        }

        .stock-details .stock-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            color: var(--text-tertiary);
            font-size: 0.8rem;
        }

        .stock-details .stock-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 4px 8px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            white-space: nowrap;
        }

        .stock-price-info {
            text-align: right;
            position: relative;
            z-index: 1;
        }

        .current-price-large {
            font-size: 2.5rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, #fff, #e0e0e0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 20px rgba(255, 255, 255, 0.1);
        }

        .price-change-large {
            font-size: 1.15rem;
            font-weight: 700;
            margin-top: 5px;
        }

        .price-change-large.positive {
            color: var(--green);
        }

        .price-change-large.negative {
            color: var(--red);
        }

        /* Results Grid */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 20px;
            margin-bottom: 25px;
            overflow: visible;
        }

        .analysis-card {
            background: linear-gradient(145deg, rgba(18, 18, 18, 0.95), rgba(26, 26, 26, 0.9));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid rgba(201, 162, 39, 0.15);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: visible;
            box-shadow:
                0 4px 30px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .analysis-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gold-gradient);
            opacity: 0;
            transition: opacity 0.3s;
            border-radius: 20px 20px 0 0;
        }

        .analysis-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 20px;
            pointer-events: none;
            background: conic-gradient(from 0deg,
                    transparent 0deg,
                    rgba(201, 162, 39, 0.1) 60deg,
                    transparent 120deg);
            animation: borderRotate 8s linear infinite;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: -1;
        }

        @keyframes borderRotate {
            100% {
                transform: rotate(360deg);
            }
        }

        .analysis-card:hover {
            border-color: rgba(201, 162, 39, 0.4);
            transform: translateY(-8px) scale(1.01);
            box-shadow:
                0 25px 60px rgba(201, 162, 39, 0.15),
                0 10px 30px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .analysis-card:hover::before {
            opacity: 1;
        }

        .analysis-card:hover::after {
            opacity: 1;
        }

        .analysis-card.full-width {
            grid-column: 1 / -1;
        }

        .analysis-card.span-2 {
            grid-column: span 2;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 14px;
            border-bottom: 1px solid var(--border-color);
            gap: 12px;
            flex-wrap: wrap;
        }

        .card-title {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .card-title .icon {
            font-size: 1rem;
            flex-shrink: 0;
        }

        .card-badge {
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .badge-bullish {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.2), rgba(74, 222, 128, 0.1));
            color: var(--green);
            border: 1px solid rgba(74, 222, 128, 0.4);
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.2);
        }

        .badge-bearish {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
            color: var(--red);
            border: 1px solid rgba(239, 68, 68, 0.4);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.2);
        }

        .badge-neutral {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.2), rgba(201, 162, 39, 0.1));
            color: var(--gold);
            border: 1px solid rgba(201, 162, 39, 0.4);
            box-shadow: 0 4px 15px rgba(201, 162, 39, 0.2);
        }

        /* Signal Card */
        .signal-box {
            text-align: center;
            padding: 35px;
            background: linear-gradient(180deg, rgba(26, 26, 26, 0.95), rgba(18, 18, 18, 0.98));
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        .signal-box::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150%;
            height: 150%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(201, 162, 39, 0.08) 0%, transparent 60%);
            animation: signalPulse 3s ease-in-out infinite;
        }

        @keyframes signalPulse {

            0%,
            100% {
                opacity: 0.5;
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.1);
            }
        }

        .signal-indicator {
            font-size: 4.5rem;
            font-weight: 900;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
            animation: signalBounce 2s ease-in-out infinite;
            font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol", sans-serif;
            line-height: 1;
        }

        @keyframes signalBounce {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .signal-buy {
            color: var(--green);
            text-shadow: 0 0 50px rgba(74, 222, 128, 0.6), 0 0 100px rgba(74, 222, 128, 0.3);
            filter: drop-shadow(0 0 20px rgba(74, 222, 128, 0.4));
        }

        .signal-sell {
            color: var(--red);
            text-shadow: 0 0 50px rgba(239, 68, 68, 0.6), 0 0 100px rgba(239, 68, 68, 0.3);
            filter: drop-shadow(0 0 20px rgba(239, 68, 68, 0.4));
        }

        .signal-hold {
            color: var(--gold);
            text-shadow: 0 0 50px rgba(201, 162, 39, 0.6), 0 0 100px rgba(201, 162, 39, 0.3);
            filter: drop-shadow(0 0 20px rgba(201, 162, 39, 0.4));
        }

        .signal-label {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: 3px;
            position: relative;
            z-index: 1;
            text-transform: uppercase;
        }

        .confidence-bar {
            height: 12px;
            background: rgba(40, 40, 40, 0.6);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 22px;
            position: relative;
            z-index: 1;
            box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .confidence-fill {
            height: 100%;
            border-radius: 8px;
            transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(90deg, #10b981, #34d399, var(--gold), #ffd700);
            box-shadow: 0 0 15px rgba(74, 222, 128, 0.4);
            position: relative;
        }

        .confidence-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: confidenceShimmer 2s infinite;
        }

        @keyframes confidenceShimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .confidence-text {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-size: 0.85rem;
            color: var(--text-tertiary);
            position: relative;
            z-index: 1;
        }

        .confidence-value {
            font-weight: 800;
            font-size: 1rem;
            background: linear-gradient(135deg, var(--gold), #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Metric Grid */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 12px;
        }

        .metric-grid.cols-4 {
            grid-template-columns: repeat(4, minmax(0, 1fr));
        }

        .metric-item {
            background: linear-gradient(145deg, rgba(26, 26, 26, 0.9), rgba(18, 18, 18, 0.95));
            padding: 14px 8px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            min-width: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .metric-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(201, 162, 39, 0.1), transparent);
            transition: left 0.6s;
        }

        .metric-item:hover::before {
            left: 100%;
        }

        .metric-item:hover {
            border-color: rgba(201, 162, 39, 0.4);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(201, 162, 39, 0.1);
        }

        .metric-value {
            font-size: clamp(0.75rem, 2vw, 0.85rem);
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            text-shadow: 0 2px 10px rgba(201, 162, 39, 0.2);
            line-height: 1.3;
            white-space: nowrap;
        }

        .metric-label {
            font-size: clamp(0.55rem, 1.5vw, 0.65rem);
            color: var(--text-tertiary);
            margin-top: 4px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-weight: 600;
            white-space: nowrap;
        }

        .metric-positive {
            color: var(--green) !important;
        }

        .metric-negative {
            color: var(--red) !important;
        }

        /* Gauge */
        .gauge-container {
            position: relative;
            width: 220px;
            height: 150px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .gauge-svg-wrapper {
            position: relative;
            width: 100%;
            height: 110px;
        }

        .gauge-bg {
            fill: none;
            stroke: rgba(40, 40, 40, 0.8);
            stroke-width: 18;
        }

        .gauge-fill {
            fill: none;
            stroke-width: 18;
            stroke-linecap: round;
            transition: stroke-dashoffset 2s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 12px var(--gold)) drop-shadow(0 0 25px rgba(201, 162, 39, 0.4));
        }

        .gauge-value {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.2rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            background: linear-gradient(135deg, var(--gold), #ffd700, var(--gold-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            white-space: nowrap;
        }

        .gauge-label {
            margin-top: 8px;
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
            white-space: nowrap;
        }

        /* Price Targets */
        .price-targets {
            background: linear-gradient(145deg, rgba(26, 26, 26, 0.9), rgba(18, 18, 18, 0.95));
            padding: 16px;
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.03);
            overflow: hidden;
        }

        .target-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            margin: 3px 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            gap: 12px;
        }

        .target-row:hover {
            background: rgba(201, 162, 39, 0.05);
            transform: translateX(3px);
        }

        .target-row:last-child {
            border-bottom: none;
        }

        .target-label {
            color: var(--text-secondary);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            min-width: 110px;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .target-label .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .target-label .dot.green {
            background: var(--green);
            box-shadow: 0 0 8px rgba(74, 222, 128, 0.5);
        }

        .target-label .dot.red {
            background: var(--red);
            box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
        }

        .target-label .dot.gold {
            background: var(--gold);
            box-shadow: 0 0 8px rgba(201, 162, 39, 0.5);
        }

        .target-value {
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: nowrap;
            white-space: nowrap;
        }

        .target-percent {
            font-size: 0.7rem;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 6px;
            min-width: 50px;
            text-align: center;
            flex-shrink: 0;
        }

        .target-upside {
            color: var(--green);
        }

        .target-upside .target-percent {
            background: rgba(74, 222, 128, 0.15);
            color: var(--green);
        }

        .target-downside {
            color: var(--red);
        }

        .target-downside .target-percent {
            background: rgba(239, 68, 68, 0.15);
            color: var(--red);
        }

        .target-current {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.15), rgba(201, 162, 39, 0.05));
            border: 1px solid rgba(201, 162, 39, 0.3);
            margin: 6px 0;
            padding: 14px 16px;
            border-left: 3px solid var(--gold);
        }

        .target-current .target-label,
        .target-current .target-value {
            color: var(--gold);
        }

        /* Technical Indicators */
        .technical-indicators {
            margin-top: 5px;
        }

        .indicator-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            margin: 2px 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            gap: 10px;
        }

        .indicator-row:hover {
            background: rgba(201, 162, 39, 0.03);
            transform: translateX(3px);
        }

        .indicator-row:last-child {
            border-bottom: none;
        }

        .indicator-name {
            color: var(--text-secondary);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .indicator-name .indicator-icon {
            font-size: 0.9rem;
            color: var(--gold);
            opacity: 0.8;
            width: 18px;
            text-align: center;
        }

        .indicator-values {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-shrink: 0;
        }

        .indicator-num {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-tertiary);
            font-size: 0.82rem;
            min-width: 45px;
            text-align: right;
        }

        .indicator-signal {
            padding: 5px 12px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: 700;
            min-width: 70px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .ind-buy {
            background: linear-gradient(135deg, rgba(74, 222, 128, 0.2), rgba(74, 222, 128, 0.1));
            color: var(--green);
            border: 1px solid rgba(74, 222, 128, 0.4);
            box-shadow: 0 2px 8px rgba(74, 222, 128, 0.15);
        }

        .ind-sell {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1));
            color: var(--red);
            border: 1px solid rgba(239, 68, 68, 0.4);
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.15);
        }

        .ind-neutral {
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.2), rgba(201, 162, 39, 0.1));
            color: var(--gold);
            border: 1px solid rgba(201, 162, 39, 0.4);
            box-shadow: 0 2px 8px rgba(201, 162, 39, 0.15);
        }

        /* AI Summary */
        .ai-summary {
            background: linear-gradient(145deg, rgba(18, 18, 18, 0.98), rgba(26, 26, 26, 0.95));
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            padding: 35px;
            border-radius: 20px;
            border: 1px solid rgba(201, 162, 39, 0.3);
            margin-top: 28px;
            position: relative;
            overflow: hidden;
            box-shadow:
                0 15px 50px rgba(201, 162, 39, 0.1),
                0 5px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .ai-summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gold-gradient);
        }

        .ai-summary::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 300px;
            height: 300px;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(201, 162, 39, 0.08), transparent 60%);
            pointer-events: none;
            animation: aiGlow 4s ease-in-out infinite;
        }

        @keyframes aiGlow {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        .ai-summary-header {
            display: flex;
            align-items: center;
            gap: 18px;
            margin-bottom: 22px;
            position: relative;
            z-index: 1;
        }

        .ai-avatar {
            width: 56px;
            height: 56px;
            background: var(--gold-gradient);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            box-shadow: 0 8px 25px rgba(201, 162, 39, 0.3);
            animation: avatarPulse 3s ease-in-out infinite;
        }

        @keyframes avatarPulse {

            0%,
            100% {
                box-shadow: 0 8px 25px rgba(201, 162, 39, 0.3);
            }

            50% {
                box-shadow: 0 8px 35px rgba(201, 162, 39, 0.5);
            }
        }

        .ai-summary h3 {
            background: linear-gradient(135deg, var(--gold), #ffd700, var(--gold-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .ai-summary h3 span {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            font-weight: 500;
            display: block;
            margin-top: 3px;
        }

        .ai-summary-content {
            color: var(--text-secondary);
            line-height: 1.9;
            font-size: 1rem;
        }

        .ai-summary-content .highlight {
            color: var(--gold);
            font-weight: 600;
        }

        .ai-summary-content .positive {
            color: var(--green);
            font-weight: 600;
        }

        .ai-summary-content .negative {
            color: var(--red);
            font-weight: 600;
        }

        /* ============================================
           LEGENDARY INVESTOR INSIGHTS - Premium Feature
           ============================================ */
        .investor-insights-section {
            margin-top: 28px;
            background: linear-gradient(145deg, rgba(18, 18, 18, 0.98), rgba(26, 26, 26, 0.95));
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            padding: 35px;
            border-radius: 20px;
            border: 1px solid rgba(201, 162, 39, 0.3);
            position: relative;
            overflow: hidden;
            box-shadow:
                0 15px 50px rgba(201, 162, 39, 0.1),
                0 5px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }

        .investor-insights-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #c9a227, #ffd700, #c9a227);
        }

        .investor-insights-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 18px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .investor-insights-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .investor-crown {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #c9a227, #ffd700);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            box-shadow: 0 8px 25px rgba(201, 162, 39, 0.3);
        }

        .investor-insights-title h3 {
            background: linear-gradient(135deg, var(--gold), #ffd700, var(--gold-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0;
        }

        .investor-insights-title h3 span {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            font-weight: 500;
            display: block;
            margin-top: 3px;
            -webkit-text-fill-color: var(--text-tertiary);
        }

        .premium-badge-investor {
            background: linear-gradient(135deg, #c9a227, #ffd700);
            color: #000;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 15px rgba(201, 162, 39, 0.4);
        }

        .investor-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
        }

        .investor-chip {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 18px;
            background: linear-gradient(145deg, rgba(40, 40, 40, 0.9), rgba(30, 30, 30, 0.95));
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
        }

        .investor-chip:hover {
            border-color: rgba(201, 162, 39, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(201, 162, 39, 0.15);
        }

        .investor-chip.active {
            background: linear-gradient(145deg, rgba(201, 162, 39, 0.2), rgba(201, 162, 39, 0.1));
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(201, 162, 39, 0.2);
        }

        .investor-chip-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.3), rgba(201, 162, 39, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            border: 2px solid rgba(201, 162, 39, 0.3);
        }

        .investor-chip.active .investor-chip-avatar {
            border-color: var(--gold);
            box-shadow: 0 0 10px rgba(201, 162, 39, 0.5);
        }

        .investor-chip-info {
            display: flex;
            flex-direction: column;
        }

        .investor-chip-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .investor-chip-style {
            font-size: 0.7rem;
            color: var(--text-tertiary);
        }

        .investor-advice-container {
            display: grid;
            gap: 20px;
        }

        .investor-advice-card {
            background: linear-gradient(145deg, rgba(30, 30, 30, 0.9), rgba(20, 20, 20, 0.95));
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 16px;
            padding: 25px;
            position: relative;
            overflow: hidden;
            display: none;
        }

        .investor-advice-card.visible {
            display: block;
            animation: fadeInUp 0.4s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(15px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .investor-advice-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gold-gradient);
        }

        .investor-card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .investor-avatar-large {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(201, 162, 39, 0.3), rgba(201, 162, 39, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            border: 3px solid rgba(201, 162, 39, 0.4);
            box-shadow: 0 8px 25px rgba(201, 162, 39, 0.2);
        }

        .investor-card-info h4 {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--gold);
            margin: 0 0 4px 0;
        }

        .investor-card-info span {
            font-size: 0.8rem;
            color: var(--text-tertiary);
        }

        .investor-verdict {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 18px;
        }

        .investor-verdict.buy {
            background: rgba(74, 222, 128, 0.15);
            color: var(--green);
            border: 1px solid rgba(74, 222, 128, 0.3);
        }

        .investor-verdict.hold {
            background: rgba(201, 162, 39, 0.15);
            color: var(--gold);
            border: 1px solid rgba(201, 162, 39, 0.3);
        }

        .investor-verdict.sell {
            background: rgba(239, 68, 68, 0.15);
            color: var(--red);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .investor-verdict.avoid {
            background: rgba(239, 68, 68, 0.2);
            color: var(--red);
            border: 1px solid rgba(239, 68, 68, 0.4);
        }

        .investor-advice-text {
            color: var(--text-secondary);
            line-height: 1.85;
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        .investor-advice-text strong {
            color: var(--text-primary);
        }

        .investor-advice-text .highlight {
            color: var(--gold);
            font-weight: 600;
        }

        .investor-key-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .investor-metric {
            background: rgba(40, 40, 40, 0.5);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .investor-metric-label {
            font-size: 0.7rem;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .investor-metric-value {
            font-size: 0.9rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .investor-metric-value.positive {
            color: var(--green);
        }

        .investor-metric-value.negative {
            color: var(--red);
        }

        .investor-metric-value.neutral {
            color: var(--gold);
        }

        .investor-quote {
            margin-top: 20px;
            padding: 18px 22px;
            background: linear-gradient(145deg, rgba(201, 162, 39, 0.08), rgba(201, 162, 39, 0.03));
            border-left: 4px solid var(--gold);
            border-radius: 0 12px 12px 0;
            font-style: italic;
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.7;
        }

        .investor-quote::before {
            content: '"';
            font-size: 2rem;
            color: var(--gold);
            font-family: Georgia, serif;
            line-height: 0;
            margin-right: 5px;
            vertical-align: -0.3em;
        }

        .investor-quote cite {
            display: block;
            margin-top: 10px;
            font-style: normal;
            font-size: 0.8rem;
            color: var(--gold);
            font-weight: 600;
        }

        .no-investor-selected {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-tertiary);
        }

        .no-investor-selected i {
            font-size: 3rem;
            color: rgba(201, 162, 39, 0.3);
            margin-bottom: 15px;
        }

        .no-investor-selected p {
            font-size: 0.95rem;
            margin: 0;
        }

        /* Sentiment Bars */
        .sentiment-bars {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .sentiment-row {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sentiment-label {
            width: 70px;
            font-size: 0.8rem;
            color: var(--text-tertiary);
        }

        .sentiment-bar-container {
            flex: 1;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .sentiment-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 1s ease-out;
        }

        .sentiment-bar-fill.positive {
            background: linear-gradient(90deg, var(--green), #5eff9e);
        }

        .sentiment-bar-fill.negative {
            background: linear-gradient(90deg, var(--red), #ff7a7a);
        }

        .sentiment-bar-fill.neutral {
            background: linear-gradient(90deg, var(--gold), var(--gold-light));
        }

        .sentiment-value {
            width: 40px;
            text-align: right;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
        }

        /* Risk Meter */
        .risk-meter {
            display: flex;
            gap: 6px;
            margin-top: 15px;
        }

        .risk-bar {
            flex: 1;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            overflow: hidden;
        }

        .risk-bar.active.low {
            background: var(--green);
        }

        .risk-bar.active.medium {
            background: var(--gold);
        }

        .risk-bar.active.high {
            background: var(--red);
        }

        /* Sector Comparison */
        .sector-comparison {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        .sector-item {
            flex: 1;
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .sector-name {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-bottom: 8px;
        }

        .sector-perf {
            font-size: 1.1rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Mini Chart */
        .mini-chart {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
        }

        .mini-chart-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }



        .candlestick-container {
            display: flex;
            align-items: flex-end;
            justify-content: space-between;
            height: 80px;
            gap: 3px;
        }

        .candle {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .candle-wick {
            width: 2px;
            background: var(--text-muted);
        }

        .candle-body {
            width: 100%;
            min-height: 8px;
            border-radius: 2px;
        }

        .candle.green .candle-body {
            background: var(--green);
        }

        .candle.red .candle-body {
            background: var(--red);
        }

        /* Live News Feed Styles */
        .news-feed-container {
            max-height: 280px;
            overflow-y: auto;
            margin-top: 15px;
            scrollbar-width: thin;
            scrollbar-color: var(--gold) var(--bg-tertiary);
        }

        .news-feed-container::-webkit-scrollbar {
            width: 6px;
        }

        .news-feed-container::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 3px;
        }

        .news-feed-container::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 3px;
        }

        .news-item {
            display: flex;
            gap: 12px;
            padding: 14px;
            background: var(--bg-secondary);
            border-radius: 10px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .news-item:hover {
            border-color: var(--gold);
            transform: translateX(5px);
            background: linear-gradient(135deg, var(--bg-secondary), rgba(201, 162, 39, 0.05));
        }

        .news-sentiment-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .news-sentiment-icon.positive {
            background: rgba(0, 214, 143, 0.15);
            color: var(--green);
        }

        .news-sentiment-icon.negative {
            background: rgba(255, 59, 92, 0.15);
            color: var(--red);
        }

        .news-sentiment-icon.neutral {
            background: rgba(201, 162, 39, 0.15);
            color: var(--gold);
        }

        .news-content {
            flex: 1;
            min-width: 0;
        }

        .news-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.4;
            margin-bottom: 6px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .news-meta {
            display: flex;
            gap: 12px;
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        .news-source {
            color: var(--gold);
            font-weight: 500;
        }

        .news-time {
            color: var(--text-muted);
        }

        .news-loading {
            text-align: center;
            padding: 30px;
            color: var(--text-tertiary);
        }

        .news-loading i {
            color: var(--gold);
            margin-right: 8px;
        }

        .news-source-info {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
            text-align: center;
        }

        .news-source-info small {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        .news-source-info i {
            color: var(--gold);
        }

        .no-news {
            text-align: center;
            padding: 30px;
            color: var(--text-tertiary);
        }

        /* Analyst Consensus Styles */
        .analyst-container {
            margin-top: 15px;
            overflow: visible;
        }

        .analyst-target-main {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .target-price-box {
            flex: 1 1 200px;
            min-width: 180px;
            background: linear-gradient(135deg, var(--bg-secondary), rgba(201, 162, 39, 0.08));
            border: 1px solid var(--border-gold);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .target-price-box .target-label {
            font-size: 0.8rem;
            color: var(--text-tertiary);
            margin-bottom: 8px;
        }

        .target-price-box .target-price {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--gold);
            font-family: 'JetBrains Mono', monospace;
        }

        .target-price-box .target-upside {
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 5px;
        }

        .target-upside.positive {
            color: var(--green);
        }

        .target-upside.negative {
            color: var(--red);
        }

        .target-range {
            flex: 1 1 200px;
            min-width: 180px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .range-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            flex: 1;
        }

        .range-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .range-value {
            font-size: 1rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
            white-space: nowrap;
        }

        .range-value.positive {
            color: var(--green);
        }

        .range-value.negative {
            color: var(--red);
        }

        .analyst-recommendations {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .rec-item {
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
            padding: 12px 15px;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
        }

        .rec-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            opacity: 0.2;
            transition: width 1s ease;
        }

        .rec-bar.buy {
            background: var(--green);
        }

        .rec-bar.hold {
            background: var(--gold);
        }

        .rec-bar.sell {
            background: var(--red);
        }

        .rec-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            z-index: 1;
            width: 50px;
        }

        .rec-count {
            font-size: 1rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-primary);
            z-index: 1;
            margin-left: auto;
        }

        /* Loading Overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 10, 0.97);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading-overlay.active {
            display: flex;
        }

        .loading-overlay::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 500px;
            height: 500px;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(201, 162, 39, 0.1), transparent 60%);
            animation: loadingGlow 3s ease-in-out infinite;
        }

        @keyframes loadingGlow {

            0%,
            100% {
                opacity: 0.5;
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
        }

        .loading-container {
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .ai-brain-container {
            position: relative;
            width: 160px;
            height: 160px;
            margin: 0 auto;
        }

        .ai-brain {
            font-size: 5rem;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation: brainFloat 2.5s ease-in-out infinite;
            filter: drop-shadow(0 0 25px rgba(201, 162, 39, 0.4));
        }

        @keyframes brainFloat {

            0%,
            100% {
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                transform: translate(-50%, -58%) scale(1.05);
            }
        }

        .brain-ring {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 3px solid transparent;
            border-top-color: var(--gold);
            border-radius: 50%;
            animation: brainRing 1s linear infinite;
        }

        .brain-ring:nth-child(2) {
            width: 80%;
            height: 80%;
            top: 10%;
            left: 10%;
            border-top-color: #9d4edd;
            animation-duration: 1.5s;
            animation-direction: reverse;
        }

        .brain-ring:nth-child(3) {
            width: 60%;
            height: 60%;
            top: 20%;
            left: 20%;
            border-top-color: var(--blue);
            animation-duration: 2s;
        }

        @keyframes brainRing {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            margin-top: 28px;
            font-size: 1.4rem;
            background: linear-gradient(135deg, var(--gold), #ffd700, var(--gold-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .loading-subtext {
            margin-top: 10px;
            font-size: 1rem;
            color: var(--text-tertiary);
        }

        .loading-steps {
            margin-top: 35px;
            text-align: left;
            background: linear-gradient(145deg, rgba(26, 26, 26, 0.9), rgba(18, 18, 18, 0.95));
            padding: 22px 28px;
            border-radius: 16px;
            border: 1px solid rgba(201, 162, 39, 0.15);
            backdrop-filter: blur(10px);
        }

        .loading-step {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 12px 0;
            color: var(--text-muted);
            font-size: 0.92rem;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .loading-step.active {
            color: var(--gold);
        }

        .loading-step.completed {
            color: var(--green);
        }

        .step-icon {
            width: 22px;
            height: 22px;
            border: 2px solid currentColor;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .loading-step.completed .step-icon {
            background: var(--green);
            border-color: var(--green);
        }

        .hidden {
            display: none !important;
        }

        /* FAQ Section */
        .faq-section {
            background: var(--bg-card);
            padding: 40px;
            border-radius: 16px;
            margin-top: 40px;
            border: 1px solid var(--border-color);
        }

        .faq-section h2 {
            color: var(--gold);
            margin-bottom: 30px;
            text-align: center;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .faq-item {
            background: var(--bg-secondary);
            margin-bottom: 12px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
        }

        .faq-item:hover {
            border-color: var(--border-gold);
        }

        .faq-question {
            padding: 18px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .faq-question span:first-child {
            flex: 1;
            text-align: left;
        }

        .faq-question:hover {
            background: var(--bg-tertiary);
        }

        .faq-answer {
            padding: 0 20px 20px;
            color: var(--text-secondary);
            line-height: 1.8;
            display: none;
        }

        .faq-item.active .faq-answer {
            display: block;
        }

        .faq-icon {
            transition: transform 0.3s;
            color: var(--gold);
            flex-shrink: 0;
        }

        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }

        /* Share Section */
        .share-section {
            text-align: center;
            margin-top: 25px;
            padding: 30px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border-color);
        }

        .share-section h3 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .share-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .share-btn {
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.95rem;
            min-width: 140px;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .share-btn i {
            font-size: 1.1rem;
        }

        .share-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .share-twitter {
            background: #000;
            color: #fff;
            border: 1px solid #333;
        }

        .share-twitter:hover {
            background: #1a1a1a;
        }

        .share-whatsapp {
            background: #25d366;
            color: #fff;
        }

        .share-whatsapp:hover {
            background: #1ebe5d;
        }

        .share-linkedin {
            background: #0077b5;
            color: #fff;
        }

        .share-linkedin:hover {
            background: #006699;
        }

        .share-copy {
            background: linear-gradient(135deg, var(--gold) 0%, #e6b800 100%);
            color: #000;
            font-weight: 700;
        }

        .share-copy:hover {
            background: linear-gradient(135deg, #e6b800 0%, var(--gold) 100%);
        }

        /* SEBI Disclaimer */
        .disclaimer {
            margin-top: 25px;
            padding: 25px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid rgba(239, 68, 68, 0.3);
            text-align: left;
        }

        .sebi-disclaimer {
            border-left: 4px solid var(--red);
        }

        .disclaimer-header {
            color: var(--red);
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .disclaimer-content p {
            color: var(--text-secondary);
            font-size: 0.85rem;
            line-height: 1.8;
            margin-bottom: 12px;
        }

        .disclaimer-content p:last-child {
            margin-bottom: 0;
        }

        .disclaimer-content strong {
            color: var(--gold);
        }

        .disclaimer-footer {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
            color: var(--text-muted);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Live Data Indicator - Premium */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.7rem;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--bg-primary);
            background: linear-gradient(135deg, var(--green), #2dd4bf);
            padding: 6px 14px;
            border-radius: 20px;
            box-shadow: 0 2px 10px rgba(74, 222, 128, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            animation: liveGlow 2s ease-in-out infinite;
        }

        .live-indicator::before {
            content: '';
            width: 8px;
            height: 8px;
            background: var(--bg-primary);
            border-radius: 50%;
            animation: liveDot 1s infinite;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.3);
        }

        @keyframes liveDot {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(0.8);
            }
        }

        @keyframes liveGlow {

            0%,
            100% {
                box-shadow: 0 2px 10px rgba(74, 222, 128, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }

            50% {
                box-shadow: 0 2px 20px rgba(74, 222, 128, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            }
        }

        /* Simulated Data Indicator */
        .simulated-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 0.7rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            color: var(--orange);
            background: rgba(251, 146, 60, 0.15);
            padding: 6px 14px;
            border-radius: 20px;
            border: 1px solid rgba(251, 146, 60, 0.3);
        }

        /* Data Source Badge */
        .data-source {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-left: 10px;
        }

        .disclaimer p {
            color: var(--text-tertiary);
            font-size: 0.8rem;
            line-height: 1.8;
        }

        .disclaimer strong {
            color: var(--gold);
        }

        /* ============================================
           EXTREMELY RESPONSIVE DESIGN SYSTEM
           Mobile-First, Fluid, Touch-Optimized
           ============================================ */

        /* Base fluid typography and spacing */
        :root {
            --fluid-padding: clamp(12px, 3vw, 35px);
            --fluid-gap: clamp(8px, 2vw, 20px);
            --fluid-radius: clamp(12px, 2vw, 20px);
        }

        /* Large Desktop (1400px+) */
        @media (min-width: 1401px) {
            .tool-container {
                max-width: 1400px;
            }

            .results-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }

        /* Desktop (1200px - 1400px) */
        @media (max-width: 1400px) and (min-width: 1201px) {
            .tool-container {
                padding: 1.5rem;
            }

            .results-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
                gap: 18px;
            }
        }

        /* Responsive: 1200px and below */
        @media (max-width: 1200px) {
            .tool-container {
                padding: 1.25rem;
            }

            .results-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 16px;
            }

            .analysis-card.span-2 {
                grid-column: span 2;
            }

            .metric-grid.cols-4 {
                grid-template-columns: repeat(2, 1fr);
            }

            .tool-header {
                padding: 45px 35px;
            }

            .tool-header h1 {
                font-size: 2.5rem;
            }

            .analyst-target-main {
                flex-direction: column;
            }

            .target-range {
                flex-direction: row;
            }

            .range-item {
                flex: 1;
            }

            .investor-selector {
                justify-content: flex-start;
            }

            .investor-chip {
                flex: 0 1 auto;
            }
        }

        /* Tablet Landscape (992px) */
        @media (max-width: 992px) {
            .tool-container {
                padding: 1rem;
            }

            .tool-header {
                padding: 40px 25px;
            }

            .tool-header h1 {
                font-size: 2.2rem;
            }

            .tool-header p {
                font-size: 1.05rem;
            }

            .target-label {
                font-size: 0.8rem;
                min-width: 100px;
            }

            .target-value {
                font-size: 0.9rem;
            }

            .indicator-row {
                flex-wrap: wrap;
                gap: 8px;
            }

            .indicator-values {
                width: 100%;
                justify-content: flex-end;
            }

            .header-stats {
                gap: 25px;
            }

            .header-stat-value {
                font-size: 1.4rem;
            }

            .search-section {
                padding: 25px;
            }

            .search-input {
                padding: 18px 20px 18px 55px;
            }

            .analyze-btn {
                padding: 18px 35px;
            }

            .back-btn {
                padding: 8px 16px;
                font-size: 0.85rem;
            }

            .ai-summary {
                padding: 30px 25px;
            }

            .ai-avatar {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }

            .investor-insights-section {
                padding: 30px 25px;
            }

            .investor-crown {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }

            .analysis-card {
                padding: 22px;
            }

            .card-header {
                margin-bottom: 15px;
                padding-bottom: 12px;
            }
        }

        /* Tablet Portrait (768px) - Major Breakpoint */
        @media (max-width: 768px) {
            .tool-page {
                padding-top: 60px;
            }

            .tool-container {
                padding: 12px;
            }

            /* Header */
            .tool-header {
                padding: 30px 18px;
                border-radius: 16px;
                margin-bottom: 20px;
            }

            .tool-header h1 {
                font-size: 1.6rem;
                line-height: 1.2;
            }

            .tool-header p {
                font-size: 0.95rem;
                padding: 0 10px;
            }

            .badge-container {
                gap: 8px;
                margin-bottom: 16px;
            }

            .premium-badge {
                padding: 7px 12px;
                font-size: 0.68rem;
                letter-spacing: 0.5px;
            }

            .header-stats {
                flex-direction: row;
                gap: 12px;
                flex-wrap: wrap;
                justify-content: center;
                margin-top: 20px;
                padding-top: 18px;
            }

            .header-stat {
                min-width: 55px;
                flex: 0 0 auto;
            }

            .header-stat-value {
                font-size: 1.2rem;
            }

            .header-stat-label {
                font-size: 0.6rem;
                letter-spacing: 0.5px;
            }

            /* Search Section */
            .search-section {
                padding: 16px;
                border-radius: 14px;
                margin-bottom: 20px;
            }

            .search-box {
                flex-direction: column;
                gap: 12px;
            }

            .search-input-wrapper {
                min-width: 100%;
                width: 100%;
            }

            .search-input-wrapper::before {
                left: 18px;
                font-size: 1rem;
            }

            .search-input {
                padding: 16px 16px 16px 48px;
                font-size: 1rem;
                border-radius: 12px;
            }

            .analyze-btn {
                width: 100%;
                justify-content: center;
                padding: 16px 24px;
                font-size: 0.95rem;
                border-radius: 12px;
            }

            .analyze-btn .btn-icon {
                font-size: 1.1rem;
            }

            .quick-stocks {
                gap: 8px;
                margin-top: 16px;
                justify-content: center;
            }

            .quick-stocks-label {
                width: 100%;
                text-align: center;
                margin-bottom: 4px;
                margin-right: 0;
            }

            .quick-stock {
                padding: 7px 12px;
                font-size: 0.75rem;
                border-radius: 6px;
            }

            .stock-count-badge {
                font-size: 0.7rem;
            }

            /* Results Grid */
            .results-grid {
                grid-template-columns: 1fr;
                gap: 14px;
            }

            .analysis-card {
                padding: 18px;
                border-radius: 14px;
            }

            .analysis-card.span-2 {
                grid-column: span 1;
            }

            .card-header {
                margin-bottom: 14px;
                padding-bottom: 12px;
                gap: 10px;
            }

            .card-title {
                font-size: 0.9rem;
            }

            .card-title .icon {
                font-size: 0.9rem;
            }

            .card-badge {
                padding: 4px 8px;
                font-size: 0.65rem;
            }

            /* Metrics */
            .metric-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
                gap: 10px;
            }

            .metric-grid.cols-4 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .metric-item {
                padding: 12px 8px;
                border-radius: 10px;
            }

            .metric-value {
                font-size: 0.8rem;
            }

            .metric-label {
                font-size: 0.58rem;
                letter-spacing: 0.3px;
                margin-top: 3px;
            }

            /* Stock Header */
            .stock-header {
                flex-direction: column;
                text-align: center;
                padding: 18px;
                gap: 14px;
                border-radius: 14px;
                margin-bottom: 20px;
            }

            .stock-info {
                flex-direction: column;
                text-align: center;
                gap: 14px;
            }

            .stock-logo {
                width: 56px;
                height: 56px;
                font-size: 1.3rem;
                border-radius: 12px;
            }

            .stock-details h2 {
                font-size: 1.25rem;
                margin-bottom: 8px;
            }

            .stock-details .stock-meta {
                justify-content: center;
                gap: 8px;
            }

            .stock-details .stock-meta span {
                padding: 3px 6px;
                font-size: 0.7rem;
            }

            .stock-price-info {
                text-align: center;
            }

            .current-price-large {
                font-size: 1.9rem;
            }

            .price-change-large {
                font-size: 1rem;
            }

            /* Signal Box */
            .signal-box {
                padding: 25px 20px;
            }

            .signal-indicator {
                font-size: 3.2rem;
            }

            .signal-label {
                font-size: 1.15rem;
                letter-spacing: 2px;
            }

            .confidence-bar {
                height: 10px;
                margin-top: 18px;
            }

            .confidence-text {
                margin-top: 10px;
                font-size: 0.8rem;
            }

            .confidence-value {
                font-size: 0.9rem;
            }

            /* Gauge */
            .gauge-container {
                width: 170px;
                height: 125px;
            }

            .gauge-value {
                font-size: 1.7rem;
            }

            .gauge-label {
                font-size: 0.58rem;
                letter-spacing: 1px;
            }

            /* Price Targets */
            .price-targets {
                padding: 12px;
            }

            .target-row {
                padding: 12px 14px;
                gap: 10px;
            }

            .target-current {
                padding: 12px 14px;
            }

            .target-label {
                font-size: 0.78rem;
                min-width: 85px;
                gap: 6px;
            }

            .target-label .dot {
                width: 8px;
                height: 8px;
            }

            .target-value {
                font-size: 0.88rem;
                gap: 6px;
            }

            .target-percent {
                font-size: 0.62rem;
                min-width: 42px;
                padding: 2px 6px;
            }

            /* Technical Indicators */
            .indicator-row {
                padding: 11px 10px;
                border-radius: 8px;
            }

            .indicator-name {
                font-size: 0.8rem;
            }

            .indicator-name .indicator-icon {
                width: 16px;
                font-size: 0.85rem;
            }

            .indicator-num {
                font-size: 0.78rem;
                min-width: 40px;
            }

            .indicator-signal {
                font-size: 0.65rem;
                padding: 4px 8px;
                min-width: 60px;
            }

            /* Autocomplete */
            .autocomplete-dropdown {
                max-height: 280px;
                border-radius: 0 0 12px 12px;
            }

            .autocomplete-item {
                padding: 12px 14px;
                gap: 10px;
                grid-template-columns: minmax(70px, auto) 1fr auto;
            }

            .autocomplete-symbol {
                font-size: 0.85rem;
            }

            .autocomplete-name {
                font-size: 0.78rem;
            }

            .autocomplete-sector {
                font-size: 0.62rem;
                padding: 3px 7px;
            }

            /* AI Summary */
            .ai-summary {
                padding: 22px 16px;
                border-radius: 14px;
                margin-top: 20px;
            }

            .ai-summary-header {
                gap: 14px;
                margin-bottom: 16px;
            }

            .ai-avatar {
                width: 46px;
                height: 46px;
                font-size: 1.3rem;
                border-radius: 10px;
            }

            .ai-summary h3 {
                font-size: 1.1rem;
            }

            .ai-summary h3 span {
                font-size: 0.7rem;
            }

            .ai-summary-content {
                font-size: 0.92rem;
                line-height: 1.8;
            }

            /* Investor Insights */
            .investor-insights-section {
                padding: 22px 16px;
                border-radius: 14px;
                margin-top: 20px;
            }

            .investor-insights-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .investor-crown {
                width: 46px;
                height: 46px;
                font-size: 1.3rem;
                border-radius: 10px;
            }

            .investor-insights-title h3 {
                font-size: 1.1rem;
            }

            .investor-selector {
                gap: 8px;
                overflow-x: auto;
                padding-bottom: 8px;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
            }

            .investor-selector::-webkit-scrollbar {
                display: none;
            }

            .investor-chip {
                padding: 10px 14px;
                flex-shrink: 0;
            }

            .investor-chip-avatar {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }

            .investor-chip-name {
                font-size: 0.82rem;
            }

            .investor-chip-style {
                font-size: 0.65rem;
            }

            .investor-advice-card {
                padding: 18px 14px;
            }

            .investor-key-metrics {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            /* Sentiment Bars */
            .sentiment-bars {
                gap: 8px;
                margin-top: 12px;
            }

            .sentiment-row {
                gap: 10px;
            }

            .sentiment-label {
                width: 60px;
                font-size: 0.75rem;
            }

            .sentiment-bar-container {
                height: 7px;
            }

            .sentiment-value {
                width: 38px;
                font-size: 0.8rem;
            }

            /* Sector Comparison */
            .sector-comparison {
                flex-wrap: wrap;
                gap: 8px;
            }

            .sector-item {
                min-width: calc(50% - 4px);
                padding: 12px 10px;
                border-radius: 8px;
            }

            .sector-name {
                font-size: 0.7rem;
            }

            .sector-perf {
                font-size: 1rem;
            }

            /* Analyst Section */
            .analyst-container {
                margin-top: 12px;
            }

            .analyst-target-main {
                flex-direction: column;
                gap: 14px;
                margin-bottom: 16px;
            }

            .target-price-box {
                padding: 16px;
                border-radius: 10px;
            }

            .target-price-box .target-label {
                font-size: 0.75rem;
            }

            .target-price-box .target-price {
                font-size: 1.5rem;
            }

            .target-price-box .target-upside {
                font-size: 0.85rem;
            }

            .target-range {
                gap: 8px;
            }

            .range-item {
                padding: 12px;
                border-radius: 8px;
            }

            .range-label {
                font-size: 0.8rem;
            }

            .range-value {
                font-size: 0.92rem;
            }

            .rec-item {
                padding: 10px 12px;
                border-radius: 6px;
            }

            .rec-label {
                font-size: 0.8rem;
                width: 45px;
            }

            .rec-count {
                font-size: 0.92rem;
            }

            /* News Feed */
            .news-feed-container {
                max-height: 260px;
                margin-top: 12px;
            }

            .news-item {
                flex-direction: column;
                gap: 10px;
                padding: 12px;
                border-radius: 8px;
            }

            .news-sentiment-icon {
                width: 36px;
                height: 36px;
                font-size: 1.1rem;
            }

            .news-title {
                font-size: 0.85rem;
            }

            .news-meta {
                font-size: 0.7rem;
                gap: 10px;
            }

            .news-source-info small {
                font-size: 0.7rem;
            }

            /* Mini Chart */
            .mini-chart {
                padding: 16px;
                border-radius: 10px;
            }

            .candlestick-container {
                height: 65px;
                gap: 2px;
            }

            /* FAQ Section */
            .faq-section {
                padding: 22px 14px;
                border-radius: 12px;
                margin-top: 25px;
            }

            .faq-section h2 {
                font-size: 1.4rem;
                margin-bottom: 20px;
            }

            .faq-item {
                border-radius: 10px;
            }

            .faq-question {
                padding: 14px 16px;
                font-size: 0.9rem;
            }

            .faq-answer {
                padding: 0 16px 16px;
                font-size: 0.88rem;
            }

            /* Share Section */
            .share-section {
                padding: 22px 16px;
                border-radius: 12px;
            }

            .share-section h3 {
                font-size: 1.1rem;
            }

            .share-buttons {
                gap: 10px;
                margin-top: 16px;
            }

            .share-btn {
                padding: 12px 18px;
                font-size: 0.82rem;
                min-width: 110px;
                border-radius: 10px;
            }

            .share-btn i {
                font-size: 1rem;
            }

            /* Disclaimer */
            .disclaimer {
                padding: 18px 16px;
                border-radius: 12px;
            }

            .disclaimer-header {
                font-size: 1rem;
                margin-bottom: 14px;
                padding-bottom: 12px;
            }

            .disclaimer-content p {
                font-size: 0.8rem;
            }

            .disclaimer-footer {
                font-size: 0.75rem;
            }

            /* Back Button */
            .back-btn {
                padding: 8px 14px;
                font-size: 0.78rem;
                top: 12px;
                left: 12px;
                border-radius: 25px;
            }

            .back-btn i {
                font-size: 0.7rem;
            }

            /* Loading Overlay */
            .loading-container {
                padding: 0 20px;
            }

            .ai-brain-container {
                width: 130px;
                height: 130px;
            }

            .ai-brain {
                font-size: 4rem;
            }

            .loading-text {
                font-size: 1.2rem;
                margin-top: 22px;
            }

            .loading-subtext {
                font-size: 0.9rem;
            }

            .loading-steps {
                padding: 18px 20px;
                margin-top: 25px;
            }

            .loading-step {
                font-size: 0.85rem;
                padding: 10px 0;
            }

            .step-icon {
                width: 20px;
                height: 20px;
            }
        }

        /* Large Mobile (576px - 768px) */
        @media (max-width: 576px) {
            .tool-page {
                padding-top: 55px;
            }

            .tool-container {
                padding: 10px;
            }

            .tool-header {
                padding: 25px 14px;
            }

            .tool-header h1 {
                font-size: 1.45rem;
            }

            .tool-header p {
                font-size: 0.88rem;
            }

            .badge-container {
                gap: 6px;
            }

            .premium-badge {
                padding: 5px 10px;
                font-size: 0.62rem;
                gap: 5px;
            }

            .premium-badge i {
                font-size: 0.7rem;
            }

            .header-stats {
                gap: 10px;
            }

            .header-stat {
                min-width: 50px;
            }

            .header-stat-value {
                font-size: 1.1rem;
            }

            .header-stat-label {
                font-size: 0.55rem;
            }

            .search-section {
                padding: 14px;
            }

            .search-input {
                padding: 14px 14px 14px 44px;
                font-size: 0.95rem;
            }

            .search-input-wrapper::before {
                left: 16px;
                font-size: 0.95rem;
            }

            .analyze-btn {
                padding: 14px 20px;
                font-size: 0.9rem;
            }

            .quick-stock {
                padding: 6px 10px;
                font-size: 0.7rem;
            }

            .quick-stocks-label {
                font-size: 0.75rem;
            }

            .results-grid {
                gap: 12px;
            }

            .analysis-card {
                padding: 16px;
            }

            .stock-header {
                padding: 16px;
            }

            .stock-logo {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .stock-details h2 {
                font-size: 1.15rem;
            }

            .current-price-large {
                font-size: 1.7rem;
            }

            .price-change-large {
                font-size: 0.95rem;
            }

            .signal-box {
                padding: 22px 16px;
            }

            .signal-indicator {
                font-size: 2.8rem;
            }

            .signal-label {
                font-size: 1.05rem;
            }

            .gauge-container {
                width: 155px;
                height: 115px;
            }

            .gauge-value {
                font-size: 1.5rem;
            }

            .metric-item {
                padding: 10px 6px;
            }

            .metric-value {
                font-size: 0.72rem;
            }

            .metric-label {
                font-size: 0.52rem;
            }

            .ai-summary {
                padding: 18px 14px;
            }

            .ai-avatar {
                width: 42px;
                height: 42px;
                font-size: 1.2rem;
            }

            .ai-summary h3 {
                font-size: 1rem;
            }

            .ai-summary-content {
                font-size: 0.88rem;
            }

            .investor-insights-section {
                padding: 18px 14px;
            }

            .investor-crown {
                width: 42px;
                height: 42px;
                font-size: 1.2rem;
            }
        }

        /* Mobile (480px) */
        @media (max-width: 480px) {
            .tool-page {
                padding-top: 50px;
            }

            .tool-container {
                padding: 8px;
            }

            .tool-header {
                padding: 22px 12px;
                border-radius: 12px;
            }

            .tool-header h1 {
                font-size: 1.3rem;
            }

            .tool-header p {
                font-size: 0.82rem;
            }

            .badge-container {
                gap: 5px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .premium-badge {
                padding: 5px 8px;
                font-size: 0.58rem;
            }

            .header-stats {
                gap: 8px;
                padding-top: 14px;
                margin-top: 16px;
            }

            .header-stat {
                min-width: 48px;
            }

            .header-stat-value {
                font-size: 1rem;
            }

            .header-stat-label {
                font-size: 0.5rem;
            }

            .search-section {
                padding: 12px;
                border-radius: 12px;
            }

            .search-input {
                padding: 13px 12px 13px 42px;
                font-size: 0.9rem;
                border-radius: 10px;
            }

            .search-input-wrapper::before {
                left: 14px;
                font-size: 0.9rem;
            }

            .analyze-btn {
                padding: 13px 18px;
                font-size: 0.85rem;
                border-radius: 10px;
            }

            .quick-stocks {
                gap: 6px;
            }

            .quick-stock {
                padding: 5px 9px;
                font-size: 0.68rem;
            }

            .stock-count-badge {
                font-size: 0.65rem;
                padding: 3px 8px;
            }

            .results-grid {
                gap: 10px;
            }

            .analysis-card {
                padding: 14px;
                border-radius: 12px;
            }

            .card-header {
                margin-bottom: 12px;
                padding-bottom: 10px;
            }

            .card-title {
                font-size: 0.85rem;
            }

            .card-badge {
                padding: 3px 7px;
                font-size: 0.6rem;
            }

            .stock-header {
                padding: 14px;
                border-radius: 12px;
                margin-bottom: 14px;
            }

            .stock-logo {
                width: 46px;
                height: 46px;
                font-size: 1.1rem;
                border-radius: 10px;
            }

            .stock-details h2 {
                font-size: 1.1rem;
            }

            .stock-details .stock-meta span {
                padding: 2px 5px;
                font-size: 0.65rem;
            }

            .current-price-large {
                font-size: 1.55rem;
            }

            .price-change-large {
                font-size: 0.9rem;
            }

            .signal-box {
                padding: 20px 14px;
                border-radius: 12px;
            }

            .signal-indicator {
                font-size: 2.5rem;
            }

            .signal-label {
                font-size: 0.95rem;
                letter-spacing: 1.5px;
            }

            .confidence-bar {
                height: 8px;
                margin-top: 14px;
            }

            .confidence-text {
                font-size: 0.75rem;
            }

            .confidence-value {
                font-size: 0.85rem;
            }

            .gauge-container {
                width: 145px;
                height: 108px;
            }

            .gauge-value {
                font-size: 1.4rem;
            }

            .gauge-label {
                font-size: 0.55rem;
                letter-spacing: 0.8px;
            }

            .metric-grid {
                gap: 8px;
            }

            .metric-item {
                padding: 9px 5px;
                border-radius: 8px;
            }

            .metric-value {
                font-size: 0.68rem;
            }

            .metric-label {
                font-size: 0.48rem;
                margin-top: 2px;
            }

            .target-row {
                padding: 10px 12px;
            }

            .target-label {
                font-size: 0.72rem;
                min-width: 78px;
            }

            .target-value {
                font-size: 0.82rem;
            }

            .target-percent {
                font-size: 0.58rem;
                min-width: 38px;
            }

            .indicator-row {
                padding: 10px 8px;
            }

            .indicator-name {
                font-size: 0.75rem;
            }

            .indicator-num {
                font-size: 0.72rem;
            }

            .indicator-signal {
                font-size: 0.6rem;
                padding: 3px 6px;
                min-width: 52px;
            }

            .autocomplete-item {
                padding: 10px 12px;
                grid-template-columns: minmax(60px, auto) 1fr auto;
            }

            .autocomplete-symbol {
                font-size: 0.8rem;
            }

            .autocomplete-name {
                font-size: 0.72rem;
            }

            .autocomplete-sector {
                font-size: 0.58rem;
                padding: 2px 6px;
            }

            .sentiment-row {
                gap: 8px;
            }

            .sentiment-label {
                width: 55px;
                font-size: 0.7rem;
            }

            .sentiment-value {
                font-size: 0.75rem;
            }

            .sector-item {
                min-width: calc(50% - 3px);
                padding: 10px 8px;
            }

            .sector-name {
                font-size: 0.65rem;
            }

            .sector-perf {
                font-size: 0.92rem;
            }

            .target-price-box {
                padding: 14px;
            }

            .target-price-box .target-price {
                font-size: 1.35rem;
            }

            .range-item {
                padding: 10px;
            }

            .range-label {
                font-size: 0.75rem;
            }

            .range-value {
                font-size: 0.88rem;
            }

            .news-item {
                padding: 10px;
            }

            .news-sentiment-icon {
                width: 32px;
                height: 32px;
                font-size: 1rem;
            }

            .news-title {
                font-size: 0.8rem;
            }

            .ai-summary {
                padding: 16px 12px;
            }

            .ai-avatar {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }

            .ai-summary h3 {
                font-size: 0.95rem;
            }

            .ai-summary h3 span {
                font-size: 0.65rem;
            }

            .ai-summary-content {
                font-size: 0.85rem;
                line-height: 1.75;
            }

            .investor-insights-section {
                padding: 16px 12px;
            }

            .investor-chip {
                padding: 8px 10px;
            }

            .investor-chip-avatar {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }

            .investor-chip-name {
                font-size: 0.75rem;
            }

            .investor-chip-style {
                font-size: 0.6rem;
            }

            .investor-advice-card {
                padding: 14px 12px;
            }

            .faq-section {
                padding: 18px 12px;
            }

            .faq-section h2 {
                font-size: 1.25rem;
            }

            .faq-question {
                padding: 12px 14px;
                font-size: 0.85rem;
            }

            .faq-answer {
                font-size: 0.82rem;
            }

            .share-section {
                padding: 18px 12px;
            }

            .share-section h3 {
                font-size: 1rem;
            }

            .share-buttons {
                gap: 8px;
                flex-wrap: wrap;
            }

            .share-btn {
                padding: 10px 14px;
                font-size: 0.78rem;
                min-width: 100px;
                flex: 1 1 calc(50% - 4px);
            }

            .disclaimer {
                padding: 14px 12px;
            }

            .disclaimer-header {
                font-size: 0.92rem;
            }

            .disclaimer-content p {
                font-size: 0.75rem;
            }

            .back-btn {
                padding: 7px 12px;
                font-size: 0.72rem;
                top: 10px;
                left: 10px;
            }

            .loading-container {
                padding: 0 15px;
            }

            .ai-brain-container {
                width: 110px;
                height: 110px;
            }

            .ai-brain {
                font-size: 3.2rem;
            }

            .loading-text {
                font-size: 1.1rem;
            }

            .loading-subtext {
                font-size: 0.85rem;
            }

            .loading-steps {
                padding: 15px 16px;
            }

            .loading-step {
                font-size: 0.8rem;
            }
        }

        /* Small Mobile (380px) */
        @media (max-width: 380px) {
            .tool-container {
                padding: 6px;
            }

            .tool-header {
                padding: 18px 10px;
            }

            .tool-header h1 {
                font-size: 1.2rem;
            }

            .tool-header p {
                font-size: 0.78rem;
            }

            .premium-badge {
                padding: 4px 7px;
                font-size: 0.55rem;
            }

            .header-stat-value {
                font-size: 0.95rem;
            }

            .header-stat-label {
                font-size: 0.48rem;
            }

            .search-section {
                padding: 10px;
            }

            .search-input {
                padding: 12px 10px 12px 38px;
                font-size: 0.85rem;
            }

            .analyze-btn {
                padding: 12px 15px;
                font-size: 0.8rem;
            }

            .quick-stock {
                padding: 4px 7px;
                font-size: 0.62rem;
            }

            .analysis-card {
                padding: 12px;
            }

            .card-title {
                font-size: 0.8rem;
            }

            .card-badge {
                font-size: 0.55rem;
            }

            .stock-header {
                padding: 12px;
            }

            .stock-logo {
                width: 42px;
                height: 42px;
                font-size: 1rem;
            }

            .stock-details h2 {
                font-size: 1rem;
            }

            .current-price-large {
                font-size: 1.4rem;
            }

            .price-change-large {
                font-size: 0.85rem;
            }

            .signal-indicator {
                font-size: 2.2rem;
            }

            .signal-label {
                font-size: 0.88rem;
            }

            .gauge-container {
                width: 135px;
                height: 100px;
            }

            .gauge-value {
                font-size: 1.3rem;
            }

            .metric-grid {
                gap: 6px;
            }

            .metric-item {
                padding: 8px 4px;
            }

            .metric-value {
                font-size: 0.62rem;
            }

            .metric-label {
                font-size: 0.45rem;
            }

            .target-label {
                min-width: 70px;
                font-size: 0.68rem;
            }

            .target-value {
                font-size: 0.78rem;
            }

            .target-percent {
                font-size: 0.55rem;
                min-width: 35px;
            }

            .indicator-name {
                font-size: 0.7rem;
            }

            .indicator-signal {
                font-size: 0.55rem;
                min-width: 48px;
            }

            .ai-summary {
                padding: 14px 10px;
            }

            .ai-summary-content {
                font-size: 0.8rem;
            }

            .share-btn {
                padding: 9px 12px;
                font-size: 0.72rem;
                min-width: 90px;
            }

            .back-btn {
                padding: 6px 10px;
                font-size: 0.68rem;
            }
        }

        /* Extra Small Mobile (320px) */
        @media (max-width: 320px) {
            .tool-container {
                padding: 5px;
            }

            .tool-header {
                padding: 15px 8px;
            }

            .tool-header h1 {
                font-size: 1.1rem;
            }

            .badge-container {
                gap: 4px;
            }

            .premium-badge {
                padding: 3px 6px;
                font-size: 0.5rem;
            }

            .header-stats {
                gap: 6px;
            }

            .header-stat {
                min-width: 42px;
            }

            .header-stat-value {
                font-size: 0.88rem;
            }

            .search-input {
                font-size: 0.8rem;
            }

            .analyze-btn {
                font-size: 0.75rem;
            }

            .quick-stock {
                padding: 3px 6px;
                font-size: 0.58rem;
            }

            .analysis-card {
                padding: 10px;
            }

            .stock-details h2 {
                font-size: 0.95rem;
            }

            .current-price-large {
                font-size: 1.3rem;
            }

            .signal-indicator {
                font-size: 2rem;
            }

            .signal-label {
                font-size: 0.82rem;
            }

            .gauge-container {
                width: 125px;
                height: 92px;
            }

            .gauge-value {
                font-size: 1.2rem;
            }

            .metric-value {
                font-size: 0.58rem;
            }

            .metric-label {
                font-size: 0.42rem;
            }
        }

        /* Landscape Mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .tool-page {
                padding-top: 10px;
            }

            .tool-header {
                padding: 20px 25px;
            }

            .loading-overlay {
                padding: 20px;
            }

            .ai-brain-container {
                width: 80px;
                height: 80px;
            }

            .ai-brain {
                font-size: 2.5rem;
            }

            .loading-text {
                font-size: 1rem;
                margin-top: 15px;
            }

            .loading-steps {
                margin-top: 15px;
                padding: 12px 15px;
            }

            .loading-step {
                padding: 6px 0;
                font-size: 0.75rem;
            }
        }

        /* High DPI / Retina Adjustments */
        @media (-webkit-min-device-pixel-ratio: 2),
        (min-resolution: 192dpi) {
            .gauge-fill {
                stroke-width: 17;
            }

            .gauge-bg {
                stroke-width: 17;
            }
        }

        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {

            .quick-stock,
            .analyze-btn,
            .investor-chip,
            .share-btn,
            .faq-question,
            .autocomplete-item,
            .news-item {
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .quick-stock {
                min-height: 36px;
            }

            .target-row,
            .indicator-row {
                min-height: 48px;
            }

            /* Remove hover effects on touch devices */
            .analysis-card:hover {
                transform: none;
            }

            .metric-item:hover {
                transform: none;
            }
        }

        /* Print Styles */
        @media print {

            .back-btn,
            .share-section,
            .loading-overlay,
            .analyze-btn,
            .quick-stocks {
                display: none !important;
            }

            .tool-page {
                padding-top: 0;
            }

            .analysis-card {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }

        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {

            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-tertiary);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gold);
        }

        /* ============================================
           PREMIUM TOOLTIP SYSTEM
           Beautiful hover explanations
           ============================================ */

        [data-tooltip] {
            position: relative;
        }

        /* Only show help cursor on non-interactive tooltip elements */
        [data-tooltip]:not(button):not(.analyze-btn):not(.quick-stock):not(.search-input-wrapper) {
            cursor: help;
        }

        /* Ensure interactive elements keep their cursor */
        button[data-tooltip],
        .analyze-btn[data-tooltip],
        .quick-stock[data-tooltip] {
            cursor: pointer !important;
        }

        [data-tooltip]::before,
        [data-tooltip]::after {
            position: absolute;
            visibility: hidden;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 10000;
        }

        /* Tooltip arrow */
        [data-tooltip]::before {
            content: '';
            border: 8px solid transparent;
            border-top-color: rgba(26, 26, 26, 0.98);
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(8px);
        }

        /* Tooltip content box */
        [data-tooltip]::after {
            content: attr(data-tooltip);
            bottom: calc(100% + 12px);
            left: 50%;
            transform: translateX(-50%) translateY(8px);
            background: linear-gradient(145deg, rgba(26, 26, 26, 0.98), rgba(18, 18, 18, 0.98));
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(201, 162, 39, 0.4);
            border-radius: 12px;
            padding: 14px 18px;
            width: max-content;
            max-width: 320px;
            font-size: 0.85rem;
            font-weight: 400;
            line-height: 1.6;
            color: #e0e0e0;
            text-align: left;
            white-space: normal;
            box-shadow:
                0 20px 50px rgba(0, 0, 0, 0.5),
                0 10px 25px rgba(201, 162, 39, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.2px;
        }

        /* Show tooltip on hover */
        [data-tooltip]:hover::before,
        [data-tooltip]:hover::after {
            visibility: visible;
            opacity: 1;
        }

        [data-tooltip]:hover::before {
            transform: translateX(-50%) translateY(0);
        }

        [data-tooltip]:hover::after {
            transform: translateX(-50%) translateY(0);
        }

        /* Tooltip positioned to bottom */
        [data-tooltip-pos="bottom"]::before {
            border-top-color: transparent;
            border-bottom-color: rgba(26, 26, 26, 0.98);
            bottom: auto;
            top: 100%;
            transform: translateX(-50%) translateY(-8px);
        }

        [data-tooltip-pos="bottom"]::after {
            bottom: auto;
            top: calc(100% + 12px);
            transform: translateX(-50%) translateY(-8px);
        }

        [data-tooltip-pos="bottom"]:hover::before,
        [data-tooltip-pos="bottom"]:hover::after {
            transform: translateX(-50%) translateY(0);
        }

        /* Tooltip positioned to left */
        [data-tooltip-pos="left"]::before {
            border-top-color: transparent;
            border-left-color: rgba(26, 26, 26, 0.98);
            bottom: auto;
            top: 50%;
            left: auto;
            right: 100%;
            transform: translateY(-50%) translateX(8px);
        }

        [data-tooltip-pos="left"]::after {
            bottom: auto;
            left: auto;
            top: 50%;
            right: calc(100% + 12px);
            transform: translateY(-50%) translateX(8px);
        }

        [data-tooltip-pos="left"]:hover::before,
        [data-tooltip-pos="left"]:hover::after {
            transform: translateY(-50%) translateX(0);
        }

        /* Tooltip positioned to right */
        [data-tooltip-pos="right"]::before {
            border-top-color: transparent;
            border-right-color: rgba(26, 26, 26, 0.98);
            bottom: auto;
            top: 50%;
            left: 100%;
            right: auto;
            transform: translateY(-50%) translateX(-8px);
        }

        [data-tooltip-pos="right"]::after {
            bottom: auto;
            left: calc(100% + 12px);
            top: 50%;
            right: auto;
            transform: translateY(-50%) translateX(-8px);
        }

        [data-tooltip-pos="right"]:hover::before,
        [data-tooltip-pos="right"]:hover::after {
            transform: translateY(-50%) translateX(0);
        }

        /* Premium gold accent highlight */
        [data-tooltip]:hover {
            position: relative;
        }

        /* Tooltip with info icon style */
        .tooltip-info {
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .tooltip-info::before {
            display: none;
        }

        .tooltip-icon {
            width: 16px;
            height: 16px;
            font-size: 0.7rem;
            border-radius: 50%;
            background: rgba(201, 162, 39, 0.2);
            color: var(--gold);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 4px;
            cursor: help;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .tooltip-icon:hover {
            background: var(--gold);
            color: var(--bg-primary);
            transform: scale(1.1);
        }

        /* Indicator rows with tooltip */
        .indicator-row[data-tooltip] {
            cursor: help;
        }

        .indicator-row[data-tooltip]:hover {
            background: rgba(201, 162, 39, 0.08);
            border-left: 3px solid var(--gold);
            padding-left: 9px;
        }

        /* Metric items with tooltip */
        .metric-item[data-tooltip]:hover {
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(201, 162, 39, 0.2);
        }

        /* Card titles with tooltip */
        .card-title[data-tooltip]::after {
            max-width: 280px;
        }

        /* Signal box tooltip */
        .signal-box[data-tooltip]::after {
            max-width: 350px;
        }

        /* Gauge tooltip */
        .gauge-container[data-tooltip]::after {
            max-width: 300px;
        }

        /* Target row tooltip */
        .target-row[data-tooltip]:hover {
            background: rgba(201, 162, 39, 0.08);
            border-left: 3px solid var(--gold);
        }

        /* Mobile tooltip adjustments */
        @media (max-width: 768px) {
            [data-tooltip]::after {
                max-width: 260px;
                font-size: 0.78rem;
                padding: 10px 12px;
                left: 0;
                right: auto;
                transform: translateX(0) translateY(8px);
            }

            [data-tooltip]:hover::after {
                transform: translateX(0) translateY(0);
            }

            [data-tooltip]::before {
                left: 20px;
            }
        }

        @media (max-width: 480px) {
            [data-tooltip]::after {
                max-width: 220px;
                font-size: 0.72rem;
                padding: 8px 10px;
            }

            /* Hide tooltips on very small screens to avoid UI clutter */
            [data-tooltip]::before,
            [data-tooltip]::after {
                display: none;
            }
        }
    </style>
</head>

<body>
    <!-- Back Button -->
    <a href="tools.html" class="back-btn">
        <i class="fas fa-arrow-left"></i> Back to Tools
    </a>

    <div class="tool-page">
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-container">
                <div class="ai-brain-container">
                    <div class="brain-ring"></div>
                    <div class="brain-ring"></div>
                    <div class="brain-ring"></div>
                    <div class="ai-brain"><i class="fas fa-brain"></i></div>
                </div>
                <div class="loading-text">AI Analyzing <span id="loadingStockName">Stock</span></div>
                <div class="loading-subtext">Processing 50+ indicators in real-time</div>
                <div class="loading-steps">
                    <div class="loading-step" id="step1">
                        <span class="step-icon">1</span>
                        <span>Fetching real-time market data</span>
                    </div>
                    <div class="loading-step" id="step2">
                        <span class="step-icon">2</span>
                        <span>Analyzing technical indicators</span>
                    </div>
                    <div class="loading-step" id="step3">
                        <span class="step-icon">3</span>
                        <span>Scanning live news & sentiment</span>
                    </div>
                    <div class="loading-step" id="step4">
                        <span class="step-icon">4</span>
                        <span>Fetching analyst recommendations</span>
                    </div>
                    <div class="loading-step" id="step5">
                        <span class="step-icon">5</span>
                        <span>Computing AI prediction model</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="tool-container">
            <div class="tool-header">
                <div class="badge-container">
                    <div class="premium-badge"
                        data-tooltip="This tool is in Beta - we're constantly improving it based on user feedback. Report any bugs to help us make it better!">
                        <i class="fas fa-flask"></i> BETA
                    </div>
                    <div class="premium-badge ai-badge"
                        data-tooltip="Powered by advanced algorithms that analyze 50+ indicators to give you intelligent insights about any stock.">
                        <i class="fas fa-brain"></i> AI-Powered
                    </div>
                    <div class="premium-badge live-badge"
                        data-tooltip="Real-time price data from NSE (National Stock Exchange) combined with Finnhub's financial analytics for accurate analysis.">
                        <i class="fas fa-circle"></i> LIVE NSE + FINNHUB
                    </div>
                </div>
                <h1><span class="gold-text">Stock Analysis</span> Tool - Technical & Fundamental Analysis FREE</h1>
                <h2 style="font-size: 1rem; color: var(--text-secondary); font-weight: 400; margin-top: 8px;">RSI ‚Ä¢ MACD
                    ‚Ä¢ Moving Averages ‚Ä¢ Bollinger Bands ‚Ä¢ PE Ratio ‚Ä¢ ROE ‚Ä¢ EPS | NSE/BSE Stocks</h2>
                <p>Free Stock Analyzer with 50+ Technical Indicators & Complete Fundamental Analysis ‚Ä¢ Real-Time NSE
                    Data ‚Ä¢ Buy/Sell Signals</p>
                <div class="header-stats">
                    <div class="header-stat"
                        data-tooltip="We analyze over 50 different technical and fundamental indicators including RSI, MACD, Moving Averages, P/E Ratio, ROE, and many more.">
                        <div class="header-stat-value">50+</div>
                        <div class="header-stat-label">Indicators</div>
                    </div>
                    <div class="header-stat"
                        data-tooltip="Stock prices are fetched in real-time from NSE (National Stock Exchange of India) for accurate current prices.">
                        <div class="header-stat-value">NSE</div>
                        <div class="header-stat-label">Live Data</div>
                    </div>
                    <div class="header-stat"
                        data-tooltip="Get the latest financial news about any stock from multiple sources, automatically analyzed for positive, negative, or neutral sentiment.">
                        <div class="header-stat-value"><i class="fas fa-newspaper"></i></div>
                        <div class="header-stat-label">Live News</div>
                    </div>
                    <div class="header-stat"
                        data-tooltip="100% free to use! No registration, no credit card, no hidden fees. Use as many times as you want.">
                        <div class="header-stat-value">FREE</div>
                        <div class="header-stat-label">No Signup</div>
                    </div>
                </div>
            </div>

            <div class="search-section">
                <div class="search-box search-container">
                    <div class="search-input-wrapper">
                        <input type="text" id="stockInput" class="search-input"
                            placeholder="Type stock symbol or company name (e.g., RELIANCE, TCS...)" autocomplete="off"
                            title="Type any NSE stock symbol (like RELIANCE, TCS, INFY) or company name">
                        <div id="autocompleteDropdown" class="autocomplete-dropdown"></div>
                    </div>
                    <button class="analyze-btn" id="analyzeBtn" onclick="analyzeStock()"
                        title="Click to start AI analysis">
                        <span class="btn-icon"><i class="fas fa-rocket"></i></span> Analyze Now
                    </button>
                </div>
                <div class="quick-stocks">
                    <span class="quick-stocks-label" title="Click any stock below for instant analysis"><i
                            class="fas fa-fire"></i> Popular:</span>
                    <span class="quick-stock" onclick="selectStock('RELIANCE')" title="Click to analyze">RELIANCE</span>
                    <span class="quick-stock" onclick="selectStock('TCS')" title="Click to analyze">TCS</span>
                    <span class="quick-stock" onclick="selectStock('HDFCBANK')" title="Click to analyze">HDFCBANK</span>
                    <span class="quick-stock" onclick="selectStock('INFY')" title="Click to analyze">INFY</span>
                    <span class="quick-stock" onclick="selectStock('ICICIBANK')"
                        title="Click to analyze">ICICIBANK</span>
                    <span class="quick-stock" onclick="selectStock('BHARTIARTL')"
                        title="Click to analyze">BHARTIARTL</span>
                    <span class="quick-stock" onclick="selectStock('SBIN')" title="Click to analyze">SBIN</span>
                    <span class="quick-stock" onclick="selectStock('TATAMOTORS')"
                        title="Click to analyze">TATAMOTORS</span>
                    <span class="quick-stock" onclick="selectStock('ADANIENT')" title="Click to analyze">ADANIENT</span>
                    <span class="quick-stock" onclick="selectStock('OLAELEC')" title="Click to analyze">OLA</span>
                </div>
                <div style="margin-top: 12px; text-align: center;">
                    <span class="stock-count-badge"
                        title="500+ NSE-listed stocks covering IT, Banking, Pharma, Auto, FMCG, and more!"><i
                            class="fas fa-database"></i> 500+ NSE Stocks Available</span>
                </div>
            </div>

            <div id="resultsSection" class="hidden">
                <!-- Stock Header Info -->
                <div class="stock-header" id="stockHeader">
                    <div class="stock-info">
                        <div class="stock-logo" id="stockLogo"
                            data-tooltip="Stock symbol abbreviation. Each listed company has a unique trading symbol on NSE.">
                            RE</div>
                        <div class="stock-details">
                            <h2 id="stockName">Loading...</h2>
                            <div class="stock-meta">
                                <span
                                    data-tooltip="The industry sector this company belongs to. Useful for comparing with similar companies."><i
                                        class="fas fa-chart-pie"></i> <span id="stockSector">-</span></span>
                                <span
                                    data-tooltip="This stock is listed on NSE (National Stock Exchange), India's largest stock exchange."><i
                                        class="fas fa-building"></i> NSE</span>
                                <span id="lastUpdated"
                                    data-tooltip="Shows if data is live from NSE or simulated for educational purposes."><i
                                        class="fas fa-clock"></i> Live</span>
                            </div>
                        </div>
                    </div>
                    <div class="stock-price-info"
                        data-tooltip="Current market price and today's change. Green = price is up from yesterday, Red = price is down.">
                        <div class="current-price-large" id="headerPrice">‚Çπ0.00</div>
                        <div class="price-change-large positive" id="headerChange">+0.00 (0.00%)</div>
                    </div>
                </div>

                <div class="results-grid">
                    <!-- AI Signal Card -->
                    <div class="analysis-card">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="Our AI analyzes 50+ technical and fundamental indicators to give you a simple Buy, Hold, or Sell recommendation. Think of it as a smart assistant summarizing complex data into one easy signal."><span
                                    class="icon"><i class="fas fa-bullseye"></i></span> AI Trading Signal</span>
                            <span class="card-badge" id="signalBadge">-</span>
                        </div>
                        <div class="signal-box"
                            data-tooltip="üöÄ STRONG BUY = Very positive outlook ‚Ä¢ üìà BUY = Good opportunity ‚Ä¢ ‚è∏Ô∏è HOLD = Wait and watch ‚Ä¢ üìâ SELL = Consider exiting ‚Ä¢ üîª STRONG SELL = High risk. The confidence % shows how certain the AI is about this signal.">
                            <div class="signal-indicator" id="signalIndicator">-</div>
                            <div class="signal-label" id="signalLabel">Analyzing...</div>
                            <div class="confidence-bar"
                                data-tooltip="This bar shows how confident the AI is about its recommendation. Higher percentage means multiple indicators are pointing in the same direction.">
                                <div class="confidence-fill" id="confidenceFill"
                                    style="width: 0%; background: linear-gradient(90deg, #4ade80, #C9A227);"></div>
                            </div>
                            <div class="confidence-text">
                                <span>AI Confidence</span>
                                <span class="confidence-value" id="confidenceText">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Stock Score Card -->
                    <div class="analysis-card">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="A combined score from 0-100 that weighs both technical signals (chart patterns, momentum) and fundamental health (company financials). Score above 60 = Bullish, 40-60 = Neutral, below 40 = Bearish."><span
                                    class="icon">üìä</span> AI Composite Score</span>
                            <span class="card-badge badge-neutral" id="scoreBadge">-/100</span>
                        </div>
                        <div class="gauge-container"
                            data-tooltip="The gauge shows overall stock health. Green zone (right) = Strong, Yellow zone (middle) = Moderate, Red zone (left) = Weak. The number in center is the final score out of 100.">
                            <div class="gauge-svg-wrapper">
                                <svg viewBox="0 0 200 110" style="width: 100%; height: 100%;">
                                    <defs>
                                        <linearGradient id="gaugeGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                            <stop offset="0%" style="stop-color:#ff3b5c" />
                                            <stop offset="50%" style="stop-color:#ffd700" />
                                            <stop offset="100%" style="stop-color:#00d68f" />
                                        </linearGradient>
                                    </defs>
                                    <path class="gauge-bg" d="M20 90 A70 70 0 0 1 180 90"></path>
                                    <path class="gauge-fill" id="gaugeFill" d="M20 90 A70 70 0 0 1 180 90"
                                        style="stroke: url(#gaugeGradient); stroke-dasharray: 220; stroke-dashoffset: 220;">
                                    </path>
                                </svg>
                                <div class="gauge-value" id="gaugeValue">0</div>
                            </div>
                            <div class="gauge-label">OVERALL SCORE</div>
                        </div>
                        <div class="metric-grid" style="margin-top: 1rem;">
                            <div class="metric-item"
                                data-tooltip="Technical Score measures price momentum, chart patterns, and trading signals like RSI, MACD, and moving averages. Higher score = stronger upward momentum.">
                                <div class="metric-value" id="technicalScore">-</div>
                                <div class="metric-label">Technical</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Fundamental Score evaluates company health using P/E ratio, ROE, debt levels, and dividend yield. Higher score = financially stronger company.">
                                <div class="metric-value" id="fundamentalScore">-</div>
                                <div class="metric-label">Fundamental</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sentiment Analysis -->
                    <div class="analysis-card">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="Market Sentiment shows how traders and investors feel about this stock. It combines news sentiment, social media buzz, and price action to gauge the overall mood."><span
                                    class="icon"><i class="fas fa-comments"></i></span> Market Sentiment</span>
                            <span class="card-badge badge-neutral" id="sentimentBadge">Neutral</span>
                        </div>
                        <div class="sentiment-bars">
                            <div class="sentiment-row"
                                data-tooltip="Bullish = Optimistic investors expecting price to go UP. Higher percentage means more people are positive about this stock.">
                                <span class="sentiment-label">Bullish</span>
                                <div class="sentiment-bar-container">
                                    <div class="sentiment-bar-fill positive" id="bullishBar" style="width: 0%"></div>
                                </div>
                                <span class="sentiment-value metric-positive" id="bullishValue">0%</span>
                            </div>
                            <div class="sentiment-row"
                                data-tooltip="Neutral = Investors who are undecided or waiting for clearer signals before taking action.">
                                <span class="sentiment-label">Neutral</span>
                                <div class="sentiment-bar-container">
                                    <div class="sentiment-bar-fill neutral" id="neutralBar" style="width: 0%"></div>
                                </div>
                                <span class="sentiment-value" id="neutralValue">0%</span>
                            </div>
                            <div class="sentiment-row"
                                data-tooltip="Bearish = Pessimistic investors expecting price to go DOWN. Higher percentage means more people are negative about this stock.">
                                <span class="sentiment-label">Bearish</span>
                                <div class="sentiment-bar-container">
                                    <div class="sentiment-bar-fill negative" id="bearishBar" style="width: 0%"></div>
                                </div>
                                <span class="sentiment-value metric-negative" id="bearishValue">0%</span>
                            </div>
                        </div>
                        <div class="metric-grid" style="margin-top: 1rem;">
                            <div class="metric-item"
                                data-tooltip="News Score analyzes recent headlines and articles about this stock. Positive news = higher score, negative news = lower score.">
                                <div class="metric-value" id="newsScore">-</div>
                                <div class="metric-label">News Score</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Social Buzz measures how much this stock is being discussed on social media and trading forums. High buzz often indicates increased interest.">
                                <div class="metric-value" id="socialScore">-</div>
                                <div class="metric-label">Social Buzz</div>
                            </div>
                        </div>
                    </div>

                    <!-- Live Stock News Card -->
                    <div class="analysis-card">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="Real-time news articles about this stock from financial sources. Green icon = positive news, Red = negative, Gold = neutral. Stay updated with what's happening!"><span
                                    class="icon"><i class="fas fa-newspaper"></i></span> Live News Feed</span>
                            <span class="card-badge badge-neutral" id="newsBadge">Loading...</span>
                        </div>
                        <div class="news-feed-container" id="newsFeedContainer">
                            <div class="news-loading">
                                <i class="fas fa-spinner fa-spin"></i> Fetching latest news...
                            </div>
                        </div>
                        <div class="news-source-info">
                            <small><i class="fas fa-info-circle"></i> News from multiple financial sources ‚Ä¢
                                Auto-refreshed</small>
                        </div>
                    </div>

                    <!-- Analyst Targets Card -->
                    <div class="analysis-card span-2">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="Professional analysts from banks and brokerages share their price targets and recommendations. This shows what the experts think about this stock's future."><span
                                    class="icon"><i class="fas fa-chart-line"></i></span> Analyst Consensus</span>
                            <span class="card-badge badge-neutral" id="analystBadge">-</span>
                        </div>
                        <div class="analyst-container">
                            <div class="analyst-target-main">
                                <div class="target-price-box"
                                    data-tooltip="This is the average price target set by professional analysts. If current price is below this, analysts expect it to go UP. The percentage shows expected upside or downside.">
                                    <div class="target-label">Average Target</div>
                                    <div class="target-price" id="avgTargetPrice">‚Çπ-</div>
                                    <div class="target-upside" id="targetUpside">-</div>
                                </div>
                                <div class="target-range">
                                    <div class="range-item"
                                        data-tooltip="The highest price target among all analysts. This represents the most optimistic view of where the stock could go.">
                                        <span class="range-label">High Target</span>
                                        <span class="range-value positive" id="highTarget">‚Çπ-</span>
                                    </div>
                                    <div class="range-item"
                                        data-tooltip="The lowest price target among all analysts. This represents the most conservative or bearish view.">
                                        <span class="range-label">Low Target</span>
                                        <span class="range-value negative" id="lowTarget">‚Çπ-</span>
                                    </div>
                                </div>
                            </div>
                            <div class="analyst-recommendations" id="analystRecommendations">
                                <div class="rec-item"
                                    data-tooltip="Number of analysts recommending to BUY this stock. More buy recommendations = more confidence from experts.">
                                    <div class="rec-bar buy" style="width: 0%" id="recBuyBar"></div>
                                    <span class="rec-label">Buy</span>
                                    <span class="rec-count" id="recBuyCount">0</span>
                                </div>
                                <div class="rec-item"
                                    data-tooltip="Number of analysts recommending to HOLD this stock. They're not bullish but not bearish either - waiting for better signals.">
                                    <div class="rec-bar hold" style="width: 0%" id="recHoldBar"></div>
                                    <span class="rec-label">Hold</span>
                                    <span class="rec-count" id="recHoldCount">0</span>
                                </div>
                                <div class="rec-item"
                                    data-tooltip="Number of analysts recommending to SELL this stock. More sell recommendations = caution advised.">
                                    <div class="rec-bar sell" style="width: 0%" id="recSellBar"></div>
                                    <span class="rec-label">Sell</span>
                                    <span class="rec-count" id="recSellCount">0</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Price Information Card -->
                    <div class="analysis-card">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="Key price levels and trading volume data. These help you understand where the stock is trading today and how actively it's being bought and sold."><span
                                    class="icon"><i class="fas fa-coins"></i></span> Price Analysis</span>
                        </div>
                        <div class="metric-grid cols-4">
                            <div class="metric-item"
                                data-tooltip="The last traded price of this stock on the exchange. This is what you would pay if you bought right now.">
                                <div class="metric-value" id="currentPrice">‚Çπ-</div>
                                <div class="metric-label">Current</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="How much the price has moved today compared to yesterday's close. Green = up, Red = down.">
                                <div class="metric-value" id="priceChange">-</div>
                                <div class="metric-label">Change</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="The highest price this stock reached during today's trading session.">
                                <div class="metric-value" id="dayHigh">‚Çπ-</div>
                                <div class="metric-label">Day High</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="The lowest price this stock fell to during today's trading session.">
                                <div class="metric-value" id="dayLow">‚Çπ-</div>
                                <div class="metric-label">Day Low</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="The highest price this stock reached in the last 52 weeks (1 year). Useful to see how far it is from its peak.">
                                <div class="metric-value" id="week52High">‚Çπ-</div>
                                <div class="metric-label">52W High</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="The lowest price this stock fell to in the last 52 weeks (1 year). Useful to see how far it's recovered from its bottom.">
                                <div class="metric-value" id="week52Low">‚Çπ-</div>
                                <div class="metric-label">52W Low</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Average number of shares traded daily over a period. Helps understand normal trading activity for this stock.">
                                <div class="metric-value" id="avgVolume">-</div>
                                <div class="metric-label">Avg Vol</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Number of shares traded today. Higher than average = increased interest. Lower = quiet day.">
                                <div class="metric-value" id="todayVolume">-</div>
                                <div class="metric-label">Today Vol</div>
                            </div>
                        </div>
                        <!-- Mini Candlestick Chart -->
                        <div class="mini-chart"
                            data-tooltip="Candlestick chart shows price movements. Green candles = price went UP that day, Red candles = price went DOWN. Tall candles = big move, short candles = small move.">
                            <div class="mini-chart-header">
                                <span style="color: var(--text-muted); font-size: 0.85rem;">Price Movement (Last 20
                                    Sessions)</span>
                            </div>
                            <div class="candlestick-container" id="candlestickChart"></div>
                        </div>
                    </div>

                    <!-- AI Price Targets Card -->
                    <div class="analysis-card">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="AI-calculated price targets based on technical analysis. Targets show where price might go UP, Support shows where it might find a floor, and Stop Loss is a suggested exit point to limit losses."><span
                                    class="icon"><i class="fas fa-crosshairs"></i></span> AI Price Targets</span>
                        </div>
                        <div class="price-targets">
                            <div class="target-row"
                                data-tooltip="Target 3 (Strong): If the stock breaks through Target 1 and 2, this is the next major resistance level. This is the most optimistic upside target.">
                                <span class="target-label"><span class="dot green"></span> Target 3 (Strong)</span>
                                <span class="target-value target-upside" id="resistance3">‚Çπ-<span class="target-percent"
                                        id="res3Pct">+0%</span></span>
                            </div>
                            <div class="target-row"
                                data-tooltip="Target 2: The second resistance level. If the stock crosses Target 1, this becomes the next goal. Percentage shows potential profit from current price.">
                                <span class="target-label"><span class="dot green"></span> Target 2</span>
                                <span class="target-value target-upside" id="resistance2">‚Çπ-<span class="target-percent"
                                        id="res2Pct">+0%</span></span>
                            </div>
                            <div class="target-row"
                                data-tooltip="Target 1: The first resistance level above current price. This is where the stock might face selling pressure. Good for short-term traders.">
                                <span class="target-label"><span class="dot green"></span> Target 1</span>
                                <span class="target-value target-upside" id="resistance1">‚Çπ-<span class="target-percent"
                                        id="res1Pct">+0%</span></span>
                            </div>
                            <div class="target-row target-current"
                                data-tooltip="The current trading price of the stock. All targets are calculated relative to this price.">
                                <span class="target-label"><span class="dot gold"></span> Current Price</span>
                                <span class="target-value" id="targetCurrent">‚Çπ-</span>
                            </div>
                            <div class="target-row"
                                data-tooltip="Support 1: The first support level below current price. This is where buyers might step in to prevent further fall.">
                                <span class="target-label"><span class="dot red"></span> Support 1</span>
                                <span class="target-value target-downside" id="support1">‚Çπ-<span class="target-percent"
                                        id="sup1Pct">-0%</span></span>
                            </div>
                            <div class="target-row"
                                data-tooltip="Support 2: A stronger support level below Support 1. If Support 1 breaks, the stock might fall to this level before finding buyers.">
                                <span class="target-label"><span class="dot red"></span> Support 2</span>
                                <span class="target-value target-downside" id="support2">‚Çπ-<span class="target-percent"
                                        id="sup2Pct">-0%</span></span>
                            </div>
                            <div class="target-row"
                                data-tooltip="Stop Loss: A suggested exit point to limit your losses. If price falls below this level, the trend might be broken and further downside is possible.">
                                <span class="target-label"><span class="dot red"></span> Stop Loss</span>
                                <span class="target-value target-downside" id="stopLoss">‚Çπ-<span class="target-percent"
                                        id="slPct">-0%</span></span>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Indicators Card -->
                    <div class="analysis-card">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="Technical indicators are mathematical calculations based on price and volume. Traders use these to predict future price movements and find good entry/exit points."><span
                                    class="icon"><i class="fas fa-chart-line"></i></span> Technical Indicators</span>
                            <span class="card-badge" id="techBadge">-</span>
                        </div>
                        <div class="technical-indicators">
                            <div class="indicator-row"
                                data-tooltip="RSI (Relative Strength Index): Measures if a stock is overbought or oversold. Below 30 = Oversold (good buy), Above 70 = Overbought (may fall). Range: 0-100.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-chart-bar"></i></span> RSI (14)</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="rsiValue">-</span>
                                    <span class="indicator-signal" id="rsiSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="MACD (Moving Average Convergence Divergence): Shows momentum and trend direction. Positive = Bullish momentum, Negative = Bearish momentum. Crossovers signal trend changes.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-wave-square"></i></span> MACD</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="macdValue">-</span>
                                    <span class="indicator-signal" id="macdSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="EMA 20 (Exponential Moving Average): Average price of last 20 days, giving more weight to recent prices. Price above EMA = Uptrend, Price below = Downtrend.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-chart-area"></i></span> EMA (20)</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="ema20Value">-</span>
                                    <span class="indicator-signal" id="ma20Signal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="SMA 50 (Simple Moving Average): Average price of last 50 days. This is a medium-term trend indicator. Price above SMA50 = Healthy uptrend.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-chart-area"></i></span> SMA (50)</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="sma50Value">-</span>
                                    <span class="indicator-signal" id="ma50Signal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="Bollinger Bands: Shows if price is high or low relative to recent trading. Lower band = potential buy zone, Upper band = potential sell zone, Middle = neutral.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-bell"></i></span> Bollinger Bands</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="bbValue">-</span>
                                    <span class="indicator-signal" id="bbSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="Stochastic Oscillator: Similar to RSI but more sensitive. Below 20 = Oversold (buy signal), Above 80 = Overbought (sell signal). Good for timing entries.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-percentage"></i></span> Stochastic</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="stochValue">-</span>
                                    <span class="indicator-signal" id="stochSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="ADX (Average Directional Index): Measures trend STRENGTH, not direction. Above 25 = Strong trend, Below 20 = Weak/No trend. Helps confirm if a trend is real.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-signal"></i></span> ADX</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="adxValue">-</span>
                                    <span class="indicator-signal" id="adxSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="Volume Trend: Compares today's volume to average volume. High volume confirms price moves. Low volume means less conviction in the move.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-database"></i></span> Volume Trend</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="volTrendValue">-</span>
                                    <span class="indicator-signal" id="volumeSignal">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Technical Indicators Card (NEW) -->
                    <div class="analysis-card">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="Advanced indicators for experienced traders. These provide deeper insights into price momentum, volume patterns, and potential reversals."><span
                                    class="icon"><i class="fas fa-cogs"></i></span> Advanced Indicators</span>
                            <span class="card-badge badge-neutral" id="advTechBadge">LIVE</span>
                        </div>
                        <div class="technical-indicators">
                            <div class="indicator-row"
                                data-tooltip="Williams %R: Similar to Stochastic but inverted. Values from -100 to 0. Below -80 = Oversold (buy zone), Above -20 = Overbought (sell zone).">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-arrows-alt-v"></i></span> Williams %R</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="williamsRValue">-</span>
                                    <span class="indicator-signal" id="williamsRSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="CCI (Commodity Channel Index): Measures price deviation from average. Above +100 = Overbought, Below -100 = Oversold. Used to spot trend reversals.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-random"></i></span> CCI (20)</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="cciValue">-</span>
                                    <span class="indicator-signal" id="cciSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="OBV (On-Balance Volume): Tracks cumulative volume to predict price direction. Rising OBV = Buying pressure, Falling OBV = Selling pressure.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-layer-group"></i></span> OBV Trend</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="obvValue">-</span>
                                    <span class="indicator-signal" id="obvSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="MFI (Money Flow Index): Like RSI but includes volume. Shows if money is flowing IN or OUT of the stock. Below 20 = Oversold, Above 80 = Overbought.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-coins"></i></span> MFI (14)</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="mfiValue">-</span>
                                    <span class="indicator-signal" id="mfiSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="VWAP (Volume Weighted Average Price): Average price weighted by volume. Used by institutions. Price above VWAP = Bullish, Below = Bearish.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-balance-scale"></i></span> VWAP</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="vwapValue">-</span>
                                    <span class="indicator-signal" id="vwapSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="ROC (Rate of Change): Measures the speed of price change over 10 periods. Positive = Upward momentum, Negative = Downward momentum.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-tachometer-alt"></i></span> ROC (10)</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="rocValue">-</span>
                                    <span class="indicator-signal" id="rocSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="AROON Oscillator: Measures trend strength and direction. Positive = Uptrend, Negative = Downtrend. Closer to ¬±100 = Stronger trend.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-sun"></i></span> AROON Osc</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="aroonValue">-</span>
                                    <span class="indicator-signal" id="aroonSignal">-</span>
                                </div>
                            </div>
                            <div class="indicator-row"
                                data-tooltip="Pivot Point: A key price level calculated from yesterday's high, low, and close. Price above Pivot = Bullish bias, Below = Bearish bias. Used by day traders.">
                                <span class="indicator-name"><span class="indicator-icon"><i
                                            class="fas fa-crosshairs"></i></span> Pivot Point</span>
                                <div class="indicator-values">
                                    <span class="indicator-num" id="pivotValue">-</span>
                                    <span class="indicator-signal" id="pivotSignal">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Fundamental Analysis Card -->
                    <div class="analysis-card span-2">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="Fundamental analysis looks at the company's financials - how profitable it is, how much debt it has, and if the stock is fairly priced. These help determine the real value of a company."><span
                                    class="icon"><i class="fas fa-clipboard-list"></i></span> Fundamental
                                Analysis</span>
                            <span class="card-badge" id="fundBadge">-</span>
                        </div>
                        <div class="metric-grid cols-4">
                            <div class="metric-item"
                                data-tooltip="P/E Ratio (Price to Earnings): Shows how expensive a stock is relative to its profits. Lower P/E = cheaper stock. Below 15 = value stock, Above 30 = growth/expensive stock.">
                                <div class="metric-value" id="peRatio">-</div>
                                <div class="metric-label">P/E Ratio</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="P/B Ratio (Price to Book): Compares stock price to the company's net assets. Below 1 = stock trades below asset value (potential bargain). Above 3 = premium valuation.">
                                <div class="metric-value" id="pbRatio">-</div>
                                <div class="metric-label">P/B Ratio</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Debt to Equity: How much the company relies on debt vs. its own money. Below 0.5 = healthy, Above 1 = high debt (risky). Banks typically have higher D/E.">
                                <div class="metric-value" id="debtEquity">-</div>
                                <div class="metric-label">Debt/Equity</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="ROE (Return on Equity): How efficiently the company uses investor money to generate profits. Above 15% = good, Above 20% = excellent. Higher is better.">
                                <div class="metric-value" id="roe">-</div>
                                <div class="metric-label">ROE</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="EPS (Earnings Per Share): Profit earned per share of stock. Growing EPS over years = healthy company. This affects stock price directly.">
                                <div class="metric-value" id="eps">-</div>
                                <div class="metric-label">EPS (TTM)</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Market Cap: Total value of all company shares. Large Cap (>‚Çπ20K Cr) = stable, Mid Cap (‚Çπ5K-20K Cr) = growth potential, Small Cap (<‚Çπ5K Cr) = high risk/reward.">
                                <div class="metric-value" id="marketCap">-</div>
                                <div class="metric-label">Market Cap</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Dividend Yield: Annual dividend payment as % of stock price. Above 2% = income-generating stock. 0% = growth stock that reinvests profits.">
                                <div class="metric-value" id="divYield">-</div>
                                <div class="metric-label">Div Yield</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Book Value: Net asset value per share (Assets - Liabilities). If stock price < book value, the stock might be undervalued.">
                                <div class="metric-value" id="bookValue">-</div>
                                <div class="metric-label">Book Value</div>
                            </div>
                        </div>
                        <div class="sector-comparison" style="margin-top: 1.5rem;">
                            <div class="sector-item"
                                data-tooltip="How this stock has performed compared to other companies in the same industry/sector. Positive = outperforming peers.">
                                <div class="sector-name">Stock vs Sector</div>
                                <div class="sector-perf metric-positive" id="vsSector">+0%</div>
                            </div>
                            <div class="sector-item"
                                data-tooltip="How this stock has performed compared to Nifty 50 index. Positive = beating the market, Negative = underperforming.">
                                <div class="sector-name">Stock vs Nifty</div>
                                <div class="sector-perf metric-positive" id="vsNifty">+0%</div>
                            </div>
                            <div class="sector-item"
                                data-tooltip="Total return in the last 1 year including price change and dividends. Shows recent performance trend.">
                                <div class="sector-name">1Y Return</div>
                                <div class="sector-perf metric-positive" id="oneYearReturn">+0%</div>
                            </div>
                            <div class="sector-item"
                                data-tooltip="CAGR (Compound Annual Growth Rate) over 3 years. Shows consistent long-term performance. Above 15% = excellent growth.">
                                <div class="sector-name">3Y CAGR</div>
                                <div class="sector-perf metric-positive" id="threeYearCAGR">+0%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Risk Assessment Card -->
                    <div class="analysis-card">
                        <div class="card-header">
                            <span class="card-title"
                                data-tooltip="Risk Assessment measures how volatile and risky this stock is. Higher risk can mean bigger gains OR bigger losses. Lower risk is more stable but with smaller returns."><span
                                    class="icon"><i class="fas fa-shield-halved"></i></span> Risk Assessment</span>
                            <span class="card-badge" id="riskBadge">-</span>
                        </div>
                        <div class="metric-grid">
                            <div class="metric-item"
                                data-tooltip="Beta: Measures stock volatility vs. market. Beta 1 = moves with market. Above 1 = more volatile (riskier), Below 1 = less volatile (defensive).">
                                <div class="metric-value" id="beta">-</div>
                                <div class="metric-label">Beta</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Volatility: How much the stock price swings daily. Higher % = bigger price moves = more risk. Low volatility stocks are more predictable.">
                                <div class="metric-value" id="volatility">-</div>
                                <div class="metric-label">Volatility</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Sharpe Ratio: Risk-adjusted returns. Above 1 = good, Above 2 = great. It shows how much return you get for the risk you take. Higher is better.">
                                <div class="metric-value" id="sharpe">-</div>
                                <div class="metric-label">Sharpe Ratio</div>
                            </div>
                            <div class="metric-item"
                                data-tooltip="Max Drawdown: The biggest drop from peak to bottom in a period. Shows worst-case scenario. -20% means at some point, you'd have lost 20% from the peak.">
                                <div class="metric-value" id="maxDrawdown">-</div>
                                <div class="metric-label">Max Drawdown</div>
                            </div>
                        </div>
                        <div style="margin-top: 1.5rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: var(--text-muted); font-size: 0.85rem;">Risk Level</span>
                                <span style="color: var(--orange); font-weight: 600;" id="riskLevelText">Moderate</span>
                            </div>
                            <div class="risk-meter" id="riskMeter"
                                data-tooltip="Visual risk meter: 1-2 bars = Low risk (safe), 3 bars = Moderate risk, 4-5 bars = High risk (volatile). Match your risk tolerance to the stock.">
                                <div class="risk-bar"></div>
                                <div class="risk-bar"></div>
                                <div class="risk-bar"></div>
                                <div class="risk-bar"></div>
                                <div class="risk-bar"></div>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-muted);">
                                <span>Low Risk</span>
                                <span>High Risk</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Summary -->
                <div class="ai-summary">
                    <div class="ai-summary-header"
                        data-tooltip="Our AI engine analyzes all the indicators above and writes a human-readable summary explaining what's happening with this stock and what it might mean for you.">
                        <div class="ai-avatar"><i class="fas fa-robot"></i></div>
                        <h3>AI Analysis Report<span>Generated by BroBillionaire AI Engine v5.0</span></h3>
                    </div>
                    <div class="ai-summary-content" id="aiSummaryText">Loading AI analysis...</div>
                </div>

                <!-- Legendary Investor Insights - Premium Feature -->
                <div class="investor-insights-section" id="investorInsightsSection" style="display: none;">
                    <div class="investor-insights-header">
                        <div class="investor-insights-title">
                            <div class="investor-crown">üëë</div>
                            <h3>Legendary Investor Insights<span>What would the masters say about this stock?</span>
                            </h3>
                        </div>
                        <div class="premium-badge-investor"><i class="fas fa-star"></i> Premium Analysis</div>
                    </div>

                    <div class="investor-selector" id="investorSelector">
                        <div class="investor-chip active" data-investor="buffett" onclick="selectInvestor('buffett')">
                            <div class="investor-chip-avatar">üé©</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Warren Buffett</span>
                                <span class="investor-chip-style">Value Investing</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="lynch" onclick="selectInvestor('lynch')">
                            <div class="investor-chip-avatar">üìä</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Peter Lynch</span>
                                <span class="investor-chip-style">Growth at GARP</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="soros" onclick="selectInvestor('soros')">
                            <div class="investor-chip-avatar">üåä</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">George Soros</span>
                                <span class="investor-chip-style">Macro Trading</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="dalio" onclick="selectInvestor('dalio')">
                            <div class="investor-chip-avatar">‚öñÔ∏è</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Ray Dalio</span>
                                <span class="investor-chip-style">All Weather</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="livermore" onclick="selectInvestor('livermore')">
                            <div class="investor-chip-avatar">üìà</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Jesse Livermore</span>
                                <span class="investor-chip-style">Trend Trading</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="icahn" onclick="selectInvestor('icahn')">
                            <div class="investor-chip-avatar">ü¶à</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Carl Icahn</span>
                                <span class="investor-chip-style">Activist Investing</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="klarman" onclick="selectInvestor('klarman')">
                            <div class="investor-chip-avatar">üõ°Ô∏è</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Seth Klarman</span>
                                <span class="investor-chip-style">Margin of Safety</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="jhunjhunwala"
                            onclick="selectInvestor('jhunjhunwala')">
                            <div class="investor-chip-avatar">üáÆüá≥</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Rakesh Jhunjhunwala</span>
                                <span class="investor-chip-style">India Bull</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="munger" onclick="selectInvestor('munger')">
                            <div class="investor-chip-avatar">üß†</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Charlie Munger</span>
                                <span class="investor-chip-style">Mental Models</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="graham" onclick="selectInvestor('graham')">
                            <div class="investor-chip-avatar">üìö</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Benjamin Graham</span>
                                <span class="investor-chip-style">Father of Value</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="druckenmiller"
                            onclick="selectInvestor('druckenmiller')">
                            <div class="investor-chip-avatar">üéØ</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Stanley Druckenmiller</span>
                                <span class="investor-chip-style">Macro Conviction</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="marks" onclick="selectInvestor('marks')">
                            <div class="investor-chip-avatar">üìù</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Howard Marks</span>
                                <span class="investor-chip-style">Second-Level Thinking</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="ackman" onclick="selectInvestor('ackman')">
                            <div class="investor-chip-avatar">üè¢</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Bill Ackman</span>
                                <span class="investor-chip-style">Concentrated Activist</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="simons" onclick="selectInvestor('simons')">
                            <div class="investor-chip-avatar">üî¢</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Jim Simons</span>
                                <span class="investor-chip-style">Quant Trading</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="templeton" onclick="selectInvestor('templeton')">
                            <div class="investor-chip-avatar">üåç</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">John Templeton</span>
                                <span class="investor-chip-style">Global Contrarian</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="fisher" onclick="selectInvestor('fisher')">
                            <div class="investor-chip-avatar">üî¨</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Philip Fisher</span>
                                <span class="investor-chip-style">Growth Pioneer</span>
                            </div>
                        </div>
                        <div class="investor-chip" data-investor="tudor" onclick="selectInvestor('tudor')">
                            <div class="investor-chip-avatar">üìâ</div>
                            <div class="investor-chip-info">
                                <span class="investor-chip-name">Paul Tudor Jones</span>
                                <span class="investor-chip-style">Macro Technician</span>
                            </div>
                        </div>
                    </div>

                    <div class="investor-advice-container" id="investorAdviceContainer">
                        <!-- Advice cards will be dynamically inserted here -->
                        <div class="no-investor-selected" id="noInvestorMessage" style="display: none;">
                            <i class="fas fa-user-tie"></i>
                            <p>Select a legendary investor above to see their perspective on this stock</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FAQ Section - SEO Optimized -->
            <div class="faq-section">
                <h2><i class="fas fa-question-circle"></i> Frequently Asked Questions About Stock Analysis</h2>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>What is Stock Analysis and why is it important?</span>
                        <span class="faq-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="faq-answer">
                        <strong>Stock analysis</strong> is the process of evaluating stocks using <strong>technical
                            analysis</strong> (chart patterns, indicators like RSI, MACD, Moving Averages) and
                        <strong>fundamental analysis</strong> (PE ratio, ROE, EPS, revenue growth). It helps traders
                        make informed buy/sell decisions. This free stock analysis tool provides both technical and
                        fundamental analysis for all NSE/BSE stocks.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>What is Technical Analysis and which indicators are analyzed?</span>
                        <span class="faq-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="faq-answer">
                        <strong>Technical Analysis</strong> studies price charts and indicators to predict future price
                        movements. This tool analyzes 50+ indicators including:<br><br>
                        ‚Ä¢ <strong>RSI (Relative Strength Index)</strong> - Overbought above 70, oversold below 30<br>
                        ‚Ä¢ <strong>MACD</strong> - Trend direction and momentum with signal line crossovers<br>
                        ‚Ä¢ <strong>Bollinger Bands</strong> - Volatility indicator with upper and lower bands<br>
                        ‚Ä¢ <strong>Moving Averages (EMA, SMA)</strong> - 20, 50, 200 period trend identification<br>
                        ‚Ä¢ <strong>Stochastic Oscillator</strong> - Momentum indicator for entry/exit points<br>
                        ‚Ä¢ <strong>ADX</strong> - Trend strength measurement<br>
                        ‚Ä¢ <strong>Support & Resistance</strong> - Key price levels for trading decisions
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>What is Fundamental Analysis and what metrics are shown?</span>
                        <span class="faq-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="faq-answer">
                        <strong>Fundamental Analysis</strong> evaluates a company's financial health and intrinsic
                        value. Key metrics analyzed include:<br><br>
                        ‚Ä¢ <strong>PE Ratio (Price to Earnings)</strong> - Valuation relative to earnings<br>
                        ‚Ä¢ <strong>PB Ratio (Price to Book)</strong> - Market value vs book value<br>
                        ‚Ä¢ <strong>ROE (Return on Equity)</strong> - Profitability efficiency, above 15% is good<br>
                        ‚Ä¢ <strong>EPS (Earnings Per Share)</strong> - Profit per share<br>
                        ‚Ä¢ <strong>Debt to Equity Ratio</strong> - Financial leverage and risk<br>
                        ‚Ä¢ <strong>Dividend Yield</strong> - Income potential for investors
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>How to use RSI indicator for stock trading?</span>
                        <span class="faq-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="faq-answer">
                        <strong>RSI (Relative Strength Index)</strong> is a momentum indicator ranging 0-100:<br><br>
                        ‚Ä¢ <strong>RSI above 70</strong> = Overbought (potential sell signal)<br>
                        ‚Ä¢ <strong>RSI below 30</strong> = Oversold (potential buy signal)<br>
                        ‚Ä¢ <strong>RSI 40-60</strong> = Neutral zone<br><br>
                        Look for RSI divergence with price for stronger signals. This tool calculates real-time RSI and
                        provides clear buy/sell signals. <em>Educational purposes only.</em>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>How to read MACD indicator for buy/sell signals?</span>
                        <span class="faq-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="faq-answer">
                        <strong>MACD (Moving Average Convergence Divergence)</strong> consists of MACD line, Signal
                        line, and Histogram:<br><br>
                        ‚Ä¢ <strong>Buy signal</strong>: MACD line crosses above Signal line (bullish crossover)<br>
                        ‚Ä¢ <strong>Sell signal</strong>: MACD line crosses below Signal line (bearish crossover)<br>
                        ‚Ä¢ <strong>Histogram</strong>: Shows momentum strength - taller bars = stronger trend<br><br>
                        This tool calculates MACD with standard 12,26,9 periods.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>What PE Ratio is considered good for investing?</span>
                        <span class="faq-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="faq-answer">
                        <strong>PE Ratio (Price to Earnings)</strong> varies by sector and market conditions:<br><br>
                        ‚Ä¢ <strong>PE below 15</strong> = May be undervalued<br>
                        ‚Ä¢ <strong>PE 15-25</strong> = Fairly valued<br>
                        ‚Ä¢ <strong>PE above 25</strong> = May be overvalued or growth stock<br><br>
                        IT stocks typically have higher PE (25-40), while banking stocks have lower PE (10-20). Always
                        compare PE with sector average and historical PE. This tool compares PE ratios automatically.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>Is this Stock Analysis Tool completely free?</span>
                        <span class="faq-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="faq-answer">
                        <strong>Yes! 100% FREE forever.</strong> No registration, no signup, no hidden fees. Get
                        complete technical analysis (RSI, MACD, Moving Averages, Bollinger Bands, 50+ indicators) and
                        fundamental analysis (PE Ratio, ROE, EPS) for any NSE/BSE stock. Unlimited analyses. <em>This is
                            an educational tool and should not be used for actual trading decisions.</em>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>Which stocks can I analyze - NSE, BSE, Nifty 50?</span>
                        <span class="faq-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="faq-answer">
                        Analyze <strong>2000+ stocks</strong> listed on NSE and BSE including:<br><br>
                        ‚Ä¢ <strong>Nifty 50</strong> - RELIANCE, TCS, HDFC Bank, Infosys, ICICI Bank<br>
                        ‚Ä¢ <strong>Bank Nifty</strong> - HDFC Bank, ICICI Bank, SBI, Axis Bank, Kotak Bank<br>
                        ‚Ä¢ <strong>Nifty IT</strong> - TCS, Infosys, Wipro, HCL Tech, Tech Mahindra<br>
                        ‚Ä¢ <strong>Midcap & Smallcap</strong> - 1500+ stocks<br><br>
                        Real-time price data from Yahoo Finance. Always verify with official NSE/BSE sources.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <span>Should I use this for actual trading decisions?</span>
                        <span class="faq-icon"><i class="fas fa-chevron-down"></i></span>
                    </div>
                    <div class="faq-answer">
                        <strong>NO.</strong> This tool is for <strong>educational and learning purposes only</strong>.
                        You should NOT make any investment or trading decisions based solely on this tool.
                        Always:<br><br>
                        ‚Ä¢ Do your own thorough research<br>
                        ‚Ä¢ Consult a <strong>SEBI-registered Investment Advisor</strong><br>
                        ‚Ä¢ Verify data from official NSE/BSE sources<br>
                        ‚Ä¢ Understand that stock markets are risky and you can lose money
                    </div>
                </div>
            </div>

            <div class="share-section">
                <h3><i class="fas fa-share-alt"></i> Share This Free Stock Analysis Tool</h3>
                <p style="color: var(--text-muted);">Help others learn technical analysis and fundamental analysis for
                    stock trading!</p>
                <div class="share-buttons">
                    <button class="share-btn share-twitter" onclick="shareTwitter()"><i class="fab fa-x-twitter"></i>
                        Post on X</button>
                    <button class="share-btn share-whatsapp" onclick="shareWhatsApp()"><i class="fab fa-whatsapp"></i>
                        WhatsApp</button>
                    <button class="share-btn share-linkedin" onclick="shareLinkedIn()"><i class="fab fa-linkedin"></i>
                        LinkedIn</button>
                    <button class="share-btn share-copy" onclick="copyLink()"><i class="fas fa-link"></i> Copy
                        Link</button>
                </div>
            </div>

            <!-- SEBI Disclaimer -->
            <div class="disclaimer sebi-disclaimer">
                <div class="disclaimer-header">
                    <i class="fas fa-gavel"></i> <strong>SEBI Regulatory Disclaimer</strong>
                </div>
                <div class="disclaimer-content">
                    <p><strong>1. Not SEBI Registered:</strong> BroBillionaire is NOT a SEBI (Securities and Exchange
                        Board of India) registered investment advisor, research analyst, or portfolio manager. This tool
                        does not provide any investment advice.</p>

                    <p><strong>2. Educational Purpose Only:</strong> This AI Stock Analyzer is purely an
                        <strong>educational and informational tool</strong>. All analysis, signals, scores, and
                        recommendations generated are for learning purposes only and should NOT be construed as buy/sell
                        recommendations.
                    </p>

                    <p><strong>3. No Guarantee of Accuracy:</strong> The data and analysis shown may contain errors,
                        delays, or inaccuracies. We make no representations or warranties about the accuracy,
                        reliability, or completeness of any information provided.</p>

                    <p><strong>4. Market Risk Warning:</strong> Investments in securities markets are subject to market
                        risks. Read all related documents carefully before investing. Past performance is not indicative
                        of future results.</p>

                    <p><strong>5. Consult SEBI Registered Advisor:</strong> Before making any investment decisions,
                        please consult a <strong>SEBI-registered Investment Advisor</strong> or do your own thorough
                        research.</p>

                    <p><strong>6. No Liability:</strong> BroBillionaire, its creators, and affiliates shall not be
                        liable for any losses, damages, or claims arising from the use of this tool or reliance on
                        information provided herein.</p>

                    <p><strong>7. Data Source:</strong> Stock prices and data are fetched from third-party APIs and may
                        be delayed or inaccurate. Always verify with official NSE/BSE sources.</p>
                </div>
                <div class="disclaimer-footer">
                    <i class="fas fa-info-circle"></i> By using this tool, you acknowledge that you have read,
                    understood, and agree to this disclaimer.
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration for Live Data
        const YAHOO_FINANCE_API = 'https://query1.finance.yahoo.com/v8/finance/chart/';
        const YAHOO_QUOTE_API = 'https://query1.finance.yahoo.com/v7/finance/quote?symbols=';
        const YAHOO_NEWS_API = 'https://query1.finance.yahoo.com/v1/finance/search?q=';

        // Finnhub API - Free tier (60 calls/minute) - For accurate news, analyst data & financials
        const FINNHUB_API = 'https://finnhub.io/api/v1/';
        const FINNHUB_KEY = 'd64mv1hr01qnn9fpb46gd64mv1hr01qnn9fpb470';

        // Alpha Vantage API - Free tier (25 requests/day) - For accurate technical indicators
        // Get free API key at: https://www.alphavantage.co/support/#api-key
        const ALPHA_VANTAGE_API = 'https://www.alphavantage.co/query';
        const ALPHA_VANTAGE_KEY = 'NPZVG6YU6Y546FUQ'; // Your Alpha Vantage API key

        // GNews API - For stock news (100 requests/day free)
        const GNEWS_API = 'https://gnews.io/api/v4/search?q=';
        const GNEWS_KEY = 'demo'; // Free demo key

        // NewsData.io - Free tier (200 credits/day) - Great for Indian news
        // Get free API key at: https://newsdata.io/register (takes 30 seconds)
        const NEWSDATA_API = 'https://newsdata.io/api/1/latest';
        const NEWSDATA_KEY = 'pub_7094b03556174e9097a8ca7504cf3631';

        // Mediastack - Free tier (500 requests/month) - Backup for Indian news
        // Get free API key at: https://mediastack.com/signup/free
        const MEDIASTACK_API = 'http://api.mediastack.com/v1/news';
        const MEDIASTACK_KEY = ''; // Add your free key from mediastack.com

        // Indian RSS News Sources (Free, no API key needed)
        const INDIAN_NEWS_RSS = {
            economicTimes: 'https://economictimes.indiatimes.com/markets/rssfeeds/1977021501.cms',
            moneycontrol: 'https://www.moneycontrol.com/rss/marketreports.xml',
            livemint: 'https://www.livemint.com/rss/markets',
            businessStandard: 'https://www.business-standard.com/rss/markets-106.rss',
            ndtvProfit: 'https://feeds.feedburner.com/ndtvprofit-latest'
        };

        const CORS_PROXIES = [
            'https://api.allorigins.win/raw?url=',
            'https://corsproxy.io/?',
            'https://api.codetabs.com/v1/proxy?quest=',
            'https://cors-anywhere.herokuapp.com/',
            'https://thingproxy.freeboard.io/fetch/'
        ];

        // NSE Stock suffix mappings
        const nseStockSuffixes = {
            // Most stocks use .NS suffix for NSE
            defaultSuffix: '.NS'
        };

        // Comprehensive NSE Stock Database (500+ stocks with accurate Yahoo Finance symbols)
        const stockMetadata = {
            // NIFTY 50 Stocks
            'RELIANCE': { name: 'Reliance Industries Ltd', sector: 'Oil & Gas' },
            'RIL': { name: 'Reliance Industries Ltd', sector: 'Oil & Gas', yahooSymbol: 'RELIANCE' },
            'TCS': { name: 'Tata Consultancy Services', sector: 'IT Services' },
            'TCSLTD': { name: 'Tata Consultancy Services', sector: 'IT Services', yahooSymbol: 'TCS' },
            'HDFCBANK': { name: 'HDFC Bank Ltd', sector: 'Private Banking' },
            'HDFCBNK': { name: 'HDFC Bank Ltd', sector: 'Private Banking', yahooSymbol: 'HDFCBANK' },
            'INFY': { name: 'Infosys Ltd', sector: 'IT Services' },
            'INFOSYS': { name: 'Infosys Ltd', sector: 'IT Services', yahooSymbol: 'INFY' },
            'ICICIBANK': { name: 'ICICI Bank Ltd', sector: 'Private Banking' },
            'ICICI': { name: 'ICICI Bank Ltd', sector: 'Private Banking', yahooSymbol: 'ICICIBANK' },
            'BHARTIARTL': { name: 'Bharti Airtel Ltd', sector: 'Telecom' },
            'AIRTEL': { name: 'Bharti Airtel Ltd', sector: 'Telecom', yahooSymbol: 'BHARTIARTL' },
            'SBIN': { name: 'State Bank of India', sector: 'PSU Banking' },
            'SBI': { name: 'State Bank of India', sector: 'PSU Banking', yahooSymbol: 'SBIN' },
            'WIPRO': { name: 'Wipro Ltd', sector: 'IT Services' },
            'WIPROLTD': { name: 'Wipro Ltd', sector: 'IT Services', yahooSymbol: 'WIPRO' },
            'LT': { name: 'Larsen & Toubro Ltd', sector: 'Infrastructure' },
            'LARSEN': { name: 'Larsen & Toubro Ltd', sector: 'Infrastructure', yahooSymbol: 'LT' },
            'HINDUNILVR': { name: 'Hindustan Unilever', sector: 'FMCG' },
            'HUL': { name: 'Hindustan Unilever', sector: 'FMCG', yahooSymbol: 'HINDUNILVR' },
            'ASIANPAINT': { name: 'Asian Paints Ltd', sector: 'Consumer Goods' },
            'ASIANPAINTS': { name: 'Asian Paints Ltd', sector: 'Consumer Goods', yahooSymbol: 'ASIANPAINT' },
            'MARUTI': { name: 'Maruti Suzuki India', sector: 'Automobile' },
            'MARUTISUZUKI': { name: 'Maruti Suzuki India', sector: 'Automobile', yahooSymbol: 'MARUTI' },
            'TATAMOTORS': { name: 'Tata Motors Ltd', sector: 'Automobile' },
            'TAMO': { name: 'Tata Motors Ltd', sector: 'Automobile', yahooSymbol: 'TATAMOTORS' },
            'TATASTEEL': { name: 'Tata Steel Ltd', sector: 'Metals & Mining' },
            'TISCO': { name: 'Tata Steel Ltd', sector: 'Metals & Mining', yahooSymbol: 'TATASTEEL' },
            'SUNPHARMA': { name: 'Sun Pharmaceutical', sector: 'Pharmaceuticals' },
            'SUNPHARMAADV': { name: 'Sun Pharma Advanced', sector: 'Pharmaceuticals' },
            'BAJFINANCE': { name: 'Bajaj Finance Ltd', sector: 'NBFC' },
            'BAJAJFIN': { name: 'Bajaj Finance Ltd', sector: 'NBFC', yahooSymbol: 'BAJFINANCE' },
            'KOTAKBANK': { name: 'Kotak Mahindra Bank', sector: 'Private Banking' },
            'KOTAK': { name: 'Kotak Mahindra Bank', sector: 'Private Banking', yahooSymbol: 'KOTAKBANK' },
            'AXISBANK': { name: 'Axis Bank Ltd', sector: 'Private Banking' },
            'AXIS': { name: 'Axis Bank Ltd', sector: 'Private Banking', yahooSymbol: 'AXISBANK' },
            'ITC': { name: 'ITC Ltd', sector: 'FMCG' },
            'ITCLTD': { name: 'ITC Ltd', sector: 'FMCG', yahooSymbol: 'ITC' },
            'ADANIENT': { name: 'Adani Enterprises', sector: 'Conglomerate' },
            'AEL': { name: 'Adani Enterprises', sector: 'Conglomerate', yahooSymbol: 'ADANIENT' },
            'POWERGRID': { name: 'Power Grid Corp', sector: 'Power' },
            'PGCIL': { name: 'Power Grid Corp', sector: 'Power', yahooSymbol: 'POWERGRID' },
            'NTPC': { name: 'NTPC Ltd', sector: 'Power' },
            'NTPCLTD': { name: 'NTPC Ltd', sector: 'Power', yahooSymbol: 'NTPC' },
            'ONGC': { name: 'Oil & Natural Gas Corp', sector: 'Oil & Gas' },
            'OIL&GAS': { name: 'Oil & Natural Gas Corp', sector: 'Oil & Gas', yahooSymbol: 'ONGC' },
            'COALINDIA': { name: 'Coal India Ltd', sector: 'Mining' },
            'CIL': { name: 'Coal India Ltd', sector: 'Mining', yahooSymbol: 'COALINDIA' },
            'JSWSTEEL': { name: 'JSW Steel Ltd', sector: 'Metals & Mining' },
            'JSW': { name: 'JSW Steel Ltd', sector: 'Metals & Mining', yahooSymbol: 'JSWSTEEL' },
            'HCLTECH': { name: 'HCL Technologies', sector: 'IT Services' },
            'HCL': { name: 'HCL Technologies', sector: 'IT Services', yahooSymbol: 'HCLTECH' },
            'TECHM': { name: 'Tech Mahindra Ltd', sector: 'IT Services' },
            'TECHMAHINDRA': { name: 'Tech Mahindra Ltd', sector: 'IT Services', yahooSymbol: 'TECHM' },
            'ULTRACEMCO': { name: 'UltraTech Cement', sector: 'Cement' },
            'ULTRATECH': { name: 'UltraTech Cement', sector: 'Cement', yahooSymbol: 'ULTRACEMCO' },
            'TITAN': { name: 'Titan Company Ltd', sector: 'Consumer Goods' },
            'TITANCOMPANY': { name: 'Titan Company Ltd', sector: 'Consumer Goods', yahooSymbol: 'TITAN' },
            'NESTLEIND': { name: 'Nestle India Ltd', sector: 'FMCG' },
            'NESTLE': { name: 'Nestle India Ltd', sector: 'FMCG', yahooSymbol: 'NESTLEIND' },
            'BAJAJFINSV': { name: 'Bajaj Finserv Ltd', sector: 'NBFC' },
            'BAJAJFINSERV': { name: 'Bajaj Finserv Ltd', sector: 'NBFC', yahooSymbol: 'BAJAJFINSV' },
            'DRREDDY': { name: 'Dr. Reddys Laboratories', sector: 'Pharmaceuticals' },
            'DRL': { name: 'Dr. Reddys Laboratories', sector: 'Pharmaceuticals', yahooSymbol: 'DRREDDY' },
            'CIPLA': { name: 'Cipla Ltd', sector: 'Pharmaceuticals' },
            'CIPLALTD': { name: 'Cipla Ltd', sector: 'Pharmaceuticals', yahooSymbol: 'CIPLA' },
            'DIVISLAB': { name: 'Divis Laboratories', sector: 'Pharmaceuticals' },
            'DIVIS': { name: 'Divis Laboratories', sector: 'Pharmaceuticals', yahooSymbol: 'DIVISLAB' },
            'APOLLOHOSP': { name: 'Apollo Hospitals', sector: 'Healthcare' },
            'APOLLO': { name: 'Apollo Hospitals', sector: 'Healthcare', yahooSymbol: 'APOLLOHOSP' },
            'EICHERMOT': { name: 'Eicher Motors Ltd', sector: 'Automobile' },
            'EICHER': { name: 'Eicher Motors Ltd', sector: 'Automobile', yahooSymbol: 'EICHERMOT' },
            'ROYALENFIELD': { name: 'Eicher Motors Ltd', sector: 'Automobile', yahooSymbol: 'EICHERMOT' },
            'BPCL': { name: 'Bharat Petroleum Corp', sector: 'Oil & Gas' },
            'BHARATPETRO': { name: 'Bharat Petroleum Corp', sector: 'Oil & Gas', yahooSymbol: 'BPCL' },
            'GRASIM': { name: 'Grasim Industries', sector: 'Cement' },
            'GRASIMIND': { name: 'Grasim Industries', sector: 'Cement', yahooSymbol: 'GRASIM' },
            'HINDALCO': { name: 'Hindalco Industries', sector: 'Metals & Mining' },
            'HINDALCOIND': { name: 'Hindalco Industries', sector: 'Metals & Mining', yahooSymbol: 'HINDALCO' },
            'ADANIPORTS': { name: 'Adani Ports & SEZ', sector: 'Infrastructure' },
            'APSEZ': { name: 'Adani Ports & SEZ', sector: 'Infrastructure', yahooSymbol: 'ADANIPORTS' },
            'SBILIFE': { name: 'SBI Life Insurance', sector: 'Insurance' },
            'SBILIFEINS': { name: 'SBI Life Insurance', sector: 'Insurance', yahooSymbol: 'SBILIFE' },
            'HDFCLIFE': { name: 'HDFC Life Insurance', sector: 'Insurance' },
            'HDFCLIFEINS': { name: 'HDFC Life Insurance', sector: 'Insurance', yahooSymbol: 'HDFCLIFE' },
            'BRITANNIA': { name: 'Britannia Industries', sector: 'FMCG' },
            'BRIT': { name: 'Britannia Industries', sector: 'FMCG', yahooSymbol: 'BRITANNIA' },
            'INDUSINDBK': { name: 'IndusInd Bank', sector: 'Private Banking' },
            'INDUSIND': { name: 'IndusInd Bank', sector: 'Private Banking', yahooSymbol: 'INDUSINDBK' },
            'HEROMOTOCO': { name: 'Hero MotoCorp', sector: 'Automobile' },
            'HERO': { name: 'Hero MotoCorp', sector: 'Automobile', yahooSymbol: 'HEROMOTOCO' },
            'BAJAJ-AUTO': { name: 'Bajaj Auto Ltd', sector: 'Automobile' },
            'BAJAJAUTO': { name: 'Bajaj Auto Ltd', sector: 'Automobile', yahooSymbol: 'BAJAJ-AUTO' },
            'TATACONSUM': { name: 'Tata Consumer Products', sector: 'FMCG' },
            'SHREECEM': { name: 'Shree Cement Ltd', sector: 'Cement' },
            'SHREECEMENT': { name: 'Shree Cement Ltd', sector: 'Cement', yahooSymbol: 'SHREECEM' },
            'ICICIGI': { name: 'ICICI Lombard Insurance', sector: 'Insurance' },
            'ICICILOMBARD': { name: 'ICICI Lombard Insurance', sector: 'Insurance', yahooSymbol: 'ICICIGI' },
            'UPL': { name: 'UPL Ltd', sector: 'Chemicals' },
            'UPLLTD': { name: 'UPL Ltd', sector: 'Chemicals', yahooSymbol: 'UPL' },

            // NIFTY Next 50
            'ADANIGREEN': { name: 'Adani Green Energy', sector: 'Power' },
            'AGEL': { name: 'Adani Green Energy', sector: 'Power', yahooSymbol: 'ADANIGREEN' },
            'ADANITRANS': { name: 'Adani Energy Solutions', sector: 'Power', yahooSymbol: 'ADANIENSOL' },
            'ADANIENSOL': { name: 'Adani Energy Solutions', sector: 'Power' },
            'AMBUJACEM': { name: 'Ambuja Cements', sector: 'Cement' },
            'AMBUJA': { name: 'Ambuja Cements', sector: 'Cement', yahooSymbol: 'AMBUJACEM' },
            'AUROPHARMA': { name: 'Aurobindo Pharma', sector: 'Pharmaceuticals' },
            'AUROBINDO': { name: 'Aurobindo Pharma', sector: 'Pharmaceuticals', yahooSymbol: 'AUROPHARMA' },
            'BANKBARODA': { name: 'Bank of Baroda', sector: 'PSU Banking' },
            'BOB': { name: 'Bank of Baroda', sector: 'PSU Banking', yahooSymbol: 'BANKBARODA' },
            'BERGEPAINT': { name: 'Berger Paints India', sector: 'Consumer Goods' },
            'BERGER': { name: 'Berger Paints India', sector: 'Consumer Goods', yahooSymbol: 'BERGEPAINT' },
            'BIOCON': { name: 'Biocon Ltd', sector: 'Pharmaceuticals' },
            'BIOCONLTD': { name: 'Biocon Ltd', sector: 'Pharmaceuticals', yahooSymbol: 'BIOCON' },
            'BOSCHLTD': { name: 'Bosch Ltd', sector: 'Automobile' },
            'BOSCH': { name: 'Bosch Ltd', sector: 'Automobile', yahooSymbol: 'BOSCHLTD' },
            'CADILAHC': { name: 'Zydus Lifesciences', sector: 'Pharmaceuticals', yahooSymbol: 'ZYDUSLIFE' },
            'ZYDUSLIFE': { name: 'Zydus Lifesciences', sector: 'Pharmaceuticals' },
            'CHOLAFIN': { name: 'Cholamandalam Investment', sector: 'NBFC' },
            'CIFC': { name: 'Cholamandalam Investment', sector: 'NBFC', yahooSymbol: 'CHOLAFIN' },
            'COLPAL': { name: 'Colgate-Palmolive India', sector: 'FMCG' },
            'COLGATE': { name: 'Colgate-Palmolive India', sector: 'FMCG', yahooSymbol: 'COLPAL' },
            'CONCOR': { name: 'Container Corp of India', sector: 'Logistics' },
            'CCRI': { name: 'Container Corp of India', sector: 'Logistics', yahooSymbol: 'CONCOR' },
            'DABUR': { name: 'Dabur India Ltd', sector: 'FMCG' },
            'DABURIND': { name: 'Dabur India Ltd', sector: 'FMCG', yahooSymbol: 'DABUR' },
            'DLF': { name: 'DLF Ltd', sector: 'Real Estate' },
            'DLFLTD': { name: 'DLF Ltd', sector: 'Real Estate', yahooSymbol: 'DLF' },
            'GAIL': { name: 'GAIL India Ltd', sector: 'Oil & Gas' },
            'GAILIND': { name: 'GAIL India Ltd', sector: 'Oil & Gas', yahooSymbol: 'GAIL' },
            'GODREJCP': { name: 'Godrej Consumer Products', sector: 'FMCG' },
            'GODREJ': { name: 'Godrej Consumer Products', sector: 'FMCG', yahooSymbol: 'GODREJCP' },
            'GODREJPROP': { name: 'Godrej Properties', sector: 'Real Estate' },
            'GPL': { name: 'Godrej Properties', sector: 'Real Estate', yahooSymbol: 'GODREJPROP' },
            'HAVELLS': { name: 'Havells India Ltd', sector: 'Consumer Durables' },
            'HAVELLSIND': { name: 'Havells India Ltd', sector: 'Consumer Durables', yahooSymbol: 'HAVELLS' },
            'HINDPETRO': { name: 'Hindustan Petroleum', sector: 'Oil & Gas' },
            'HPCL': { name: 'Hindustan Petroleum', sector: 'Oil & Gas', yahooSymbol: 'HINDPETRO' },
            'ICICIPRULI': { name: 'ICICI Pru Life Insurance', sector: 'Insurance' },
            'ICICIPRU': { name: 'ICICI Pru Life Insurance', sector: 'Insurance', yahooSymbol: 'ICICIPRULI' },
            'INDUSTOWER': { name: 'Indus Towers Ltd', sector: 'Telecom' },
            'BHARTIINFRATEL': { name: 'Indus Towers Ltd', sector: 'Telecom', yahooSymbol: 'INDUSTOWER' },
            'IOC': { name: 'Indian Oil Corporation', sector: 'Oil & Gas' },
            'IOCL': { name: 'Indian Oil Corporation', sector: 'Oil & Gas', yahooSymbol: 'IOC' },
            'LUPIN': { name: 'Lupin Ltd', sector: 'Pharmaceuticals' },
            'LUPINLTD': { name: 'Lupin Ltd', sector: 'Pharmaceuticals', yahooSymbol: 'LUPIN' },
            'MARICO': { name: 'Marico Ltd', sector: 'FMCG' },
            'MARICOLTD': { name: 'Marico Ltd', sector: 'FMCG', yahooSymbol: 'MARICO' },
            'MCDOWELL-N': { name: 'United Spirits Ltd', sector: 'FMCG' },
            'UNITDSPR': { name: 'United Spirits Ltd', sector: 'FMCG', yahooSymbol: 'MCDOWELL-N' },
            'MOTHERSON': { name: 'Samvardhana Motherson', sector: 'Automobile' },
            'MUTHOOTFIN': { name: 'Muthoot Finance', sector: 'NBFC' },
            'MUTHOOT': { name: 'Muthoot Finance', sector: 'NBFC', yahooSymbol: 'MUTHOOTFIN' },
            'NAUKRI': { name: 'Info Edge India', sector: 'IT Services' },
            'INFOEDGE': { name: 'Info Edge India', sector: 'IT Services', yahooSymbol: 'NAUKRI' },
            'NMDC': { name: 'NMDC Ltd', sector: 'Mining' },
            'NMDCLTD': { name: 'NMDC Ltd', sector: 'Mining', yahooSymbol: 'NMDC' },
            'OFSS': { name: 'Oracle Financial Services', sector: 'IT Services' },
            'ORACLE': { name: 'Oracle Financial Services', sector: 'IT Services', yahooSymbol: 'OFSS' },
            'PAGEIND': { name: 'Page Industries', sector: 'Textiles' },
            'PETRONET': { name: 'Petronet LNG Ltd', sector: 'Oil & Gas' },
            'PLNG': { name: 'Petronet LNG Ltd', sector: 'Oil & Gas', yahooSymbol: 'PETRONET' },
            'PIDILITIND': { name: 'Pidilite Industries', sector: 'Chemicals' },
            'PIDILITE': { name: 'Pidilite Industries', sector: 'Chemicals', yahooSymbol: 'PIDILITIND' },
            'PNB': { name: 'Punjab National Bank', sector: 'PSU Banking' },
            'PUNJAB': { name: 'Punjab National Bank', sector: 'PSU Banking', yahooSymbol: 'PNB' },
            'RECLTD': { name: 'REC Ltd', sector: 'NBFC' },
            'REC': { name: 'REC Ltd', sector: 'NBFC', yahooSymbol: 'RECLTD' },
            'SAIL': { name: 'Steel Authority of India', sector: 'Metals & Mining' },
            'SAILSTEEL': { name: 'Steel Authority of India', sector: 'Metals & Mining', yahooSymbol: 'SAIL' },
            'SIEMENS': { name: 'Siemens Ltd', sector: 'Industrial' },
            'SIEMENSLTD': { name: 'Siemens Ltd', sector: 'Industrial', yahooSymbol: 'SIEMENS' },
            'TORNTPHARM': { name: 'Torrent Pharmaceuticals', sector: 'Pharmaceuticals' },
            'TORRENT': { name: 'Torrent Pharmaceuticals', sector: 'Pharmaceuticals', yahooSymbol: 'TORNTPHARM' },
            'TRENT': { name: 'Trent Ltd', sector: 'Retail' },
            'TRENTLTD': { name: 'Trent Ltd', sector: 'Retail', yahooSymbol: 'TRENT' },
            'ZUDIO': { name: 'Trent Ltd', sector: 'Retail', yahooSymbol: 'TRENT' },
            'VEDL': { name: 'Vedanta Ltd', sector: 'Metals & Mining' },
            'VEDANTA': { name: 'Vedanta Ltd', sector: 'Metals & Mining', yahooSymbol: 'VEDL' },
            'ETERNAL': { name: 'Eternal Ltd', sector: 'Internet' },
            'ZOMATO': { name: 'Eternal Ltd', sector: 'Internet', yahooSymbol: 'ETERNAL' },
            'ZOMATOLIMITED': { name: 'Eternal Ltd', sector: 'Internet', yahooSymbol: 'ETERNAL' },
            'PAYTM': { name: 'One97 Communications', sector: 'Fintech' },
            'ONE97': { name: 'One97 Communications', sector: 'Fintech', yahooSymbol: 'PAYTM' },
            'NYKAA': { name: 'FSN E-Commerce Ventures', sector: 'E-commerce' },
            'FSN': { name: 'FSN E-Commerce Ventures', sector: 'E-commerce', yahooSymbol: 'NYKAA' },
            'POLICYBZR': { name: 'PB Fintech Ltd', sector: 'Fintech' },
            'PBFINTECH': { name: 'PB Fintech Ltd', sector: 'Fintech', yahooSymbol: 'POLICYBZR' },
            'DELHIVERY': { name: 'Delhivery Ltd', sector: 'Logistics' },
            'DELHIVERYLTD': { name: 'Delhivery Ltd', sector: 'Logistics', yahooSymbol: 'DELHIVERY' },
            'LIC': { name: 'Life Insurance Corp', sector: 'Insurance', yahooSymbol: 'LICI' },
            'LICI': { name: 'Life Insurance Corp', sector: 'Insurance' },

            // Electric Vehicles & New Age
            'OLAELEC': { name: 'Ola Electric Mobility', sector: 'Electric Vehicles' },
            'OLA': { name: 'Ola Electric Mobility', sector: 'Electric Vehicles', yahooSymbol: 'OLAELEC' },
            'TATAPOW': { name: 'Tata Power Company', sector: 'Power', yahooSymbol: 'TATAPOWER' },
            'TATAELXSI': { name: 'Tata Elxsi Ltd', sector: 'IT Services' },
            'ELXSI': { name: 'Tata Elxsi Ltd', sector: 'IT Services', yahooSymbol: 'TATAELXSI' },
            'TATAPOWER': { name: 'Tata Power Company', sector: 'Power' },
            'M&M': { name: 'Mahindra & Mahindra', sector: 'Automobile', yahooSymbol: 'M%26M' },
            'MM': { name: 'Mahindra & Mahindra', sector: 'Automobile', yahooSymbol: 'M%26M' },
            'MAHINDRA': { name: 'Mahindra & Mahindra', sector: 'Automobile', yahooSymbol: 'M%26M' },
            'MAHINDCIE': { name: 'Mahindra CIE Auto', sector: 'Automobile' },
            'MPHASIS': { name: 'Mphasis Ltd', sector: 'IT Services' },
            'MPHASISLTD': { name: 'Mphasis Ltd', sector: 'IT Services', yahooSymbol: 'MPHASIS' },
            'LTIM': { name: 'LTIMindtree Ltd', sector: 'IT Services' },
            'LTIMINDTREE': { name: 'LTIMindtree Ltd', sector: 'IT Services', yahooSymbol: 'LTIM' },
            'LTTS': { name: 'L&T Technology Services', sector: 'IT Services' },
            'LTTECHSERV': { name: 'L&T Technology Services', sector: 'IT Services', yahooSymbol: 'LTTS' },
            'PERSISTENT': { name: 'Persistent Systems', sector: 'IT Services' },
            'PERSISTENTSYS': { name: 'Persistent Systems', sector: 'IT Services', yahooSymbol: 'PERSISTENT' },
            'COFORGE': { name: 'Coforge Ltd', sector: 'IT Services' },
            'COFORGELTD': { name: 'Coforge Ltd', sector: 'IT Services', yahooSymbol: 'COFORGE' },
            'HAPPSTMNDS': { name: 'Happiest Minds Tech', sector: 'IT Services' },
            'ROUTE': { name: 'Route Mobile Ltd', sector: 'IT Services' },
            'TANLA': { name: 'Tanla Platforms', sector: 'IT Services' },
            'KPITTECH': { name: 'KPIT Technologies', sector: 'IT Services' },
            'KPIT': { name: 'KPIT Technologies', sector: 'IT Services', yahooSymbol: 'KPITTECH' },
            'ZENSAR': { name: 'Zensar Technologies', sector: 'IT Services' },
            'BIRLASOFT': { name: 'Birlasoft Ltd', sector: 'IT Services' },
            'CYIENT': { name: 'Cyient Ltd', sector: 'IT Services' },
            'MINDTREE': { name: 'LTIMindtree Ltd', sector: 'IT Services', yahooSymbol: 'LTIM' },
            'NIITLTD': { name: 'NIIT Ltd', sector: 'IT Services' },
            'NEWGEN': { name: 'Newgen Software', sector: 'IT Services' },

            // Banking & Finance
            'YESBANK': { name: 'Yes Bank Ltd', sector: 'Private Banking' },
            'YES': { name: 'Yes Bank Ltd', sector: 'Private Banking', yahooSymbol: 'YESBANK' },
            'IDFCFIRSTB': { name: 'IDFC First Bank', sector: 'Private Banking' },
            'IDFCFIRST': { name: 'IDFC First Bank', sector: 'Private Banking', yahooSymbol: 'IDFCFIRSTB' },
            'FEDERALBNK': { name: 'Federal Bank Ltd', sector: 'Private Banking' },
            'FEDERAL': { name: 'Federal Bank Ltd', sector: 'Private Banking', yahooSymbol: 'FEDERALBNK' },
            'RBLBANK': { name: 'RBL Bank Ltd', sector: 'Private Banking' },
            'CANBK': { name: 'Canara Bank', sector: 'PSU Banking' },
            'CANARABANK': { name: 'Canara Bank', sector: 'PSU Banking', yahooSymbol: 'CANBK' },
            'UNIONBANK': { name: 'Union Bank of India', sector: 'PSU Banking' },
            'INDIANB': { name: 'Indian Bank', sector: 'PSU Banking' },
            'IOB': { name: 'Indian Overseas Bank', sector: 'PSU Banking' },
            'CENTRALBK': { name: 'Central Bank of India', sector: 'PSU Banking' },
            'BANKINDIA': { name: 'Bank of India', sector: 'PSU Banking' },
            'BOI': { name: 'Bank of India', sector: 'PSU Banking', yahooSymbol: 'BANKINDIA' },
            'MAHABANK': { name: 'Bank of Maharashtra', sector: 'PSU Banking' },
            'UCOBANK': { name: 'UCO Bank', sector: 'PSU Banking' },
            'J&KBANK': { name: 'J&K Bank Ltd', sector: 'Private Banking', yahooSymbol: 'J%26KBANK' },
            'JKBANK': { name: 'J&K Bank Ltd', sector: 'Private Banking', yahooSymbol: 'J%26KBANK' },
            'KARURVYSYA': { name: 'Karur Vysya Bank', sector: 'Private Banking' },
            'SOUTHBANK': { name: 'South Indian Bank', sector: 'Private Banking' },
            'DCBBANK': { name: 'DCB Bank Ltd', sector: 'Private Banking' },
            'BANDHANBNK': { name: 'Bandhan Bank Ltd', sector: 'Private Banking' },
            'BANDHAN': { name: 'Bandhan Bank Ltd', sector: 'Private Banking', yahooSymbol: 'BANDHANBNK' },
            'AUBANK': { name: 'AU Small Finance Bank', sector: 'Private Banking' },
            'AUSFB': { name: 'AU Small Finance Bank', sector: 'Private Banking', yahooSymbol: 'AUBANK' },
            'EQUITASBNK': { name: 'Equitas Small Finance', sector: 'Private Banking' },
            'UJJIVANSFB': { name: 'Ujjivan Small Finance', sector: 'Private Banking' },
            'HDFC': { name: 'HDFC Bank Ltd', sector: 'Private Banking', yahooSymbol: 'HDFCBANK' },
            'LICHSGFIN': { name: 'LIC Housing Finance', sector: 'NBFC' },
            'LICHF': { name: 'LIC Housing Finance', sector: 'NBFC', yahooSymbol: 'LICHSGFIN' },
            'CANFINHOME': { name: 'Can Fin Homes', sector: 'NBFC' },
            'PNBHOUSING': { name: 'PNB Housing Finance', sector: 'NBFC' },
            'IBULHSGFIN': { name: 'Indiabulls Housing', sector: 'NBFC' },
            'AAVAS': { name: 'Aavas Financiers', sector: 'NBFC' },
            'HOMEFIRST': { name: 'Home First Finance', sector: 'NBFC' },
            'APTUS': { name: 'Aptus Value Housing', sector: 'NBFC' },
            'SHRIRAMFIN': { name: 'Shriram Finance', sector: 'NBFC' },
            'SRTRANSFIN': { name: 'Shriram Finance', sector: 'NBFC', yahooSymbol: 'SHRIRAMFIN' },
            'M&MFIN': { name: 'Mahindra & Mahindra Fin', sector: 'NBFC', yahooSymbol: 'M%26MFIN' },
            'MMFIN': { name: 'Mahindra & Mahindra Fin', sector: 'NBFC', yahooSymbol: 'M%26MFIN' },
            'MANAPPURAM': { name: 'Manappuram Finance', sector: 'NBFC' },
            'MANAP': { name: 'Manappuram Finance', sector: 'NBFC', yahooSymbol: 'MANAPPURAM' },
            'CREDITACC': { name: 'CreditAccess Grameen', sector: 'NBFC' },
            'IIFL': { name: 'IIFL Finance Ltd', sector: 'NBFC' },
            'POONAWALLA': { name: 'Poonawalla Fincorp', sector: 'NBFC' },
            'JMFINANCIL': { name: 'JM Financial Ltd', sector: 'NBFC' },
            'SUNDARMFIN': { name: 'Sundaram Finance', sector: 'NBFC' },
            'L&TFH': { name: 'L&T Finance Holdings', sector: 'NBFC', yahooSymbol: 'L%26TFH' },
            'LTFH': { name: 'L&T Finance Holdings', sector: 'NBFC', yahooSymbol: 'L%26TFH' },
            'PFC': { name: 'Power Finance Corp', sector: 'NBFC' },
            'PFCLTD': { name: 'Power Finance Corp', sector: 'NBFC', yahooSymbol: 'PFC' },
            'IRFC': { name: 'Indian Railway Finance', sector: 'NBFC' },
            'IRFCLTD': { name: 'Indian Railway Finance', sector: 'NBFC', yahooSymbol: 'IRFC' },

            // Pharma & Healthcare
            'ALKEM': { name: 'Alkem Laboratories', sector: 'Pharmaceuticals' },
            'ALKEMLAB': { name: 'Alkem Laboratories', sector: 'Pharmaceuticals', yahooSymbol: 'ALKEM' },
            'APLLTD': { name: 'Alembic Pharma', sector: 'Pharmaceuticals' },
            'GLENMARK': { name: 'Glenmark Pharma', sector: 'Pharmaceuticals' },
            'GLENMARKPHARMA': { name: 'Glenmark Pharma', sector: 'Pharmaceuticals', yahooSymbol: 'GLENMARK' },
            'IPCALAB': { name: 'IPCA Laboratories', sector: 'Pharmaceuticals' },
            'LAURUSLABS': { name: 'Laurus Labs Ltd', sector: 'Pharmaceuticals' },
            'NATCOPHARM': { name: 'Natco Pharma', sector: 'Pharmaceuticals' },
            'GRANULES': { name: 'Granules India', sector: 'Pharmaceuticals' },
            'AARTIDRUGS': { name: 'Aarti Drugs Ltd', sector: 'Pharmaceuticals' },
            'SYNGENE': { name: 'Syngene International', sector: 'Pharmaceuticals' },
            'GLAND': { name: 'Gland Pharma Ltd', sector: 'Pharmaceuticals' },
            'ABBOTINDIA': { name: 'Abbott India Ltd', sector: 'Pharmaceuticals' },
            'GLAXO': { name: 'GlaxoSmithKline Pharma', sector: 'Pharmaceuticals' },
            'PFIZER': { name: 'Pfizer Ltd', sector: 'Pharmaceuticals' },
            'SANOFI': { name: 'Sanofi India Ltd', sector: 'Pharmaceuticals' },
            'AJANTPHARM': { name: 'Ajanta Pharma', sector: 'Pharmaceuticals' },
            'JBCHEPHARM': { name: 'JB Chemicals & Pharma', sector: 'Pharmaceuticals' },
            'SPARC': { name: 'Sun Pharma Advanced', sector: 'Pharmaceuticals' },
            'MAXHEALTH': { name: 'Max Healthcare', sector: 'Healthcare' },
            'MAX': { name: 'Max Healthcare', sector: 'Healthcare', yahooSymbol: 'MAXHEALTH' },
            'FORTIS': { name: 'Fortis Healthcare', sector: 'Healthcare' },
            'FORTISHC': { name: 'Fortis Healthcare', sector: 'Healthcare', yahooSymbol: 'FORTIS' },
            'METROPOLIS': { name: 'Metropolis Healthcare', sector: 'Healthcare' },
            'LALPATHLAB': { name: 'Dr Lal PathLabs', sector: 'Healthcare' },
            'LALPATH': { name: 'Dr Lal PathLabs', sector: 'Healthcare', yahooSymbol: 'LALPATHLAB' },
            'THYROCARE': { name: 'Thyrocare Technologies', sector: 'Healthcare' },
            'NARAYANA': { name: 'Narayana Hrudayalaya', sector: 'Healthcare' },
            'ASTER': { name: 'Aster DM Healthcare', sector: 'Healthcare' },
            'SHALBY': { name: 'Shalby Ltd', sector: 'Healthcare' },

            // Auto & Auto Ancillary
            'ASHOKLEY': { name: 'Ashok Leyland', sector: 'Automobile' },
            'ASHOK': { name: 'Ashok Leyland', sector: 'Automobile', yahooSymbol: 'ASHOKLEY' },
            'TVSMOTOR': { name: 'TVS Motor Company', sector: 'Automobile' },
            'TVS': { name: 'TVS Motor Company', sector: 'Automobile', yahooSymbol: 'TVSMOTOR' },
            'ESCORTS': { name: 'Escorts Kubota', sector: 'Automobile' },
            'ESCORTKUB': { name: 'Escorts Kubota', sector: 'Automobile', yahooSymbol: 'ESCORTS' },
            'SONACOMS': { name: 'Sona BLW Precision', sector: 'Automobile' },
            'BHARATFORG': { name: 'Bharat Forge Ltd', sector: 'Automobile' },
            'BHARATFORGE': { name: 'Bharat Forge Ltd', sector: 'Automobile', yahooSymbol: 'BHARATFORG' },
            'ENDURANCE': { name: 'Endurance Technologies', sector: 'Automobile' },
            'SUNDRMFAST': { name: 'Sundram Fasteners', sector: 'Automobile' },
            'MINDA': { name: 'Minda Industries', sector: 'Automobile' },
            'BALKRISIND': { name: 'Balkrishna Industries', sector: 'Automobile' },
            'BALKRISHNA': { name: 'Balkrishna Industries', sector: 'Automobile', yahooSymbol: 'BALKRISIND' },
            'APOLLOTYRE': { name: 'Apollo Tyres Ltd', sector: 'Automobile' },
            'APOLLOTYRES': { name: 'Apollo Tyres Ltd', sector: 'Automobile', yahooSymbol: 'APOLLOTYRE' },
            'MRF': { name: 'MRF Ltd', sector: 'Automobile' },
            'MRFLTD': { name: 'MRF Ltd', sector: 'Automobile', yahooSymbol: 'MRF' },
            'CEAT': { name: 'CEAT Ltd', sector: 'Automobile' },
            'JKTYRE': { name: 'JK Tyre & Industries', sector: 'Automobile' },
            'EXIDEIND': { name: 'Exide Industries', sector: 'Automobile' },
            'EXIDE': { name: 'Exide Industries', sector: 'Automobile', yahooSymbol: 'EXIDEIND' },
            'AMARAJABAT': { name: 'Amara Raja Batteries', sector: 'Automobile' },
            'AMARARAJA': { name: 'Amara Raja Batteries', sector: 'Automobile', yahooSymbol: 'AMARAJABAT' },
            'SCHAEFFLER': { name: 'Schaeffler India', sector: 'Automobile' },
            'SKFINDIA': { name: 'SKF India Ltd', sector: 'Automobile' },
            'VARROC': { name: 'Varroc Engineering', sector: 'Automobile' },
            'JINDALSTEEL': { name: 'Jindal Steel & Power', sector: 'Metals & Mining', yahooSymbol: 'JINDALSTEL' },

            // Metals & Mining
            'HINDZINC': { name: 'Hindustan Zinc', sector: 'Metals & Mining', fallbackPrice: 445 },
            'HINDCOPPER': { name: 'Hindustan Copper', sector: 'Metals & Mining', fallbackPrice: 220 },
            'NATIONALUM': { name: 'National Aluminium', sector: 'Metals & Mining', fallbackPrice: 175 },
            'MOIL': { name: 'MOIL Ltd', sector: 'Mining' },
            'APLAPOLLO': { name: 'APL Apollo Tubes', sector: 'Metals & Mining' },
            'RATNAMANI': { name: 'Ratnamani Metals', sector: 'Metals & Mining' },
            'JINDALSTEL': { name: 'Jindal Steel & Power', sector: 'Metals & Mining' },
            'WELSPUNLIV': { name: 'Welspun Living', sector: 'Textiles' },

            // Infrastructure & Construction
            'IRB': { name: 'IRB Infrastructure', sector: 'Infrastructure' },
            'GMRINFRA': { name: 'GMR Airports Infra', sector: 'Infrastructure' },
            'GMRAIRPORT': { name: 'GMR Airports Infra', sector: 'Infrastructure', yahooSymbol: 'GMRINFRA' },
            'KNRCON': { name: 'KNR Constructions', sector: 'Infrastructure' },
            'NCC': { name: 'NCC Ltd', sector: 'Infrastructure' },
            'NBCC': { name: 'NBCC India Ltd', sector: 'Infrastructure' },
            'PEL': { name: 'Piramal Enterprises', sector: 'Conglomerate' },
            'OBEROIRLTY': { name: 'Oberoi Realty', sector: 'Real Estate' },
            'OBEROI': { name: 'Oberoi Realty', sector: 'Real Estate', yahooSymbol: 'OBEROIRLTY' },
            'PRESTIGE': { name: 'Prestige Estates', sector: 'Real Estate' },
            'PRESTIGEEST': { name: 'Prestige Estates', sector: 'Real Estate', yahooSymbol: 'PRESTIGE' },
            'BRIGADE': { name: 'Brigade Enterprises', sector: 'Real Estate' },
            'SOBHA': { name: 'Sobha Ltd', sector: 'Real Estate' },
            'SUNTECK': { name: 'Sunteck Realty', sector: 'Real Estate' },
            'PHOENIXLTD': { name: 'Phoenix Mills Ltd', sector: 'Real Estate' },
            'MAHLIFE': { name: 'Mahindra Lifespace', sector: 'Real Estate' },
            'LODHA': { name: 'Macrotech Developers', sector: 'Real Estate' },
            'MACROTECH': { name: 'Macrotech Developers', sector: 'Real Estate', yahooSymbol: 'LODHA' },

            // Power & Energy
            'ADANIPOWER': { name: 'Adani Power Ltd', sector: 'Power' },
            'APL': { name: 'Adani Power Ltd', sector: 'Power', yahooSymbol: 'ADANIPOWER' },
            'JSL': { name: 'Jindal Stainless', sector: 'Metals & Mining' },
            'NHPC': { name: 'NHPC Ltd', sector: 'Power' },
            'NHPCLTD': { name: 'NHPC Ltd', sector: 'Power', yahooSymbol: 'NHPC' },
            'SJVN': { name: 'SJVN Ltd', sector: 'Power' },
            'TORNTPOWER': { name: 'Torrent Power', sector: 'Power' },
            'CESC': { name: 'CESC Ltd', sector: 'Power' },
            'JSWENERGY': { name: 'JSW Energy Ltd', sector: 'Power' },
            'JSWENERGYLTD': { name: 'JSW Energy Ltd', sector: 'Power', yahooSymbol: 'JSWENERGY' },
            'IEX': { name: 'Indian Energy Exchange', sector: 'Power' },
            'IEXCHANGE': { name: 'Indian Energy Exchange', sector: 'Power', yahooSymbol: 'IEX' },
            'RENERGYIND': { name: 'Rattanindia Ent', sector: 'Power' },

            // Oil & Gas
            'MRPL': { name: 'MRPL', sector: 'Oil & Gas' },
            'CHENNPETRO': { name: 'Chennai Petroleum', sector: 'Oil & Gas' },
            'CASTROLIND': { name: 'Castrol India', sector: 'Oil & Gas' },
            'GSPL': { name: 'Gujarat State Petro', sector: 'Oil & Gas' },
            'MGL': { name: 'Mahanagar Gas', sector: 'Oil & Gas' },
            'MAHANAGAR': { name: 'Mahanagar Gas', sector: 'Oil & Gas', yahooSymbol: 'MGL' },
            'IGL': { name: 'Indraprastha Gas', sector: 'Oil & Gas' },
            'INDRAPRASTHA': { name: 'Indraprastha Gas', sector: 'Oil & Gas', yahooSymbol: 'IGL' },
            'GUJGASLTD': { name: 'Gujarat Gas Ltd', sector: 'Oil & Gas' },
            'AEGISLOG': { name: 'Aegis Logistics', sector: 'Oil & Gas' },
            'OIL': { name: 'Oil India Ltd', sector: 'Oil & Gas' },

            // FMCG & Consumer
            'EMAMILTD': { name: 'Emami Ltd', sector: 'FMCG' },
            'VARUNBEV': { name: 'Varun Beverages', sector: 'FMCG', yahooSymbol: 'VBL' },
            'VBL': { name: 'Varun Beverages Ltd', sector: 'FMCG' },
            'RADICO': { name: 'Radico Khaitan', sector: 'FMCG' },
            'JUBLFOOD': { name: 'Jubilant FoodWorks', sector: 'FMCG' },
            'JUBILANT': { name: 'Jubilant FoodWorks', sector: 'FMCG', yahooSymbol: 'JUBLFOOD' },
            'WESTLIFE': { name: 'Westlife Development', sector: 'FMCG' },
            'DEVYANI': { name: 'Devyani International', sector: 'FMCG' },
            'SAPPHIRE': { name: 'Sapphire Foods', sector: 'FMCG' },
            'BATAINDIA': { name: 'Bata India Ltd', sector: 'Consumer Goods' },
            'BATA': { name: 'Bata India Ltd', sector: 'Consumer Goods', yahooSymbol: 'BATAINDIA' },
            'RELAXO': { name: 'Relaxo Footwears', sector: 'Consumer Goods' },
            'VMART': { name: 'V-Mart Retail', sector: 'Retail' },
            'DMART': { name: 'Avenue Supermarts', sector: 'Retail' },
            'AVENUE': { name: 'Avenue Supermarts', sector: 'Retail', yahooSymbol: 'DMART' },
            'SHOPERSTOP': { name: 'Shoppers Stop', sector: 'Retail' },
            'ARVIND': { name: 'Arvind Ltd', sector: 'Textiles' },
            'RAYMOND': { name: 'Raymond Ltd', sector: 'Textiles' },
            'ABFRL': { name: 'Aditya Birla Fashion', sector: 'Textiles' },
            'LAXMIMACH': { name: 'Lakshmi Machine Works', sector: 'Textiles' },
            'KPRMILL': { name: 'K.P.R. Mill Ltd', sector: 'Textiles' },

            // Consumer Durables
            'VOLTAS': { name: 'Voltas Ltd', sector: 'Consumer Durables' },
            'VOLTASLTD': { name: 'Voltas Ltd', sector: 'Consumer Durables', yahooSymbol: 'VOLTAS' },
            'BLUESTARCO': { name: 'Blue Star Ltd', sector: 'Consumer Durables' },
            'WHIRLPOOL': { name: 'Whirlpool of India', sector: 'Consumer Durables' },
            'SYMPHONY': { name: 'Symphony Ltd', sector: 'Consumer Durables' },
            'DIXON': { name: 'Dixon Technologies', sector: 'Consumer Durables' },
            'DIXONTECH': { name: 'Dixon Technologies', sector: 'Consumer Durables', yahooSymbol: 'DIXON' },
            'AMBER': { name: 'Amber Enterprises', sector: 'Consumer Durables' },
            'CROMPTON': { name: 'Crompton Greaves CE', sector: 'Consumer Durables' },
            'ORIENTELEC': { name: 'Orient Electric', sector: 'Consumer Durables' },
            'VGUARD': { name: 'V-Guard Industries', sector: 'Consumer Durables' },
            'POLYCAB': { name: 'Polycab India', sector: 'Consumer Durables' },
            'POLYCABIND': { name: 'Polycab India', sector: 'Consumer Durables', yahooSymbol: 'POLYCAB' },
            'KEI': { name: 'KEI Industries', sector: 'Consumer Durables' },
            'FINOLEX': { name: 'Finolex Cables', sector: 'Consumer Durables' },
            'RAJESHEXPO': { name: 'Rajesh Exports', sector: 'Consumer Goods' },
            'KALYANKJIL': { name: 'Kalyan Jewellers', sector: 'Consumer Goods' },
            'KALYAN': { name: 'Kalyan Jewellers', sector: 'Consumer Goods', yahooSymbol: 'KALYANKJIL' },

            // Chemicals & Specialty
            'AARTIIND': { name: 'Aarti Industries', sector: 'Chemicals' },
            'AARTI': { name: 'Aarti Industries', sector: 'Chemicals', yahooSymbol: 'AARTIIND' },
            'DEEPAKNTR': { name: 'Deepak Nitrite', sector: 'Chemicals' },
            'DEEPAK': { name: 'Deepak Nitrite', sector: 'Chemicals', yahooSymbol: 'DEEPAKNTR' },
            'NAVINFLUOR': { name: 'Navin Fluorine', sector: 'Chemicals' },
            'FINEORG': { name: 'Fine Organic Ind', sector: 'Chemicals' },
            'CLEAN': { name: 'Clean Science & Tech', sector: 'Chemicals' },
            'TATACHEM': { name: 'Tata Chemicals', sector: 'Chemicals' },
            'ALKYLAMINE': { name: 'Alkyl Amines Chemicals', sector: 'Chemicals' },
            'GALAXYSURF': { name: 'Galaxy Surfactants', sector: 'Chemicals' },
            'VINATIORG': { name: 'Vinati Organics', sector: 'Chemicals' },
            'PIIND': { name: 'PI Industries', sector: 'Chemicals' },
            'PIINDUSTRIES': { name: 'PI Industries', sector: 'Chemicals', yahooSymbol: 'PIIND' },
            'SRF': { name: 'SRF Ltd', sector: 'Chemicals' },
            'SRFLTD': { name: 'SRF Ltd', sector: 'Chemicals', yahooSymbol: 'SRF' },
            'BASF': { name: 'BASF India Ltd', sector: 'Chemicals' },
            'SUDARSCHEM': { name: 'Sudarshan Chem', sector: 'Chemicals' },
            'ROSSARI': { name: 'Rossari Biotech', sector: 'Chemicals' },
            'NEOGEN': { name: 'Neogen Chemicals', sector: 'Chemicals' },

            // Cement & Building Materials
            'DALMIAEBHA': { name: 'Dalmia Bharat', sector: 'Cement' },
            'RAMCOCEM': { name: 'Ramco Cements', sector: 'Cement' },
            'INDIACEM': { name: 'India Cements', sector: 'Cement' },
            'JKCEMENT': { name: 'JK Cement Ltd', sector: 'Cement' },
            'HEIDELBERG': { name: 'Heidelberg Cement', sector: 'Cement' },
            'BIRLACORPN': { name: 'Birla Corporation', sector: 'Cement' },
            'JKLAKSHMI': { name: 'JK Lakshmi Cement', sector: 'Cement' },
            'PRISMJOINTER': { name: 'Prism Johnson', sector: 'Cement' },
            'ORIENTCEM': { name: 'Orient Cement', sector: 'Cement' },
            'STARCEMENT': { name: 'Star Cement', sector: 'Cement' },
            'ACC': { name: 'ACC Ltd', sector: 'Cement' },
            'ACCLTD': { name: 'ACC Ltd', sector: 'Cement', yahooSymbol: 'ACC' },

            // Industrial & Capital Goods
            'ABB': { name: 'ABB India Ltd', sector: 'Industrial' },
            'ABBINDIA': { name: 'ABB India Ltd', sector: 'Industrial', yahooSymbol: 'ABB' },
            'CUMMINSIND': { name: 'Cummins India', sector: 'Industrial' },
            'THERMAX': { name: 'Thermax Ltd', sector: 'Industrial' },
            'GRINDWELL': { name: 'Grindwell Norton', sector: 'Industrial' },
            'ELGIEQUIP': { name: 'Elgi Equipments', sector: 'Industrial' },
            'AIAENG': { name: 'AIA Engineering', sector: 'Industrial' },
            'HONAUT': { name: 'Honeywell Automation', sector: 'Industrial' },
            'CGPOWER': { name: 'CG Power & Industrial', sector: 'Industrial' },
            'BHEL': { name: 'Bharat Heavy Elect', sector: 'Industrial' },
            'BHARATHEAVY': { name: 'Bharat Heavy Elect', sector: 'Industrial', yahooSymbol: 'BHEL' },
            'BEL': { name: 'Bharat Electronics', sector: 'Defence' },
            'BHARATELEC': { name: 'Bharat Electronics', sector: 'Defence', yahooSymbol: 'BEL' },
            'HAL': { name: 'Hindustan Aeronautics', sector: 'Defence' },
            'HINDAERO': { name: 'Hindustan Aeronautics', sector: 'Defence', yahooSymbol: 'HAL' },
            'COCHINSHIP': { name: 'Cochin Shipyard', sector: 'Defence' },
            'CSL': { name: 'Cochin Shipyard', sector: 'Defence', yahooSymbol: 'COCHINSHIP' },
            'MAZAGONDOK': { name: 'Mazagon Dock Ship', sector: 'Defence' },
            'MDL': { name: 'Mazagon Dock Ship', sector: 'Defence', yahooSymbol: 'MAZAGONDOK' },
            'GRSE': { name: 'Garden Reach Shipbuild', sector: 'Defence' },
            'BDL': { name: 'Bharat Dynamics', sector: 'Defence' },
            'BHARATDYN': { name: 'Bharat Dynamics', sector: 'Defence', yahooSymbol: 'BDL' },
            'MIDHANI': { name: 'Mishra Dhatu Nigam', sector: 'Defence' },
            'DATAPATTNS': { name: 'Data Patterns', sector: 'Defence' },

            // Telecom & Media
            'IDEA': { name: 'Vodafone Idea Ltd', sector: 'Telecom' },
            'VI': { name: 'Vodafone Idea Ltd', sector: 'Telecom', yahooSymbol: 'IDEA' },
            'TATACOMM': { name: 'Tata Communications', sector: 'Telecom' },
            'TATACOM': { name: 'Tata Communications', sector: 'Telecom', yahooSymbol: 'TATACOMM' },
            'SUNTV': { name: 'Sun TV Network', sector: 'Media' },
            'SUNTVNET': { name: 'Sun TV Network', sector: 'Media', yahooSymbol: 'SUNTV' },
            'ZEEL': { name: 'Zee Entertainment', sector: 'Media' },
            'ZEE': { name: 'Zee Entertainment', sector: 'Media', yahooSymbol: 'ZEEL' },
            'PVR': { name: 'PVR INOX Ltd', sector: 'Media', yahooSymbol: 'PVRINOX' },
            'PVRINOX': { name: 'PVR INOX Ltd', sector: 'Media' },
            'TVTODAY': { name: 'TV Today Network', sector: 'Media' },
            'DISHTV': { name: 'Dish TV India', sector: 'Media' },
            'NAZARA': { name: 'Nazara Technologies', sector: 'Gaming' },
            'NAZARATECH': { name: 'Nazara Technologies', sector: 'Gaming', yahooSymbol: 'NAZARA' },

            // Logistics & Transport
            'BLUEDART': { name: 'Blue Dart Express', sector: 'Logistics' },
            'BLUEDARTEXP': { name: 'Blue Dart Express', sector: 'Logistics', yahooSymbol: 'BLUEDART' },
            'TCI': { name: 'Transport Corp of India', sector: 'Logistics' },
            'GATI': { name: 'Gati Ltd', sector: 'Logistics' },
            'MAHSEAMLES': { name: 'Maharashtra Seamless', sector: 'Logistics' },
            'ALLCARGO': { name: 'Allcargo Logistics', sector: 'Logistics' },
            'IRCTC': { name: 'IRCTC Ltd', sector: 'Travel' },
            'INDIANRAIL': { name: 'IRCTC Ltd', sector: 'Travel', yahooSymbol: 'IRCTC' },
            'EASEMYTRIP': { name: 'Easy Trip Planners', sector: 'Travel' },
            'EMT': { name: 'Easy Trip Planners', sector: 'Travel', yahooSymbol: 'EASEMYTRIP' },
            'THOMASCOOK': { name: 'Thomas Cook India', sector: 'Travel' },
            'LEMONTRE': { name: 'Lemon Tree Hotels', sector: 'Hotels' },
            'INDHOTEL': { name: 'Indian Hotels Company', sector: 'Hotels' },
            'INDIANHOTELS': { name: 'Indian Hotels Company', sector: 'Hotels', yahooSymbol: 'INDHOTEL' },
            'TAJHOTELS': { name: 'Indian Hotels Company', sector: 'Hotels', yahooSymbol: 'INDHOTEL' },
            'EIHOTEL': { name: 'EIH Ltd', sector: 'Hotels' },
            'CHALET': { name: 'Chalet Hotels', sector: 'Hotels' },

            // Insurance
            'NIACL': { name: 'New India Assurance', sector: 'Insurance' },
            'GICRE': { name: 'General Insurance Corp', sector: 'Insurance' },
            'STARHEALTH': { name: 'Star Health Insurance', sector: 'Insurance' },
            'STAR': { name: 'Star Health Insurance', sector: 'Insurance', yahooSymbol: 'STARHEALTH' },

            // Miscellaneous
            'IRCON': { name: 'Ircon International', sector: 'Infrastructure' },
            'IRCONINT': { name: 'Ircon International', sector: 'Infrastructure', yahooSymbol: 'IRCON' },
            'RITES': { name: 'RITES Ltd', sector: 'Infrastructure' },
            'RITESLTD': { name: 'RITES Ltd', sector: 'Infrastructure', yahooSymbol: 'RITES' },
            'RVNL': { name: 'Rail Vikas Nigam', sector: 'Infrastructure' },
            'RAILVIKASN': { name: 'Rail Vikas Nigam', sector: 'Infrastructure', yahooSymbol: 'RVNL' },
            'RAILTEL': { name: 'RailTel Corporation', sector: 'Telecom' },
            'HUDCO': { name: 'HUDCO', sector: 'NBFC' },
            'NLCINDIA': { name: 'NLC India Ltd', sector: 'Power' },
            'HFCL': { name: 'HFCL Ltd', sector: 'Telecom' },
            'ITI': { name: 'ITI Ltd', sector: 'Telecom' },
            'BALRAMCHIN': { name: 'Balrampur Chini', sector: 'Sugar' },
            'RENUKA': { name: 'Shree Renuka Sugars', sector: 'Sugar' },
            'DWARIKESH': { name: 'Dwarikesh Sugar', sector: 'Sugar' },
            'TRIVENI': { name: 'Triveni Engineering', sector: 'Sugar' },
            'HATHWAY': { name: 'Hathway Cable', sector: 'Media' },
            'DEN': { name: 'Den Networks', sector: 'Media' },
            'CENTURYPLY': { name: 'Century Plyboards', sector: 'Building Materials' },
            'GREENPLY': { name: 'Greenply Industries', sector: 'Building Materials' },
            'ASTRAL': { name: 'Astral Ltd', sector: 'Building Materials' },
            'ASTRALLTD': { name: 'Astral Ltd', sector: 'Building Materials', yahooSymbol: 'ASTRAL' },
            'SUPREME': { name: 'Supreme Industries', sector: 'Building Materials' },
            'PRINCEPIPE': { name: 'Prince Pipes', sector: 'Building Materials' },
            'FLUOROCHEM': { name: 'Gujarat Fluorochem', sector: 'Chemicals' },
            'IIFLWAM': { name: 'IIFL Wealth Management', sector: 'NBFC' },
            'NESCO': { name: 'Nesco Ltd', sector: 'Real Estate' },
            'CAMS': { name: 'Computer Age Mgmt', sector: 'Fintech' },
            'CDSL': { name: 'CDSL', sector: 'Fintech' },
            'CDSLINDIA': { name: 'CDSL', sector: 'Fintech', yahooSymbol: 'CDSL' },
            'BSE': { name: 'BSE Ltd', sector: 'Fintech' },
            'BSELTD': { name: 'BSE Ltd', sector: 'Fintech', yahooSymbol: 'BSE' },
            'MCX': { name: 'Multi Commodity Exch', sector: 'Fintech' },
            'MCXINDIA': { name: 'Multi Commodity Exch', sector: 'Fintech', yahooSymbol: 'MCX' },
            'ANGELONE': { name: 'Angel One Ltd', sector: 'Fintech' },
            'ANGEL': { name: 'Angel One Ltd', sector: 'Fintech', yahooSymbol: 'ANGELONE' },
            'MOTILALOFS': { name: 'Motilal Oswal', sector: 'Fintech' },
            '5PAISA': { name: '5paisa Capital', sector: 'Fintech' },
            'FIVEPAISA': { name: '5paisa Capital', sector: 'Fintech', yahooSymbol: '5PAISA' },
            'ICICIBRK': { name: 'ICICI Securities', sector: 'Fintech', yahooSymbol: 'ISEC' },
            'ISEC': { name: 'ICICI Securities', sector: 'Fintech' },
            'HDFCSEC': { name: 'HDFC Securities', sector: 'Fintech' },
            'EDELWEISS': { name: 'Edelweiss Financial', sector: 'NBFC' },
            'CAMPUS': { name: 'Campus Activewear', sector: 'Consumer Goods' },
            'METROBRAND': { name: 'Metro Brands', sector: 'Consumer Goods' },
            'CARTRADE': { name: 'CarTrade Tech', sector: 'Internet' },
            'JUSTDIAL': { name: 'Just Dial Ltd', sector: 'Internet' },
            'JD': { name: 'Just Dial Ltd', sector: 'Internet', yahooSymbol: 'JUSTDIAL' },
            'TANLAPLATF': { name: 'Tanla Platforms', sector: 'IT Services' },
            'LATENTVIEW': { name: 'Latent View Analytics', sector: 'IT Services' },
            'FIVESTAR': { name: 'Five-Star Business', sector: 'NBFC' },
            'MAPMYINDIA': { name: 'CE Info Systems', sector: 'IT Services' }
        };

        // Fetch live stock data from Yahoo Finance - FAST parallel fetch with retry
        async function fetchLiveStockData(symbol) {
            const metadata = stockMetadata[symbol.toUpperCase()];
            // Use custom Yahoo symbol if defined in metadata, otherwise use standard NSE symbol
            const yahooSymbol = (metadata && metadata.yahooSymbol ? metadata.yahooSymbol : symbol.toUpperCase()) + '.NS';

            // Retry configuration - PRIORITIZE 100% ACCURACY OVER SPEED
            const MAX_RETRIES = 5; // Increased from 3 to 5 retries
            const INITIAL_TIMEOUT = 10000; // Increased from 5000ms to 10000ms (10 seconds)

            for (let retry = 0; retry < MAX_RETRIES; retry++) {
                const timeout = INITIAL_TIMEOUT + (retry * 5000); // Progressive timeout: 10s, 15s, 20s, 25s, 30s
                console.log(`üîç Attempt ${retry + 1}/${MAX_RETRIES} to fetch ACCURATE data for ${symbol}... (timeout: ${timeout}ms)`);

                // Try backend proxy FIRST, then CORS proxies as fallback
                const sources = [
                    `/api/yahoo/chart/${yahooSymbol}?interval=1d&range=1d`,
                    ...CORS_PROXIES.map(proxy => proxy + encodeURIComponent(YAHOO_FINANCE_API + yahooSymbol + '?interval=1d&range=1d'))
                ];

                const fetchPromises = sources.map(async (url) => {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), timeout);

                    try {
                        const response = await fetch(url, { signal: controller.signal });
                        clearTimeout(timeoutId);

                        if (!response.ok) throw new Error('Not OK');

                        const data = await response.json();

                        if (data.chart && data.chart.result && data.chart.result[0]) {
                            const result = data.chart.result[0];
                            const meta = result.meta;
                            const quote = result.indicators.quote[0];

                            // Get the most accurate current price with multiple fallbacks
                            // Priority: regularMarketPrice (real-time) > latest quote close > previousClose
                            let currentPrice = null;

                            // 1. regularMarketPrice is the real-time price from Yahoo Finance
                            if (meta.regularMarketPrice && meta.regularMarketPrice > 0) {
                                currentPrice = meta.regularMarketPrice;
                            }

                            // 2. Fallback to latest quote close (may lag during market hours)
                            if (!currentPrice && quote.close && Array.isArray(quote.close)) {
                                const closePrices = quote.close.filter(p => p !== null && p > 0);
                                if (closePrices.length > 0) {
                                    currentPrice = closePrices[closePrices.length - 1];
                                }
                            }

                            // 3. Final fallback to previousClose
                            if (!currentPrice && meta.previousClose && meta.previousClose > 0) {
                                currentPrice = meta.previousClose;
                            }

                            const previousClose = meta.chartPreviousClose || meta.previousClose;

                            // STRICT VALIDATION: Ensure we have real, accurate price data
                            if (!currentPrice || currentPrice <= 0) {
                                throw new Error('Invalid price data received');
                            }

                            // Additional validation: Ensure price is reasonable and not corrupted
                            if (currentPrice > 10000000 || !Number.isFinite(currentPrice)) {
                                throw new Error('Price data appears corrupted or unrealistic');
                            }

                            // Validate previous close exists
                            if (!previousClose || previousClose <= 0) {
                                throw new Error('Invalid previous close data');
                            }

                            const change = ((currentPrice - previousClose) / previousClose) * 100;

                            // Sanity check: Flag if change is too extreme (circuit limits in India are ¬±20%)
                            if (!Number.isFinite(change) || Math.abs(change) > 25) {
                                console.warn(`‚ö†Ô∏è Unusual price change detected: ${change.toFixed(2)}% - validating...`);
                                // Still accept it but flag for additional validation later
                            }

                            // Get high/low from recent data
                            const highs = quote.high ? quote.high.filter(h => h !== null && h > 0) : [];
                            const lows = quote.low ? quote.low.filter(l => l !== null && l > 0) : [];
                            const volumes = quote.volume ? quote.volume.filter(v => v !== null && v >= 0) : [];

                            // Calculate day high/low with validation
                            const dayHigh = highs.length > 0 ? Math.max(...highs) : currentPrice * 1.01;
                            const dayLow = lows.length > 0 ? Math.min(...lows) : currentPrice * 0.99;

                            // CROSS-VALIDATION: Current price must be within day's range
                            if (currentPrice > dayHigh * 1.01) {
                                console.warn(`‚ö†Ô∏è Price validation warning: Current price ${currentPrice} exceeds day high ${dayHigh}`);
                                // This could indicate stale or incorrect data
                            }
                            if (currentPrice < dayLow * 0.99) {
                                console.warn(`‚ö†Ô∏è Price validation warning: Current price ${currentPrice} below day low ${dayLow}`);
                            }

                            // Validate 52-week range
                            const fiftyTwoWeekHigh = meta.fiftyTwoWeekHigh || currentPrice * 1.2;
                            const fiftyTwoWeekLow = meta.fiftyTwoWeekLow || currentPrice * 0.7;

                            // Ensure 52-week range makes sense
                            if (fiftyTwoWeekHigh < fiftyTwoWeekLow) {
                                throw new Error('Invalid 52-week range data - high is less than low');
                            }

                            // Validate current price is within reasonable bounds of 52-week range
                            if (currentPrice > fiftyTwoWeekHigh * 1.5) {
                                console.warn(`‚ö†Ô∏è Price ${currentPrice} significantly exceeds 52-week high ${fiftyTwoWeekHigh}`);
                            }

                            console.log(`‚úÖ DATA VALIDATED: ${symbol} at ‚Çπ${currentPrice.toFixed(2)} (${change >= 0 ? '+' : ''}${change.toFixed(2)}%)`);
                            console.log(`   Range: ‚Çπ${dayLow.toFixed(2)} - ‚Çπ${dayHigh.toFixed(2)} | Volume: ${volumes.length > 0 ? volumes[volumes.length - 1].toLocaleString() : 'N/A'}`);

                            return {
                                success: true,
                                name: metadata ? metadata.name : symbol + ' Ltd',
                                sector: metadata ? metadata.sector : 'Unknown',
                                price: currentPrice,
                                change: change,
                                previousClose: previousClose,
                                dayHigh: dayHigh,
                                dayLow: dayLow,
                                volume: volumes.length > 0 ? volumes[volumes.length - 1] : 0,
                                avgVolume: volumes.length > 0 ? volumes.reduce((a, b) => a + b, 0) / volumes.length : 0,
                                fiftyTwoWeekHigh: fiftyTwoWeekHigh,
                                fiftyTwoWeekLow: fiftyTwoWeekLow,
                                marketCap: meta.marketCap || 0,
                                source: 'Yahoo Finance (Live)',
                                timestamp: new Date().toISOString(),
                                dataQuality: 'VALIDATED' // Mark as validated data
                            };
                        }
                        throw new Error('Invalid data structure');
                    } catch (error) {
                        clearTimeout(timeoutId);
                        throw error;
                    }
                });

                // Race all proxies - first success wins
                try {
                    const result = await Promise.any(fetchPromises);
                    return result;
                } catch (error) {
                    console.error(`Attempt ${retry + 1} failed for ${symbol}:`, error.message);
                    if (retry < MAX_RETRIES - 1) {
                        // Wait before retry with exponential backoff - PRIORITIZE ACCURACY
                        const waitTime = 2000 + (retry * 2000); // 2s, 4s, 6s, 8s
                        console.log(`‚è≥ Waiting ${waitTime}ms before retry to ensure data accuracy...`);
                        await new Promise(resolve => setTimeout(resolve, waitTime));
                    }
                }
            }

            // All retries failed - throw detailed error
            console.error('‚ùå All retry attempts failed for symbol:', symbol);
            throw new Error(`Unable to fetch live data for ${symbol}. All ${MAX_RETRIES} attempts failed across multiple data sources. Please check:\n1. Stock symbol is correct (e.g., RELIANCE, TCS, INFY)\n2. Internet connection is stable\n3. Stock is listed on NSE\n4. Try again in a few moments`);
        }

        // =============================================
        // DATA VALIDATION AND QUALITY CHECKS
        // =============================================

        // Validate stock data for accuracy and completeness - STRICT CHECKS
        function validateStockData(stockData, symbol) {
            const errors = [];
            const warnings = [];

            console.log(`üîç Running comprehensive data validation for ${symbol}...`);

            // 1. CRITICAL: Price validation
            if (!stockData.price || stockData.price <= 0) {
                errors.push('Invalid price data - price is zero or negative');
            }
            if (!Number.isFinite(stockData.price)) {
                errors.push('Price is not a valid number');
            }
            if (stockData.price > 10000000) {
                errors.push('Price exceeds reasonable maximum (‚Çπ1 crore)');
            }

            // 2. CRITICAL: Previous close validation
            if (!stockData.previousClose || stockData.previousClose <= 0) {
                errors.push('Invalid previous close data');
            }

            // 3. Change percentage sanity check (NSE/BSE circuit limits)
            if (!Number.isFinite(stockData.change)) {
                errors.push('Change percentage is not a valid number');
            }
            if (Math.abs(stockData.change) > 20) {
                warnings.push(`Large price change: ${stockData.change.toFixed(2)}% (exceeds typical circuit limit)`);
            }

            // 4. Day high/low validation - CRITICAL CONSISTENCY CHECK
            if (stockData.dayHigh && stockData.dayLow) {
                if (stockData.dayHigh < stockData.dayLow) {
                    errors.push('Day high is less than day low - data inconsistency');
                }
                if (stockData.price > stockData.dayHigh * 1.02) {
                    errors.push(`Current price ‚Çπ${stockData.price.toFixed(2)} exceeds day high ‚Çπ${stockData.dayHigh.toFixed(2)} - data inconsistency`);
                }
                if (stockData.price < stockData.dayLow * 0.98) {
                    errors.push(`Current price ‚Çπ${stockData.price.toFixed(2)} below day low ‚Çπ${stockData.dayLow.toFixed(2)} - data inconsistency`);
                }
            }

            // 5. 52-week range validation
            if (stockData.fiftyTwoWeekHigh && stockData.fiftyTwoWeekLow) {
                if (stockData.fiftyTwoWeekHigh < stockData.fiftyTwoWeekLow) {
                    errors.push('52-week high is less than 52-week low - data error');
                }
                if (stockData.price > stockData.fiftyTwoWeekHigh * 1.5) {
                    warnings.push(`Price significantly above 52-week high (${((stockData.price / stockData.fiftyTwoWeekHigh - 1) * 100).toFixed(1)}%)`);
                }
                if (stockData.price < stockData.fiftyTwoWeekLow * 0.5) {
                    warnings.push(`Price significantly below 52-week low (${((1 - stockData.price / stockData.fiftyTwoWeekLow) * 100).toFixed(1)}%)`);
                }
            }

            // 6. Volume validation
            if (stockData.volume < 0) {
                errors.push('Volume is negative - invalid data');
            }
            if (!Number.isFinite(stockData.volume)) {
                errors.push('Volume is not a valid number');
            }

            // 7. Source validation - MUST be live data
            if (!stockData.source || !stockData.source.toLowerCase().includes('live')) {
                errors.push('Data source is not marked as live - may be simulated');
            }

            // 8. Data quality marker check
            if (!stockData.dataQuality || stockData.dataQuality !== 'VALIDATED') {
                warnings.push('Data has not been validated at fetch time');
            }

            // 9. Timestamp freshness (critical during market hours)
            if (stockData.timestamp) {
                const dataAge = Date.now() - new Date(stockData.timestamp).getTime();
                if (dataAge > 10 * 60 * 1000) { // 10 minutes
                    warnings.push(`Data may be stale (${Math.floor(dataAge / 60000)} minutes old)`);
                }
            } else {
                warnings.push('No timestamp provided for data freshness check');
            }

            // 10. Cross-field consistency check
            if (stockData.previousClose && stockData.price && stockData.change) {
                const calculatedChange = ((stockData.price - stockData.previousClose) / stockData.previousClose) * 100;
                if (Math.abs(calculatedChange - stockData.change) > 0.1) {
                    errors.push(`Change percentage mismatch: reported ${stockData.change.toFixed(2)}%, calculated ${calculatedChange.toFixed(2)}%`);
                }
            }

            // Log results
            if (errors.length > 0) {
                console.error(`‚ùå DATA VALIDATION FAILED for ${symbol}:`);
                errors.forEach(err => console.error(`   ‚úó ${err}`));
                return { valid: false, errors, warnings };
            }

            if (warnings.length > 0) {
                console.warn(`‚ö†Ô∏è Data validation warnings for ${symbol}:`);
                warnings.forEach(warn => console.warn(`   ‚ö† ${warn}`));
            } else {
                console.log(`‚úÖ All validation checks PASSED for ${symbol} - Data is accurate and reliable`);
            }

            return { valid: true, errors: [], warnings };
        }

        // =============================================
        // LIVE NEWS FETCHING FROM MULTIPLE SOURCES
        // =============================================

        // Finnhub symbol mapping for Indian stocks (BSE format)
        function getFinnhubSymbol(symbol) {
            const metadata = stockMetadata[symbol.toUpperCase()];
            const baseSymbol = metadata && metadata.yahooSymbol ? metadata.yahooSymbol : symbol.toUpperCase();
            // Finnhub uses BSE: prefix for Indian stocks
            return baseSymbol + '.NS';
        }

        // Fetch stock news - Priority: Finnhub > Yahoo > Google News
        async function fetchStockNews(symbol, stockName) {
            const searchTerms = [symbol, stockName.split(' ')[0], stockName];
            let allNews = [];

            // Try Finnhub Company News first (most accurate for stocks)
            try {
                const today = new Date();
                const fromDate = new Date(today.getTime() - 30 * 24 * 60 * 60 * 1000); // 30 days ago
                const toDate = today.toISOString().split('T')[0];
                const fromStr = fromDate.toISOString().split('T')[0];

                // Search for company news using company name
                const searchQuery = encodeURIComponent(stockName.split(' ')[0] + ' India');
                const finnhubUrl = `${FINNHUB_API}company-news?symbol=${symbol}.NS&from=${fromStr}&to=${toDate}&token=${FINNHUB_KEY}`;

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);

                const response = await fetch(finnhubUrl, { signal: controller.signal });
                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    if (data && data.length > 0) {
                        allNews = data.slice(0, 6).map(item => ({
                            title: item.headline,
                            source: item.source || 'Finnhub',
                            time: formatNewsTime(item.datetime * 1000),
                            url: item.url,
                            sentiment: analyzeNewsSentiment(item.headline),
                            summary: item.summary
                        }));
                        console.log('‚úÖ Finnhub news loaded:', allNews.length, 'articles');
                    }
                }
            } catch (error) {
                console.log('Finnhub news fetch failed, trying alternatives:', error);
            }

            // Try NewsData.io API for Indian stock news (Free: 200 req/day)
            if (allNews.length === 0 && NEWSDATA_KEY && NEWSDATA_KEY !== 'demo') {
                try {
                    const query = encodeURIComponent(`${stockName.split(' ')[0]} stock`);
                    const newsDataUrl = `${NEWSDATA_API}?apikey=${NEWSDATA_KEY}&q=${query}&country=in&language=en&category=business`;

                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 6000);

                    const response = await fetch(newsDataUrl, { signal: controller.signal });
                    clearTimeout(timeoutId);

                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'success' && data.results && data.results.length > 0) {
                            allNews = data.results.slice(0, 6).map(item => ({
                                title: item.title,
                                source: item.source_id || 'NewsData.io',
                                time: formatNewsTime(new Date(item.pubDate).getTime()),
                                url: item.link,
                                sentiment: analyzeNewsSentiment(item.title),
                                summary: item.description
                            }));
                            console.log('‚úÖ NewsData.io news loaded:', allNews.length, 'articles');
                        }
                    }
                } catch (error) {
                    console.log('NewsData.io fetch failed:', error);
                }
            }

            // Fallback to Yahoo Finance news if Finnhub fails
            if (allNews.length === 0) {
                try {
                    for (const proxy of CORS_PROXIES) {
                        try {
                            const searchQuery = encodeURIComponent(`${symbol} NSE stock`);
                            const url = proxy + encodeURIComponent(`https://query1.finance.yahoo.com/v1/finance/search?q=${searchQuery}&newsCount=8&enableFuzzyQuery=false&quotesQueryId=tss_match_phrase_query`);

                            const controller = new AbortController();
                            const timeoutId = setTimeout(() => controller.abort(), 5000);

                            const response = await fetch(url, { signal: controller.signal });
                            clearTimeout(timeoutId);

                            if (response.ok) {
                                const data = await response.json();
                                if (data.news && data.news.length > 0) {
                                    allNews = data.news.map(item => ({
                                        title: item.title,
                                        source: item.publisher || 'Yahoo Finance',
                                        time: formatNewsTime(item.providerPublishTime * 1000),
                                        url: item.link,
                                        sentiment: analyzeNewsSentiment(item.title)
                                    }));
                                    break;
                                }
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                } catch (error) {
                    console.log('Yahoo News fetch failed:', error);
                }
            }

            // Fallback to Google News RSS if all else fails
            if (allNews.length === 0) {
                try {
                    for (const proxy of CORS_PROXIES) {
                        try {
                            const searchQuery = encodeURIComponent(`${stockName} stock NSE India`);
                            const rssUrl = `https://news.google.com/rss/search?q=${searchQuery}&hl=en-IN&gl=IN&ceid=IN:en`;
                            const url = proxy + encodeURIComponent(rssUrl);

                            const controller = new AbortController();
                            const timeoutId = setTimeout(() => controller.abort(), 5000);

                            const response = await fetch(url, { signal: controller.signal });
                            clearTimeout(timeoutId);

                            if (response.ok) {
                                const text = await response.text();
                                const parser = new DOMParser();
                                const xml = parser.parseFromString(text, 'text/xml');
                                const items = xml.querySelectorAll('item');

                                if (items.length > 0) {
                                    items.forEach((item, index) => {
                                        if (index < 6) {
                                            const title = item.querySelector('title')?.textContent || '';
                                            const pubDate = item.querySelector('pubDate')?.textContent || '';
                                            const source = item.querySelector('source')?.textContent || 'Google News';
                                            const link = item.querySelector('link')?.textContent || '#';

                                            allNews.push({
                                                title: title,
                                                source: source,
                                                time: formatNewsTime(new Date(pubDate).getTime()),
                                                url: link,
                                                sentiment: analyzeNewsSentiment(title)
                                            });
                                        }
                                    });
                                    break;
                                }
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                } catch (error) {
                    console.log('Google News RSS fetch failed:', error);
                }
            }

            // If still no stock-specific news, fetch latest Indian market news
            if (allNews.length === 0) {
                const marketNews = await fetchIndianMarketNews();
                return { news: marketNews, isMarketNews: true };
            }

            return { news: allNews, isMarketNews: false };
        }

        // Fetch latest Indian stock market news when stock-specific news not found
        async function fetchIndianMarketNews() {
            const marketNews = [];

            // Priority 1: Try NewsData.io for Indian business news (Free: 200 req/day)
            if (NEWSDATA_KEY && NEWSDATA_KEY !== 'demo' && NEWSDATA_KEY !== '') {
                try {
                    const newsDataUrl = `${NEWSDATA_API}?apikey=${NEWSDATA_KEY}&country=in&language=en&category=business`;

                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 6000);

                    const response = await fetch(newsDataUrl, { signal: controller.signal });
                    clearTimeout(timeoutId);

                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'success' && data.results && data.results.length > 0) {
                            data.results.slice(0, 6).forEach(item => {
                                if (!marketNews.some(n => n.title === item.title)) {
                                    marketNews.push({
                                        title: item.title,
                                        source: item.source_id || 'NewsData.io',
                                        time: formatNewsTime(new Date(item.pubDate).getTime()),
                                        url: item.link,
                                        sentiment: analyzeNewsSentiment(item.title)
                                    });
                                }
                            });
                            console.log('‚úÖ NewsData.io Indian market news loaded:', marketNews.length);
                        }
                    }
                } catch (error) {
                    console.log('NewsData.io market news failed:', error);
                }
            }

            // Priority 2: Try Livemint RSS (Great for Indian markets)
            if (marketNews.length < 4) {
                try {
                    for (const proxy of CORS_PROXIES) {
                        try {
                            const url = proxy + encodeURIComponent(INDIAN_NEWS_RSS.livemint);

                            const controller = new AbortController();
                            const timeoutId = setTimeout(() => controller.abort(), 5000);

                            const response = await fetch(url, { signal: controller.signal });
                            clearTimeout(timeoutId);

                            if (response.ok) {
                                const text = await response.text();
                                const parser = new DOMParser();
                                const xml = parser.parseFromString(text, 'text/xml');
                                const items = xml.querySelectorAll('item');

                                items.forEach((item, index) => {
                                    if (marketNews.length < 6) {
                                        const title = item.querySelector('title')?.textContent || '';
                                        const pubDate = item.querySelector('pubDate')?.textContent || '';
                                        const link = item.querySelector('link')?.textContent || '#';

                                        if (title && !marketNews.some(n => n.title === title)) {
                                            marketNews.push({
                                                title: title,
                                                source: 'Livemint',
                                                time: formatNewsTime(new Date(pubDate).getTime()),
                                                url: link,
                                                sentiment: analyzeNewsSentiment(title)
                                            });
                                        }
                                    }
                                });
                                if (marketNews.length >= 4) break;
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                } catch (error) {
                    console.log('Livemint RSS fetch failed:', error);
                }
            }

            // Priority 3: Try Business Standard RSS
            if (marketNews.length < 4) {
                try {
                    for (const proxy of CORS_PROXIES) {
                        try {
                            const url = proxy + encodeURIComponent(INDIAN_NEWS_RSS.businessStandard);

                            const controller = new AbortController();
                            const timeoutId = setTimeout(() => controller.abort(), 5000);

                            const response = await fetch(url, { signal: controller.signal });
                            clearTimeout(timeoutId);

                            if (response.ok) {
                                const text = await response.text();
                                const parser = new DOMParser();
                                const xml = parser.parseFromString(text, 'text/xml');
                                const items = xml.querySelectorAll('item');

                                items.forEach((item) => {
                                    if (marketNews.length < 6) {
                                        const title = item.querySelector('title')?.textContent || '';
                                        const pubDate = item.querySelector('pubDate')?.textContent || '';
                                        const link = item.querySelector('link')?.textContent || '#';

                                        if (title && !marketNews.some(n => n.title === title)) {
                                            marketNews.push({
                                                title: title,
                                                source: 'Business Standard',
                                                time: formatNewsTime(new Date(pubDate).getTime()),
                                                url: link,
                                                sentiment: analyzeNewsSentiment(title)
                                            });
                                        }
                                    }
                                });
                                if (marketNews.length >= 4) break;
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                } catch (error) {
                    console.log('Business Standard RSS fetch failed:', error);
                }
            }

            // Priority 4: Try Google News RSS for Indian stock market news
            if (marketNews.length < 3) {
                const marketSearchTerms = [
                    'Indian stock market today',
                    'Nifty Sensex today',
                    'NSE BSE market news'
                ];

                for (const searchTerm of marketSearchTerms) {
                    if (marketNews.length >= 5) break;

                    try {
                        for (const proxy of CORS_PROXIES) {
                            try {
                                const searchQuery = encodeURIComponent(searchTerm);
                                const rssUrl = `https://news.google.com/rss/search?q=${searchQuery}&hl=en-IN&gl=IN&ceid=IN:en`;
                                const url = proxy + encodeURIComponent(rssUrl);

                                const controller = new AbortController();
                                const timeoutId = setTimeout(() => controller.abort(), 5000);

                                const response = await fetch(url, { signal: controller.signal });
                                clearTimeout(timeoutId);

                                if (response.ok) {
                                    const text = await response.text();
                                    const parser = new DOMParser();
                                    const xml = parser.parseFromString(text, 'text/xml');
                                    const items = xml.querySelectorAll('item');

                                    if (items.length > 0) {
                                        items.forEach((item, index) => {
                                            if (marketNews.length < 6) {
                                                const title = item.querySelector('title')?.textContent || '';
                                                const pubDate = item.querySelector('pubDate')?.textContent || '';
                                                const source = item.querySelector('source')?.textContent || 'Google News';
                                                const link = item.querySelector('link')?.textContent || '#';

                                                // Avoid duplicates
                                                if (!marketNews.some(n => n.title === title)) {
                                                    marketNews.push({
                                                        title: title,
                                                        source: source,
                                                        time: formatNewsTime(new Date(pubDate).getTime()),
                                                        url: link,
                                                        sentiment: analyzeNewsSentiment(title)
                                                    });
                                                }
                                            }
                                        });
                                        if (marketNews.length >= 5) break;
                                    }
                                }
                            } catch (e) {
                                continue;
                            }
                        }
                    } catch (error) {
                        console.log('Market news fetch attempt failed:', error);
                    }
                }
            }

            // Try Economic Times RSS as another source
            if (marketNews.length < 3) {
                try {
                    for (const proxy of CORS_PROXIES) {
                        try {
                            const rssUrl = 'https://economictimes.indiatimes.com/markets/rssfeeds/1977021501.cms';
                            const url = proxy + encodeURIComponent(rssUrl);

                            const controller = new AbortController();
                            const timeoutId = setTimeout(() => controller.abort(), 5000);

                            const response = await fetch(url, { signal: controller.signal });
                            clearTimeout(timeoutId);

                            if (response.ok) {
                                const text = await response.text();
                                const parser = new DOMParser();
                                const xml = parser.parseFromString(text, 'text/xml');
                                const items = xml.querySelectorAll('item');

                                items.forEach((item, index) => {
                                    if (marketNews.length < 6) {
                                        const title = item.querySelector('title')?.textContent || '';
                                        const pubDate = item.querySelector('pubDate')?.textContent || '';
                                        const link = item.querySelector('link')?.textContent || '#';

                                        if (title && !marketNews.some(n => n.title === title)) {
                                            marketNews.push({
                                                title: title,
                                                source: 'Economic Times',
                                                time: formatNewsTime(new Date(pubDate).getTime()),
                                                url: link,
                                                sentiment: analyzeNewsSentiment(title)
                                            });
                                        }
                                    }
                                });
                                if (marketNews.length >= 3) break;
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                } catch (error) {
                    console.log('ET RSS fetch failed:', error);
                }
            }

            // Try Moneycontrol RSS
            if (marketNews.length < 3) {
                try {
                    for (const proxy of CORS_PROXIES) {
                        try {
                            const rssUrl = 'https://www.moneycontrol.com/rss/marketreports.xml';
                            const url = proxy + encodeURIComponent(rssUrl);

                            const controller = new AbortController();
                            const timeoutId = setTimeout(() => controller.abort(), 5000);

                            const response = await fetch(url, { signal: controller.signal });
                            clearTimeout(timeoutId);

                            if (response.ok) {
                                const text = await response.text();
                                const parser = new DOMParser();
                                const xml = parser.parseFromString(text, 'text/xml');
                                const items = xml.querySelectorAll('item');

                                items.forEach((item, index) => {
                                    if (marketNews.length < 6) {
                                        const title = item.querySelector('title')?.textContent || '';
                                        const pubDate = item.querySelector('pubDate')?.textContent || '';
                                        const link = item.querySelector('link')?.textContent || '#';

                                        if (title && !marketNews.some(n => n.title === title)) {
                                            marketNews.push({
                                                title: title,
                                                source: 'Moneycontrol',
                                                time: formatNewsTime(new Date(pubDate).getTime()),
                                                url: link,
                                                sentiment: analyzeNewsSentiment(title)
                                            });
                                        }
                                    }
                                });
                                if (marketNews.length >= 3) break;
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                } catch (error) {
                    console.log('Moneycontrol RSS fetch failed:', error);
                }
            }

            // Only if all real news sources fail, show minimal fallback
            if (marketNews.length === 0) {
                console.log('All news sources unavailable');
                return [{
                    title: 'Unable to fetch latest news. Please check your connection.',
                    source: 'System',
                    time: 'Now',
                    url: '#',
                    sentiment: 'neutral'
                }];
            }

            console.log('‚úÖ Indian market news loaded:', marketNews.length, 'articles');
            return marketNews.slice(0, 5);
        }

        // Enhanced sentiment analysis with more comprehensive keyword matching
        function analyzeNewsSentiment(title) {
            const positiveWords = ['surge', 'rally', 'gain', 'rise', 'jump', 'soar', 'bullish', 'upgrade', 'buy', 'growth', 'profit', 'beat', 'outperform', 'record', 'high', 'boost', 'positive', 'strong', 'breakthrough', 'success', 'up', 'expand', 'dividend', 'bonus', 'acquisition', 'partnership', 'deal', 'launches', 'wins', 'award', 'exceeds', 'surpasses'];
            const negativeWords = ['fall', 'drop', 'decline', 'crash', 'plunge', 'bearish', 'downgrade', 'sell', 'loss', 'miss', 'underperform', 'low', 'weak', 'concern', 'risk', 'warning', 'down', 'cut', 'negative', 'slump', 'fraud', 'scandal', 'investigation', 'lawsuit', 'debt', 'default', 'layoff', 'terminate', 'fails', 'disappoints'];

            const lowerTitle = title.toLowerCase();
            let score = 0;

            positiveWords.forEach(word => {
                if (lowerTitle.includes(word)) score += 1;
            });

            negativeWords.forEach(word => {
                if (lowerTitle.includes(word)) score -= 1;
            });

            if (score > 0) return 'positive';
            if (score < 0) return 'negative';
            return 'neutral';
        }

        // Format news timestamp
        function formatNewsTime(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;

            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
            if (diff < 604800000) return Math.floor(diff / 86400000) + 'd ago';
            return new Date(timestamp).toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });
        }

        // Render news feed in UI
        function renderNewsFeed(newsData) {
            const container = document.getElementById('newsFeedContainer');
            const badge = document.getElementById('newsBadge');
            const sourceInfo = document.querySelector('.news-source-info small');

            // Handle both old format (array) and new format (object with news and isMarketNews)
            let news, isMarketNews;
            if (Array.isArray(newsData)) {
                news = newsData;
                isMarketNews = false;
            } else if (newsData && newsData.news) {
                news = newsData.news;
                isMarketNews = newsData.isMarketNews;
            } else {
                news = [];
                isMarketNews = false;
            }

            if (!news || news.length === 0) {
                container.innerHTML = '<div class="no-news"><i class="fas fa-newspaper"></i> No recent news available</div>';
                badge.textContent = 'No News';
                badge.className = 'card-badge badge-neutral';
                if (sourceInfo) {
                    sourceInfo.innerHTML = '<i class="fas fa-info-circle"></i> News from multiple financial sources ‚Ä¢ Auto-refreshed';
                }
                return;
            }

            // Update source info based on whether it's stock-specific or market news
            if (sourceInfo) {
                if (isMarketNews) {
                    sourceInfo.innerHTML = '<i class="fas fa-chart-line"></i> Showing latest Indian market news ‚Ä¢ No stock-specific news found';
                } else {
                    sourceInfo.innerHTML = '<i class="fas fa-info-circle"></i> News related to this stock ‚Ä¢ Auto-refreshed';
                }
            }

            // Calculate overall news sentiment
            const sentiments = news.map(n => n.sentiment);
            const positive = sentiments.filter(s => s === 'positive').length;
            const negative = sentiments.filter(s => s === 'negative').length;

            let overallSentiment = 'Neutral';
            let badgeClass = 'badge-neutral';

            if (positive > negative + 1) {
                overallSentiment = 'Bullish';
                badgeClass = 'badge-bullish';
            } else if (negative > positive + 1) {
                overallSentiment = 'Bearish';
                badgeClass = 'badge-bearish';
            }

            badge.textContent = overallSentiment;
            badge.className = 'card-badge ' + badgeClass;

            // Add market news indicator if applicable
            const marketNewsNotice = isMarketNews ?
                `<div class="market-news-notice" style="padding: 8px 12px; background: rgba(255,193,7,0.1); border-left: 3px solid var(--orange); margin-bottom: 10px; font-size: 12px; color: var(--orange); border-radius: 4px;">
                    <i class="fas fa-bullhorn"></i> Showing latest Indian market news
                </div>` : '';

            container.innerHTML = marketNewsNotice + news.map(item => `
                <div class="news-item" onclick="window.open('${item.url}', '_blank')">
                    <div class="news-sentiment-icon ${item.sentiment}">
                        <i class="fas fa-${item.sentiment === 'positive' ? 'arrow-trend-up' : item.sentiment === 'negative' ? 'arrow-trend-down' : 'minus'}"></i>
                    </div>
                    <div class="news-content">
                        <div class="news-title">${item.title}</div>
                        <div class="news-meta">
                            <span class="news-source">${item.source}</span>
                            <span class="news-time"><i class="fas fa-clock"></i> ${item.time}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // =============================================
        // ANALYST RECOMMENDATIONS & PRICE TARGETS (Finnhub + Yahoo)
        // =============================================

        // Fetch analyst data from Finnhub
        // NOTE: Get a free Finnhub API key at https://finnhub.io/register if the current key expires
        async function fetchAnalystData(symbol, currentPrice) {
            const metadata = stockMetadata[symbol.toUpperCase()];
            const finnhubSymbol = ((metadata && metadata.yahooSymbol) ? metadata.yahooSymbol : symbol.toUpperCase()) + '.NS';

            let analystData = null;

            try {
                const recUrl = `${FINNHUB_API}stock/recommendation?symbol=${finnhubSymbol}&token=${FINNHUB_KEY}`;
                const targetUrl = `${FINNHUB_API}stock/price-target?symbol=${finnhubSymbol}&token=${FINNHUB_KEY}`;

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);

                const [recResponse, targetResponse] = await Promise.all([
                    fetch(recUrl, { signal: controller.signal }).catch(() => null),
                    fetch(targetUrl, { signal: controller.signal }).catch(() => null)
                ]);
                clearTimeout(timeoutId);

                let recommendations = null;
                let priceTarget = null;

                if (recResponse && recResponse.ok) {
                    const recData = await recResponse.json();
                    if (recData && recData.length > 0) {
                        recommendations = recData[0];
                        console.log('‚úÖ Finnhub recommendations loaded:', recommendations);
                    }
                }

                if (targetResponse && targetResponse.ok) {
                    priceTarget = await targetResponse.json();
                    if (priceTarget && priceTarget.targetHigh) {
                        console.log('‚úÖ Finnhub price targets loaded:', priceTarget);
                    } else {
                        priceTarget = null;
                    }
                }

                if (recommendations || priceTarget) {
                    const totalAnalysts = (recommendations?.strongBuy || 0) + (recommendations?.buy || 0) +
                        (recommendations?.hold || 0) + (recommendations?.sell || 0) + (recommendations?.strongSell || 0);

                    analystData = {
                        targetHigh: priceTarget?.targetHigh || null,
                        targetLow: priceTarget?.targetLow || null,
                        targetMean: priceTarget?.targetMean || null,
                        targetMedian: priceTarget?.targetMedian || null,
                        recommendation: recommendations ?
                            (recommendations.buy > recommendations.sell ? 'buy' :
                                recommendations.sell > recommendations.buy ? 'sell' : 'hold') : 'hold',
                        numberOfAnalysts: totalAnalysts,
                        strongBuy: recommendations?.strongBuy || 0,
                        buy: recommendations?.buy || 0,
                        hold: recommendations?.hold || 0,
                        sell: recommendations?.sell || 0,
                        strongSell: recommendations?.strongSell || 0,
                        source: 'Finnhub (Live)'
                    };
                }
            } catch (error) {
                console.log('Finnhub analyst data fetch failed:', error);
            }

            if (!analystData) {
                console.warn('‚ö†Ô∏è Analyst data unavailable - Finnhub API may need a new key (https://finnhub.io/register)');
                return null;
            }

            return analystData;
        }

        // Fetch basic financials from Finnhub (PE, EPS, etc.)
        async function fetchFinnhubFinancials(symbol) {
            try {
                const finnhubSymbol = symbol.toUpperCase() + '.NS';
                const url = `${FINNHUB_API}stock/metric?symbol=${finnhubSymbol}&metric=all&token=${FINNHUB_KEY}`;

                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);

                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    if (data && data.metric) {
                        console.log('‚úÖ Finnhub financials loaded:', data.metric);
                        return {
                            pe: data.metric.peNormalizedAnnual || data.metric.peExclExtraTTM || null,
                            pb: data.metric.pbQuarterly || data.metric.pbAnnual || null,
                            eps: data.metric.epsNormalizedAnnual || data.metric.epsTTM || null,
                            roe: data.metric.roeRfy || data.metric.roeTTM || null,
                            divYield: data.metric.dividendYieldIndicatedAnnual || null,
                            beta: data.metric.beta || null,
                            marketCap: data.metric.marketCapitalization || null,
                            fiftyTwoWeekHigh: data.metric['52WeekHigh'] || null,
                            fiftyTwoWeekLow: data.metric['52WeekLow'] || null,
                            source: 'Finnhub'
                        };
                    }
                }
            } catch (error) {
                console.log('Finnhub financials fetch failed:', error);
            }
            return null;
        }

        // Generate analyst estimates when API fails
        function generateAnalystEstimates(symbol, currentPrice) {
            const metadata = stockMetadata[symbol.toUpperCase()];
            const sector = metadata ? metadata.sector : 'Unknown';

            // Sector-based target multipliers
            const sectorMultipliers = {
                'IT Services': { high: 1.35, low: 0.88, avg: 1.15 },
                'Private Banking': { high: 1.30, low: 0.90, avg: 1.12 },
                'PSU Banking': { high: 1.25, low: 0.85, avg: 1.08 },
                'FMCG': { high: 1.20, low: 0.92, avg: 1.10 },
                'Pharmaceuticals': { high: 1.30, low: 0.88, avg: 1.12 },
                'Oil & Gas': { high: 1.22, low: 0.90, avg: 1.08 },
                'Automobile': { high: 1.28, low: 0.88, avg: 1.12 },
                'Metals & Mining': { high: 1.35, low: 0.80, avg: 1.10 },
                'Power': { high: 1.25, low: 0.88, avg: 1.10 },
                'Telecom': { high: 1.30, low: 0.85, avg: 1.12 },
                'Infrastructure': { high: 1.28, low: 0.85, avg: 1.10 },
                'Default': { high: 1.25, low: 0.88, avg: 1.10 }
            };

            const mult = sectorMultipliers[sector] || sectorMultipliers['Default'];
            const variance = () => (Math.random() - 0.5) * 0.08;

            const totalAnalysts = 8 + Math.floor(Math.random() * 15);
            const buyRatio = 0.35 + Math.random() * 0.35;
            const holdRatio = 0.25 + Math.random() * 0.25;
            const sellRatio = 1 - buyRatio - holdRatio;

            return {
                targetHigh: currentPrice * (mult.high + variance()),
                targetLow: currentPrice * (mult.low + variance()),
                targetMean: currentPrice * (mult.avg + variance() * 0.5),
                targetMedian: currentPrice * (mult.avg + variance() * 0.3),
                recommendation: buyRatio > 0.5 ? 'buy' : buyRatio > 0.35 ? 'hold' : 'sell',
                numberOfAnalysts: totalAnalysts,
                strongBuy: Math.floor(totalAnalysts * buyRatio * 0.4),
                buy: Math.floor(totalAnalysts * buyRatio * 0.6),
                hold: Math.floor(totalAnalysts * holdRatio),
                sell: Math.floor(totalAnalysts * sellRatio * 0.7),
                strongSell: Math.floor(totalAnalysts * sellRatio * 0.3),
                source: 'Estimated (Live data unavailable)'
            };
        }

        // =============================================
        // TECHNICAL INDICATORS FROM YAHOO HISTORICAL DATA
        // =============================================

        // Global variable to store fetched technical indicators
        let liveTechnicalIndicators = null;

        // Generate fallback technical indicators when API fails
        function generateFallbackTechnicalIndicators(currentPrice) {
            // Generate realistic pseudo-random indicators based on price
            const seed = Math.floor(currentPrice) % 100;
            const pseudoRandom = (offset) => {
                const x = Math.sin((seed + offset) * 12.9898) * 43758.5453;
                return x - Math.floor(x);
            };

            const rsi = 30 + pseudoRandom(1) * 40; // 30-70 range
            const williamsR = -80 + pseudoRandom(2) * 60; // -80 to -20
            const cci = -100 + pseudoRandom(3) * 200; // -100 to +100
            const mfi = 25 + pseudoRandom(4) * 50; // 25-75 range
            const stochK = 20 + pseudoRandom(5) * 60; // 20-80 range
            const adx = 15 + pseudoRandom(6) * 30; // 15-45 range
            const roc = -5 + pseudoRandom(7) * 10; // -5% to +5%
            const aroonOsc = -50 + pseudoRandom(8) * 100; // -50 to +50

            const vwap = currentPrice * (0.98 + pseudoRandom(9) * 0.04); // ¬±2% of price
            const ema20 = currentPrice * (0.97 + pseudoRandom(10) * 0.06);
            const sma50 = currentPrice * (0.95 + pseudoRandom(11) * 0.10);

            const obvTrend = pseudoRandom(12) > 0.5 ? 'bullish' : pseudoRandom(12) > 0.3 ? 'neutral' : 'bearish';

            // Pivot points based on simulated previous day
            const prevHigh = currentPrice * 1.02;
            const prevLow = currentPrice * 0.98;
            const prevClose = currentPrice * (0.99 + pseudoRandom(13) * 0.02);
            const pivot = (prevHigh + prevLow + prevClose) / 3;

            return {
                rsi: rsi,
                macd: pseudoRandom(14) * 2 - 1,
                macdSignal: pseudoRandom(15) * 1.5 - 0.75,
                macdHistogram: pseudoRandom(16) * 1 - 0.5,
                ema20: ema20,
                sma50: sma50,
                sma200: sma50 * 0.95,
                bollingerUpper: currentPrice * 1.05,
                bollingerMiddle: currentPrice,
                bollingerLower: currentPrice * 0.95,
                bollingerPosition: pseudoRandom(17) > 0.6 ? 'middle' : pseudoRandom(17) > 0.3 ? 'lower-mid' : 'upper-mid',
                stochK: stochK,
                stochD: stochK - 5 + pseudoRandom(18) * 10,
                adx: adx,
                volumeRatio: 0.8 + pseudoRandom(19) * 0.4,
                atr: currentPrice * 0.02,
                volatility: 1.5 + pseudoRandom(20) * 2,
                williamsR: williamsR,
                cci: cci,
                obv: 1000000 + pseudoRandom(21) * 5000000,
                obvTrend: obvTrend,
                mfi: mfi,
                vwap: vwap,
                pivotPoints: {
                    pivot: pivot,
                    r1: (2 * pivot) - prevLow,
                    s1: (2 * pivot) - prevHigh,
                    r2: pivot + (prevHigh - prevLow),
                    s2: pivot - (prevHigh - prevLow),
                    r3: prevHigh + 2 * (pivot - prevLow),
                    s3: prevLow - 2 * (prevHigh - pivot)
                },
                roc: roc,
                aroonUp: 50 + pseudoRandom(22) * 50,
                aroonDown: 50 + pseudoRandom(23) * 50,
                aroonOscillator: aroonOsc,
                currentPrice: currentPrice,
                source: 'Estimated (API unavailable)'
            };
        }

        // Fetch historical data from Yahoo Finance and calculate real technical indicators
        async function fetchTechnicalIndicators(symbol) {
            const metadata = stockMetadata[symbol.toUpperCase()];
            const yahooSymbol = (metadata && metadata.yahooSymbol ? metadata.yahooSymbol : symbol.toUpperCase()) + '.NS';

            try {
                // Fetch 3 months of daily data for accurate indicator calculations
                // Try backend proxy FIRST, then CORS proxies as fallback
                const sources = [
                    `/api/yahoo/chart/${yahooSymbol}?interval=1d&range=3mo`,
                    ...CORS_PROXIES.map(proxy => proxy + encodeURIComponent(
                        `${YAHOO_FINANCE_API}${yahooSymbol}?interval=1d&range=3mo`
                    ))
                ];

                const fetchPromises = sources.map(async (url) => {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 8000);

                    try {
                        const response = await fetch(url, { signal: controller.signal });
                        clearTimeout(timeoutId);

                        if (!response.ok) throw new Error('Not OK');
                        const data = await response.json();

                        if (data.chart && data.chart.result && data.chart.result[0]) {
                            const result = data.chart.result[0];
                            const quotes = result.indicators.quote[0];

                            // Keep arrays aligned by filtering out indices where ANY value is null
                            const closes = [];
                            const highs = [];
                            const lows = [];
                            const volumes = [];

                            for (let i = 0; i < quotes.close.length; i++) {
                                if (quotes.close[i] !== null && quotes.high[i] !== null &&
                                    quotes.low[i] !== null && quotes.volume[i] !== null) {
                                    closes.push(quotes.close[i]);
                                    highs.push(quotes.high[i]);
                                    lows.push(quotes.low[i]);
                                    volumes.push(quotes.volume[i]);
                                }
                            }

                            if (closes.length >= 20) {
                                return calculateTechnicalIndicators(closes, highs, lows, volumes);
                            }
                        }
                        throw new Error('Insufficient data');
                    } catch (error) {
                        clearTimeout(timeoutId);
                        throw error;
                    }
                });

                const indicators = await Promise.any(fetchPromises);
                console.log('‚úÖ Technical indicators calculated from Yahoo historical data:', indicators);
                return indicators;

            } catch (error) {
                console.log('‚ö†Ô∏è Could not fetch historical data for technical indicators:', error);
                return null;
            }
        }

        // Calculate all technical indicators from historical price data
        function calculateTechnicalIndicators(closes, highs, lows, volumes) {
            const n = closes.length;
            const currentPrice = closes[n - 1];

            // ===== RSI (14-period) =====
            const rsi = calculateRSI(closes, 14);

            // ===== MACD (12, 26, 9) =====
            const macd = calculateMACD(closes);

            // ===== Moving Averages =====
            const ema20 = calculateEMA(closes, 20);
            const sma50 = calculateSMA(closes, 50);
            const sma200 = closes.length >= 200 ? calculateSMA(closes, 200) : null;

            // ===== Bollinger Bands (20, 2) =====
            const bb = calculateBollingerBands(closes, 20, 2);

            // ===== Stochastic Oscillator (14, 3, 3) =====
            const stochastic = calculateStochastic(highs, lows, closes, 14, 3);

            // ===== ADX (14-period) =====
            const adx = calculateADX(highs, lows, closes, 14);

            // ===== Volume Analysis =====
            const avgVolume = volumes.slice(-20).reduce((a, b) => a + b, 0) / 20;
            const currentVolume = volumes[volumes.length - 1];
            const volumeRatio = currentVolume / avgVolume;

            // ===== ATR (14-period) for volatility =====
            const atr = calculateATR(highs, lows, closes, 14);
            const volatility = (atr / currentPrice) * 100;

            // ===== NEW INDICATORS =====
            // Williams %R (14-period)
            const williamsR = calculateWilliamsR(highs, lows, closes, 14);

            // CCI (20-period)
            const cci = calculateCCI(highs, lows, closes, 20);

            // OBV with trend analysis
            const obv = calculateOBV(closes, volumes);

            // MFI (14-period)
            const mfi = calculateMFI(highs, lows, closes, volumes, 14);

            // VWAP approximation
            const vwap = calculateVWAP(highs, lows, closes, volumes);

            // Pivot Points (using previous day)
            const prevDayHigh = highs[n - 2] || highs[n - 1];
            const prevDayLow = lows[n - 2] || lows[n - 1];
            const prevDayClose = closes[n - 2] || closes[n - 1];
            const pivotPoints = calculatePivotPoints(prevDayHigh, prevDayLow, prevDayClose);

            // ROC (10-period)
            const roc = calculateROC(closes, 10);

            // AROON (25-period)
            const aroon = calculateAROON(highs, lows, 25);

            return {
                rsi: rsi,
                macd: macd.macd,
                macdSignal: macd.signal,
                macdHistogram: macd.histogram,
                ema20: ema20,
                sma50: sma50,
                sma200: sma200,
                bollingerUpper: bb.upper,
                bollingerMiddle: bb.middle,
                bollingerLower: bb.lower,
                bollingerPosition: bb.position,
                stochK: stochastic.k,
                stochD: stochastic.d,
                adx: adx,
                volumeRatio: volumeRatio,
                atr: atr,
                volatility: volatility,
                // New indicators
                williamsR: williamsR,
                cci: cci,
                obv: obv.obv,
                obvTrend: obv.trend,
                mfi: mfi,
                vwap: vwap,
                pivotPoints: pivotPoints,
                roc: roc,
                aroonUp: aroon.up,
                aroonDown: aroon.down,
                aroonOscillator: aroon.oscillator,
                currentPrice: currentPrice,
                source: 'Yahoo Finance (Calculated)'
            };
        }

        // RSI Calculation
        function calculateRSI(prices, period = 14) {
            if (prices.length < period + 1) return 50;

            let gains = 0, losses = 0;

            // Initial average gain/loss
            for (let i = 1; i <= period; i++) {
                const change = prices[i] - prices[i - 1];
                if (change > 0) gains += change;
                else losses += Math.abs(change);
            }

            let avgGain = gains / period;
            let avgLoss = losses / period;

            // Smooth using Wilder's method
            for (let i = period + 1; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                const gain = change > 0 ? change : 0;
                const loss = change < 0 ? Math.abs(change) : 0;

                avgGain = (avgGain * (period - 1) + gain) / period;
                avgLoss = (avgLoss * (period - 1) + loss) / period;
            }

            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        // EMA Calculation
        function calculateEMA(prices, period) {
            if (prices.length < period) return prices[prices.length - 1];

            const multiplier = 2 / (period + 1);
            let ema = prices.slice(0, period).reduce((a, b) => a + b, 0) / period;

            for (let i = period; i < prices.length; i++) {
                ema = (prices[i] - ema) * multiplier + ema;
            }

            return ema;
        }

        // SMA Calculation
        function calculateSMA(prices, period) {
            if (prices.length < period) return prices[prices.length - 1];
            return prices.slice(-period).reduce((a, b) => a + b, 0) / period;
        }

        // MACD Calculation (12, 26, 9)
        function calculateMACD(prices) {
            const ema12 = calculateEMA(prices, 12);
            const ema26 = calculateEMA(prices, 26);
            const macdLine = ema12 - ema26;

            // Calculate signal line (9-period EMA of MACD)
            // Simplified: use recent MACD values
            const macdValues = [];
            let tempEma12 = prices.slice(0, 12).reduce((a, b) => a + b, 0) / 12;
            let tempEma26 = prices.slice(0, 26).reduce((a, b) => a + b, 0) / 26;
            const mult12 = 2 / 13;
            const mult26 = 2 / 27;

            for (let i = 26; i < prices.length; i++) {
                tempEma12 = (prices[i] - tempEma12) * mult12 + tempEma12;
                tempEma26 = (prices[i] - tempEma26) * mult26 + tempEma26;
                macdValues.push(tempEma12 - tempEma26);
            }

            const signalLine = macdValues.length >= 9 ?
                calculateEMA(macdValues, 9) : macdLine;

            return {
                macd: macdLine,
                signal: signalLine,
                histogram: macdLine - signalLine
            };
        }

        // Bollinger Bands Calculation
        function calculateBollingerBands(prices, period = 20, stdDev = 2) {
            if (prices.length < period) {
                return { upper: prices[prices.length - 1] * 1.02, middle: prices[prices.length - 1], lower: prices[prices.length - 1] * 0.98, position: 'middle' };
            }

            const slice = prices.slice(-period);
            const sma = slice.reduce((a, b) => a + b, 0) / period;
            const variance = slice.reduce((sum, val) => sum + Math.pow(val - sma, 2), 0) / period;
            const std = Math.sqrt(variance);

            const upper = sma + (stdDev * std);
            const lower = sma - (stdDev * std);
            const currentPrice = prices[prices.length - 1];

            // Determine position
            let position = 'middle';
            if (currentPrice <= lower) position = 'lower';
            else if (currentPrice >= upper) position = 'upper';
            else if (currentPrice < sma - std * 0.5) position = 'lower-mid';
            else if (currentPrice > sma + std * 0.5) position = 'upper-mid';

            return { upper, middle: sma, lower, position };
        }

        // Stochastic Oscillator Calculation
        function calculateStochastic(highs, lows, closes, kPeriod = 14, dPeriod = 3) {
            if (closes.length < kPeriod) return { k: 50, d: 50 };

            const kValues = [];

            for (let i = kPeriod - 1; i < closes.length; i++) {
                const highestHigh = Math.max(...highs.slice(i - kPeriod + 1, i + 1));
                const lowestLow = Math.min(...lows.slice(i - kPeriod + 1, i + 1));
                const currentClose = closes[i];

                const k = highestHigh !== lowestLow ?
                    ((currentClose - lowestLow) / (highestHigh - lowestLow)) * 100 : 50;
                kValues.push(k);
            }

            const currentK = kValues[kValues.length - 1];
            const d = kValues.length >= dPeriod ?
                kValues.slice(-dPeriod).reduce((a, b) => a + b, 0) / dPeriod : currentK;

            return { k: currentK, d: d };
        }

        // ADX Calculation (simplified)
        function calculateADX(highs, lows, closes, period = 14) {
            if (closes.length < period * 2) return 25;

            const trueRanges = [];
            const plusDM = [];
            const minusDM = [];

            for (let i = 1; i < closes.length; i++) {
                const high = highs[i];
                const low = lows[i];
                const prevHigh = highs[i - 1];
                const prevLow = lows[i - 1];
                const prevClose = closes[i - 1];

                // True Range
                const tr = Math.max(
                    high - low,
                    Math.abs(high - prevClose),
                    Math.abs(low - prevClose)
                );
                trueRanges.push(tr);

                // Directional Movement
                const upMove = high - prevHigh;
                const downMove = prevLow - low;

                plusDM.push(upMove > downMove && upMove > 0 ? upMove : 0);
                minusDM.push(downMove > upMove && downMove > 0 ? downMove : 0);
            }

            // Smooth the values
            const smoothTR = trueRanges.slice(-period).reduce((a, b) => a + b, 0);
            const smoothPlusDM = plusDM.slice(-period).reduce((a, b) => a + b, 0);
            const smoothMinusDM = minusDM.slice(-period).reduce((a, b) => a + b, 0);

            const plusDI = (smoothPlusDM / smoothTR) * 100;
            const minusDI = (smoothMinusDM / smoothTR) * 100;

            const dx = Math.abs(plusDI - minusDI) / (plusDI + minusDI) * 100;

            return isNaN(dx) ? 25 : dx;
        }

        // ATR Calculation
        function calculateATR(highs, lows, closes, period = 14) {
            if (closes.length < period + 1) return closes[closes.length - 1] * 0.02;

            const trueRanges = [];

            for (let i = 1; i < closes.length; i++) {
                const tr = Math.max(
                    highs[i] - lows[i],
                    Math.abs(highs[i] - closes[i - 1]),
                    Math.abs(lows[i] - closes[i - 1])
                );
                trueRanges.push(tr);
            }

            return trueRanges.slice(-period).reduce((a, b) => a + b, 0) / period;
        }

        // =============================================
        // ADDITIONAL TECHNICAL INDICATORS (FREE DATA)
        // =============================================

        // Williams %R Calculation (14-period) - Range -100 to 0
        function calculateWilliamsR(highs, lows, closes, period = 14) {
            if (closes.length < period) return -50;

            const recentHighs = highs.slice(-period);
            const recentLows = lows.slice(-period);
            const currentClose = closes[closes.length - 1];

            const highestHigh = Math.max(...recentHighs);
            const lowestLow = Math.min(...recentLows);

            if (highestHigh === lowestLow) return -50;

            return ((highestHigh - currentClose) / (highestHigh - lowestLow)) * -100;
        }

        // CCI (Commodity Channel Index) - Typically 20-period
        function calculateCCI(highs, lows, closes, period = 20) {
            if (closes.length < period) return 0;

            // Calculate Typical Price (TP) for each period
            const typicalPrices = [];
            for (let i = 0; i < closes.length; i++) {
                typicalPrices.push((highs[i] + lows[i] + closes[i]) / 3);
            }

            const recentTP = typicalPrices.slice(-period);
            const smaTP = recentTP.reduce((a, b) => a + b, 0) / period;

            // Mean Deviation
            const meanDeviation = recentTP.reduce((sum, tp) => sum + Math.abs(tp - smaTP), 0) / period;

            if (meanDeviation === 0) return 0;

            const currentTP = typicalPrices[typicalPrices.length - 1];
            return (currentTP - smaTP) / (0.015 * meanDeviation);
        }

        // OBV (On-Balance Volume) - Returns trend direction
        function calculateOBV(closes, volumes) {
            if (closes.length < 2) return { obv: 0, trend: 'neutral' };

            let obv = 0;
            const obvValues = [0];

            for (let i = 1; i < closes.length; i++) {
                if (closes[i] > closes[i - 1]) {
                    obv += volumes[i];
                } else if (closes[i] < closes[i - 1]) {
                    obv -= volumes[i];
                }
                // If equal, OBV stays the same
                obvValues.push(obv);
            }

            // Determine OBV trend (last 5 vs previous 5)
            const recent = obvValues.slice(-5);
            const previous = obvValues.slice(-10, -5);

            if (recent.length >= 5 && previous.length >= 5) {
                const recentAvg = recent.reduce((a, b) => a + b, 0) / 5;
                const prevAvg = previous.reduce((a, b) => a + b, 0) / 5;
                const trend = recentAvg > prevAvg * 1.05 ? 'bullish' : recentAvg < prevAvg * 0.95 ? 'bearish' : 'neutral';
                return { obv: obv, trend: trend };
            }

            return { obv: obv, trend: 'neutral' };
        }

        // MFI (Money Flow Index) - Volume-weighted RSI, range 0-100
        function calculateMFI(highs, lows, closes, volumes, period = 14) {
            if (closes.length < period + 1) return 50;

            let positiveMF = 0;
            let negativeMF = 0;

            for (let i = closes.length - period; i < closes.length; i++) {
                const typicalPrice = (highs[i] + lows[i] + closes[i]) / 3;
                const prevTypicalPrice = (highs[i - 1] + lows[i - 1] + closes[i - 1]) / 3;
                const rawMF = typicalPrice * volumes[i];

                if (typicalPrice > prevTypicalPrice) {
                    positiveMF += rawMF;
                } else {
                    negativeMF += rawMF;
                }
            }

            if (negativeMF === 0) return 100;
            const moneyRatio = positiveMF / negativeMF;
            return 100 - (100 / (1 + moneyRatio));
        }

        // Approximate VWAP from daily data
        function calculateVWAP(highs, lows, closes, volumes) {
            if (closes.length < 5) return closes[closes.length - 1];

            // Use last 5 days for intraday approximation
            let cumulativeTPV = 0;
            let cumulativeVol = 0;

            for (let i = closes.length - 5; i < closes.length; i++) {
                const typicalPrice = (highs[i] + lows[i] + closes[i]) / 3;
                cumulativeTPV += typicalPrice * volumes[i];
                cumulativeVol += volumes[i];
            }

            return cumulativeVol > 0 ? cumulativeTPV / cumulativeVol : closes[closes.length - 1];
        }

        // Pivot Points (Standard Floor Trader Pivots)
        function calculatePivotPoints(high, low, close) {
            const pivot = (high + low + close) / 3;
            const r1 = (2 * pivot) - low;
            const s1 = (2 * pivot) - high;
            const r2 = pivot + (high - low);
            const s2 = pivot - (high - low);
            const r3 = high + 2 * (pivot - low);
            const s3 = low - 2 * (high - pivot);

            return {
                pivot: pivot,
                r1: r1, r2: r2, r3: r3,
                s1: s1, s2: s2, s3: s3
            };
        }

        // ROC (Rate of Change) - 10-period
        function calculateROC(closes, period = 10) {
            if (closes.length < period + 1) return 0;

            const currentClose = closes[closes.length - 1];
            const pastClose = closes[closes.length - period - 1];

            return ((currentClose - pastClose) / pastClose) * 100;
        }

        // AROON Indicator - Trend strength
        function calculateAROON(highs, lows, period = 25) {
            if (highs.length < period) return { up: 50, down: 50, oscillator: 0 };

            const recentHighs = highs.slice(-period);
            const recentLows = lows.slice(-period);

            // Find periods since highest high and lowest low
            const highestIdx = recentHighs.indexOf(Math.max(...recentHighs));
            const lowestIdx = recentLows.indexOf(Math.min(...recentLows));

            const periodsSinceHigh = period - 1 - highestIdx;
            const periodsSinceLow = period - 1 - lowestIdx;

            const aroonUp = ((period - periodsSinceHigh) / period) * 100;
            const aroonDown = ((period - periodsSinceLow) / period) * 100;

            return {
                up: aroonUp,
                down: aroonDown,
                oscillator: aroonUp - aroonDown
            };
        }

        // Update technical indicators in UI with live data
        function updateTechnicalIndicatorsUI(indicators, currentPrice) {
            if (!indicators) return;

            const signals = ['ind-buy', 'ind-sell', 'ind-neutral'];
            const signalTexts = ['BUY', 'SELL', 'NEUTRAL'];

            // RSI
            const rsiSignal = indicators.rsi < 30 ? 0 : indicators.rsi > 70 ? 1 : 2;
            document.getElementById('rsiValue').textContent = indicators.rsi.toFixed(1);
            document.getElementById('rsiSignal').textContent = signalTexts[rsiSignal];
            document.getElementById('rsiSignal').className = 'indicator-signal ' + signals[rsiSignal];

            // MACD
            const macdSig = indicators.macdHistogram > 0.5 ? 0 : indicators.macdHistogram < -0.5 ? 1 : 2;
            document.getElementById('macdValue').textContent = (indicators.macdHistogram >= 0 ? '+' : '') + indicators.macdHistogram.toFixed(2);
            document.getElementById('macdSignal').textContent = signalTexts[macdSig];
            document.getElementById('macdSignal').className = 'indicator-signal ' + signals[macdSig];

            // EMA 20
            const ema20Sig = currentPrice > indicators.ema20 * 1.01 ? 0 : currentPrice < indicators.ema20 * 0.99 ? 1 : 2;
            document.getElementById('ema20Value').textContent = '‚Çπ' + indicators.ema20.toFixed(0);
            document.getElementById('ma20Signal').textContent = signalTexts[ema20Sig];
            document.getElementById('ma20Signal').className = 'indicator-signal ' + signals[ema20Sig];

            // SMA 50
            const sma50Sig = currentPrice > indicators.sma50 * 1.02 ? 0 : currentPrice < indicators.sma50 * 0.98 ? 1 : 2;
            document.getElementById('sma50Value').textContent = '‚Çπ' + indicators.sma50.toFixed(0);
            document.getElementById('ma50Signal').textContent = signalTexts[sma50Sig];
            document.getElementById('ma50Signal').className = 'indicator-signal ' + signals[sma50Sig];

            // Bollinger Bands
            const bbPos = indicators.bollingerPosition;
            const bbSig = bbPos === 'lower' || bbPos === 'lower-mid' ? 0 : bbPos === 'upper' || bbPos === 'upper-mid' ? 1 : 2;
            const bbText = bbPos.includes('lower') ? 'Lower' : bbPos.includes('upper') ? 'Upper' : 'Middle';
            document.getElementById('bbValue').textContent = bbText;
            document.getElementById('bbSignal').textContent = signalTexts[bbSig];
            document.getElementById('bbSignal').className = 'indicator-signal ' + signals[bbSig];

            // Stochastic
            const stochSig = indicators.stochK < 20 ? 0 : indicators.stochK > 80 ? 1 : 2;
            document.getElementById('stochValue').textContent = indicators.stochK.toFixed(1);
            document.getElementById('stochSignal').textContent = signalTexts[stochSig];
            document.getElementById('stochSignal').className = 'indicator-signal ' + signals[stochSig];

            // ADX
            const adxSig = indicators.adx > 30 ? 0 : indicators.adx < 20 ? 1 : 2;
            document.getElementById('adxValue').textContent = indicators.adx.toFixed(1);
            document.getElementById('adxSignal').textContent = indicators.adx > 30 ? 'STRONG' : indicators.adx < 20 ? 'WEAK' : 'MODERATE';
            document.getElementById('adxSignal').className = 'indicator-signal ' + (indicators.adx > 30 ? 'ind-buy' : indicators.adx < 20 ? 'ind-sell' : 'ind-neutral');

            // Volume
            const volSig = indicators.volumeRatio > 1.2 ? 0 : indicators.volumeRatio < 0.8 ? 1 : 2;
            document.getElementById('volTrendValue').textContent = (indicators.volumeRatio * 100).toFixed(0) + '%';
            document.getElementById('volumeSignal').textContent = indicators.volumeRatio > 1.2 ? 'HIGH' : indicators.volumeRatio < 0.8 ? 'LOW' : 'NORMAL';
            document.getElementById('volumeSignal').className = 'indicator-signal ' + signals[volSig];

            // Update technical badge
            const techBuySignals = [rsiSignal, macdSig, ema20Sig, sma50Sig, bbSig, stochSig].filter(s => s === 0).length;
            document.getElementById('techBadge').textContent = techBuySignals + '/6 BUY';
            document.getElementById('techBadge').className = 'card-badge ' + (techBuySignals >= 4 ? 'badge-bullish' : techBuySignals <= 2 ? 'badge-bearish' : 'badge-neutral');

            // =============================================
            // UPDATE ADVANCED INDICATORS (NEW)
            // =============================================

            // Williams %R (range -100 to 0, oversold < -80, overbought > -20)
            if (indicators.williamsR !== undefined) {
                const willRSig = indicators.williamsR < -80 ? 0 : indicators.williamsR > -20 ? 1 : 2;
                document.getElementById('williamsRValue').textContent = indicators.williamsR.toFixed(1);
                document.getElementById('williamsRSignal').textContent = signalTexts[willRSig];
                document.getElementById('williamsRSignal').className = 'indicator-signal ' + signals[willRSig];
            }

            // CCI (oversold < -100, overbought > +100)
            if (indicators.cci !== undefined) {
                const cciSig = indicators.cci < -100 ? 0 : indicators.cci > 100 ? 1 : 2;
                document.getElementById('cciValue').textContent = (indicators.cci >= 0 ? '+' : '') + indicators.cci.toFixed(0);
                document.getElementById('cciSignal').textContent = signalTexts[cciSig];
                document.getElementById('cciSignal').className = 'indicator-signal ' + signals[cciSig];
            }

            // OBV Trend
            if (indicators.obvTrend !== undefined) {
                const obvSig = indicators.obvTrend === 'bullish' ? 0 : indicators.obvTrend === 'bearish' ? 1 : 2;
                const obvDisplay = indicators.obv > 1000000 ? (indicators.obv / 1000000).toFixed(1) + 'M' :
                    indicators.obv > 1000 ? (indicators.obv / 1000).toFixed(1) + 'K' : indicators.obv.toFixed(0);
                document.getElementById('obvValue').textContent = indicators.obvTrend.charAt(0).toUpperCase() + indicators.obvTrend.slice(1);
                document.getElementById('obvSignal').textContent = indicators.obvTrend === 'bullish' ? 'BULLISH' : indicators.obvTrend === 'bearish' ? 'BEARISH' : 'NEUTRAL';
                document.getElementById('obvSignal').className = 'indicator-signal ' + signals[obvSig];
            }

            // MFI (similar to RSI, oversold < 20, overbought > 80)
            if (indicators.mfi !== undefined) {
                const mfiSig = indicators.mfi < 20 ? 0 : indicators.mfi > 80 ? 1 : 2;
                document.getElementById('mfiValue').textContent = indicators.mfi.toFixed(1);
                document.getElementById('mfiSignal').textContent = signalTexts[mfiSig];
                document.getElementById('mfiSignal').className = 'indicator-signal ' + signals[mfiSig];
            }

            // VWAP (price above = bullish, below = bearish)
            if (indicators.vwap !== undefined) {
                const vwapSig = currentPrice > indicators.vwap * 1.01 ? 0 : currentPrice < indicators.vwap * 0.99 ? 1 : 2;
                document.getElementById('vwapValue').textContent = '‚Çπ' + indicators.vwap.toFixed(0);
                document.getElementById('vwapSignal').textContent = currentPrice > indicators.vwap ? 'ABOVE' : currentPrice < indicators.vwap ? 'BELOW' : 'AT';
                document.getElementById('vwapSignal').className = 'indicator-signal ' + signals[vwapSig];
            }

            // ROC (positive = bullish, negative = bearish)
            if (indicators.roc !== undefined) {
                const rocSig = indicators.roc > 2 ? 0 : indicators.roc < -2 ? 1 : 2;
                document.getElementById('rocValue').textContent = (indicators.roc >= 0 ? '+' : '') + indicators.roc.toFixed(2) + '%';
                document.getElementById('rocSignal').textContent = signalTexts[rocSig];
                document.getElementById('rocSignal').className = 'indicator-signal ' + signals[rocSig];
            }

            // AROON Oscillator (-100 to +100, positive = bullish trend)
            if (indicators.aroonOscillator !== undefined) {
                const aroonSig = indicators.aroonOscillator > 50 ? 0 : indicators.aroonOscillator < -50 ? 1 : 2;
                document.getElementById('aroonValue').textContent = (indicators.aroonOscillator >= 0 ? '+' : '') + indicators.aroonOscillator.toFixed(0);
                document.getElementById('aroonSignal').textContent = indicators.aroonOscillator > 50 ? 'BULLISH' : indicators.aroonOscillator < -50 ? 'BEARISH' : 'NEUTRAL';
                document.getElementById('aroonSignal').className = 'indicator-signal ' + signals[aroonSig];
            }

            // Pivot Point (price vs pivot)
            if (indicators.pivotPoints !== undefined) {
                const pp = indicators.pivotPoints;
                const pivotSig = currentPrice > pp.r1 ? 0 : currentPrice < pp.s1 ? 1 : 2;
                document.getElementById('pivotValue').textContent = '‚Çπ' + pp.pivot.toFixed(0);
                document.getElementById('pivotSignal').textContent = currentPrice > pp.pivot ? 'ABOVE' : currentPrice < pp.pivot ? 'BELOW' : 'AT';
                document.getElementById('pivotSignal').className = 'indicator-signal ' + signals[pivotSig];
            }

            // Update Advanced Indicators badge with buy signal count
            const advBuySignals = [
                indicators.williamsR < -80 ? 0 : indicators.williamsR > -20 ? 1 : 2,
                indicators.cci < -100 ? 0 : indicators.cci > 100 ? 1 : 2,
                indicators.obvTrend === 'bullish' ? 0 : indicators.obvTrend === 'bearish' ? 1 : 2,
                indicators.mfi < 20 ? 0 : indicators.mfi > 80 ? 1 : 2,
                currentPrice > indicators.vwap * 1.01 ? 0 : currentPrice < indicators.vwap * 0.99 ? 1 : 2,
                indicators.roc > 2 ? 0 : indicators.roc < -2 ? 1 : 2,
                indicators.aroonOscillator > 50 ? 0 : indicators.aroonOscillator < -50 ? 1 : 2,
                currentPrice > indicators.pivotPoints?.r1 ? 0 : currentPrice < indicators.pivotPoints?.s1 ? 1 : 2
            ].filter(s => s === 0).length;

            document.getElementById('advTechBadge').textContent = advBuySignals + '/8 BUY';
            document.getElementById('advTechBadge').className = 'card-badge ' + (advBuySignals >= 5 ? 'badge-bullish' : advBuySignals <= 2 ? 'badge-bearish' : 'badge-neutral');

            // Add live indicator badge
            const techCard = document.querySelector('.analysis-card:has(#techBadge)');
            if (techCard && !techCard.querySelector('.live-tech-badge')) {
                const liveBadge = document.createElement('span');
                liveBadge.className = 'live-tech-badge';
                liveBadge.innerHTML = '<i class="fas fa-chart-line"></i> LIVE';
                liveBadge.style.cssText = 'position: absolute; top: 10px; right: 85px; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 3px 8px; border-radius: 4px; font-size: 0.65rem; font-weight: 600;';
                const header = techCard.querySelector('.card-header');
                if (header) header.style.position = 'relative';
                techCard.querySelector('.card-header')?.appendChild(liveBadge);
            }

            console.log('‚úÖ Technical indicators UI updated with LIVE data (including advanced indicators)');
        }
        function renderAnalystData(data, currentPrice) {
            const badge = document.getElementById('analystBadge');
            const avgTarget = document.getElementById('avgTargetPrice');
            const upside = document.getElementById('targetUpside');
            const highTarget = document.getElementById('highTarget');
            const lowTarget = document.getElementById('lowTarget');

            // Update targets (only if real data exists)
            if (data.targetMean) {
                avgTarget.textContent = '‚Çπ' + data.targetMean.toFixed(2);
                const upsidePercent = ((data.targetMean - currentPrice) / currentPrice) * 100;
                upside.textContent = (upsidePercent >= 0 ? '+' : '') + upsidePercent.toFixed(1) + '% upside';
                upside.className = 'target-upside ' + (upsidePercent >= 0 ? 'positive' : 'negative');
            } else {
                avgTarget.textContent = '-';
                upside.textContent = '';
                upside.className = 'target-upside';
            }
            highTarget.textContent = data.targetHigh ? '‚Çπ' + data.targetHigh.toFixed(2) : '-';
            lowTarget.textContent = data.targetLow ? '‚Çπ' + data.targetLow.toFixed(2) : '-';

            // Update badge
            const rec = data.recommendation.toUpperCase();
            badge.textContent = rec;
            badge.className = 'card-badge ' + (rec === 'BUY' || rec === 'STRONG BUY' ? 'badge-bullish' : rec === 'SELL' || rec === 'STRONG SELL' ? 'badge-bearish' : 'badge-neutral');

            // Update recommendation bars
            const totalRecs = data.strongBuy + data.buy + data.hold + data.sell + data.strongSell;
            const buyTotal = data.strongBuy + data.buy;
            const holdTotal = data.hold;
            const sellTotal = data.sell + data.strongSell;

            document.getElementById('recBuyBar').style.width = (totalRecs > 0 ? buyTotal / totalRecs * 100 : 0) + '%';
            document.getElementById('recHoldBar').style.width = (totalRecs > 0 ? holdTotal / totalRecs * 100 : 0) + '%';
            document.getElementById('recSellBar').style.width = (totalRecs > 0 ? sellTotal / totalRecs * 100 : 0) + '%';

            document.getElementById('recBuyCount').textContent = buyTotal;
            document.getElementById('recHoldCount').textContent = holdTotal;
            document.getElementById('recSellCount').textContent = sellTotal;
        }

        function renderAnalystUnavailable() {
            document.getElementById('analystBadge').textContent = 'N/A';
            document.getElementById('analystBadge').className = 'card-badge badge-neutral';
            document.getElementById('avgTargetPrice').textContent = 'Unavailable';
            document.getElementById('targetUpside').textContent = 'Live data not available';
            document.getElementById('targetUpside').className = 'target-upside';
            document.getElementById('highTarget').textContent = '-';
            document.getElementById('lowTarget').textContent = '-';
            document.getElementById('recBuyBar').style.width = '0%';
            document.getElementById('recHoldBar').style.width = '0%';
            document.getElementById('recSellBar').style.width = '0%';
            document.getElementById('recBuyCount').textContent = '-';
            document.getElementById('recHoldCount').textContent = '-';
            document.getElementById('recSellCount').textContent = '-';
        }

        // Generate stock fundamentals with sector-specific accuracy
        // (These require paid APIs, so we simulate with realistic sector-based values)
        // Updated to use deterministic seed for consistency
        function generateFundamentals(price, sector, symbol = '') {
            // Generate seed from symbol for deterministic results
            const symbolSeed = symbol.split('').reduce((a, c) => a + c.charCodeAt(0), 0);

            // Deterministic pseudo-random based on seed
            const seededRandom = (seed, offset = 0) => {
                const x = Math.sin((seed + offset) * 12.9898) * 43758.5453;
                return x - Math.floor(x);
            };

            // Comprehensive sector-based fundamental parameters
            const sectorData = {
                'IT Services': {
                    pe: { min: 22, max: 38 }, roe: { min: 20, max: 35 },
                    de: { min: 0.02, max: 0.25 }, div: { min: 0.5, max: 2.5 },
                    pb: { min: 4, max: 12 }, beta: { min: 0.8, max: 1.3 }
                },
                'Private Banking': {
                    pe: { min: 14, max: 28 }, roe: { min: 12, max: 22 },
                    de: { min: 0.8, max: 2.0 }, div: { min: 0.3, max: 1.2 },
                    pb: { min: 2, max: 5 }, beta: { min: 1.0, max: 1.4 }
                },
                'PSU Banking': {
                    pe: { min: 6, max: 14 }, roe: { min: 8, max: 16 },
                    de: { min: 1.2, max: 2.5 }, div: { min: 1.5, max: 4.0 },
                    pb: { min: 0.6, max: 1.5 }, beta: { min: 1.1, max: 1.6 }
                },
                'FMCG': {
                    pe: { min: 45, max: 85 }, roe: { min: 25, max: 45 },
                    de: { min: 0.05, max: 0.3 }, div: { min: 1.0, max: 2.5 },
                    pb: { min: 8, max: 25 }, beta: { min: 0.4, max: 0.8 }
                },
                'Automobile': {
                    pe: { min: 18, max: 40 }, roe: { min: 12, max: 25 },
                    de: { min: 0.2, max: 0.8 }, div: { min: 0.5, max: 2.0 },
                    pb: { min: 3, max: 10 }, beta: { min: 0.9, max: 1.4 }
                },
                'Pharmaceuticals': {
                    pe: { min: 22, max: 45 }, roe: { min: 15, max: 28 },
                    de: { min: 0.1, max: 0.5 }, div: { min: 0.5, max: 1.5 },
                    pb: { min: 3, max: 8 }, beta: { min: 0.5, max: 0.9 }
                },
                'Oil & Gas': {
                    pe: { min: 8, max: 18 }, roe: { min: 10, max: 22 },
                    de: { min: 0.3, max: 1.0 }, div: { min: 2.0, max: 5.0 },
                    pb: { min: 1, max: 3 }, beta: { min: 0.8, max: 1.3 }
                },
                'Power': {
                    pe: { min: 12, max: 22 }, roe: { min: 10, max: 18 },
                    de: { min: 0.8, max: 1.8 }, div: { min: 2.5, max: 5.0 },
                    pb: { min: 1.5, max: 4 }, beta: { min: 0.6, max: 1.0 }
                },
                'Metals & Mining': {
                    pe: { min: 5, max: 14 }, roe: { min: 12, max: 28 },
                    de: { min: 0.3, max: 1.2 }, div: { min: 1.5, max: 4.5 },
                    pb: { min: 0.8, max: 2.5 }, beta: { min: 1.2, max: 1.8 }
                },
                'Telecom': {
                    pe: { min: 25, max: 80 }, roe: { min: 5, max: 15 },
                    de: { min: 0.8, max: 2.0 }, div: { min: 0.0, max: 0.5 },
                    pb: { min: 2, max: 6 }, beta: { min: 0.7, max: 1.1 }
                },
                'Infrastructure': {
                    pe: { min: 18, max: 40 }, roe: { min: 10, max: 20 },
                    de: { min: 0.5, max: 1.5 }, div: { min: 0.5, max: 1.5 },
                    pb: { min: 2, max: 6 }, beta: { min: 1.0, max: 1.5 }
                },
                'NBFC': {
                    pe: { min: 15, max: 35 }, roe: { min: 12, max: 25 },
                    de: { min: 3, max: 8 }, div: { min: 0.5, max: 2.0 },
                    pb: { min: 2, max: 5 }, beta: { min: 1.1, max: 1.6 }
                },
                'Consumer Goods': {
                    pe: { min: 35, max: 70 }, roe: { min: 20, max: 40 },
                    de: { min: 0.05, max: 0.4 }, div: { min: 1.0, max: 2.5 },
                    pb: { min: 6, max: 18 }, beta: { min: 0.5, max: 0.9 }
                },
                'Cement': {
                    pe: { min: 22, max: 45 }, roe: { min: 10, max: 20 },
                    de: { min: 0.2, max: 0.8 }, div: { min: 0.5, max: 1.5 },
                    pb: { min: 3, max: 8 }, beta: { min: 0.9, max: 1.3 }
                },
                'Conglomerate': {
                    pe: { min: 35, max: 90 }, roe: { min: 8, max: 18 },
                    de: { min: 0.2, max: 0.6 }, div: { min: 0.2, max: 0.8 },
                    pb: { min: 3, max: 10 }, beta: { min: 0.8, max: 1.2 }
                }
            };

            // Default sector values if not found
            const defaults = {
                pe: { min: 15, max: 35 }, roe: { min: 10, max: 22 },
                de: { min: 0.3, max: 1.0 }, div: { min: 0.5, max: 2.0 },
                pb: { min: 2, max: 6 }, beta: { min: 0.8, max: 1.2 }
            };

            const data = sectorData[sector] || defaults;

            // Generate values with wider variance - can go outside "typical" ranges
            // Use skewed distribution to create more realistic outliers
            let skewCounter = 0;
            const skewRandom = () => {
                const r = seededRandom(symbolSeed, ++skewCounter);
                // Creates distribution that sometimes produces extreme values
                return r < 0.15 ? r * 0.5 : r > 0.85 ? 0.5 + r * 0.6 : r;
            };

            // Add 20% variance outside normal ranges for realism
            const rangeExpand = 1.25;
            const peRange = (data.pe.max - data.pe.min) * rangeExpand;
            const pe = data.pe.min - peRange * 0.1 + skewRandom() * peRange;

            const roeRange = (data.roe.max - data.roe.min) * rangeExpand;
            const roe = Math.max(2, data.roe.min - roeRange * 0.15 + skewRandom() * roeRange);

            const deRange = (data.de.max - data.de.min) * rangeExpand;
            const debtEquity = Math.max(0, data.de.min - deRange * 0.1 + skewRandom() * deRange);

            const divRange = (data.div.max - data.div.min) * rangeExpand;
            const divYield = Math.max(0, data.div.min - divRange * 0.2 + skewRandom() * divRange);

            const pbRange = (data.pb.max - data.pb.min) * rangeExpand;
            const pb = Math.max(0.3, data.pb.min - pbRange * 0.1 + skewRandom() * pbRange);

            const betaRange = (data.beta.max - data.beta.min) * rangeExpand;
            const beta = Math.max(0.2, data.beta.min - betaRange * 0.1 + skewRandom() * betaRange);

            const eps = price / pe;
            const bookValue = price / pb;

            return {
                pe: pe,
                pb: pb,
                divYield: divYield,
                beta: beta,
                roe: roe,
                eps: eps,
                debtEquity: debtEquity,
                bookValue: bookValue
            };
        }

        // Loading animation steps
        let loadingInterval;
        function animateLoadingSteps(stockName) {
            document.getElementById('loadingStockName').textContent = stockName;
            const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
            let currentStep = 0;

            steps.forEach(s => {
                document.getElementById(s).classList.remove('active', 'completed');
            });

            loadingInterval = setInterval(() => {
                if (currentStep > 0) {
                    document.getElementById(steps[currentStep - 1]).classList.remove('active');
                    document.getElementById(steps[currentStep - 1]).classList.add('completed');
                    document.getElementById(steps[currentStep - 1]).querySelector('.step-icon').textContent = '‚úì';
                }
                if (currentStep < steps.length) {
                    document.getElementById(steps[currentStep]).classList.add('active');
                    currentStep++;
                }
            }, 500);
        }

        async function analyzeStock() {
            const input = document.getElementById('stockInput').value.trim().toUpperCase();
            if (!input) {
                alert('Please enter a stock symbol');
                return;
            }

            // Validate that the stock exists in our dropdown list
            if (!stockMetadata[input]) {
                alert('Please select a valid stock from the dropdown suggestions. Only listed stocks can be analyzed.');
                document.getElementById('stockInput').focus();
                return;
            }

            console.log(`\n${'='.repeat(60)}`);
            console.log(`üéØ ACCURACY-FIRST MODE: Analyzing ${input}`);
            console.log(`üìä Priority: 100% correct data over speed`);
            console.log(`‚è±Ô∏è  May take longer to ensure data accuracy`);
            console.log(`${'='.repeat(60)}\n`);

            // Show loading
            document.getElementById('loadingOverlay').classList.add('active');
            document.getElementById('resultsSection').classList.add('hidden');
            animateLoadingSteps(input);

            // Failsafe: Allow sufficient time for retries (up to 2 minutes for accuracy-first approach)
            // With 5 retries @ 10-30s each + wait times, we need ~120s max
            const failsafeTimeout = setTimeout(() => {
                console.log('‚è∞ Failsafe timeout triggered - analysis taking longer than expected');
                clearInterval(loadingInterval);
                document.getElementById('loadingOverlay').classList.remove('active');
                alert('‚è∞ Analysis is taking longer than expected. Please try again.\n\nThis may indicate network issues or the stock data source is temporarily unavailable.');
            }, 120000); // 2 minutes for accuracy-first approach

            try {
                // Fetch live data from API
                const stockData = await fetchLiveStockData(input);

                // Validate the fetched data for accuracy
                const validation = validateStockData(stockData, input);
                if (!validation.valid) {
                    throw new Error(`Data validation failed: ${validation.errors.join(', ')}`);
                }

                // Show warnings to user if any (non-blocking)
                if (validation.warnings.length > 0) {
                    console.warn('Data quality warnings:', validation.warnings);
                }

                clearTimeout(failsafeTimeout);
                clearInterval(loadingInterval);
                displayAnalysis(input, stockData);
                document.getElementById('loadingOverlay').classList.remove('active');
                document.getElementById('resultsSection').classList.remove('hidden');

                // Smooth scroll to results
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });

                // Fetch news and analyst data asynchronously (don't block UI)
                fetchAndDisplayNewsAndAnalyst(input, stockData);

            } catch (error) {
                console.error('Analysis error:', error);
                clearTimeout(failsafeTimeout);
                clearInterval(loadingInterval);
                document.getElementById('loadingOverlay').classList.remove('active');

                // Show error message to user instead of fallback data
                const errorMessage = error.message || 'Unable to fetch live stock data. Please check the stock symbol and try again.';
                alert(`‚ùå Error: ${errorMessage}\n\nPlease ensure:\n1. Stock symbol is correct (e.g., RELIANCE, TCS, INFY)\n2. You have an active internet connection\n3. The stock is listed on NSE\n\nTry again in a few moments.`);

                // Reset UI
                document.getElementById('resultsSection').classList.add('hidden');
            }
        }

        // Fetch news and analyst data asynchronously after main analysis
        async function fetchAndDisplayNewsAndAnalyst(symbol, stockData) {
            try {
                // Fetch news, analyst data, Finnhub financials, and technical indicators in parallel
                const [newsData, analystData, finnhubFinancials, technicalIndicators] = await Promise.all([
                    fetchStockNews(symbol, stockData.name),
                    fetchAnalystData(symbol, stockData.price),
                    fetchFinnhubFinancials(symbol),
                    fetchTechnicalIndicators(symbol)
                ]);

                // Render news feed
                renderNewsFeed(newsData);

                // Render analyst data only if real API data is available
                if (analystData) {
                    renderAnalystData(analystData, stockData.price);
                } else {
                    renderAnalystUnavailable();
                }

                // Update news score based on sentiment analysis
                updateNewsScore(newsData);

                // If Finnhub financials are available, update the fundamental display
                if (finnhubFinancials) {
                    updateFundamentalsFromAPI(finnhubFinancials, stockData.price);
                }

                // Use ONLY real technical indicators - no fallback
                if (!technicalIndicators) {
                    console.warn('‚ö†Ô∏è Technical indicators unavailable - API failed');
                    // Show estimated signal as fallback since real data failed
                    showEstimatedSignal(symbol, stockData);
                    alert('‚ö†Ô∏è Warning: Advanced technical indicators could not be loaded. Showing estimated signal based on limited data.');
                } else {
                    liveTechnicalIndicators = technicalIndicators;
                    // Update UI with technical indicators (real data only)
                    updateTechnicalIndicatorsUI(technicalIndicators, stockData.price);
                    // Recalculate overall score with technical data
                    recalculateScoreWithRealData(symbol, stockData, technicalIndicators, finnhubFinancials);
                    console.log('‚úÖ Advanced indicators updated with LIVE data');
                }

            } catch (error) {
                console.error('News/Analyst fetch error:', error);
                renderAnalystUnavailable();
            }
        }

        // =============================================
        // ACCURATE SCORE CALCULATION WITH REAL DATA
        // =============================================

        function recalculateScoreWithRealData(symbol, stockData, techIndicators, fundamentalsData) {
            const price = stockData.price;
            const change = stockData.change;

            console.log('üîÑ Recalculating score with REAL technical indicators...');

            // ========== ACCURATE TECHNICAL SCORE (from real data) ==========
            let technicalScore = 50; // Start neutral

            // === RSI Analysis (Real 14-period RSI) ===
            const rsi = techIndicators.rsi;
            if (rsi <= 20) technicalScore += 25;        // Extremely oversold - STRONG BUY signal
            else if (rsi <= 30) technicalScore += 18;   // Oversold - BUY signal
            else if (rsi <= 40) technicalScore += 8;    // Slightly oversold
            else if (rsi >= 80) technicalScore -= 25;   // Extremely overbought - STRONG SELL
            else if (rsi >= 70) technicalScore -= 18;   // Overbought - SELL signal
            else if (rsi >= 60) technicalScore -= 6;    // Slightly overbought
            // RSI 40-60 is neutral zone, no adjustment

            // === MACD Analysis (Real MACD) ===
            const macdHistogram = techIndicators.macdHistogram;
            const macdValue = techIndicators.macd;
            if (macdHistogram > 2) technicalScore += 15;      // Strong bullish momentum
            else if (macdHistogram > 0.5) technicalScore += 10; // Bullish
            else if (macdHistogram > 0) technicalScore += 4;  // Slightly bullish
            else if (macdHistogram < -2) technicalScore -= 15; // Strong bearish momentum
            else if (macdHistogram < -0.5) technicalScore -= 10; // Bearish
            else if (macdHistogram < 0) technicalScore -= 4;  // Slightly bearish

            // MACD crossover detection (MACD vs Signal)
            if (macdValue > techIndicators.macdSignal && macdHistogram > 0) {
                technicalScore += 5; // Bullish crossover
            } else if (macdValue < techIndicators.macdSignal && macdHistogram < 0) {
                technicalScore -= 5; // Bearish crossover
            }

            // === Moving Average Analysis (Real EMA20, SMA50) ===
            const ema20 = techIndicators.ema20;
            const sma50 = techIndicators.sma50;

            // Price vs EMA20 (short-term trend)
            const ema20Diff = ((price - ema20) / ema20) * 100;
            if (ema20Diff > 5) technicalScore += 8;       // Strong uptrend
            else if (ema20Diff > 2) technicalScore += 5;  // Uptrend
            else if (ema20Diff > 0) technicalScore += 2;  // Slight uptrend
            else if (ema20Diff < -5) technicalScore -= 10; // Strong downtrend
            else if (ema20Diff < -2) technicalScore -= 6;  // Downtrend
            else if (ema20Diff < 0) technicalScore -= 2;   // Slight downtrend

            // Price vs SMA50 (medium-term trend)
            const sma50Diff = ((price - sma50) / sma50) * 100;
            if (sma50Diff > 10) technicalScore += 6;      // Strong uptrend
            else if (sma50Diff > 3) technicalScore += 4;  // Uptrend
            else if (sma50Diff < -10) technicalScore -= 8; // Strong downtrend
            else if (sma50Diff < -3) technicalScore -= 5;  // Downtrend

            // Golden/Death Cross detection
            if (ema20 > sma50 && ema20Diff > 0) {
                technicalScore += 4; // Golden cross territory
            } else if (ema20 < sma50 && ema20Diff < 0) {
                technicalScore -= 6; // Death cross territory
            }

            // === Bollinger Bands Analysis ===
            const bbPosition = techIndicators.bollingerPosition;
            if (bbPosition === 'lower') technicalScore += 12;       // At lower band - oversold
            else if (bbPosition === 'lower-mid') technicalScore += 5;
            else if (bbPosition === 'upper') technicalScore -= 12;   // At upper band - overbought
            else if (bbPosition === 'upper-mid') technicalScore -= 5;

            // === Stochastic Analysis (Real K, D values) ===
            const stochK = techIndicators.stochK;
            const stochD = techIndicators.stochD;
            if (stochK <= 20 && stochD <= 20) technicalScore += 12;  // Oversold
            else if (stochK <= 30) technicalScore += 5;
            else if (stochK >= 80 && stochD >= 80) technicalScore -= 12; // Overbought
            else if (stochK >= 70) technicalScore -= 5;

            // Stochastic crossover
            if (stochK > stochD && stochK < 30) technicalScore += 4; // Bullish crossover in oversold
            else if (stochK < stochD && stochK > 70) technicalScore -= 4; // Bearish crossover in overbought

            // === ADX (Trend Strength) ===
            const adx = techIndicators.adx;
            // ADX measures trend strength, not direction
            // High ADX with positive price change = strong uptrend
            // High ADX with negative price change = strong downtrend
            if (adx > 40 && change > 0) technicalScore += 8;  // Strong bullish trend
            else if (adx > 25 && change > 0) technicalScore += 4;
            else if (adx > 40 && change < 0) technicalScore -= 10; // Strong bearish trend
            else if (adx > 25 && change < 0) technicalScore -= 5;
            else if (adx < 20) technicalScore -= 2; // Weak/no trend - uncertainty

            // === Volume Analysis ===
            const volumeRatio = techIndicators.volumeRatio;
            if (volumeRatio > 2.0 && change > 1) technicalScore += 10; // High volume up
            else if (volumeRatio > 1.5 && change > 0) technicalScore += 5;
            else if (volumeRatio > 2.0 && change < -1) technicalScore -= 12; // High volume down - bearish
            else if (volumeRatio > 1.5 && change < 0) technicalScore -= 6;
            else if (volumeRatio < 0.5) technicalScore -= 3; // Low conviction

            // === Volatility Consideration ===
            const volatility = techIndicators.volatility;
            if (volatility > 5) technicalScore -= 5; // High volatility = risk
            else if (volatility > 3) technicalScore -= 2;

            // ========== ADVANCED INDICATORS SCORING ==========

            // === Williams %R Analysis ===
            const williamsR = techIndicators.williamsR;
            if (williamsR !== undefined && williamsR !== null) {
                if (williamsR <= -80) technicalScore += 10;       // Extremely oversold
                else if (williamsR <= -60) technicalScore += 5;   // Oversold
                else if (williamsR >= -20) technicalScore -= 10;  // Extremely overbought
                else if (williamsR >= -40) technicalScore -= 5;   // Overbought
            }

            // === CCI (Commodity Channel Index) Analysis ===
            const cci = techIndicators.cci;
            if (cci !== undefined && cci !== null) {
                if (cci < -200) technicalScore += 12;         // Extreme oversold
                else if (cci < -100) technicalScore += 8;     // Oversold
                else if (cci < -50) technicalScore += 3;      // Mildly oversold
                else if (cci > 200) technicalScore -= 12;     // Extreme overbought
                else if (cci > 100) technicalScore -= 8;      // Overbought
                else if (cci > 50) technicalScore -= 3;       // Mildly overbought
            }

            // === OBV (On-Balance Volume) Analysis ===
            const obvTrend = techIndicators.obvTrend;
            if (obvTrend) {
                if (obvTrend === 'bullish' && change > 0) technicalScore += 6;     // Volume confirms uptrend
                else if (obvTrend === 'bearish' && change < 0) technicalScore -= 8; // Volume confirms downtrend
                else if (obvTrend === 'bullish' && change < 0) technicalScore += 3; // Accumulation despite price drop
                else if (obvTrend === 'bearish' && change > 0) technicalScore -= 4; // Distribution despite price rise
            }

            // === MFI (Money Flow Index) Analysis ===
            const mfi = techIndicators.mfi;
            if (mfi !== undefined && mfi !== null) {
                if (mfi <= 20) technicalScore += 10;          // Oversold with money flow
                else if (mfi <= 30) technicalScore += 5;
                else if (mfi >= 80) technicalScore -= 10;     // Overbought with money flow
                else if (mfi >= 70) technicalScore -= 5;
            }

            // === VWAP Analysis (Price vs VWAP) ===
            const vwap = techIndicators.vwap;
            if (vwap && vwap > 0) {
                const vwapDiff = ((price - vwap) / vwap) * 100;
                if (vwapDiff > 3) technicalScore += 5;        // Price above VWAP (bullish)
                else if (vwapDiff > 1) technicalScore += 2;
                else if (vwapDiff < -3) technicalScore -= 6;  // Price below VWAP (bearish)
                else if (vwapDiff < -1) technicalScore -= 3;
            }

            // === ROC (Rate of Change) Analysis ===
            const roc = techIndicators.roc;
            if (roc !== undefined && roc !== null) {
                if (roc > 10) technicalScore += 8;            // Strong positive momentum
                else if (roc > 5) technicalScore += 5;
                else if (roc > 2) technicalScore += 2;
                else if (roc < -10) technicalScore -= 10;     // Strong negative momentum
                else if (roc < -5) technicalScore -= 6;
                else if (roc < -2) technicalScore -= 3;
            }

            // === AROON Analysis ===
            const aroonUp = techIndicators.aroonUp;
            const aroonDown = techIndicators.aroonDown;
            if (aroonUp !== undefined && aroonDown !== undefined) {
                const aroonOscillator = aroonUp - aroonDown;
                if (aroonUp > 70 && aroonDown < 30) technicalScore += 8;      // Strong uptrend
                else if (aroonUp > 50 && aroonOscillator > 40) technicalScore += 4;
                else if (aroonDown > 70 && aroonUp < 30) technicalScore -= 10; // Strong downtrend
                else if (aroonDown > 50 && aroonOscillator < -40) technicalScore -= 5;
            }

            // === Pivot Points Analysis ===
            const pivotPoints = techIndicators.pivotPoints;
            if (pivotPoints) {
                const pp = pivotPoints.pp;
                const r1 = pivotPoints.r1;
                const s1 = pivotPoints.s1;

                if (price > r1) technicalScore += 4;          // Breaking resistance
                else if (price > pp) technicalScore += 2;     // Above pivot
                else if (price < s1) technicalScore -= 6;     // Breaking support
                else if (price < pp) technicalScore -= 2;     // Below pivot
            }

            // Clamp technical score
            technicalScore = Math.max(5, Math.min(95, technicalScore));

            // ========== FUNDAMENTAL SCORE ==========
            let fundamentalScore = 50;

            // Use real fundamentals if available
            const pe = fundamentalsData?.pe || null;
            const pb = fundamentalsData?.pb || null;
            const roe = fundamentalsData?.roe || null;
            const divYield = fundamentalsData?.divYield || null;
            const beta = fundamentalsData?.beta || null;

            if (pe !== null && pe > 0) {
                if (pe < 10) fundamentalScore += 20;       // Deep value
                else if (pe < 15) fundamentalScore += 14;  // Value
                else if (pe < 20) fundamentalScore += 8;   // Fair value
                else if (pe < 25) fundamentalScore += 2;   // Slightly expensive
                else if (pe > 60) fundamentalScore -= 18;  // Very expensive
                else if (pe > 40) fundamentalScore -= 12;
                else if (pe > 30) fundamentalScore -= 6;
            }

            if (roe !== null && roe > 0) {
                if (roe > 25) fundamentalScore += 15;
                else if (roe > 18) fundamentalScore += 10;
                else if (roe > 12) fundamentalScore += 5;
                else if (roe < 8) fundamentalScore -= 10;
                else if (roe < 5) fundamentalScore -= 15;
            }

            if (pb !== null && pb > 0) {
                if (pb < 1) fundamentalScore += 12;        // Trading below book value
                else if (pb < 2) fundamentalScore += 6;
                else if (pb > 8) fundamentalScore -= 10;
                else if (pb > 5) fundamentalScore -= 5;
            }

            if (divYield !== null && divYield > 0) {
                if (divYield > 4 && divYield < 8) fundamentalScore += 6; // Good yield
                else if (divYield > 2) fundamentalScore += 3;
                else if (divYield > 8) fundamentalScore -= 3; // Yield trap risk
            }

            if (beta !== null && beta > 0) {
                if (beta > 1.5) fundamentalScore -= 8;  // High volatility
                else if (beta > 1.2) fundamentalScore -= 4;
                else if (beta < 0.7) fundamentalScore += 4; // Defensive
            }

            // Clamp fundamental score
            fundamentalScore = Math.max(10, Math.min(90, fundamentalScore));

            // ========== FINAL WEIGHTED SCORE ==========
            // Technical: 60%, Fundamental: 40% (technical gets more weight for trading signals)
            const rawScore = (technicalScore * 0.60) + (fundamentalScore * 0.40);

            // Daily momentum bonus/penalty
            let momentumAdjust = 0;
            if (change > 3 && volumeRatio > 1.5) momentumAdjust = 5;
            else if (change > 2) momentumAdjust = 3;
            else if (change < -3 && volumeRatio > 1.5) momentumAdjust = -7;
            else if (change < -2) momentumAdjust = -4;

            const finalScore = Math.round(Math.max(8, Math.min(92, rawScore + momentumAdjust)));

            // ========== DETERMINE SIGNAL ==========
            let signal, signalClass, signalBadgeClass, signalEmoji;

            // More conservative thresholds based on real analysis
            if (finalScore >= 72 && rsi < 65 && macdHistogram > 0) {
                signal = 'STRONG BUY';
                signalClass = 'signal-buy';
                signalBadgeClass = 'badge-bullish';
                signalEmoji = 'üöÄ';
            } else if (finalScore >= 58 && rsi < 70) {
                signal = 'BUY';
                signalClass = 'signal-buy';
                signalBadgeClass = 'badge-bullish';
                signalEmoji = 'üìà';
            } else if (finalScore >= 42 || (rsi >= 40 && rsi <= 60)) {
                signal = 'HOLD';
                signalClass = 'signal-hold';
                signalBadgeClass = 'badge-neutral';
                signalEmoji = '‚è∏Ô∏è';
            } else if (finalScore >= 28 || rsi > 70) {
                signal = 'SELL';
                signalClass = 'signal-sell';
                signalBadgeClass = 'badge-bearish';
                signalEmoji = 'üìâ';
            } else {
                signal = 'STRONG SELL';
                signalClass = 'signal-sell';
                signalBadgeClass = 'badge-bearish';
                signalEmoji = 'üîª';
            }

            // Override for extreme RSI conditions
            if (rsi <= 25 && macdHistogram > -1) {
                signal = finalScore >= 50 ? 'STRONG BUY' : 'BUY';
                signalClass = 'signal-buy';
                signalBadgeClass = 'badge-bullish';
                signalEmoji = finalScore >= 50 ? 'üöÄ' : 'üìà';
            } else if (rsi >= 80 && macdHistogram < 1) {
                signal = finalScore <= 50 ? 'STRONG SELL' : 'SELL';
                signalClass = 'signal-sell';
                signalBadgeClass = 'badge-bearish';
                signalEmoji = finalScore <= 50 ? 'üîª' : 'üìâ';
            }

            // ========== UPDATE UI WITH ACCURATE DATA ==========
            document.getElementById('signalIndicator').textContent = signalEmoji;
            document.getElementById('signalIndicator').className = 'signal-indicator ' + signalClass;
            document.getElementById('signalLabel').textContent = signal;
            document.getElementById('signalLabel').className = 'signal-label ' + signalClass;
            document.getElementById('signalBadge').textContent = signal;
            document.getElementById('signalBadge').className = 'card-badge ' + signalBadgeClass;

            // Update scores
            document.getElementById('scoreBadge').textContent = finalScore + '/100';
            document.getElementById('scoreBadge').className = 'card-badge ' + (finalScore >= 58 ? 'badge-bullish' : finalScore >= 42 ? 'badge-neutral' : 'badge-bearish');
            document.getElementById('gaugeValue').textContent = finalScore;
            document.getElementById('technicalScore').textContent = Math.round(technicalScore) + '/100';
            document.getElementById('fundamentalScore').textContent = Math.round(fundamentalScore) + '/100';

            // Animate gauge
            const gaugeOffset = 220 - (220 * finalScore / 100);
            document.getElementById('gaugeFill').style.strokeDashoffset = gaugeOffset;

            // Update confidence based on indicator alignment
            let indicatorAlignment = 0;
            if ((rsi < 50 && macdHistogram > 0) || (rsi > 50 && macdHistogram < 0)) indicatorAlignment++; // RSI-MACD agree
            if ((price > ema20 && macdHistogram > 0) || (price < ema20 && macdHistogram < 0)) indicatorAlignment++; // Trend-MACD agree
            if ((stochK < 50 && rsi < 50) || (stochK > 50 && rsi > 50)) indicatorAlignment++; // Stoch-RSI agree
            if (adx > 25) indicatorAlignment++; // Clear trend

            // Advanced indicator alignment checks
            if (williamsR !== undefined && ((williamsR < -50 && rsi < 50) || (williamsR > -50 && rsi > 50))) indicatorAlignment++; // Williams-RSI agree
            if (mfi !== undefined && ((mfi < 50 && rsi < 50) || (mfi > 50 && rsi > 50))) indicatorAlignment++; // MFI-RSI agree
            if (cci !== undefined && ((cci < 0 && change < 0) || (cci > 0 && change > 0))) indicatorAlignment++; // CCI confirms price direction
            if (roc !== undefined && ((roc > 0 && change > 0) || (roc < 0 && change < 0))) indicatorAlignment++; // ROC confirms momentum
            if (aroonUp !== undefined && aroonDown !== undefined) {
                const aroonOsc = aroonUp - aroonDown;
                if ((aroonOsc > 30 && change > 0) || (aroonOsc < -30 && change < 0)) indicatorAlignment++; // Aroon confirms trend
            }
            if (obvTrend === 'bullish' && change > 0 || obvTrend === 'bearish' && change < 0) indicatorAlignment++; // OBV confirms direction

            const confidence = Math.min(95, Math.max(50, 55 + indicatorAlignment * 4 + Math.abs(finalScore - 50) * 0.5));
            document.getElementById('confidenceText').textContent = confidence.toFixed(1) + '%';
            document.getElementById('confidenceFill').style.width = confidence + '%';

            // Update sentiment based on real indicators
            const bullish = Math.min(75, Math.max(20, technicalScore * 0.8 + 10));
            const bearish = Math.min(50, Math.max(10, (100 - technicalScore) * 0.5));
            const neutral = Math.max(10, 100 - bullish - bearish);

            document.getElementById('bullishBar').style.width = bullish + '%';
            document.getElementById('neutralBar').style.width = neutral + '%';
            document.getElementById('bearishBar').style.width = bearish + '%';
            document.getElementById('bullishValue').textContent = Math.round(bullish) + '%';
            document.getElementById('neutralValue').textContent = Math.round(neutral) + '%';
            document.getElementById('bearishValue').textContent = Math.round(bearish) + '%';

            const sentimentLabel = bullish > 50 ? 'Bullish' : bearish > 35 ? 'Bearish' : 'Neutral';
            document.getElementById('sentimentBadge').textContent = sentimentLabel;
            document.getElementById('sentimentBadge').className = 'card-badge ' + (bullish > 50 ? 'badge-bullish' : bearish > 35 ? 'badge-bearish' : 'badge-neutral');

            // Add LIVE ACCURATE badge
            const signalCard = document.querySelector('.signal-card');
            if (signalCard && !signalCard.querySelector('.live-accurate-badge')) {
                const accurateBadge = document.createElement('div');
                accurateBadge.className = 'live-accurate-badge';
                accurateBadge.innerHTML = '<i class="fas fa-check-circle"></i> LIVE ACCURATE';
                accurateBadge.style.cssText = 'position: absolute; top: 8px; left: 8px; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 4px 10px; border-radius: 6px; font-size: 0.7rem; font-weight: 600; display: flex; align-items: center; gap: 4px; z-index: 10;';
                signalCard.style.position = 'relative';
                signalCard.appendChild(accurateBadge);
            }

            console.log('‚úÖ Score recalculated with REAL data:', {
                technicalScore: Math.round(technicalScore),
                fundamentalScore: Math.round(fundamentalScore),
                finalScore,
                signal,
                rsi: rsi.toFixed(1),
                macd: macdHistogram.toFixed(2),
                confidence: confidence.toFixed(1)
            });

            // Update social score based on real analysis
            const symbolSeedSocial = symbol.split('').reduce((a, c) => a + c.charCodeAt(0), 0);
            const socialVariance = ((symbolSeedSocial * 23 % 28) - 14);
            const socialBase = 50 + (finalScore - 50) * 0.4;
            document.getElementById('socialScore').textContent = Math.round(Math.max(35, Math.min(85, socialBase + socialVariance))) + '/100';

            // Update AI Summary with accurate data
            generateAccurateAISummary(symbol, stockData, techIndicators, finalScore, signal, technicalScore, fundamentalScore);
        }

        // Fallback: show estimated signal when real technical data fails to load
        function showEstimatedSignal(symbol, stockData) {
            // Re-run displayAnalysis scoring but actually show the signal (with warning)
            const price = stockData.price;
            const change = stockData.change;
            const fundamentals = generateFundamentals(price, stockData.sector);

            const yearlyRange = stockData.fiftyTwoWeekHigh - stockData.fiftyTwoWeekLow;
            const pricePosition = yearlyRange > 0 ? ((price - stockData.fiftyTwoWeekLow) / yearlyRange) * 100 : 50;

            let rsiBase = 50;
            rsiBase += (pricePosition - 50) * 0.35;
            const momentumWeight = change > 2 || change < -2 ? 3 : 2;
            rsiBase += change * momentumWeight;
            const volumeRatioRaw = stockData.volume / Math.max(stockData.avgVolume, 1);
            if (volumeRatioRaw > 1.3 && change > 0) rsiBase += 5;
            else if (volumeRatioRaw > 1.3 && change < 0) rsiBase -= 5;
            const dayRange = stockData.dayHigh - stockData.dayLow;
            const dayPosition = dayRange > 0 ? ((price - stockData.dayLow) / dayRange) : 0.5;
            rsiBase += (dayPosition - 0.5) * 10;
            const symbolHash = symbol.split('').reduce((a, c) => a + c.charCodeAt(0), 0) % 100;
            const microVariance = ((symbolHash - 50) / 50) * 3;
            const rsi = Math.max(15, Math.min(85, rsiBase + microVariance));

            let technicalScore = 45;
            if (rsi < 25) technicalScore += 18;
            else if (rsi < 35) technicalScore += 8;
            else if (rsi > 75) technicalScore -= 20;
            else if (rsi > 65) technicalScore -= 12;
            else if (rsi > 55) technicalScore -= 4;
            technicalScore = Math.max(10, Math.min(90, technicalScore));

            let fundamentalScore = 40;
            if (fundamentals.pe < 12) fundamentalScore += 18;
            else if (fundamentals.pe < 18) fundamentalScore += 10;
            else if (fundamentals.pe > 60) fundamentalScore -= 20;
            else if (fundamentals.pe > 35) fundamentalScore -= 8;
            fundamentalScore = Math.max(10, Math.min(90, fundamentalScore));

            const rawScore = (technicalScore * 0.55 + fundamentalScore * 0.45);
            const score = Math.round(Math.max(12, Math.min(88, rawScore)));

            let signal, signalClass, signalBadgeClass, signalEmoji;
            if (score >= 75) { signal = 'STRONG BUY'; signalClass = 'signal-buy'; signalBadgeClass = 'badge-bullish'; signalEmoji = 'üöÄ'; }
            else if (score >= 60) { signal = 'BUY'; signalClass = 'signal-buy'; signalBadgeClass = 'badge-bullish'; signalEmoji = 'üìà'; }
            else if (score >= 45) { signal = 'HOLD'; signalClass = 'signal-hold'; signalBadgeClass = 'badge-neutral'; signalEmoji = '‚è∏Ô∏è'; }
            else if (score >= 30) { signal = 'SELL'; signalClass = 'signal-sell'; signalBadgeClass = 'badge-bearish'; signalEmoji = 'üìâ'; }
            else { signal = 'STRONG SELL'; signalClass = 'signal-sell'; signalBadgeClass = 'badge-bearish'; signalEmoji = 'üîª'; }

            document.getElementById('signalIndicator').textContent = signalEmoji;
            document.getElementById('signalIndicator').className = 'signal-indicator ' + signalClass;
            document.getElementById('signalLabel').textContent = signal + ' (Est.)';
            document.getElementById('signalLabel').className = 'signal-label ' + signalClass;
            document.getElementById('signalBadge').textContent = signal + ' (Est.)';
            document.getElementById('signalBadge').className = 'card-badge ' + signalBadgeClass;

            document.getElementById('scoreBadge').textContent = score + '/100';
            document.getElementById('scoreBadge').className = 'card-badge ' + (score >= 60 ? 'badge-bullish' : score >= 40 ? 'badge-neutral' : 'badge-bearish');
            document.getElementById('gaugeValue').textContent = score;
            document.getElementById('technicalScore').textContent = Math.round(technicalScore) + '/100';
            document.getElementById('fundamentalScore').textContent = Math.round(fundamentalScore) + '/100';
            const gaugeOffset = 220 - (220 * score / 100);
            document.getElementById('gaugeFill').style.strokeDashoffset = gaugeOffset;

            document.getElementById('confidenceText').textContent = 'Limited';
            document.getElementById('confidenceFill').style.width = '30%';

            console.warn('‚ö†Ô∏è Showing estimated signal - real technical data unavailable');
        }

        // Generate AI Summary based on real technical data
        function generateAccurateAISummary(symbol, stockData, indicators, score, signal, techScore, fundScore) {
            const rsi = indicators.rsi;
            const macd = indicators.macdHistogram;
            const price = stockData.price;
            const change = stockData.change;

            let rsiAnalysis = '';
            if (rsi <= 30) rsiAnalysis = `<span class="positive">RSI at ${rsi.toFixed(1)} indicates oversold conditions - potential reversal opportunity</span>`;
            else if (rsi >= 70) rsiAnalysis = `<span class="negative">RSI at ${rsi.toFixed(1)} shows overbought levels - exercise caution</span>`;
            else rsiAnalysis = `RSI at ${rsi.toFixed(1)} is in neutral territory`;

            let macdAnalysis = '';
            if (macd > 1) macdAnalysis = '<span class="positive">MACD histogram is positive with bullish momentum</span>';
            else if (macd < -1) macdAnalysis = '<span class="negative">MACD histogram is negative showing bearish pressure</span>';
            else macdAnalysis = 'MACD is near zero indicating consolidation';

            let trendAnalysis = '';
            if (price > indicators.ema20 && price > indicators.sma50) {
                trendAnalysis = '<span class="positive">Price is above both EMA20 and SMA50 - confirmed uptrend</span>';
            } else if (price < indicators.ema20 && price < indicators.sma50) {
                trendAnalysis = '<span class="negative">Price is below both moving averages - confirmed downtrend</span>';
            } else {
                trendAnalysis = 'Price is between moving averages - trend transition phase';
            }

            const summary = `
                <span class="highlight">${symbol}</span> - <span class="${signal.includes('BUY') ? 'positive' : signal.includes('SELL') ? 'negative' : 'highlight'}">${signal}</span> (Accurate Score: ${score}/100)<br><br>
                
                <strong>üìä Technical Analysis (Real-Time):</strong><br>
                ‚Ä¢ ${rsiAnalysis}<br>
                ‚Ä¢ ${macdAnalysis}<br>
                ‚Ä¢ ${trendAnalysis}<br>
                ‚Ä¢ Stochastic: ${indicators.stochK.toFixed(1)}%K / ${indicators.stochD.toFixed(1)}%D ${indicators.stochK < 20 ? '(Oversold)' : indicators.stochK > 80 ? '(Overbought)' : '(Neutral)'}<br>
                ‚Ä¢ ADX Trend Strength: ${indicators.adx.toFixed(1)} ${indicators.adx > 30 ? '(Strong Trend)' : indicators.adx > 20 ? '(Moderate)' : '(Weak/No Trend)'}<br><br>
                
                <strong>üìà Key Levels:</strong><br>
                ‚Ä¢ EMA20: ‚Çπ${indicators.ema20.toFixed(2)} ${price > indicators.ema20 ? '(Above ‚úì)' : '(Below ‚úó)'}<br>
                ‚Ä¢ SMA50: ‚Çπ${indicators.sma50.toFixed(2)} ${price > indicators.sma50 ? '(Above ‚úì)' : '(Below ‚úó)'}<br>
                ‚Ä¢ Bollinger: ${indicators.bollingerPosition.charAt(0).toUpperCase() + indicators.bollingerPosition.slice(1)} Band<br><br>
                
                <strong>‚ö†Ô∏è IMPORTANT DISCLAIMER:</strong> This analysis uses REAL technical indicators calculated from live market data. However, this is for EDUCATIONAL PURPOSES ONLY and NOT investment advice. Always consult a SEBI-registered financial advisor before making investment decisions. Past performance does not guarantee future results.
            `;

            document.getElementById('aiSummaryText').innerHTML = summary;
        }

        // Update fundamentals display with live API data
        function updateFundamentalsFromAPI(data, currentPrice) {
            if (data.pe && data.pe > 0) {
                document.getElementById('peRatio').textContent = data.pe.toFixed(1);
            }
            if (data.pb && data.pb > 0) {
                document.getElementById('pbRatio').textContent = data.pb.toFixed(2);
            }
            if (data.roe && data.roe > 0) {
                document.getElementById('roe').textContent = data.roe.toFixed(1) + '%';
            }
            if (data.eps && data.eps > 0) {
                document.getElementById('eps').textContent = '‚Çπ' + data.eps.toFixed(2);
            }
            if (data.divYield && data.divYield > 0) {
                document.getElementById('divYield').textContent = data.divYield.toFixed(2) + '%';
            }
            if (data.beta && data.beta > 0) {
                document.getElementById('beta').textContent = data.beta.toFixed(2);
            }
            if (data.marketCap && data.marketCap > 0) {
                document.getElementById('marketCap').textContent = formatNumber(data.marketCap);
            }
            // Update 52-week data if available
            if (data.fiftyTwoWeekHigh) {
                document.getElementById('week52High').textContent = '‚Çπ' + data.fiftyTwoWeekHigh.toFixed(2);
            }
            if (data.fiftyTwoWeekLow) {
                document.getElementById('week52Low').textContent = '‚Çπ' + data.fiftyTwoWeekLow.toFixed(2);
            }
            console.log('‚úÖ Fundamentals updated from Finnhub API');
        }

        // Update news score in sentiment card based on real news
        function updateNewsScore(newsData) {
            // Handle both old format (array) and new format (object with news and isMarketNews)
            let news;
            if (Array.isArray(newsData)) {
                news = newsData;
            } else if (newsData && newsData.news) {
                news = newsData.news;
            } else {
                return;
            }

            if (!news || news.length === 0) return;

            const positive = news.filter(n => n.sentiment === 'positive').length;
            const negative = news.filter(n => n.sentiment === 'negative').length;
            const total = news.length;

            // Calculate score: 50 base, +10 for each positive, -10 for each negative
            const score = Math.max(20, Math.min(95, 50 + (positive - negative) * 12));
            document.getElementById('newsScore').textContent = Math.round(score) + '/100';
        }

        function formatNumber(num) {
            if (num >= 100000) return '‚Çπ' + (num / 100000).toFixed(2) + ' L Cr';
            if (num >= 1000) return '‚Çπ' + (num / 1000).toFixed(2) + ' K Cr';
            return '‚Çπ' + num.toFixed(2) + ' Cr';
        }

        function generateCandlestickChart(price, volatility) {
            const container = document.getElementById('candlestickChart');
            container.innerHTML = '';

            let currentPrice = price * 0.95;
            for (let i = 0; i < 20; i++) {
                const change = (Math.random() - 0.5) * volatility * 2;
                const open = currentPrice;
                const close = currentPrice * (1 + change);
                const high = Math.max(open, close) * (1 + Math.random() * volatility * 0.5);
                const low = Math.min(open, close) * (1 - Math.random() * volatility * 0.5);

                const isGreen = close > open;
                const maxHeight = 100;
                const priceRange = price * volatility * 3;

                const wickTop = ((high - Math.max(open, close)) / priceRange) * maxHeight;
                const bodyHeight = Math.max(5, (Math.abs(close - open) / priceRange) * maxHeight);
                const wickBottom = ((Math.min(open, close) - low) / priceRange) * maxHeight;

                const candle = document.createElement('div');
                candle.className = 'candle ' + (isGreen ? 'green' : 'red');
                candle.innerHTML = `
                    <div class="candle-wick" style="height: ${wickTop}px;"></div>
                    <div class="candle-body" style="height: ${bodyHeight}px;"></div>
                    <div class="candle-wick" style="height: ${wickBottom}px;"></div>
                `;
                container.appendChild(candle);

                currentPrice = close;
            }
        }

        function displayAnalysis(symbol, stockData) {
            // Use real price data from API or fallback
            const price = stockData.price;
            const change = stockData.change;
            const changeAmount = price * (change / 100);

            // Generate fundamentals for analysis (API doesn't provide these for free)
            const fundamentals = generateFundamentals(price, stockData.sector);

            // Show data source indicator
            const dataSourceBadge = stockData.success !== false ?
                '<span class="live-indicator">LIVE</span>' :
                '<span style="color: var(--text-muted); font-size: 0.7rem;">(Simulated)</span>';

            // ========== ADVANCED TECHNICAL ANALYSIS ==========
            // Calculate 52-week position (where price is relative to yearly range)
            const yearlyRange = stockData.fiftyTwoWeekHigh - stockData.fiftyTwoWeekLow;
            const pricePosition = yearlyRange > 0 ? ((price - stockData.fiftyTwoWeekLow) / yearlyRange) * 100 : 50;

            // RSI Calculation based on price momentum (improved accuracy)
            // Uses multiple factors: price position, daily change, volume confirmation
            // More deterministic - reduced random variance for consistency
            let rsiBase = 50;

            // Position in yearly range (weighted contribution)
            const positionWeight = 0.35;
            rsiBase += (pricePosition - 50) * positionWeight;

            // Daily momentum (higher weight for strong moves)
            const momentumWeight = change > 2 || change < -2 ? 3 : 2;
            rsiBase += change * momentumWeight;

            // Volume confirmation adjusts RSI
            const volumeRatioRaw = stockData.volume / Math.max(stockData.avgVolume, 1);
            if (volumeRatioRaw > 1.3 && change > 0) rsiBase += 5; // High volume uptrend
            else if (volumeRatioRaw > 1.3 && change < 0) rsiBase -= 5; // High volume downtrend

            // Day range position (where price closed relative to day's range)
            const dayRange = stockData.dayHigh - stockData.dayLow;
            const dayPosition = dayRange > 0 ? ((price - stockData.dayLow) / dayRange) : 0.5;
            rsiBase += (dayPosition - 0.5) * 10; // Closed near high = bullish

            // Minimal deterministic variance (based on symbol hash for consistency)
            const symbolHash = symbol.split('').reduce((a, c) => a + c.charCodeAt(0), 0) % 100;
            const microVariance = ((symbolHash - 50) / 50) * 3; // -3 to +3 range

            const rsi = Math.max(15, Math.min(85, rsiBase + microVariance));

            // Volume Analysis Score (more granular thresholds)
            const volumeRatio = stockData.volume / Math.max(stockData.avgVolume, 1);
            // Smoother scoring curve instead of discrete steps
            let volumeScore;
            if (volumeRatio > 2.0) volumeScore = 0.95; // Exceptional volume
            else if (volumeRatio > 1.5) volumeScore = 0.85; // Very high volume
            else if (volumeRatio > 1.2) volumeScore = 0.75; // Above average
            else if (volumeRatio > 1.0) volumeScore = 0.65; // Normal-high
            else if (volumeRatio > 0.8) volumeScore = 0.50; // Normal
            else if (volumeRatio > 0.6) volumeScore = 0.35; // Below average
            else if (volumeRatio > 0.4) volumeScore = 0.25; // Low volume
            else volumeScore = 0.15; // Very low volume - weak conviction

            // MACD Signal (improved approximation using multiple momentum factors)
            // Combines daily change, price position, and volume for better accuracy
            let macdSignal = 0.5; // Start neutral

            // Trend direction from daily change
            if (change > 2) macdSignal += 0.20;
            else if (change > 1) macdSignal += 0.12;
            else if (change > 0.3) macdSignal += 0.06;
            else if (change < -2) macdSignal -= 0.20;
            else if (change < -1) macdSignal -= 0.12;
            else if (change < -0.3) macdSignal -= 0.06;

            // Price position relative to range adds conviction
            if (pricePosition > 60 && change > 0) macdSignal += 0.08; // Uptrend confirmation
            else if (pricePosition < 40 && change < 0) macdSignal -= 0.08; // Downtrend confirmation
            else if (pricePosition > 70 && change < 0) macdSignal -= 0.10; // Reversal warning
            else if (pricePosition < 30 && change > 0) macdSignal += 0.10; // Recovery signal

            // Volume confirmation
            if (volumeScore > 0.7 && change > 0.5) macdSignal += 0.05;
            else if (volumeScore > 0.7 && change < -0.5) macdSignal -= 0.05;

            const macdSignalScore = Math.max(0.1, Math.min(0.9, macdSignal));

            // Support/Resistance proximity
            const nearSupport = pricePosition < 25;
            const nearResistance = pricePosition > 75;

            // ========== TECHNICAL SCORE CALCULATION ==========
            let technicalScore = 45; // Start slightly below neutral

            // RSI contribution (more balanced - penalize extremes both ways)
            if (rsi < 25) technicalScore += 18; // Deeply oversold = bullish
            else if (rsi < 35) technicalScore += 8; // Mildly oversold
            else if (rsi > 75) technicalScore -= 20; // Heavily overbought = bearish
            else if (rsi > 65) technicalScore -= 12; // Overbought
            else if (rsi > 55) technicalScore -= 4; // Slightly overbought
            else if (rsi >= 45 && rsi <= 55) technicalScore += 0; // True neutral zone
            else technicalScore += 3; // Slightly oversold

            // Volume confirmation (symmetric scoring)
            if (volumeScore > 0.7 && change > 1) technicalScore += 12; // Strong volume up
            else if (volumeScore > 0.7 && change < -1) technicalScore -= 15; // Strong volume down = bearish
            else if (volumeScore > 0.7 && change < 0) technicalScore -= 8; // Volume up but price down
            else if (volumeScore < 0.4 && change > 0) technicalScore -= 5; // Weak volume rally
            else if (volumeScore < 0.4) technicalScore -= 3; // Low conviction

            // MACD Signal (reduced impact, more symmetric)
            technicalScore += (macdSignalScore - 0.5) * 20;

            // Daily trend (more realistic - small moves are noise)
            if (change > 3) technicalScore += 10; // Strong up
            else if (change > 1.5) technicalScore += 5;
            else if (change > 0.3) technicalScore += 2;
            else if (change >= -0.3 && change <= 0.3) technicalScore -= 2; // Flat = uncertainty
            else if (change < -3) technicalScore -= 18; // Strong down = bearish
            else if (change < -1.5) technicalScore -= 10;
            else if (change < -0.3) technicalScore -= 5;

            // Support/Resistance levels (symmetric)
            if (nearSupport && change > 0.5) technicalScore += 8; // Bouncing off support
            else if (nearSupport && change < 0) technicalScore -= 12; // Breaking support = very bearish
            else if (nearResistance && change < -0.5) technicalScore -= 10; // Rejected at resistance
            else if (nearResistance && change > 0) technicalScore += 5; // Breaking resistance
            else if (pricePosition > 85) technicalScore -= 8; // Near all-time high = risky
            else if (pricePosition < 20) technicalScore -= 5; // Falling knife risk

            // Beta consideration (high beta = more risk)
            technicalScore += fundamentals.beta < 0.7 ? 4 : fundamentals.beta < 1.0 ? 2 : fundamentals.beta > 1.5 ? -8 : fundamentals.beta > 1.2 ? -3 : 0;

            technicalScore = Math.max(10, Math.min(90, technicalScore));

            // ========== FUNDAMENTAL SCORE CALCULATION ==========
            let fundamentalScore = 40; // Start below neutral

            // PE Ratio analysis (stricter thresholds)
            if (fundamentals.pe < 12) fundamentalScore += 18; // Deep value
            else if (fundamentals.pe < 18) fundamentalScore += 10; // Fair value
            else if (fundamentals.pe < 25) fundamentalScore += 3; // Slightly expensive
            else if (fundamentals.pe > 60) fundamentalScore -= 20; // Extremely overvalued
            else if (fundamentals.pe > 45) fundamentalScore -= 14; // Very expensive
            else if (fundamentals.pe > 35) fundamentalScore -= 8; // Expensive
            else fundamentalScore -= 3; // Above average

            // ROE analysis (more balanced)
            if (fundamentals.roe > 30) fundamentalScore += 15;
            else if (fundamentals.roe > 22) fundamentalScore += 10;
            else if (fundamentals.roe > 15) fundamentalScore += 4;
            else if (fundamentals.roe < 8) fundamentalScore -= 15; // Poor returns
            else if (fundamentals.roe < 12) fundamentalScore -= 6; // Below average
            else fundamentalScore -= 2; // Mediocre

            // Debt to Equity (stricter on high debt)
            if (fundamentals.debtEquity < 0.2) fundamentalScore += 12; // Very low debt
            else if (fundamentals.debtEquity < 0.5) fundamentalScore += 6;
            else if (fundamentals.debtEquity < 0.8) fundamentalScore += 2;
            else if (fundamentals.debtEquity > 2.0) fundamentalScore -= 18; // Highly leveraged = risky
            else if (fundamentals.debtEquity > 1.2) fundamentalScore -= 10;
            else fundamentalScore -= 4; // Above average debt

            // Dividend yield (more nuanced - too high can be a trap)
            if (fundamentals.divYield > 6) fundamentalScore -= 5; // Yield trap warning
            else if (fundamentals.divYield > 3.5) fundamentalScore += 6; // Good yield
            else if (fundamentals.divYield > 2) fundamentalScore += 4;
            else if (fundamentals.divYield > 1) fundamentalScore += 1;
            else fundamentalScore -= 3; // No/low dividend

            // P/B Ratio consideration (stricter)
            if (fundamentals.pb < 1.5) fundamentalScore += 8; // Deep value
            else if (fundamentals.pb < 2.5) fundamentalScore += 3;
            else if (fundamentals.pb > 10) fundamentalScore -= 12; // Very expensive
            else if (fundamentals.pb > 6) fundamentalScore -= 6;
            else if (fundamentals.pb > 4) fundamentalScore -= 2;

            fundamentalScore = Math.max(10, Math.min(90, fundamentalScore));

            // ========== WEIGHTED OVERALL SCORE ==========
            // Technical: 55%, Fundamental: 45% (slight technical bias for short-term signals)
            const rawScore = (technicalScore * 0.55 + fundamentalScore * 0.45);

            // Trend Strength Bonus - reward clear trends (high volume + strong move)
            let trendBonus = 0;
            if (volumeScore > 0.7) {
                if (change > 2) trendBonus = 5; // Strong bullish confirmation
                else if (change > 1) trendBonus = 2;
                else if (change < -2) trendBonus = -5; // Strong bearish confirmation
                else if (change < -1) trendBonus = -2;
            }

            // Deterministic micro-adjustment based on symbol (for consistency)
            const symbolSeed = symbol.split('').reduce((a, c) => a + c.charCodeAt(0), 0);
            const deterministicAdjust = ((symbolSeed % 50) - 25) / 10; // -2.5 to +2.5 range

            // Apply softer mean reversion - only for extreme scores
            let adjustedScore = rawScore + trendBonus + deterministicAdjust;
            if (adjustedScore > 80) adjustedScore -= (adjustedScore - 80) * 0.15; // Gentler pull
            if (adjustedScore < 20) adjustedScore += (20 - adjustedScore) * 0.15; // Gentler push

            const score = Math.round(Math.max(12, Math.min(88, adjustedScore)));

            // Update Stock Header
            document.getElementById('stockLogo').textContent = symbol.substring(0, 2);
            document.getElementById('stockName').textContent = stockData.name;
            document.getElementById('stockSector').textContent = stockData.sector;
            document.getElementById('headerPrice').textContent = '‚Çπ' + price.toFixed(2);
            document.getElementById('headerChange').textContent = (change >= 0 ? '+' : '') + changeAmount.toFixed(2) + ' (' + (change >= 0 ? '+' : '') + change.toFixed(2) + '%)';
            document.getElementById('headerChange').className = 'price-change-large ' + (change >= 0 ? 'positive' : 'negative');

            // Update data source indicator - Always show "NSE LIVE" since we only fetch live data now
            const timestamp = stockData.timestamp ? new Date(stockData.timestamp).toLocaleTimeString('en-IN') : new Date().toLocaleTimeString('en-IN');
            document.getElementById('lastUpdated').innerHTML = `<span class="live-indicator"><i class="fas fa-circle" style="color: #22c55e; font-size: 8px;"></i> NSE LIVE</span> <span style="font-size: 0.85em; color: var(--text-muted);">${timestamp}</span>`;

            // ========== SHOW LOADING STATE FOR SIGNAL (wait for real data) ==========
            // Don't show estimated signal - wait for recalculateScoreWithRealData() to set the real one
            document.getElementById('signalIndicator').textContent = '‚è≥';
            document.getElementById('signalIndicator').className = 'signal-indicator signal-hold';
            document.getElementById('signalLabel').textContent = 'Analyzing...';
            document.getElementById('signalLabel').className = 'signal-label signal-hold';
            document.getElementById('signalBadge').textContent = 'Analyzing...';
            document.getElementById('signalBadge').className = 'card-badge badge-neutral';

            // Loading state for confidence
            document.getElementById('confidenceText').textContent = 'Calculating...';
            document.getElementById('confidenceFill').style.width = '0%';

            // Loading state for score
            document.getElementById('scoreBadge').textContent = '--/100';
            document.getElementById('scoreBadge').className = 'card-badge badge-neutral';
            document.getElementById('gaugeValue').textContent = '--';
            document.getElementById('technicalScore').textContent = '--/100';
            document.getElementById('fundamentalScore').textContent = '--/100';
            document.getElementById('gaugeFill').style.strokeDashoffset = 220;

            // Loading state for sentiment
            document.getElementById('bullishBar').style.width = '33%';
            document.getElementById('neutralBar').style.width = '34%';
            document.getElementById('bearishBar').style.width = '33%';
            document.getElementById('bullishValue').textContent = '--';
            document.getElementById('neutralValue').textContent = '--';
            document.getElementById('bearishValue').textContent = '--';
            document.getElementById('sentimentBadge').textContent = 'Analyzing';
            document.getElementById('sentimentBadge').className = 'card-badge badge-neutral';

            // Loading state for news/social scores
            document.getElementById('newsScore').textContent = '--/100';
            document.getElementById('socialScore').textContent = '--/100';

            // Price Analysis - use real data from API
            const dayHigh = stockData.dayHigh || price * 1.01;
            const dayLow = stockData.dayLow || price * 0.99;
            const w52High = stockData.fiftyTwoWeekHigh || price * 1.25;
            const w52Low = stockData.fiftyTwoWeekLow || price * 0.75;

            document.getElementById('currentPrice').textContent = '‚Çπ' + price.toFixed(2);
            document.getElementById('priceChange').textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
            document.getElementById('priceChange').className = 'metric-value ' + (change >= 0 ? 'metric-positive' : 'metric-negative');
            document.getElementById('dayHigh').textContent = '‚Çπ' + dayHigh.toFixed(2);
            document.getElementById('dayLow').textContent = '‚Çπ' + dayLow.toFixed(2);
            document.getElementById('week52High').textContent = '‚Çπ' + w52High.toFixed(2);
            document.getElementById('week52Low').textContent = '‚Çπ' + w52Low.toFixed(2);

            // Use real volume data from API (deterministic fallback)
            const volFallback = 5 + (symbolSeed % 15);
            const todayVol = stockData.volume ? (stockData.volume / 1000000).toFixed(2) : volFallback.toFixed(1);
            const avgVolFactor = 0.8 + ((symbolSeed * 7 % 40) / 100);
            const avgVol = stockData.avgVolume ? (stockData.avgVolume / 1000000).toFixed(2) : (volFallback * avgVolFactor).toFixed(1);
            document.getElementById('avgVolume').textContent = avgVol + 'M';
            document.getElementById('todayVolume').textContent = todayVol + 'M';

            // Generate Candlestick Chart
            const volatility = Math.abs(change) / 100 + 0.015;
            generateCandlestickChart(price, volatility);

            // Price Targets - Dynamic based on score and volatility
            const bullishBias = score > 55 ? 1.02 : score < 45 ? 0.98 : 1.0;
            const t1 = price * (1.04 + (score - 50) / 500) * bullishBias;
            const t2 = price * (1.09 + (score - 50) / 400) * bullishBias;
            const t3 = price * (1.16 + (score - 50) / 300) * bullishBias;
            const s1 = price * (0.97 - (50 - score) / 600);
            const s2 = price * (0.93 - (50 - score) / 500);
            const sl = price * (0.89 - (50 - score) / 400);

            document.getElementById('resistance3').innerHTML = '‚Çπ' + t3.toFixed(2) + '<span class="target-percent" id="res3Pct">+' + ((t3 / price - 1) * 100).toFixed(1) + '%</span>';
            document.getElementById('resistance2').innerHTML = '‚Çπ' + t2.toFixed(2) + '<span class="target-percent" id="res2Pct">+' + ((t2 / price - 1) * 100).toFixed(1) + '%</span>';
            document.getElementById('resistance1').innerHTML = '‚Çπ' + t1.toFixed(2) + '<span class="target-percent" id="res1Pct">+' + ((t1 / price - 1) * 100).toFixed(1) + '%</span>';
            document.getElementById('targetCurrent').textContent = '‚Çπ' + price.toFixed(2);
            document.getElementById('support1').innerHTML = '‚Çπ' + s1.toFixed(2) + '<span class="target-percent" id="sup1Pct">' + ((s1 / price - 1) * 100).toFixed(1) + '%</span>';
            document.getElementById('support2').innerHTML = '‚Çπ' + s2.toFixed(2) + '<span class="target-percent" id="sup2Pct">' + ((s2 / price - 1) * 100).toFixed(1) + '%</span>';
            document.getElementById('stopLoss').innerHTML = '‚Çπ' + sl.toFixed(2) + '<span class="target-percent" id="slPct">' + ((sl / price - 1) * 100).toFixed(1) + '%</span>';

            // Technical Indicators - Deterministic calculations based on available data
            const signals = ['ind-buy', 'ind-sell', 'ind-neutral'];
            const signalTexts = ['BUY', 'SELL', 'NEUTRAL'];

            // Use symbol seed for deterministic variations (consistency between analyses)
            const indicatorSeed = symbolSeed;

            // RSI - already calculated above, use directly
            const rsiSignal = rsi < 30 ? 0 : rsi > 70 ? 1 : 2;
            document.getElementById('rsiValue').textContent = rsi.toFixed(1);
            document.getElementById('rsiSignal').textContent = signalTexts[rsiSignal];
            document.getElementById('rsiSignal').className = 'indicator-signal ' + signals[rsiSignal];

            // MACD - Derive from macdSignalScore calculated above (consistent with analysis)
            // Convert 0-1 score to MACD-like value (-10 to +10 range)
            const macdVal = (macdSignalScore - 0.5) * 20;
            const macdSig = macdVal > 2 ? 0 : macdVal < -2 ? 1 : 2;
            document.getElementById('macdValue').textContent = (macdVal >= 0 ? '+' : '') + macdVal.toFixed(2);
            document.getElementById('macdSignal').textContent = signalTexts[macdSig];
            document.getElementById('macdSignal').className = 'indicator-signal ' + signals[macdSig];

            // EMA 20 - Estimate based on price position and trend
            // If price is above position 50, EMA20 should be slightly below price (uptrend)
            const ema20Factor = pricePosition > 60 ? 0.97 : pricePosition > 40 ? 0.995 : 1.02;
            const ema20Variance = ((indicatorSeed % 30) - 15) / 1000; // ¬±1.5% max
            const ema20 = price * (ema20Factor + ema20Variance);
            const ema20Sig = price > ema20 * 1.015 ? 0 : price < ema20 * 0.985 ? 1 : 2;
            document.getElementById('ema20Value').textContent = '‚Çπ' + ema20.toFixed(0);
            document.getElementById('ma20Signal').textContent = signalTexts[ema20Sig];
            document.getElementById('ma20Signal').className = 'indicator-signal ' + signals[ema20Sig];

            // SMA 50 - Estimate based on 52-week position (longer term trend)
            // If near 52-week high, SMA50 should be well below price
            const sma50Factor = pricePosition > 70 ? 0.92 : pricePosition > 50 ? 0.97 : pricePosition > 30 ? 1.02 : 1.08;
            const sma50Variance = ((indicatorSeed * 7 % 40) - 20) / 1000; // ¬±2% max
            const sma50 = price * (sma50Factor + sma50Variance);
            const sma50Sig = price > sma50 * 1.02 ? 0 : price < sma50 * 0.98 ? 1 : 2;
            document.getElementById('sma50Value').textContent = '‚Çπ' + sma50.toFixed(0);
            document.getElementById('ma50Signal').textContent = signalTexts[sma50Sig];
            document.getElementById('ma50Signal').className = 'indicator-signal ' + signals[sma50Sig];

            // Bollinger Bands - Based on day's price position (high/low range)
            // Uses dayPosition calculated earlier
            const bbSig = dayPosition < 0.25 ? 0 : dayPosition > 0.75 ? 1 : 2;
            const bbText = dayPosition < 0.25 ? 'Lower' : dayPosition > 0.75 ? 'Upper' : 'Middle';
            document.getElementById('bbValue').textContent = bbText;
            document.getElementById('bbSignal').textContent = signalTexts[bbSig];
            document.getElementById('bbSignal').className = 'indicator-signal ' + signals[bbSig];

            // Stochastic - Correlate with RSI but with different thresholds
            // Stochastic is more volatile, derived from day range and price position
            const stochBase = (dayPosition * 50) + (pricePosition * 0.3) + ((change + 3) * 5);
            const stochVariance = ((indicatorSeed * 3 % 20) - 10);
            const stoch = Math.max(5, Math.min(95, stochBase + stochVariance));
            const stochSig = stoch < 20 ? 0 : stoch > 80 ? 1 : 2;
            document.getElementById('stochValue').textContent = stoch.toFixed(1);
            document.getElementById('stochSignal').textContent = signalTexts[stochSig];
            document.getElementById('stochSignal').className = 'indicator-signal ' + signals[stochSig];

            // ADX - Trend strength based on volatility and volume
            // High volume + strong move = strong trend (high ADX)
            const adxBase = 20 + (Math.abs(change) * 5) + (volumeScore * 20);
            const adxVariance = ((indicatorSeed * 11 % 15) - 7);
            const adx = Math.max(10, Math.min(60, adxBase + adxVariance));
            const adxSig = adx > 30 ? 0 : adx < 20 ? 1 : 2;
            document.getElementById('adxValue').textContent = adx.toFixed(1);
            document.getElementById('adxSignal').textContent = adx > 30 ? 'STRONG' : adx < 20 ? 'WEAK' : 'MODERATE';
            document.getElementById('adxSignal').className = 'indicator-signal ' + (adx > 30 ? 'ind-buy' : adx < 20 ? 'ind-sell' : 'ind-neutral');

            // Volume - Use actual volume ratio
            const volTrend = volumeRatio;
            const volSig = volTrend > 1.2 ? 0 : volTrend < 0.8 ? 1 : 2;
            document.getElementById('volTrendValue').textContent = (volTrend * 100).toFixed(0) + '%';
            document.getElementById('volumeSignal').textContent = volTrend > 1.2 ? 'HIGH' : volTrend < 0.8 ? 'LOW' : 'NORMAL';
            document.getElementById('volumeSignal').className = 'indicator-signal ' + signals[volSig];

            // Technical Badge
            const techBuySignals = [rsiSignal, macdSig, ema20Sig, sma50Sig, bbSig, stochSig].filter(s => s === 0).length;
            document.getElementById('techBadge').textContent = techBuySignals + '/6 BUY';
            document.getElementById('techBadge').className = 'card-badge ' + (techBuySignals >= 4 ? 'badge-bullish' : techBuySignals <= 2 ? 'badge-bearish' : 'badge-neutral');

            // ========== ADVANCED INDICATORS - Initial Values ==========
            // Calculate based on available data to show immediately (will be updated with live data later)

            // Williams %R - Similar to stochastic, inverted (-100 to 0)
            const williamsR = -100 + (stoch);
            const willRSig = williamsR < -80 ? 0 : williamsR > -20 ? 1 : 2;
            document.getElementById('williamsRValue').textContent = williamsR.toFixed(1);
            document.getElementById('williamsRSignal').textContent = signalTexts[willRSig];
            document.getElementById('williamsRSignal').className = 'indicator-signal ' + signals[willRSig];

            // CCI - Based on price deviation from moving average
            const cci = ((price - ema20) / ema20) * 500 + ((indicatorSeed % 60) - 30);
            const cciSig = cci < -100 ? 0 : cci > 100 ? 1 : 2;
            document.getElementById('cciValue').textContent = (cci >= 0 ? '+' : '') + cci.toFixed(0);
            document.getElementById('cciSignal').textContent = signalTexts[cciSig];
            document.getElementById('cciSignal').className = 'indicator-signal ' + signals[cciSig];

            // OBV Trend - Based on volume and price direction
            const obvTrend = volumeScore > 0.6 && change > 0 ? 'bullish' : volumeScore > 0.6 && change < 0 ? 'bearish' : 'neutral';
            const obvSig = obvTrend === 'bullish' ? 0 : obvTrend === 'bearish' ? 1 : 2;
            document.getElementById('obvValue').textContent = obvTrend.charAt(0).toUpperCase() + obvTrend.slice(1);
            document.getElementById('obvSignal').textContent = obvTrend === 'bullish' ? 'BULLISH' : obvTrend === 'bearish' ? 'BEARISH' : 'NEUTRAL';
            document.getElementById('obvSignal').className = 'indicator-signal ' + signals[obvSig];

            // MFI - Volume-weighted RSI (similar to RSI but with volume)
            const mfi = (rsi * 0.7) + (volumeScore * 30) + ((indicatorSeed % 20) - 10);
            const mfiClamped = Math.max(10, Math.min(90, mfi));
            const mfiSig = mfiClamped < 20 ? 0 : mfiClamped > 80 ? 1 : 2;
            document.getElementById('mfiValue').textContent = mfiClamped.toFixed(1);
            document.getElementById('mfiSignal').textContent = signalTexts[mfiSig];
            document.getElementById('mfiSignal').className = 'indicator-signal ' + signals[mfiSig];

            // VWAP - Approximate as average between day high/low
            const vwap = (stockData.dayHigh + stockData.dayLow + price) / 3;
            const vwapSig = price > vwap * 1.01 ? 0 : price < vwap * 0.99 ? 1 : 2;
            document.getElementById('vwapValue').textContent = '‚Çπ' + vwap.toFixed(0);
            document.getElementById('vwapSignal').textContent = price > vwap ? 'ABOVE' : price < vwap ? 'BELOW' : 'AT';
            document.getElementById('vwapSignal').className = 'indicator-signal ' + signals[vwapSig];

            // ROC (Rate of Change) - Based on daily change
            const roc = change * 0.8 + ((indicatorSeed % 30) - 15) / 10;
            const rocSig = roc > 2 ? 0 : roc < -2 ? 1 : 2;
            document.getElementById('rocValue').textContent = (roc >= 0 ? '+' : '') + roc.toFixed(2) + '%';
            document.getElementById('rocSignal').textContent = signalTexts[rocSig];
            document.getElementById('rocSignal').className = 'indicator-signal ' + signals[rocSig];

            // AROON Oscillator - Trend direction based on price position
            const aroonOsc = (pricePosition - 50) * 1.5 + ((indicatorSeed % 40) - 20);
            const aroonOscClamped = Math.max(-100, Math.min(100, aroonOsc));
            const aroonSig = aroonOscClamped > 50 ? 0 : aroonOscClamped < -50 ? 1 : 2;
            document.getElementById('aroonValue').textContent = (aroonOscClamped >= 0 ? '+' : '') + aroonOscClamped.toFixed(0);
            document.getElementById('aroonSignal').textContent = aroonOscClamped > 50 ? 'BULLISH' : aroonOscClamped < -50 ? 'BEARISH' : 'NEUTRAL';
            document.getElementById('aroonSignal').className = 'indicator-signal ' + signals[aroonSig];

            // Pivot Point - Standard floor trader pivot
            const prevClose = stockData.previousClose || price / (1 + change / 100);
            const pivot = (stockData.dayHigh + stockData.dayLow + prevClose) / 3;
            const pivotSig = price > pivot * 1.01 ? 0 : price < pivot * 0.99 ? 1 : 2;
            document.getElementById('pivotValue').textContent = '‚Çπ' + pivot.toFixed(0);
            document.getElementById('pivotSignal').textContent = price > pivot ? 'ABOVE' : price < pivot ? 'BELOW' : 'AT';
            document.getElementById('pivotSignal').className = 'indicator-signal ' + signals[pivotSig];

            // Update Advanced Indicators badge
            const advBuySignals = [willRSig, cciSig, obvSig, mfiSig, vwapSig, rocSig, aroonSig, pivotSig].filter(s => s === 0).length;
            document.getElementById('advTechBadge').textContent = advBuySignals + '/8 BUY';
            document.getElementById('advTechBadge').className = 'card-badge ' + (advBuySignals >= 5 ? 'badge-bullish' : advBuySignals <= 2 ? 'badge-bearish' : 'badge-neutral');

            // Fundamentals - use generated data
            document.getElementById('peRatio').textContent = fundamentals.pe.toFixed(1);
            document.getElementById('pbRatio').textContent = fundamentals.pb.toFixed(2);
            document.getElementById('debtEquity').textContent = fundamentals.debtEquity.toFixed(2);
            document.getElementById('roe').textContent = fundamentals.roe.toFixed(1) + '%';
            document.getElementById('eps').textContent = '‚Çπ' + fundamentals.eps.toFixed(2);
            // Estimate market cap from price if not available (deterministic based on symbol)
            const estimatedMarketCap = stockData.marketCap || (price * (50000 + (symbolSeed % 500) * 1000) * 100000);
            document.getElementById('marketCap').textContent = stockData.marketCap ? formatNumber(stockData.marketCap / 10000000) : formatNumber(estimatedMarketCap / 10000000);
            document.getElementById('divYield').textContent = fundamentals.divYield.toFixed(2) + '%';
            document.getElementById('bookValue').textContent = '‚Çπ' + fundamentals.bookValue.toFixed(0);

            // Fundamental Badge
            const fundBadgeClass = fundamentalScore >= 60 ? 'badge-bullish' : fundamentalScore >= 40 ? 'badge-neutral' : 'badge-bearish';
            document.getElementById('fundBadge').textContent = fundamentalScore >= 60 ? 'STRONG' : fundamentalScore >= 40 ? 'FAIR' : 'WEAK';
            document.getElementById('fundBadge').className = 'card-badge ' + fundBadgeClass;

            // Sector Comparison - Derive from score and price position (deterministic)
            // Good score + high price position = outperforming
            const performanceBase = (score - 50) / 5; // -10 to +8 range
            const positionBonus = (pricePosition - 50) / 10; // -5 to +5 range
            const sectorVariance = ((symbolSeed * 7 % 40) - 20) / 10; // deterministic variance

            const vsSector = performanceBase + positionBonus + sectorVariance;
            const vsNifty = performanceBase * 0.8 + ((symbolSeed * 11 % 30) - 15) / 10;

            // One year return correlates with 52-week position
            const oneYr = (pricePosition - 40) * 0.6 + ((symbolSeed * 13 % 50) - 25) / 2;
            // Three year CAGR - more stable, correlates with fundamentals
            const threeYr = (fundamentalScore - 45) * 0.4 + ((symbolSeed * 17 % 30) - 15) / 2;

            document.getElementById('vsSector').textContent = (vsSector >= 0 ? '+' : '') + vsSector.toFixed(1) + '%';
            document.getElementById('vsSector').className = 'sector-perf ' + (vsSector >= 0 ? 'metric-positive' : 'metric-negative');
            document.getElementById('vsNifty').textContent = (vsNifty >= 0 ? '+' : '') + vsNifty.toFixed(1) + '%';
            document.getElementById('vsNifty').className = 'sector-perf ' + (vsNifty >= 0 ? 'metric-positive' : 'metric-negative');
            document.getElementById('oneYearReturn').textContent = (oneYr >= 0 ? '+' : '') + oneYr.toFixed(1) + '%';
            document.getElementById('oneYearReturn').className = 'sector-perf ' + (oneYr >= 0 ? 'metric-positive' : 'metric-negative');
            document.getElementById('threeYearCAGR').textContent = (threeYr >= 0 ? '+' : '') + threeYr.toFixed(1) + '%';
            document.getElementById('threeYearCAGR').className = 'sector-perf ' + (threeYr >= 0 ? 'metric-positive' : 'metric-negative');

            // Risk Assessment
            document.getElementById('beta').textContent = fundamentals.beta.toFixed(2);
            document.getElementById('volatility').textContent = (volatility * 100).toFixed(1) + '%';

            // Sharpe ratio derived from score and volatility (higher score + lower vol = better Sharpe)
            const sharpeBase = (score / 50) - 0.5 + (1 - volatility * 10);
            const sharpeVariance = ((symbolSeed * 19 % 20) - 10) / 20;
            const sharpe = Math.max(0.3, Math.min(2.8, sharpeBase + sharpeVariance));
            document.getElementById('sharpe').textContent = sharpe.toFixed(2);

            // Max drawdown correlates with beta, volatility, and price position from 52-week high
            const fromHigh = 100 - pricePosition;
            const drawdownBase = 8 + (fromHigh * 0.3) + (fundamentals.beta * 8) + (volatility * 50);
            const drawdownVariance = ((symbolSeed * 23 % 15) - 7);
            const maxDrawdown = Math.max(5, Math.min(45, drawdownBase + drawdownVariance));
            document.getElementById('maxDrawdown').textContent = '-' + maxDrawdown.toFixed(1) + '%';

            // Risk Level based on beta and volatility
            let riskLevel = fundamentals.beta > 1.3 || volatility > 0.035 ? 4 :
                fundamentals.beta > 1.1 || volatility > 0.025 ? 3 :
                    fundamentals.beta > 0.9 || volatility > 0.018 ? 2 : 1;

            const riskTexts = ['Very Low', 'Low', 'Moderate', 'High', 'Very High'];
            const riskColors = ['var(--green)', 'var(--green)', 'var(--orange)', 'var(--red)', 'var(--red)'];
            document.getElementById('riskLevelText').textContent = riskTexts[riskLevel];
            document.getElementById('riskLevelText').style.color = riskColors[riskLevel];

            document.getElementById('riskBadge').textContent = riskTexts[riskLevel];
            document.getElementById('riskBadge').className = 'card-badge ' + (riskLevel <= 1 ? 'badge-bullish' : riskLevel <= 2 ? 'badge-neutral' : 'badge-bearish');

            // Risk Meter
            const riskBars = document.querySelectorAll('#riskMeter .risk-bar');
            riskBars.forEach((bar, i) => {
                bar.classList.remove('active', 'low', 'medium', 'high');
                if (i <= riskLevel) {
                    bar.classList.add('active');
                    if (i <= 1) bar.classList.add('low');
                    else if (i <= 2) bar.classList.add('medium');
                    else bar.classList.add('high');
                }
            });

            // Generate AI Summary
            generateAISummary(symbol, stockData, fundamentals, price, change, score, signal, technicalScore, fundamentalScore, rsi, bullish);

            // Update Legendary Investor Insights (wrapped in try-catch to prevent breaking main analysis)
            try {
                updateInvestorInsights(stockData, fundamentals, score, technicalScore, fundamentalScore, rsi, pricePosition, volumeRatio, ema20, sma50, fundamentals.beta, volatility, sharpe, maxDrawdown);
            } catch (investorError) {
                console.error('Investor insights error:', investorError);
            }
        }

        function generateAISummary(symbol, stockData, fundamentals, price, change, score, signal, techScore, fundScore, rsi, bullish) {
            const summaryTemplates = [
                `<span class="highlight">${symbol}</span> presents a <span class="${signal.includes('BUY') ? 'positive' : signal.includes('SELL') ? 'negative' : 'highlight'}">${signal}</span> opportunity based on our analysis. With a composite score of <span class="highlight">${score}/100</span>, the stock demonstrates ${techScore > 60 ? '<span class="positive">strong technical momentum</span>' : techScore > 40 ? 'moderate technical positioning' : '<span class="negative">weak technical signals</span>'}.<br><br>The RSI at <span class="highlight">${rsi.toFixed(1)}</span> indicates ${rsi < 30 ? '<span class="positive">oversold conditions - potential reversal ahead</span>' : rsi > 70 ? '<span class="negative">overbought territory - exercise caution</span>' : 'neutral momentum'}. Fundamentally, ${stockData.name} shows ${fundScore > 60 ? '<span class="positive">robust metrics</span>' : fundScore > 40 ? 'adequate fundamentals' : '<span class="negative">areas requiring attention</span>'} with a P/E of ${fundamentals.pe.toFixed(1)} and ROE of ${fundamentals.roe.toFixed(1)}%.<br><br><strong>Key Levels:</strong> Immediate support at ‚Çπ${(price * 0.96).toFixed(0)}, resistance at ‚Çπ${(price * 1.05).toFixed(0)}. Market sentiment is <span class="${bullish > 50 ? 'positive' : 'negative'}">${bullish.toFixed(0)}% bullish</span>.<br><br><strong>‚ö†Ô∏è IMPORTANT DISCLAIMER:</strong> This analysis is AI-generated for EDUCATIONAL PURPOSES ONLY. This is NOT investment advice. Always conduct your own research and consult a SEBI-registered financial advisor before investing. Stock markets are risky and you can lose money.`,

                `Our analysis engine has examined <span class="highlight">${stockData.name}</span> across multiple parameters. The overall verdict: <span class="${signal.includes('BUY') ? 'positive' : signal.includes('SELL') ? 'negative' : 'highlight'}">${signal}</span> with a score of ${score}/100.<br><br><strong>Technical Analysis:</strong> Score <span class="highlight">${Math.round(techScore)}/100</span>. ${techScore > 55 ? '<span class="positive">Indicators showing positive alignment.</span>' : techScore < 45 ? '<span class="negative">Technical weakness detected.</span>' : 'Mixed signals - await confirmation.'}<br><br><strong>Fundamental Health:</strong> Score <span class="highlight">${Math.round(fundScore)}/100</span>. ${fundamentals.debtEquity < 0.5 ? '<span class="positive">Low debt levels.</span>' : fundamentals.debtEquity > 1 ? '<span class="negative">High leverage.</span>' : 'Manageable debt structure.'} Dividend yield of ${fundamentals.divYield.toFixed(2)}%.<br><br><strong>Risk Profile:</strong> Beta of ${fundamentals.beta.toFixed(2)} indicates ${fundamentals.beta > 1.2 ? '<span class="negative">higher volatility</span>' : fundamentals.beta < 0.8 ? '<span class="positive">defensive characteristics</span>' : 'market-aligned volatility'}.<br><br><strong>‚ö†Ô∏è DISCLAIMER:</strong> This is algorithmic analysis for EDUCATIONAL PURPOSES ONLY. NOT investment advice. Do your own research and consult a SEBI-registered advisor.`,

                `<span class="highlight">${symbol}</span> Analysis Complete. Rating: <span class="${signal.includes('BUY') ? 'positive' : signal.includes('SELL') ? 'negative' : 'highlight'}">${signal}</span> (Score: ${score}/100)<br><br>üìä <strong>Market Position:</strong> Currently trading at ‚Çπ${price.toFixed(2)} with ${change >= 0 ? '<span class="positive">+' + change.toFixed(2) + '%</span>' : '<span class="negative">' + change.toFixed(2) + '%</span>'} today. The ${stockData.sector} sector is in focus.<br><br>üìà <strong>Technical Outlook:</strong> ${rsi < 35 ? '<span class="positive">RSI indicates oversold conditions</span>' : rsi > 65 ? '<span class="negative">RSI approaching overbought</span>' : 'Momentum indicators in neutral zone'}.<br><br>üí∞ <strong>Valuation Metrics:</strong> P/E of ${fundamentals.pe.toFixed(1)} is ${fundamentals.pe < 20 ? '<span class="positive">below average</span>' : fundamentals.pe > 40 ? '<span class="negative">above average</span>' : 'around average'} for the sector.<br><br><strong>‚ö†Ô∏è IMPORTANT:</strong> This is an EDUCATIONAL tool only. NOT investment advice. Consult a SEBI-registered advisor before making any investment decisions. Markets involve risk.`
            ];

            document.getElementById('aiSummaryText').innerHTML = summaryTemplates[Math.floor(Math.random() * summaryTemplates.length)];
        }

        // =============================================
        // LEGENDARY INVESTOR INSIGHTS - Premium Feature
        // =============================================

        let currentAnalysisData = null;
        let currentSelectedInvestor = 'buffett';

        const legendaryInvestors = {
            buffett: {
                name: 'Warren Buffett',
                title: 'The Oracle of Omaha',
                avatar: 'üé©',
                style: 'Value Investing',
                quotes: [
                    "Be fearful when others are greedy and greedy when others are fearful.",
                    "Price is what you pay; value is what you get.",
                    "Our favorite holding period is forever.",
                    "It's far better to buy a wonderful company at a fair price than a fair company at a wonderful price.",
                    "Rule No. 1: Never lose money. Rule No. 2: Never forget Rule No. 1."
                ],
                analyze: function (data) {
                    const { pe, roe, debtEquity, divYield, pb, name, sector, fundScore } = data;
                    let verdict = 'hold', verdictText = 'HOLD - Study Further', buffettScore = 0, analysis = [];

                    if (pe < 15) { buffettScore += 25; analysis.push('<span class="positive">‚úì P/E of ' + pe.toFixed(1) + ' shows value pricing</span>'); }
                    else if (pe < 25) { buffettScore += 10; analysis.push('‚Ä¢ P/E of ' + pe.toFixed(1) + ' is fair'); }
                    else { buffettScore -= 15; analysis.push('<span class="negative">‚úó P/E of ' + pe.toFixed(1) + ' is expensive for my taste</span>'); }

                    if (roe > 20) { buffettScore += 25; analysis.push('<span class="positive">‚úì Excellent ROE of ' + roe.toFixed(1) + '% - great capital efficiency</span>'); }
                    else if (roe > 15) { buffettScore += 10; analysis.push('‚Ä¢ ROE of ' + roe.toFixed(1) + '% is acceptable'); }
                    else { buffettScore -= 10; analysis.push('<span class="negative">‚úó ROE of ' + roe.toFixed(1) + '% is below my standards</span>'); }

                    if (debtEquity < 0.5) { buffettScore += 20; analysis.push('<span class="positive">‚úì Low debt (D/E: ' + debtEquity.toFixed(2) + ') - conservative balance sheet</span>'); }
                    else if (debtEquity < 1) { buffettScore += 5; analysis.push('‚Ä¢ Debt levels are manageable'); }
                    else { buffettScore -= 20; analysis.push('<span class="negative">‚úó High debt (D/E: ' + debtEquity.toFixed(2) + ') - I prefer less leverage</span>'); }

                    if (divYield > 2) { buffettScore += 15; analysis.push('<span class="positive">‚úì Dividend yield of ' + divYield.toFixed(2) + '% provides income</span>'); }
                    else if (divYield > 0.5) { buffettScore += 5; analysis.push('‚Ä¢ Some dividend income (' + divYield.toFixed(2) + '%)'); }

                    if (fundScore > 60) buffettScore += 10;

                    if (buffettScore >= 50) { verdict = 'buy'; verdictText = 'INVEST - Quality Business'; }
                    else if (buffettScore >= 25) { verdict = 'hold'; verdictText = 'WATCHLIST - Monitor Closely'; }
                    else if (buffettScore >= 0) { verdict = 'hold'; verdictText = 'HOLD - Not My Style'; }
                    else { verdict = 'avoid'; verdictText = 'AVOID - Too Risky'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `Looking at <span class="highlight">${name}</span>, I would evaluate it through my value investing lens. ${buffettScore >= 40 ? 'This company shows characteristics I look for - ' : 'This company has some concerns - '}${pe < 20 ? 'reasonable valuation, ' : 'premium valuation, '}${roe > 15 ? 'good returns on capital, ' : 'mediocre capital returns, '}and ${debtEquity < 0.8 ? 'a solid balance sheet.' : 'concerning debt levels.'} ${sector === 'Banking' || sector === 'IT' || sector === 'FMCG' ? 'The ' + sector + ' sector is one I understand well.' : 'I prefer to invest in businesses I truly understand.'} Remember, I never invest based on short-term price movements - I focus on the business quality and holding for decades.`,
                        keyMetrics: [
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 20 ? 'positive' : pe < 30 ? 'neutral' : 'negative' },
                            { label: 'ROE', value: roe.toFixed(1) + '%', class: roe > 15 ? 'positive' : roe > 10 ? 'neutral' : 'negative' },
                            { label: 'Debt/Equity', value: debtEquity.toFixed(2), class: debtEquity < 0.5 ? 'positive' : debtEquity < 1 ? 'neutral' : 'negative' },
                            { label: 'Div Yield', value: divYield.toFixed(2) + '%', class: divYield > 2 ? 'positive' : divYield > 0 ? 'neutral' : 'negative' }
                        ]
                    };
                }
            },
            lynch: {
                name: 'Peter Lynch',
                title: 'The Magellan Fund Legend',
                avatar: 'üìä',
                style: 'Growth at Reasonable Price',
                quotes: ["Know what you own, and know why you own it.", "The best stock to buy is the one you already own.", "Go for a business that any idiot can run.", "Behind every stock is a company. Find out what it's doing."],
                analyze: function (data) {
                    const { pe, roe, score, techScore, name, sector } = data;
                    let verdict = 'hold', verdictText = 'HOLD - Research More', lynchScore = 0, analysis = [];
                    const estGrowth = Math.min(roe * 0.8, 30);
                    const pegRatio = pe / Math.max(estGrowth, 1);

                    if (pegRatio < 1) { lynchScore += 30; analysis.push('<span class="positive">‚úì PEG ratio of ' + pegRatio.toFixed(2) + ' - potential tenbagger!</span>'); }
                    else if (pegRatio < 1.5) { lynchScore += 15; analysis.push('‚Ä¢ PEG of ' + pegRatio.toFixed(2) + ' is reasonable'); }
                    else if (pegRatio < 2) { lynchScore += 5; analysis.push('‚Ä¢ PEG of ' + pegRatio.toFixed(2) + ' - fairly valued'); }
                    else { lynchScore -= 10; analysis.push('<span class="negative">‚úó PEG of ' + pegRatio.toFixed(2) + ' - overvalued</span>'); }

                    if (estGrowth > 20) { lynchScore += 20; analysis.push('<span class="positive">‚úì Strong growth (~' + estGrowth.toFixed(0) + '% implied)</span>'); }
                    else if (estGrowth > 12) { lynchScore += 10; analysis.push('‚Ä¢ Moderate growth'); }

                    if (['FMCG', 'Retail', 'Auto', 'IT'].includes(sector)) { lynchScore += 10; analysis.push('<span class="positive">‚úì ' + sector + ' - consumer understandable</span>'); }
                    if (score > 60) lynchScore += 10;

                    if (lynchScore >= 45) { verdict = 'buy'; verdictText = 'BUY - Potential Tenbagger'; }
                    else if (lynchScore >= 25) { verdict = 'buy'; verdictText = 'BUY - Growth Story'; }
                    else if (lynchScore >= 10) { verdict = 'hold'; verdictText = 'HOLD - Stalwart'; }
                    else { verdict = 'sell'; verdictText = 'AVOID - Better Options'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - ${pegRatio < 1.5 ? 'With PEG under 1.5, could be a "fast grower." ' : 'Not a classic growth bargain. '}${estGrowth > 15 ? 'Growth looks promising. ' : ''}${lynchScore >= 30 ? 'Do your homework - could reward patient investors.' : 'Keep on radar, better opportunities may exist.'}`,
                        keyMetrics: [
                            { label: 'PEG Ratio', value: pegRatio.toFixed(2), class: pegRatio < 1 ? 'positive' : pegRatio < 2 ? 'neutral' : 'negative' },
                            { label: 'Est. Growth', value: estGrowth.toFixed(0) + '%', class: estGrowth > 15 ? 'positive' : 'neutral' },
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 25 ? 'positive' : 'neutral' },
                            { label: 'Score', value: score + '/100', class: score > 60 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            soros: {
                name: 'George Soros',
                title: 'The Man Who Broke the Bank of England',
                avatar: 'üåä',
                style: 'Macro Trading & Reflexivity',
                quotes: ["It's not whether you're right or wrong, but how much you make when right.", "Markets are constantly in uncertainty and flux.", "I'm only rich because I know when I'm wrong."],
                analyze: function (data) {
                    const { change, techScore, rsi, beta, volatility, name } = data;
                    let verdict = 'hold', verdictText = 'OBSERVE - Wait for Setup', sorosScore = 0, analysis = [];

                    if (Math.abs(change) > 2) {
                        if (change > 2) { sorosScore += 20; analysis.push('<span class="positive">‚úì Strong momentum (+' + change.toFixed(2) + '%)</span>'); }
                        else { sorosScore += 10; analysis.push('‚Ä¢ Bearish momentum - short opportunity'); }
                    } else { analysis.push('‚Ä¢ Markets consolidating'); }

                    if (rsi < 30) { sorosScore += 25; analysis.push('<span class="positive">‚úì RSI ' + rsi.toFixed(0) + ' - contrarian opportunity</span>'); }
                    else if (rsi > 70) { sorosScore -= 10; analysis.push('<span class="negative">‚úó RSI ' + rsi.toFixed(0) + ' - crowded trade</span>'); }
                    else if (techScore > 60 && change > 0) { sorosScore += 15; analysis.push('‚Ä¢ Technical strength with momentum'); }

                    if (beta > 1.3) { sorosScore += 10; analysis.push('‚Ä¢ High beta - leveraged to market'); }

                    if (sorosScore >= 35) { verdict = 'buy'; verdictText = 'LONG - Ride the Wave'; }
                    else if (sorosScore >= 15) { verdict = 'hold'; verdictText = 'POSITION - Scale In'; }
                    else if (sorosScore >= 0) { verdict = 'hold'; verdictText = 'WAIT - No Edge'; }
                    else { verdict = 'sell'; verdictText = 'SHORT/AVOID'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I care about what the market BELIEVES. ${rsi < 35 ? 'Extreme pessimism creates opportunity. ' : rsi > 65 ? 'Crowd too optimistic - be careful. ' : ''}${sorosScore >= 25 ? 'I see potential - size appropriately, cut losses fast if wrong.' : 'Wait for cleaner setup.'}`,
                        keyMetrics: [
                            { label: 'Momentum', value: (change >= 0 ? '+' : '') + change.toFixed(2) + '%', class: change > 1 ? 'positive' : change < -1 ? 'negative' : 'neutral' },
                            { label: 'RSI', value: rsi.toFixed(0), class: rsi < 30 ? 'positive' : rsi > 70 ? 'negative' : 'neutral' },
                            { label: 'Beta', value: beta.toFixed(2), class: 'neutral' },
                            { label: 'Tech Score', value: techScore.toFixed(0), class: techScore > 55 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            dalio: {
                name: 'Ray Dalio',
                title: 'Founder of Bridgewater',
                avatar: '‚öñÔ∏è',
                style: 'All Weather & Risk Parity',
                quotes: ["He who lives by the crystal ball will eat shattered glass.", "Pain + Reflection = Progress.", "Diversifying well is most important."],
                analyze: function (data) {
                    const { beta, volatility, sharpe, divYield, name, sector } = data;
                    let verdict = 'hold', verdictText = 'ANALYZE - Risk Metrics', dalioScore = 0, analysis = [];

                    if (beta < 0.8) { dalioScore += 20; analysis.push('<span class="positive">‚úì Low beta (' + beta.toFixed(2) + ') - defensive</span>'); }
                    else if (beta < 1.1) { dalioScore += 10; analysis.push('‚Ä¢ Beta ' + beta.toFixed(2) + ' - market aligned'); }
                    else { dalioScore -= 5; analysis.push('‚Ä¢ High beta - increases portfolio risk'); }

                    if (sharpe > 1.5) { dalioScore += 25; analysis.push('<span class="positive">‚úì Excellent Sharpe (' + sharpe.toFixed(2) + ')</span>'); }
                    else if (sharpe > 1) { dalioScore += 15; analysis.push('‚Ä¢ Good Sharpe (' + sharpe.toFixed(2) + ')'); }
                    else if (sharpe > 0.5) { dalioScore += 5; analysis.push('‚Ä¢ Modest Sharpe'); }

                    if (volatility < 0.02) { dalioScore += 15; analysis.push('<span class="positive">‚úì Low volatility</span>'); }
                    else if (volatility > 0.04) { dalioScore -= 10; analysis.push('<span class="negative">‚úó High volatility</span>'); }

                    if (divYield > 2) { dalioScore += 10; analysis.push('<span class="positive">‚úì Dividend income</span>'); }

                    if (dalioScore >= 40) { verdict = 'buy'; verdictText = 'ALLOCATE - Portfolio Fit'; }
                    else if (dalioScore >= 20) { verdict = 'hold'; verdictText = 'CONSIDER - Partial Position'; }
                    else if (dalioScore >= 0) { verdict = 'hold'; verdictText = 'NEUTRAL - Size Carefully'; }
                    else { verdict = 'avoid'; verdictText = 'UNDERWEIGHT - Too Risky'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `For <span class="highlight">${name}</span>, I think about portfolio fit. ${beta < 1 ? 'Lower beta reduces volatility. ' : 'Higher beta adds risk. '}${sharpe > 1 ? 'Risk-adjusted returns look favorable. ' : ''}${dalioScore >= 25 ? 'Reasonable allocation in diversified portfolio.' : 'Be careful with sizing.'}`,
                        keyMetrics: [
                            { label: 'Beta', value: beta.toFixed(2), class: beta < 0.8 ? 'positive' : beta < 1.2 ? 'neutral' : 'negative' },
                            { label: 'Volatility', value: (volatility * 100).toFixed(1) + '%', class: volatility < 0.02 ? 'positive' : 'neutral' },
                            { label: 'Sharpe', value: sharpe.toFixed(2), class: sharpe > 1 ? 'positive' : 'neutral' },
                            { label: 'Div Yield', value: divYield.toFixed(2) + '%', class: divYield > 2 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            livermore: {
                name: 'Jesse Livermore',
                title: 'The Boy Plunger',
                avatar: 'üìà',
                style: 'Trend Following',
                quotes: ["The market is never wrong ‚Äì opinions often are.", "It never was my thinking that made big money. It was my sitting.", "The big money is in the waiting."],
                analyze: function (data) {
                    const { price, change, rsi, volumeRatio, pricePosition, ema20, sma50, name } = data;
                    let verdict = 'hold', verdictText = 'WAIT - No Setup', livermoreScore = 0, analysis = [];
                    const inUptrend = price > ema20 && price > sma50;
                    const inDowntrend = price < ema20 && price < sma50;

                    if (inUptrend && change > 0) { livermoreScore += 30; analysis.push('<span class="positive">‚úì Above MAs - confirmed uptrend</span>'); }
                    else if (inDowntrend) { livermoreScore -= 20; analysis.push('<span class="negative">‚úó Below MAs - avoid longs</span>'); }
                    else { analysis.push('‚Ä¢ No clear trend - wait for confirmation'); }

                    if (change > 2 && volumeRatio > 1.3) { livermoreScore += 25; analysis.push('<span class="positive">‚úì Breakout on volume!</span>'); }
                    else if (change < -2 && volumeRatio > 1.3) { livermoreScore -= 15; analysis.push('<span class="negative">‚úó Breakdown on volume</span>'); }

                    if (pricePosition > 70) { livermoreScore += 10; analysis.push('‚Ä¢ Near 52W highs - strength'); }
                    else if (pricePosition < 30) { livermoreScore -= 10; analysis.push('‚Ä¢ Near lows - falling knife'); }

                    if (rsi > 50 && rsi < 70) { livermoreScore += 10; analysis.push('‚Ä¢ Momentum intact'); }

                    if (livermoreScore >= 40) { verdict = 'buy'; verdictText = 'BUY - Trend Confirmed'; }
                    else if (livermoreScore >= 20) { verdict = 'buy'; verdictText = 'BUY - Early Entry'; }
                    else if (livermoreScore >= 0) { verdict = 'hold'; verdictText = 'WAIT - Patience Pays'; }
                    else { verdict = 'sell'; verdictText = 'AVOID/SHORT'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I read the tape. ${inUptrend ? 'Trend is UP - that\'s all that matters. ' : inDowntrend ? 'Trend is DOWN - never fight it. ' : 'No clear trend - I wait. '}${livermoreScore >= 30 ? 'Enter with tight stop. Big money is sitting tight with winners.' : 'No clean setup. Patience is the edge.'}`,
                        keyMetrics: [
                            { label: 'Trend', value: inUptrend ? 'BULLISH' : inDowntrend ? 'BEARISH' : 'NEUTRAL', class: inUptrend ? 'positive' : inDowntrend ? 'negative' : 'neutral' },
                            { label: 'Day Move', value: (change >= 0 ? '+' : '') + change.toFixed(2) + '%', class: change > 1 ? 'positive' : change < -1 ? 'negative' : 'neutral' },
                            { label: 'Volume', value: (volumeRatio * 100).toFixed(0) + '%', class: volumeRatio > 1.2 ? 'positive' : 'neutral' },
                            { label: '52W Pos', value: pricePosition.toFixed(0) + '%', class: pricePosition > 60 ? 'positive' : pricePosition < 40 ? 'negative' : 'neutral' }
                        ]
                    };
                }
            },
            icahn: {
                name: 'Carl Icahn',
                title: 'The Corporate Raider',
                avatar: 'ü¶à',
                style: 'Activist Investing',
                quotes: ["My philosophy is to buy when no one wants it.", "If you want a friend, get a dog.", "I make money studying natural stupidity."],
                analyze: function (data) {
                    const { pe, pb, roe, debtEquity, fundScore, divYield, name } = data;
                    let verdict = 'hold', verdictText = 'MONITOR - Look for Catalyst', icahnScore = 0, analysis = [];

                    if (pb < 1) { icahnScore += 30; analysis.push('<span class="positive">‚úì Below book value - hidden assets!</span>'); }
                    else if (pb < 1.5) { icahnScore += 15; analysis.push('‚Ä¢ P/B ' + pb.toFixed(2) + ' shows value'); }
                    else if (pb > 4) { icahnScore -= 10; analysis.push('<span class="negative">‚úó No asset play here</span>'); }

                    if (pe < 12 && roe < 12) { icahnScore += 20; analysis.push('<span class="positive">‚úì Cheap + underperforming - activist target!</span>'); }
                    else if (pe < 15) { icahnScore += 10; analysis.push('‚Ä¢ Reasonably valued'); }

                    if (roe < 10 && fundScore < 50) { icahnScore += 15; analysis.push('<span class="positive">‚úì Poor fundamentals = opportunity</span>'); }
                    else if (roe > 20) { icahnScore -= 5; analysis.push('‚Ä¢ Well-managed - less opportunity'); }

                    if (icahnScore >= 40) { verdict = 'buy'; verdictText = 'ACCUMULATE - Activist Potential'; }
                    else if (icahnScore >= 20) { verdict = 'buy'; verdictText = 'BUY - Value Unlock'; }
                    else if (icahnScore >= 5) { verdict = 'hold'; verdictText = 'WATCH - Wait for Dislocation'; }
                    else { verdict = 'hold'; verdictText = 'PASS - No Angle'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I look for activist opportunities. ${pb < 1.5 ? 'Near book value is interesting. ' : ''}${roe < 12 && pe < 15 ? 'Underperforming at cheap price - classic setup. ' : ''}${icahnScore >= 30 ? 'Best investments are ones everyone hates.' : 'Not my typical target.'}`,
                        keyMetrics: [
                            { label: 'P/B Ratio', value: pb.toFixed(2), class: pb < 1 ? 'positive' : pb < 2 ? 'neutral' : 'negative' },
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 12 ? 'positive' : 'neutral' },
                            { label: 'ROE', value: roe.toFixed(1) + '%', class: roe < 10 ? 'positive' : 'neutral' },
                            { label: 'Debt/Eq', value: debtEquity.toFixed(2), class: debtEquity < 0.5 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            klarman: {
                name: 'Seth Klarman',
                title: 'Author of Margin of Safety',
                avatar: 'üõ°Ô∏è',
                style: 'Deep Value',
                quotes: ["Value investing is the marriage of a contrarian streak and a calculator.", "Most investors pay little attention to risk.", "The single greatest edge is a long-term orientation."],
                analyze: function (data) {
                    const { pe, pb, debtEquity, pricePosition, name } = data;
                    let verdict = 'hold', verdictText = 'WAIT - Insufficient Margin', klarmanScore = 0, analysis = [];
                    const marginOfSafety = Math.max(0, (1 - pb) * 100);

                    if (pb < 0.8) { klarmanScore += 30; analysis.push('<span class="positive">‚úì P/B ' + pb.toFixed(2) + ' - significant margin (' + marginOfSafety.toFixed(0) + '%)</span>'); }
                    else if (pb < 1.2) { klarmanScore += 15; analysis.push('‚Ä¢ Modest margin of safety'); }
                    else { klarmanScore -= 10; analysis.push('<span class="negative">‚úó No margin of safety</span>'); }

                    if (pe < 10) { klarmanScore += 25; analysis.push('<span class="positive">‚úì Deep value territory</span>'); }
                    else if (pe < 15) { klarmanScore += 12; analysis.push('‚Ä¢ Reasonable P/E'); }
                    else if (pe > 30) { klarmanScore -= 15; analysis.push('<span class="negative">‚úó No safety cushion</span>'); }

                    if (pricePosition < 35) { klarmanScore += 15; analysis.push('<span class="positive">‚úì Near lows - contrarian</span>'); }
                    else if (pricePosition > 80) { klarmanScore -= 10; analysis.push('<span class="negative">‚úó Near highs - no safety</span>'); }

                    if (debtEquity < 0.4) { klarmanScore += 10; analysis.push('<span class="positive">‚úì Low debt cushion</span>'); }

                    if (klarmanScore >= 45) { verdict = 'buy'; verdictText = 'BUY - Deep Value'; }
                    else if (klarmanScore >= 25) { verdict = 'buy'; verdictText = 'ACCUMULATE - Value Present'; }
                    else if (klarmanScore >= 5) { verdict = 'hold'; verdictText = 'WAIT - Need Discount'; }
                    else { verdict = 'avoid'; verdictText = 'AVOID - No Safety'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I ask "what could go wrong?" ${pb < 1 ? 'Below book provides margin. ' : 'Valuation lacks protection. '}${pe < 12 ? 'Low P/E suggests pessimism - I get interested. ' : ''}${klarmanScore >= 30 ? 'Warrants deeper analysis. Value investing requires patience.' : 'Need larger discount to get excited.'}`,
                        keyMetrics: [
                            { label: 'Margin', value: marginOfSafety.toFixed(0) + '%', class: marginOfSafety > 20 ? 'positive' : 'neutral' },
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 12 ? 'positive' : 'neutral' },
                            { label: 'P/B Ratio', value: pb.toFixed(2), class: pb < 1 ? 'positive' : 'neutral' },
                            { label: 'Debt/Eq', value: debtEquity.toFixed(2), class: debtEquity < 0.5 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            jhunjhunwala: {
                name: 'Rakesh Jhunjhunwala',
                title: 'The Big Bull of India',
                avatar: 'üáÆüá≥',
                style: 'India Growth + Value',
                quotes: ["Respect the market. Have an open mind.", "Never invest at unreasonable valuations.", "India is the best place to invest.", "The biggest risk is not taking any risk. In a world that is changing quickly, the only strategy that is guaranteed to fail is not taking risks."],
                analyze: function (data) {
                    const { pe, roe, score, techScore, change, name, sector } = data;
                    let verdict = 'hold', verdictText = 'MONITOR - Wait for Entry', rkjScore = 0, analysis = [];
                    const growthSectors = ['Banking', 'Finance', 'FMCG', 'Pharma', 'IT', 'Infra', 'Auto'];

                    if (growthSectors.includes(sector)) { rkjScore += 15; analysis.push('<span class="positive">‚úì ' + sector + ' - India growth story</span>'); }

                    if (roe > 18) { rkjScore += 20; analysis.push('<span class="positive">‚úì Strong ROE ' + roe.toFixed(1) + '%</span>'); }
                    else if (roe > 12) { rkjScore += 8; analysis.push('‚Ä¢ Decent ROE'); }
                    else { rkjScore -= 5; analysis.push('‚Ä¢ ROE needs improvement'); }

                    if (pe < 20 && roe > 15) { rkjScore += 25; analysis.push('<span class="positive">‚úì Good business, reasonable price</span>'); }
                    else if (pe < 30) { rkjScore += 10; analysis.push('‚Ä¢ Valuation acceptable'); }
                    else { rkjScore -= 5; analysis.push('‚Ä¢ P/E on higher side'); }

                    if (techScore > 55 && change > 0) { rkjScore += 10; analysis.push('‚Ä¢ Momentum with bulls'); }
                    if (score > 60) { rkjScore += 10; analysis.push('‚Ä¢ Overall positive'); }

                    if (rkjScore >= 45) { verdict = 'buy'; verdictText = 'BUY - India Winner'; }
                    else if (rkjScore >= 25) { verdict = 'buy'; verdictText = 'ACCUMULATE - Long Term'; }
                    else if (rkjScore >= 10) { verdict = 'hold'; verdictText = 'HOLD - Needs Time'; }
                    else { verdict = 'hold'; verdictText = 'WAIT - Better Options'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - Arre yaar! ${growthSectors.includes(sector) ? sector + ' is India\'s growth story. ' : ''}${roe > 15 ? 'Returns are impressive - quality business. ' : ''}${rkjScore >= 35 ? 'Could be multibagger in 5-10 years. India ka future bright hai!' : 'Wait for better entry. Patience is key.'}`,
                        keyMetrics: [
                            { label: 'Sector', value: sector.substring(0, 8), class: growthSectors.includes(sector) ? 'positive' : 'neutral' },
                            { label: 'ROE', value: roe.toFixed(1) + '%', class: roe > 15 ? 'positive' : 'neutral' },
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 20 ? 'positive' : 'neutral' },
                            { label: 'Score', value: score + '/100', class: score > 55 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            munger: {
                name: 'Charlie Munger',
                title: 'The Abominable No-Man',
                avatar: 'üß†',
                style: 'Mental Models & Quality',
                quotes: [
                    "The big money is not in the buying and selling, but in the waiting.",
                    "Invert, always invert. Turn a situation or problem upside down.",
                    "A great business at a fair price is superior to a fair business at a great price.",
                    "It is remarkable how much long-term advantage people like us have gotten by trying to be consistently not stupid, instead of trying to be very intelligent."
                ],
                analyze: function (data) {
                    const { pe, roe, debtEquity, divYield, pb, name, sector, fundScore } = data;
                    let verdict = 'hold', verdictText = 'HOLD - Think Harder', mungerScore = 0, analysis = [];

                    // Quality focus - Munger loves high-quality businesses
                    if (roe > 25) { mungerScore += 30; analysis.push('<span class="positive">‚úì Exceptional ROE ' + roe.toFixed(1) + '% - wonderful business</span>'); }
                    else if (roe > 18) { mungerScore += 15; analysis.push('<span class="positive">‚úì ROE of ' + roe.toFixed(1) + '% shows quality</span>'); }
                    else if (roe > 12) { mungerScore += 5; analysis.push('‚Ä¢ ROE is acceptable'); }
                    else { mungerScore -= 15; analysis.push('<span class="negative">‚úó Poor ROE - not a quality business</span>'); }

                    // Fair price, not necessarily cheap
                    if (pe < 25 && roe > 18) { mungerScore += 20; analysis.push('<span class="positive">‚úì Fair price for quality</span>'); }
                    else if (pe > 40) { mungerScore -= 10; analysis.push('<span class="negative">‚úó Too expensive even for quality</span>'); }

                    // Low debt preference
                    if (debtEquity < 0.3) { mungerScore += 15; analysis.push('<span class="positive">‚úì Fortress balance sheet</span>'); }
                    else if (debtEquity > 1.5) { mungerScore -= 20; analysis.push('<span class="negative">‚úó Too much financial engineering</span>'); }

                    // Simple understandable business
                    if (['FMCG', 'Banking', 'IT', 'Pharma'].includes(sector)) { mungerScore += 10; analysis.push('‚Ä¢ ' + sector + ' - understandable moat'); }

                    if (mungerScore >= 50) { verdict = 'buy'; verdictText = 'BUY - Wonderful Business'; }
                    else if (mungerScore >= 30) { verdict = 'hold'; verdictText = 'WATCHLIST - Quality Present'; }
                    else if (mungerScore >= 10) { verdict = 'hold'; verdictText = 'HOLD - Mediocre'; }
                    else { verdict = 'avoid'; verdictText = 'AVOID - Stupid Investment'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - All I want to know is where I'm going to die, so I'll never go there. ${roe > 20 ? 'This business generates excellent returns - a sign of competitive advantage. ' : 'Returns are not exceptional. '}${debtEquity < 0.5 ? 'The balance sheet shows discipline. ' : ''}${mungerScore >= 40 ? 'Sit on your hands and wait for the right pitch. Quality compounds.' : 'Invert - ask what could destroy this business.'}`,
                        keyMetrics: [
                            { label: 'ROE', value: roe.toFixed(1) + '%', class: roe > 20 ? 'positive' : roe > 12 ? 'neutral' : 'negative' },
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 25 ? 'positive' : pe < 35 ? 'neutral' : 'negative' },
                            { label: 'Debt/Equity', value: debtEquity.toFixed(2), class: debtEquity < 0.3 ? 'positive' : debtEquity < 1 ? 'neutral' : 'negative' },
                            { label: 'Quality', value: fundScore > 60 ? 'HIGH' : 'MEDIUM', class: fundScore > 60 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            graham: {
                name: 'Benjamin Graham',
                title: 'The Father of Value Investing',
                avatar: 'üìö',
                style: 'Deep Value & Net-Nets',
                quotes: [
                    "The intelligent investor is a realist who sells to optimists and buys from pessimists.",
                    "In the short run, the market is a voting machine but in the long run, it is a weighing machine.",
                    "The margin of safety is always dependent on the price paid.",
                    "The individual investor should act consistently as an investor and not as a speculator."
                ],
                analyze: function (data) {
                    const { pe, pb, debtEquity, divYield, roe, name } = data;
                    let verdict = 'hold', verdictText = 'HOLD - Insufficient Margin', grahamScore = 0, analysis = [];

                    // Graham Number approximation
                    const grahamNumber = Math.sqrt(22.5 * (pe > 0 ? pe : 15) * pb);
                    const netCurrentAssetValue = pb < 0.67; // Proxy for NCAV

                    // Strict P/E requirement
                    if (pe < 10) { grahamScore += 30; analysis.push('<span class="positive">‚úì P/E of ' + pe.toFixed(1) + ' - deep value territory</span>'); }
                    else if (pe < 15) { grahamScore += 20; analysis.push('<span class="positive">‚úì P/E of ' + pe.toFixed(1) + ' - defensive range</span>'); }
                    else if (pe > 25) { grahamScore -= 20; analysis.push('<span class="negative">‚úó P/E of ' + pe.toFixed(1) + ' - speculative</span>'); }
                    else { grahamScore += 5; analysis.push('‚Ä¢ P/E is borderline acceptable'); }

                    // Book value analysis
                    if (pb < 1) { grahamScore += 25; analysis.push('<span class="positive">‚úì Trading below book value!</span>'); }
                    else if (pb < 1.5) { grahamScore += 10; analysis.push('‚Ä¢ P/B of ' + pb.toFixed(2) + ' near book'); }
                    else if (pb > 3) { grahamScore -= 15; analysis.push('<span class="negative">‚úó P/B of ' + pb.toFixed(2) + ' - paying premium for intangibles</span>'); }

                    // Dividend requirement
                    if (divYield > 3) { grahamScore += 15; analysis.push('<span class="positive">‚úì Strong dividend yield ' + divYield.toFixed(2) + '%</span>'); }
                    else if (divYield > 1.5) { grahamScore += 8; analysis.push('‚Ä¢ Dividend provides some income'); }
                    else { grahamScore -= 5; analysis.push('‚Ä¢ Prefer dividend-paying stocks'); }

                    // Conservative balance sheet
                    if (debtEquity < 0.5) { grahamScore += 15; analysis.push('<span class="positive">‚úì Conservative debt levels</span>'); }
                    else if (debtEquity > 1.5) { grahamScore -= 15; analysis.push('<span class="negative">‚úó Excessive leverage</span>'); }

                    if (grahamScore >= 55) { verdict = 'buy'; verdictText = 'BUY - Classic Value'; }
                    else if (grahamScore >= 35) { verdict = 'buy'; verdictText = 'ACCUMULATE - Defensive'; }
                    else if (grahamScore >= 15) { verdict = 'hold'; verdictText = 'HOLD - Wait for Discount'; }
                    else { verdict = 'avoid'; verdictText = 'AVOID - Too Speculative'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I evaluate securities with mathematical precision. ${pb < 1.2 ? 'Trading near or below book value provides tangible protection. ' : 'Premium to book value requires careful analysis. '}${pe < 15 ? 'Earnings yield is attractive versus bonds. ' : ''}${divYield > 2 ? 'Dividend provides return while waiting. ' : ''}${grahamScore >= 40 ? 'This meets my criteria for a defensive investor.' : 'An enterprising investor might find better opportunities.'}`,
                        keyMetrics: [
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 15 ? 'positive' : pe < 20 ? 'neutral' : 'negative' },
                            { label: 'P/B Ratio', value: pb.toFixed(2), class: pb < 1 ? 'positive' : pb < 1.5 ? 'neutral' : 'negative' },
                            { label: 'Div Yield', value: divYield.toFixed(2) + '%', class: divYield > 3 ? 'positive' : divYield > 1 ? 'neutral' : 'negative' },
                            { label: 'Debt/Eq', value: debtEquity.toFixed(2), class: debtEquity < 0.5 ? 'positive' : debtEquity < 1 ? 'neutral' : 'negative' }
                        ]
                    };
                }
            },
            druckenmiller: {
                name: 'Stanley Druckenmiller',
                title: '30 Years, No Losing Year',
                avatar: 'üéØ',
                style: 'Macro Conviction Bets',
                quotes: [
                    "The way to build superior long-term returns is through preservation of capital and home runs.",
                    "I've learned many things from George Soros, but perhaps the most significant is that it's not whether you're right or wrong, but how much money you make when you're right and how much you lose when you're wrong.",
                    "Never, ever invest in the present. It doesn't matter what a company is earning today.",
                    "The key is to wait. Sometimes the best thing to do is nothing."
                ],
                analyze: function (data) {
                    const { change, techScore, rsi, volumeRatio, pricePosition, roe, pe, name, sector } = data;
                    let verdict = 'hold', verdictText = 'WAIT - No Conviction', druckScore = 0, analysis = [];

                    // Looking for asymmetric opportunities
                    const momentum = change * (volumeRatio > 1 ? 1.5 : 1);

                    if (techScore > 65 && change > 1) { druckScore += 25; analysis.push('<span class="positive">‚úì Strong momentum setup</span>'); }
                    else if (techScore > 55) { druckScore += 10; analysis.push('‚Ä¢ Technical picture improving'); }
                    else if (techScore < 40) { druckScore -= 10; analysis.push('<span class="negative">‚úó Weak technicals</span>'); }

                    // Price position for conviction
                    if (pricePosition > 80) { druckScore += 15; analysis.push('<span class="positive">‚úì Near highs - strength attracts strength</span>'); }
                    else if (pricePosition < 20 && rsi < 35) { druckScore += 20; analysis.push('<span class="positive">‚úì Extreme pessimism - contrarian opportunity</span>'); }

                    // Volume confirmation
                    if (volumeRatio > 1.5 && change > 0) { druckScore += 15; analysis.push('<span class="positive">‚úì Institutional accumulation</span>'); }
                    else if (volumeRatio > 1.3 && change < -2) { druckScore -= 15; analysis.push('<span class="negative">‚úó Heavy distribution</span>'); }

                    // Growth sectors for big moves
                    if (['IT', 'Pharma', 'Auto', 'Banking'].includes(sector)) { druckScore += 10; analysis.push('‚Ä¢ ' + sector + ' - can deliver asymmetric returns'); }

                    if (druckScore >= 40) { verdict = 'buy'; verdictText = 'BUY BIG - High Conviction'; }
                    else if (druckScore >= 25) { verdict = 'buy'; verdictText = 'POSITION - Building Thesis'; }
                    else if (druckScore >= 5) { verdict = 'hold'; verdictText = 'WATCH - Wait for Setup'; }
                    else { verdict = 'avoid'; verdictText = 'AVOID - No Edge'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I'm looking for the fat pitch. ${pricePosition > 70 ? 'Relative strength is powerful. ' : pricePosition < 30 ? 'Beaten down but needs catalyst. ' : ''}${druckScore >= 30 ? 'When I see it, I bet big. Risk management is about sizing, not avoiding bets.' : 'No clear asymmetric opportunity. I preserve capital until conviction appears.'}`,
                        keyMetrics: [
                            { label: 'Momentum', value: (change >= 0 ? '+' : '') + change.toFixed(2) + '%', class: change > 2 ? 'positive' : change < -2 ? 'negative' : 'neutral' },
                            { label: 'Volume', value: (volumeRatio * 100).toFixed(0) + '%', class: volumeRatio > 1.3 ? 'positive' : 'neutral' },
                            { label: '52W Pos', value: pricePosition.toFixed(0) + '%', class: pricePosition > 70 ? 'positive' : pricePosition < 30 ? 'negative' : 'neutral' },
                            { label: 'Tech Score', value: techScore.toFixed(0), class: techScore > 60 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            marks: {
                name: 'Howard Marks',
                title: 'The Memo Writer',
                avatar: 'üìù',
                style: 'Second-Level Thinking',
                quotes: [
                    "The most important thing is understanding where we are in the cycle.",
                    "Second-level thinking is deep, complex and convoluted. It asks 'Who doesn't know that?'",
                    "Being too far ahead of your time is indistinguishable from being wrong.",
                    "There's a big difference between probability and outcome. Probable things fail to happen‚Äîand improbable things happen‚Äîall the time."
                ],
                analyze: function (data) {
                    const { pe, pb, rsi, pricePosition, change, volatility, name, sector } = data;
                    let verdict = 'hold', verdictText = 'ANALYZE - Check the Cycle', marksScore = 0, analysis = [];

                    // Cycle positioning
                    const marketCyclePosition = (pricePosition + (100 - rsi)) / 2;

                    if (rsi < 30 && pricePosition < 30) { marksScore += 30; analysis.push('<span class="positive">‚úì Extreme fear - cycle bottom signals</span>'); }
                    else if (rsi > 70 && pricePosition > 80) { marksScore -= 25; analysis.push('<span class="negative">‚úó Euphoria zone - cycle top warning</span>'); }
                    else if (rsi > 60 && pricePosition > 70) { marksScore -= 10; analysis.push('‚Ä¢ Getting crowded - first-level thinking'); }
                    else { marksScore += 5; analysis.push('‚Ä¢ Middle of the cycle - be selective'); }

                    // Value consciousness
                    if (pe < 12 && pb < 1.5) { marksScore += 25; analysis.push('<span class="positive">‚úì Contrarian value opportunity</span>'); }
                    else if (pe > 35) { marksScore -= 15; analysis.push('<span class="negative">‚úó Consensus optimism priced in</span>'); }

                    // Risk awareness
                    if (volatility > 0.03 && pricePosition < 40) { marksScore += 10; analysis.push('‚Ä¢ Volatility creates opportunity'); }
                    else if (volatility < 0.01 && pricePosition > 70) { marksScore -= 10; analysis.push('<span class="negative">‚úó Low vol at highs - complacency</span>'); }

                    if (marksScore >= 35) { verdict = 'buy'; verdictText = 'BUY - Contrarian Opportunity'; }
                    else if (marksScore >= 15) { verdict = 'hold'; verdictText = 'HOLD - Second-Level Analysis'; }
                    else if (marksScore >= 0) { verdict = 'hold'; verdictText = 'CAUTION - Cycle Awareness'; }
                    else { verdict = 'avoid'; verdictText = 'AVOID - Wrong Part of Cycle'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - Ask yourself: what does the consensus think, and are they right? ${rsi < 35 ? 'Fear is high - that\'s when I get interested. ' : rsi > 65 ? 'Too much optimism. First-level thinkers are buying. ' : ''}${marksScore >= 25 ? 'Remember: you can\'t predict, but you can prepare.' : 'Understanding risk means knowing when you\'re being paid to take it.'}`,
                        keyMetrics: [
                            { label: 'RSI', value: rsi.toFixed(0), class: rsi < 35 ? 'positive' : rsi > 65 ? 'negative' : 'neutral' },
                            { label: 'Cycle Pos', value: marketCyclePosition.toFixed(0), class: marketCyclePosition < 40 ? 'positive' : marketCyclePosition > 70 ? 'negative' : 'neutral' },
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 15 ? 'positive' : pe < 25 ? 'neutral' : 'negative' },
                            { label: 'Volatility', value: (volatility * 100).toFixed(1) + '%', class: 'neutral' }
                        ]
                    };
                }
            },
            ackman: {
                name: 'Bill Ackman',
                title: 'Pershing Square',
                avatar: 'üè¢',
                style: 'Concentrated Activism',
                quotes: [
                    "I don't look to invest in mediocre businesses.",
                    "We try to buy businesses that have large competitive moats and pricing power.",
                    "The best ideas are simple. We focus on a handful of positions.",
                    "I think the best way to protect capital is to own great businesses at reasonable prices."
                ],
                analyze: function (data) {
                    const { pe, roe, debtEquity, pb, fundScore, name, sector, marketCap } = data;
                    let verdict = 'hold', verdictText = 'PASS - No Catalyst', ackmanScore = 0, analysis = [];

                    // Quality business focus
                    if (roe > 20) { ackmanScore += 25; analysis.push('<span class="positive">‚úì Excellent ROE ' + roe.toFixed(1) + '% - quality moat</span>'); }
                    else if (roe > 15) { ackmanScore += 12; analysis.push('‚Ä¢ Decent returns on capital'); }
                    else if (roe < 10) { ackmanScore -= 10; analysis.push('<span class="negative">‚úó Weak returns - activist opportunity?</span>'); }

                    // Reasonable valuation for quality
                    if (pe < 20 && roe > 15) { ackmanScore += 20; analysis.push('<span class="positive">‚úì Quality at fair price</span>'); }
                    else if (pe < 15) { ackmanScore += 15; analysis.push('<span class="positive">‚úì Compelling valuation</span>'); }
                    else if (pe > 35) { ackmanScore -= 15; analysis.push('<span class="negative">‚úó Too expensive for my style</span>'); }

                    // Balance sheet strength
                    if (debtEquity < 0.5) { ackmanScore += 15; analysis.push('<span class="positive">‚úì Strong balance sheet</span>'); }
                    else if (debtEquity > 1.5) { ackmanScore -= 10; analysis.push('<span class="negative">‚úó Leverage concerns</span>'); }

                    // Sector preference
                    if (['FMCG', 'Retail', 'IT', 'Pharma'].includes(sector)) { ackmanScore += 10; analysis.push('‚Ä¢ ' + sector + ' - simple, understandable'); }

                    if (ackmanScore >= 45) { verdict = 'buy'; verdictText = 'BUY BIG - Concentrated Bet'; }
                    else if (ackmanScore >= 30) { verdict = 'buy'; verdictText = 'ACCUMULATE - Core Position'; }
                    else if (ackmanScore >= 10) { verdict = 'hold'; verdictText = 'MONITOR - Needs Catalyst'; }
                    else { verdict = 'avoid'; verdictText = 'PASS - Not My Type'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I run a concentrated portfolio. ${roe > 18 ? 'High returns on capital suggest a competitive moat. ' : ''}${pe < 20 ? 'Valuation is reasonable. ' : 'Valuation needs to compress. '}${ackmanScore >= 35 ? 'This could be a core holding. I do deep research and take big swings on high-conviction ideas.' : 'I prefer to wait for better opportunities or a catalyst.'}`,
                        keyMetrics: [
                            { label: 'ROE', value: roe.toFixed(1) + '%', class: roe > 18 ? 'positive' : roe > 12 ? 'neutral' : 'negative' },
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 18 ? 'positive' : pe < 28 ? 'neutral' : 'negative' },
                            { label: 'Debt/Eq', value: debtEquity.toFixed(2), class: debtEquity < 0.5 ? 'positive' : debtEquity < 1 ? 'neutral' : 'negative' },
                            { label: 'Quality', value: fundScore > 60 ? 'HIGH' : 'MEDIUM', class: fundScore > 60 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            simons: {
                name: 'Jim Simons',
                title: 'Renaissance Technologies',
                avatar: 'üî¢',
                style: 'Quantitative Trading',
                quotes: [
                    "We search through historical data looking for anomalous patterns.",
                    "The things we are doing will not go away. We might have a bad period, but the underlying technology is robust.",
                    "I don't predict the future, I just try to figure out the odds.",
                    "Good mathematics pays off enormously. The better the math, the better the model."
                ],
                analyze: function (data) {
                    const { techScore, rsi, volumeRatio, change, volatility, sharpe, beta, name } = data;
                    let verdict = 'hold', verdictText = 'NEUTRAL - No Signal', simonsScore = 0, analysis = [];

                    // Statistical edge detection
                    const momentumSignal = (techScore - 50) * 0.5 + (50 - rsi) * 0.3;

                    // Sharpe ratio priority
                    if (sharpe > 2) { simonsScore += 30; analysis.push('<span class="positive">‚úì Exceptional Sharpe ratio ' + sharpe.toFixed(2) + '</span>'); }
                    else if (sharpe > 1.2) { simonsScore += 18; analysis.push('<span class="positive">‚úì Good risk-adjusted returns</span>'); }
                    else if (sharpe < 0.5) { simonsScore -= 15; analysis.push('<span class="negative">‚úó Poor Sharpe - insufficient edge</span>'); }

                    // Volume anomalies
                    if (volumeRatio > 2 && Math.abs(change) > 2) { simonsScore += 20; analysis.push('<span class="positive">‚úì Volume spike detected - pattern forming</span>'); }
                    else if (volumeRatio > 1.5) { simonsScore += 10; analysis.push('‚Ä¢ Above-average activity'); }

                    // Mean reversion signals
                    if (rsi < 25) { simonsScore += 15; analysis.push('<span class="positive">‚úì Extreme RSI - mean reversion probable</span>'); }
                    else if (rsi > 75) { simonsScore += 10; analysis.push('‚Ä¢ Extended - reversion or breakout'); }

                    // Beta optimization
                    if (beta < 0.7 && sharpe > 1) { simonsScore += 10; analysis.push('<span class="positive">‚úì Low beta, good Sharpe - efficient</span>'); }

                    if (simonsScore >= 40) { verdict = 'buy'; verdictText = 'LONG SIGNAL - Statistical Edge'; }
                    else if (simonsScore >= 20) { verdict = 'hold'; verdictText = 'MONITOR - Pattern Developing'; }
                    else if (simonsScore >= 0) { verdict = 'hold'; verdictText = 'NEUTRAL - No Statistical Edge'; }
                    else { verdict = 'avoid'; verdictText = 'AVOID - Negative Expectancy'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I don't care about stories, only statistics. ${sharpe > 1.2 ? 'Risk-adjusted returns are favorable. ' : 'Need better risk-adjusted profile. '}${volumeRatio > 1.5 ? 'Volume patterns show anomalies worth investigating. ' : ''}${simonsScore >= 25 ? 'The data suggests positive expected value. We size positions based on Kelly criterion and edge magnitude.' : 'No clear statistical advantage. Markets are efficient most of the time.'}`,
                        keyMetrics: [
                            { label: 'Sharpe', value: sharpe.toFixed(2), class: sharpe > 1.5 ? 'positive' : sharpe > 0.8 ? 'neutral' : 'negative' },
                            { label: 'RSI', value: rsi.toFixed(0), class: rsi < 30 || rsi > 70 ? 'positive' : 'neutral' },
                            { label: 'Vol Ratio', value: (volumeRatio * 100).toFixed(0) + '%', class: volumeRatio > 1.5 ? 'positive' : 'neutral' },
                            { label: 'Beta', value: beta.toFixed(2), class: beta < 0.8 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            templeton: {
                name: 'John Templeton',
                title: 'Pioneer of Global Investing',
                avatar: 'üåç',
                style: 'Maximum Pessimism',
                quotes: [
                    "The time of maximum pessimism is the best time to buy, and the time of maximum optimism is the best time to sell.",
                    "Bull markets are born on pessimism, grown on skepticism, mature on optimism, and die on euphoria.",
                    "If you want to have a better performance than the crowd, you must do things differently from the crowd.",
                    "To buy when others are despondently selling and sell when others are greedily buying requires the greatest fortitude."
                ],
                analyze: function (data) {
                    const { pe, pb, rsi, pricePosition, change, divYield, name, sector } = data;
                    let verdict = 'hold', verdictText = 'WAIT - Pessimism Needed', templetonScore = 0, analysis = [];

                    // Maximum pessimism indicators
                    if (rsi < 25) { templetonScore += 35; analysis.push('<span class="positive">‚úì RSI ' + rsi.toFixed(0) + ' - maximum pessimism zone!</span>'); }
                    else if (rsi < 35) { templetonScore += 20; analysis.push('<span class="positive">‚úì RSI ' + rsi.toFixed(0) + ' - fear building</span>'); }
                    else if (rsi > 70) { templetonScore -= 25; analysis.push('<span class="negative">‚úó RSI ' + rsi.toFixed(0) + ' - too much optimism</span>'); }

                    // Price position from lows
                    if (pricePosition < 20) { templetonScore += 25; analysis.push('<span class="positive">‚úì Near 52W lows - contrarian territory</span>'); }
                    else if (pricePosition < 35) { templetonScore += 12; analysis.push('‚Ä¢ Below average - some pessimism'); }
                    else if (pricePosition > 80) { templetonScore -= 20; analysis.push('<span class="negative">‚úó Near highs - optimism peaked</span>'); }

                    // Value support
                    if (pe < 10) { templetonScore += 20; analysis.push('<span class="positive">‚úì Deep discount P/E</span>'); }
                    else if (pe < 15) { templetonScore += 10; analysis.push('‚Ä¢ Reasonable valuation'); }

                    // Dividend income while waiting
                    if (divYield > 4) { templetonScore += 15; analysis.push('<span class="positive">‚úì High yield ' + divYield.toFixed(2) + '% - paid to wait</span>'); }
                    else if (divYield > 2) { templetonScore += 5; analysis.push('‚Ä¢ Some dividend support'); }

                    if (templetonScore >= 50) { verdict = 'buy'; verdictText = 'BUY - Maximum Pessimism'; }
                    else if (templetonScore >= 30) { verdict = 'buy'; verdictText = 'ACCUMULATE - Fear Present'; }
                    else if (templetonScore >= 10) { verdict = 'hold'; verdictText = 'WATCH - Need More Fear'; }
                    else { verdict = 'avoid'; verdictText = 'AVOID - Too Much Optimism'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I search the world for maximum pessimism. ${rsi < 35 ? 'Fear is elevated - that\'s when fortunes are made. ' : rsi > 60 ? 'Too much optimism here. ' : ''}${pricePosition < 30 ? 'Beaten down prices often precede recoveries. ' : ''}${templetonScore >= 35 ? 'This requires courage - buying when everyone else is selling. Bull markets begin in despair.' : 'I wait for capitulation. Patience is essential for contrarian investing.'}`,
                        keyMetrics: [
                            { label: 'RSI', value: rsi.toFixed(0), class: rsi < 30 ? 'positive' : rsi > 60 ? 'negative' : 'neutral' },
                            { label: '52W Pos', value: pricePosition.toFixed(0) + '%', class: pricePosition < 25 ? 'positive' : pricePosition > 75 ? 'negative' : 'neutral' },
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 12 ? 'positive' : pe < 20 ? 'neutral' : 'negative' },
                            { label: 'Div Yield', value: divYield.toFixed(2) + '%', class: divYield > 3 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            fisher: {
                name: 'Philip Fisher',
                title: 'Author of Common Stocks',
                avatar: 'üî¨',
                style: 'Scuttlebutt Research',
                quotes: [
                    "The stock market is filled with individuals who know the price of everything, but the value of nothing.",
                    "I don't want a lot of good investments; I want a few outstanding ones.",
                    "More money has been made by purchasing outstanding companies and holding them through thick and thin.",
                    "Conservative investors sleep well."
                ],
                analyze: function (data) {
                    const { pe, roe, score, fundScore, name, sector, debtEquity } = data;
                    let verdict = 'hold', verdictText = 'RESEARCH MORE', fisherScore = 0, analysis = [];

                    // Outstanding business characteristics
                    if (roe > 25) { fisherScore += 30; analysis.push('<span class="positive">‚úì Exceptional ROE ' + roe.toFixed(1) + '% - outstanding company</span>'); }
                    else if (roe > 18) { fisherScore += 18; analysis.push('<span class="positive">‚úì Strong ROE - quality management</span>'); }
                    else if (roe > 12) { fisherScore += 5; analysis.push('‚Ä¢ Acceptable returns'); }
                    else { fisherScore -= 15; analysis.push('<span class="negative">‚úó Poor returns - not outstanding</span>'); }

                    // Growth potential (sectors with R&D, innovation)
                    if (['IT', 'Pharma', 'Auto', 'FMCG'].includes(sector)) { fisherScore += 15; analysis.push('<span class="positive">‚úì ' + sector + ' - growth & innovation potential</span>'); }

                    // Management quality proxy
                    if (fundScore > 70) { fisherScore += 20; analysis.push('<span class="positive">‚úì Strong fundamentals - good management</span>'); }
                    else if (fundScore > 55) { fisherScore += 8; analysis.push('‚Ä¢ Fundamentals acceptable'); }
                    else { fisherScore -= 10; analysis.push('‚Ä¢ Fundamentals need investigation'); }

                    // Don't overpay, but don't be too cheap
                    if (pe > 10 && pe < 35 && roe > 18) { fisherScore += 15; analysis.push('‚Ä¢ Willing to pay fair price for quality'); }
                    else if (pe > 50) { fisherScore -= 10; analysis.push('<span class="negative">‚úó Price too high even for growth</span>'); }

                    // Financial strength
                    if (debtEquity < 0.4) { fisherScore += 10; analysis.push('<span class="positive">‚úì Conservative financial policy</span>'); }

                    if (fisherScore >= 50) { verdict = 'buy'; verdictText = 'BUY & HOLD - Outstanding'; }
                    else if (fisherScore >= 30) { verdict = 'buy'; verdictText = 'ACCUMULATE - Quality Growth'; }
                    else if (fisherScore >= 15) { verdict = 'hold'; verdictText = 'RESEARCH - Scuttlebutt Needed'; }
                    else { verdict = 'avoid'; verdictText = 'PASS - Not Outstanding'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I spend 90% of my time on research, talking to customers, suppliers, and competitors. ${roe > 20 ? 'High returns suggest competitive advantage and capable management. ' : ''}${['IT', 'Pharma'].includes(sector) ? 'This sector rewards innovation. ' : ''}${fisherScore >= 40 ? 'An outstanding company at a fair price is worth holding for many years. I rarely sell.' : 'Need to understand the business better through scuttlebutt before committing.'}`,
                        keyMetrics: [
                            { label: 'ROE', value: roe.toFixed(1) + '%', class: roe > 20 ? 'positive' : roe > 12 ? 'neutral' : 'negative' },
                            { label: 'Quality', value: fundScore > 65 ? 'HIGH' : fundScore > 50 ? 'MED' : 'LOW', class: fundScore > 65 ? 'positive' : fundScore > 50 ? 'neutral' : 'negative' },
                            { label: 'P/E Ratio', value: pe.toFixed(1), class: pe < 30 ? 'neutral' : 'negative' },
                            { label: 'Sector', value: sector.substring(0, 6), class: ['IT', 'Pharma', 'FMCG'].includes(sector) ? 'positive' : 'neutral' }
                        ]
                    };
                }
            },
            tudor: {
                name: 'Paul Tudor Jones',
                title: 'Macro Trading Legend',
                avatar: 'üìâ',
                style: 'Technical Macro',
                quotes: [
                    "The secret to being successful from a trading perspective is to have an indefatigable and an undying and unquenchable thirst for information.",
                    "Don't focus on making money; focus on protecting what you have.",
                    "I believe the very best money is made at the market turns. I get real, real cautious when I see numbers coming in much below or above expectations.",
                    "The whole trick in investing is: How do I keep from losing everything?"
                ],
                analyze: function (data) {
                    const { change, techScore, rsi, volumeRatio, pricePosition, ema20, sma50, price, name, volatility } = data;
                    let verdict = 'hold', verdictText = 'FLAT - No Edge', tudorScore = 0, analysis = [];
                    const trend = price > ema20 && price > sma50;
                    const downtrend = price < ema20 && price < sma50;

                    // 200-day moving average religion
                    if (trend) { tudorScore += 20; analysis.push('<span class="positive">‚úì Above key MAs - trend is your friend</span>'); }
                    else if (downtrend) { tudorScore -= 15; analysis.push('<span class="negative">‚úó Below MAs - defensive mode</span>'); }
                    else { analysis.push('‚Ä¢ No clear trend - reduced position'); }

                    // Market turn detection
                    if (rsi < 25 && pricePosition < 25) { tudorScore += 25; analysis.push('<span class="positive">‚úì Potential market turn - extreme oversold</span>'); }
                    else if (rsi > 80 && pricePosition > 85) { tudorScore += 15; analysis.push('‚Ä¢ Euphoria - look for reversal signs'); }

                    // Volume and momentum
                    if (volumeRatio > 1.5 && change > 1.5 && trend) { tudorScore += 20; analysis.push('<span class="positive">‚úì Breakout with conviction</span>'); }
                    else if (volumeRatio > 1.5 && change < -1.5) { tudorScore -= 10; analysis.push('<span class="negative">‚úó Distribution - reduce exposure</span>'); }

                    // Volatility management
                    if (volatility > 0.04) { tudorScore -= 5; analysis.push('‚Ä¢ High volatility - reduce size'); }
                    else if (volatility < 0.02 && trend) { tudorScore += 10; analysis.push('<span class="positive">‚úì Low vol uptrend - ideal setup</span>'); }

                    if (tudorScore >= 35) { verdict = 'buy'; verdictText = 'LONG - Trend Confirmed'; }
                    else if (tudorScore >= 15) { verdict = 'hold'; verdictText = 'POSITION - Scale In'; }
                    else if (tudorScore >= 0) { verdict = 'hold'; verdictText = 'FLAT - Wait for Setup'; }
                    else { verdict = 'sell'; verdictText = 'SHORT/AVOID - Risk Off'; }

                    return {
                        verdict, verdictText, analysis: analysis.join('<br>'),
                        summary: `<span class="highlight">${name}</span> - I'm a tape reader first. ${trend ? 'Price above moving averages - stay long. ' : downtrend ? 'Below MAs - I\'m either short or flat. ' : ''}${rsi < 30 ? 'Extreme fear creates opportunity for a turn. ' : ''}${tudorScore >= 25 ? 'Risk management is key. I never risk more than 2% on any trade. Cut losses fast, let winners run.' : 'Protecting capital is paramount. No setup, no trade.'}`,
                        keyMetrics: [
                            { label: 'Trend', value: trend ? 'UP' : downtrend ? 'DOWN' : 'FLAT', class: trend ? 'positive' : downtrend ? 'negative' : 'neutral' },
                            { label: 'RSI', value: rsi.toFixed(0), class: rsi < 30 ? 'positive' : rsi > 70 ? 'negative' : 'neutral' },
                            { label: 'Volume', value: (volumeRatio * 100).toFixed(0) + '%', class: volumeRatio > 1.3 ? 'positive' : 'neutral' },
                            { label: 'Volatility', value: (volatility * 100).toFixed(1) + '%', class: volatility < 0.025 ? 'positive' : 'neutral' }
                        ]
                    };
                }
            }
        };

        function selectInvestor(investorId) {
            currentSelectedInvestor = investorId;
            document.querySelectorAll('.investor-chip').forEach(chip => {
                chip.classList.remove('active');
                if (chip.dataset.investor === investorId) chip.classList.add('active');
            });
            if (currentAnalysisData) generateInvestorAdvice(investorId);
        }

        // AI-powered personalized investor advice generation
        async function generateAIInvestorAdvice(investorId, stockData, verdict) {
            const investor = legendaryInvestors[investorId];
            if (!investor) return null;

            // Investor personality profiles for AI prompt
            const investorProfiles = {
                buffett: {
                    personality: "Warren Buffett - speaks simply and folksy, uses Omaha/Midwest expressions, references See's Candies and Coca-Cola, talks about 'wonderful businesses at fair prices', 'economic moats', 'Mr. Market', and holding forever. Uses phrases like 'our shareholders' and 'Charlie and I'.",
                    focus: "P/E ratio, ROE, debt levels, dividend yield, business quality, competitive moat"
                },
                lynch: {
                    personality: "Peter Lynch - enthusiastic and accessible, uses 'tenbagger' often, talks about 'invest in what you know', PEG ratio obsession, references walking through malls to find ideas. Very practical, common-sense approach.",
                    focus: "PEG ratio, growth rate, consumer-facing businesses, understandable products"
                },
                soros: {
                    personality: "George Soros - intellectual, talks about 'reflexivity', market psychology, boom-bust cycles. References 'being wrong is not the problem', macro trends, and going for the jugular when right.",
                    focus: "momentum, RSI, market sentiment, macro trends, when to go big"
                },
                dalio: {
                    personality: "Ray Dalio - systematic, uses 'principles', talks about 'radical transparency', 'pain + reflection = progress', diversification, understanding cycles, and 'beautiful deleveraging'.",
                    focus: "risk parity, diversification, Sharpe ratio, volatility, portfolio fit"
                },
                livermore: {
                    personality: "Jesse Livermore - dramatic old-school trader speak, references 'reading the tape', 'the trend is your friend', sitting tight with winners, talks about 'bucket shops' and being a 'plunger'.",
                    focus: "trend direction, price action, volume confirmation, breakouts"
                },
                icahn: {
                    personality: "Carl Icahn - aggressive, confrontational, talks about 'shaking up management', 'unlocking value', being a 'raider'. Uses corporate warfare language.",
                    focus: "undervalued assets, P/B ratio, activist potential, poor management"
                },
                klarman: {
                    personality: "Seth Klarman - cautious intellectual, obsessed with 'margin of safety', references Ben Graham constantly, talks about 'edge', patience, and waiting for fat pitches.",
                    focus: "margin of safety, downside protection, deep value, patience"
                },
                jhunjhunwala: {
                    personality: "Rakesh Jhunjhunwala - enthusiastic about India, uses Hindi expressions like 'Arre yaar!', 'Bahut accha!', talks about India's growth story, multibaggers, and being bullish on Bharat.",
                    focus: "India growth sectors, ROE, long-term potential, betting on India"
                },
                munger: {
                    personality: "Charlie Munger - curmudgeonly, uses 'invert, always invert', calls things 'stupid' or 'idiotic', references mental models, talks about 'consistently not being stupid'. Very direct and dismissive of bad ideas.",
                    focus: "quality businesses, high ROE, avoiding stupidity, mental models"
                },
                graham: {
                    personality: "Benjamin Graham - academic and precise, references 'The Intelligent Investor', talks about 'Mr. Market', 'defensive investor' vs 'enterprising investor', obsessed with margin of safety and net-net stocks.",
                    focus: "P/E below 15, P/B below 1.5, dividend yield, conservative balance sheet"
                },
                druckenmiller: {
                    personality: "Stanley Druckenmiller - confident, talks about 'betting big when you're right', 'home runs', learned from Soros. References preservation of capital and being 'in the zone'.",
                    focus: "momentum, asymmetric bets, conviction sizing, when to go all-in"
                },
                marks: {
                    personality: "Howard Marks - thoughtful memo-writer style, asks 'what does the consensus think?', talks about 'second-level thinking', cycles, and 'being too early is indistinguishable from being wrong'.",
                    focus: "cycle positioning, contrarian thinking, risk awareness, market psychology"
                },
                ackman: {
                    personality: "Bill Ackman - confident activist, talks about 'simple, predictable businesses', 'concentrated portfolios', and 'pricing power'. References Pershing Square and doing deep research.",
                    focus: "quality moats, concentrated bets, pricing power, activist potential"
                },
                simons: {
                    personality: "Jim Simons - mathematical and cryptic, talks about 'patterns in the data', 'statistical edge', 'models'. Very secretive about methods, references 'the Medallion Fund' approach.",
                    focus: "Sharpe ratio, statistical patterns, quantitative signals, edge detection"
                },
                templeton: {
                    personality: "John Templeton - wise and patient, talks about 'maximum pessimism', 'bull markets born on pessimism', and investing globally. References finding value in crisis.",
                    focus: "extreme fear indicators, contrarian timing, RSI oversold, beaten-down prices"
                },
                fisher: {
                    personality: "Philip Fisher - methodical researcher, talks about 'scuttlebutt' method, 'outstanding companies', holding for years. References talking to customers/competitors/suppliers.",
                    focus: "quality management, growth potential, R&D focus, long-term holding"
                },
                tudor: {
                    personality: "Paul Tudor Jones - intense trader, obsessed with '200-day moving average', talks about 'protecting capital first', 'market turns', and documentary style intensity.",
                    focus: "trend following, moving averages, risk management, capital preservation"
                }
            };

            const profile = investorProfiles[investorId];
            if (!profile) return null;

            const prompt = `You are ${investor.name}. Speak EXACTLY in their voice and personality.

${profile.personality}

A stock called "${stockData.name}" (${stockData.symbol}) in ${stockData.sector} sector has these metrics:
- Price: ‚Çπ${stockData.price?.toFixed(2) || 'N/A'}
- P/E Ratio: ${stockData.pe?.toFixed(1) || 'N/A'}
- P/B Ratio: ${stockData.pb?.toFixed(2) || 'N/A'}  
- ROE: ${stockData.roe?.toFixed(1) || 'N/A'}%
- Debt/Equity: ${stockData.debtEquity?.toFixed(2) || 'N/A'}
- Dividend Yield: ${stockData.divYield?.toFixed(2) || 'N/A'}%
- RSI: ${stockData.rsi?.toFixed(0) || 'N/A'}
- Today's Change: ${stockData.change >= 0 ? '+' : ''}${stockData.change?.toFixed(2) || 'N/A'}%
- 52-Week Position: ${stockData.pricePosition?.toFixed(0) || 'N/A'}%
- Analysis Verdict: ${verdict}

Focus on: ${profile.focus}

Give exactly 3-4 lines of investment advice about this specific stock in ${investor.name}'s authentic voice, personality, and philosophy. Be specific about the numbers. Use their catchphrases and speaking style. Do NOT use quotation marks or say "I would say". Just speak as them directly.`;

            try {
                // Use server proxy for OpenAI API (key stored in .env)
                const response = await fetch('/api/openai/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: `You are ${investor.name}, the legendary investor. Respond ONLY in their authentic voice, using their famous phrases, speaking style, and investment philosophy. Keep responses to exactly 3-4 lines. Be specific about the stock metrics provided.`
                            },
                            { role: 'user', content: prompt }
                        ],
                        max_tokens: 250,
                        temperature: 0.85
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    return data.choices?.[0]?.message?.content?.trim() || null;
                } else {
                    const error = await response.json();
                    console.log('OpenAI API error:', error);
                }
            } catch (error) {
                console.log('AI advice generation failed:', error.message);
            }

            return null;
        }

        // Check if API key exists - always true since we have it hardcoded
        function hasOpenAIKey() {
            return true;
        }

        // Enhanced pre-written AI-style personalized advice for each investor
        function getPersonalizedAdvice(investorId, data, verdict) {
            const { name, symbol, pe, pb, roe, debtEquity, divYield, rsi, change, sector, pricePosition } = data;

            const adviceTemplates = {
                buffett: () => {
                    if (verdict === 'buy') return `Well, Charlie and I have always said - when you find a wonderful business, you want to own it. ${name} with its ${roe?.toFixed(1)}% return on equity reminds me of the kind of capital allocators we love. At ${pe?.toFixed(1)}x earnings, this isn't expensive for quality. Our favorite holding period is forever, and I'd be comfortable adding this to the portfolio for our shareholders.`;
                    if (verdict === 'hold') return `${name} is like a fair business at a fair price - not what excites us. The ${roe?.toFixed(1)}% ROE is acceptable, but Charlie would say we can do better. We'll keep watching. Remember, the stock market is a device for transferring money from the impatient to the patient. No rush here.`;
                    return `I'd pass on ${name}. At ${pe?.toFixed(1)}x earnings with ${roe?.toFixed(1)}% ROE, this doesn't have the economic moat we look for. Rule number one is don't lose money. Rule number two is don't forget rule number one. There are 3,000 stocks out there - we'll find something better.`;
                },
                lynch: () => {
                    if (verdict === 'buy') return `Now THIS is interesting! ${name} in ${sector} - something I could understand walking through a mall. With growth implied from that ${roe?.toFixed(1)}% ROE, the PEG ratio looks favorable. Could be a tenbagger in the making! Do your homework, but I like what I see here.`;
                    if (verdict === 'hold') return `${name} is what I'd call a stalwart - steady but not spectacular. The ${pe?.toFixed(1)}x P/E is fair. Know what you own and why you own it. If you own it already, no need to sell. If not, there might be faster growers out there.`;
                    return `${name} doesn't excite me at these prices. The numbers don't scream "tenbagger" to me. Remember - behind every stock is a company. Make sure you understand what this company is doing before jumping in. I'd look elsewhere.`;
                },
                soros: () => {
                    if (verdict === 'buy') return `The reflexivity here is interesting. ${name} at RSI ${rsi?.toFixed(0)} with ${change >= 0 ? '+' : ''}${change?.toFixed(2)}% today shows the market is waking up. When I see momentum confirming, I don't nibble - I go for the jugular. Size this appropriately but be ready to cut if wrong.`;
                    if (verdict === 'hold') return `Markets are in constant flux. ${name} shows no clear trend yet - RSI at ${rsi?.toFixed(0)} is neutral territory. It's not whether you're right or wrong that matters, but how much you make when right and lose when wrong. Wait for a cleaner setup.`;
                    return `${name} looks like a crowded trade. RSI at ${rsi?.toFixed(0)} and near ${pricePosition?.toFixed(0)}% of 52-week range - the easy money has been made. When everyone is on one side of the boat, I prefer the other side. Or I simply wait.`;
                },
                dalio: () => {
                    if (verdict === 'buy') return `From a risk parity perspective, ${name} fits well. The Sharpe ratio and beta suggest good risk-adjusted returns. In my All Weather approach, this could provide diversification benefit. Remember - diversifying well is the most important thing you can do.`;
                    if (verdict === 'hold') return `${name} presents moderate risk-reward. I think about portfolio construction holistically. Pain plus reflection equals progress - if this position hasn't worked, understand why before adding. Size it appropriately for your risk tolerance.`;
                    return `The risk metrics on ${name} concern me. Understanding what you don't know matters more than what you do know. This would add volatility without commensurate return potential. An All Weather portfolio needs better balance than this.`;
                },
                livermore: () => {
                    if (verdict === 'buy') return `The tape doesn't lie! ${name} above its moving averages with volume confirming - this is what I wait for. The trend is up, and the big money is made by sitting tight with winners. Enter here with a tight stop. Let the position work.`;
                    if (verdict === 'hold') return `${name} is consolidating - the tape shows indecision. It was never my thinking that made big money, it was my sitting. Patience. Wait for the stock to prove itself. No confirmation, no position. The market will tell us when it's ready.`;
                    return `${name} is breaking down. Below its averages, trend is against us. Never argue with the tape! The market is never wrong - only opinions are. I'm either short or flat here. Preserve your capital for better setups.`;
                },
                icahn: () => {
                    if (verdict === 'buy') return `Now we're talking! ${name} at ${pb?.toFixed(2)}x book with weak ROE at ${roe?.toFixed(1)}% - this screams activist opportunity. Management is probably asleep. I make money studying natural stupidity. Get a board seat, shake things up, unlock that hidden value.`;
                    if (verdict === 'hold') return `${name} has some value but no clear catalyst for change. The ${pb?.toFixed(2)}x book value is interesting, but we need management to make mistakes we can exploit. Keep it on the radar. If you want a friend on Wall Street, get a dog.`;
                    return `${name} is too well-run for my style. ROE of ${roe?.toFixed(1)}% shows competent management - no angle for activism. I look for the broken and undervalued, not the polished. Moving on to find real opportunities.`;
                },
                klarman: () => {
                    if (verdict === 'buy') return `${name} at ${pb?.toFixed(2)}x book provides meaningful margin of safety. The ${pe?.toFixed(1)}x P/E shows the market's pessimism - that's when I get interested. Value investing is the marriage of a contrarian streak and a calculator. The math works here.`;
                    if (verdict === 'hold') return `${name} offers some value but insufficient margin of safety for my taste. At ${pe?.toFixed(1)}x earnings, I need more discount to compensate for what could go wrong. The single greatest edge is a long-term orientation. I can wait for a better price.`;
                    return `No margin of safety in ${name}. At ${pb?.toFixed(2)}x book and ${pe?.toFixed(1)}x earnings, where's the protection if I'm wrong? Being too far ahead of your time is indistinguishable from being wrong. I pass and wait for genuine fear in the market.`;
                },
                jhunjhunwala: () => {
                    if (verdict === 'buy') return `Arre yaar! ${name} in ${sector} - this is India's growth story! ${roe?.toFixed(1)}% ROE shows quality management. At ${pe?.toFixed(1)}x, I'm getting a good business at reasonable price. India ka future bright hai! This could be 10x in ten years. I'm bullish!`;
                    if (verdict === 'hold') return `${name} is decent yaar, but not exceptional. ${roe?.toFixed(1)}% ROE - theek hai, nothing special. I respect the market, have an open mind. Wait for better entry. Never invest at unreasonable valuations. Patience is key, India has thousands of opportunities!`;
                    return `${name} at these valuations? Nahi yaar! P/E of ${pe?.toFixed(1)}x with ${roe?.toFixed(1)}% ROE doesn't excite me. The biggest risk is overpaying. Better opportunities exist in India - banking, pharma, IT. We are selective here.`;
                },
                munger: () => {
                    if (verdict === 'buy') return `This isn't stupid, which already puts it ahead of most ideas I see. ${name} with ${roe?.toFixed(1)}% ROE suggests a real business, not financial engineering. The big money is in the waiting. Buy it and sit on your hands. Don't be an idiot by trading it.`;
                    if (verdict === 'hold') return `${name} is mediocre. ${roe?.toFixed(1)}% ROE - not terrible, not wonderful. Invert, always invert - what would make this a disaster? If you can't answer that quickly, maybe you don't understand it. We can do better.`;
                    return `${name} would be idiotic to own. ${roe?.toFixed(1)}% ROE? That's not a business, that's a destruction of capital. It's remarkable how much long-term advantage we've gotten by just consistently avoiding stupidity. This is stupid. Pass.`;
                },
                graham: () => {
                    if (verdict === 'buy') return `${name} meets my criteria for the defensive investor. P/E of ${pe?.toFixed(1)}x, P/B of ${pb?.toFixed(2)}x - we're buying assets at a discount. The margin of safety is always dependent on price paid. At these levels, Mr. Market is being pessimistic. We should be buyers.`;
                    if (verdict === 'hold') return `${name} is fairly valued - not cheap enough for the defensive investor, not expensive enough to sell. P/E of ${pe?.toFixed(1)}x is borderline. In the short run, the market is a voting machine. Be patient. Wait for Mr. Market to offer better prices.`;
                    return `${name} at ${pe?.toFixed(1)}x P/E is speculative, not investment. The intelligent investor is a realist who buys from pessimists. Currently, optimism is priced in. This provides no margin of safety. I would require at least 30% discount to consider.`;
                },
                druckenmiller: () => {
                    if (verdict === 'buy') return `I see the setup. ${name} showing strength with momentum confirming - when I see this, I don't nibble, I bet big. ${pricePosition?.toFixed(0)}% of 52-week range with positive technicals. The way to build returns is preservation of capital AND home runs. This could be a home run.`;
                    if (verdict === 'hold') return `${name} is still developing its thesis. No clear asymmetric opportunity yet. The key is to wait - sometimes the best thing to do is nothing. Preserve capital until conviction appears. I need to see cleaner confirmation before sizing up.`;
                    return `No edge in ${name} right now. ${rsi?.toFixed(0)} RSI, ${pricePosition?.toFixed(0)}% 52-week position - where's the asymmetry? I learned from Soros that it's about how much you make when right. This setup doesn't offer that. Sitting in cash.`;
                },
                marks: () => {
                    if (verdict === 'buy') return `Second-level thinking here: everyone hates ${name} - RSI ${rsi?.toFixed(0)}, ${pricePosition?.toFixed(0)}% of 52-week range. First-level thinkers are selling. But ask yourself - who doesn't know that it's struggling? Bull markets are born on pessimism. This is that moment.`;
                    if (verdict === 'hold') return `Where are we in the cycle? ${name} is in the middle - not peak optimism, not maximum pessimism. Understanding cycles is crucial. The consensus is neutral here, and the consensus is usually already in the price. Wait for extreme positioning.`;
                    return `${name} at RSI ${rsi?.toFixed(0)} near ${pricePosition?.toFixed(0)}% of highs - this is where first-level thinkers are buying. But second-level thinking asks: what's already priced in? Too much optimism here. Being too early is indistinguishable from being wrong, but so is being too late.`;
                },
                ackman: () => {
                    if (verdict === 'buy') return `${name} is the kind of business I build positions in. ${roe?.toFixed(1)}% ROE suggests competitive moat, P/E of ${pe?.toFixed(1)}x is reasonable for quality. I don't diversify across 50 stocks - I go deep on 8-10 high-conviction ideas. This deserves concentration.`;
                    if (verdict === 'hold') return `${name} is decent but not compelling enough for my concentrated approach. ${roe?.toFixed(1)}% ROE and ${pe?.toFixed(1)}x P/E - I need to see more pricing power or an activist angle. The best way to protect capital is owning great businesses. This is good, not great.`;
                    return `I don't invest in mediocre businesses, and ${name} looks mediocre. ${roe?.toFixed(1)}% ROE doesn't scream competitive advantage. I need simple, predictable businesses with pricing power. This isn't it. Passing for now.`;
                },
                simons: () => {
                    if (verdict === 'buy') return `The patterns are favorable. ${name} showing Sharpe ratio signals with volume anomalies worth investigating. Our models don't predict the future - they calculate probabilities. Current probabilities suggest positive expected value. Size according to Kelly criterion.`;
                    if (verdict === 'hold') return `${name} shows no clear statistical edge currently. RSI at ${rsi?.toFixed(0)}, volume patterns neutral. We search for anomalies in the data - there's no anomaly here to exploit. Good mathematics requires good data. The data says wait.`;
                    return `Negative expectancy on ${name}. The models suggest poor risk-adjusted returns. I don't care about stories or narratives - only statistics. The statistics here are unfavorable. Markets are efficient most of the time. This is one of those times.`;
                },
                templeton: () => {
                    if (verdict === 'buy') return `${name} at maximum pessimism! RSI ${rsi?.toFixed(0)}, ${pricePosition?.toFixed(0)}% of 52-week range - everyone is despondently selling. This requires fortitude. Bull markets are born on pessimism, grow on skepticism. We are buying when others cannot imagine buying.`;
                    if (verdict === 'hold') return `${name} is not at maximum pessimism yet. RSI ${rsi?.toFixed(0)} shows fear, but not capitulation. The time to buy is when blood is in the streets. Keep watching. If you want better performance than the crowd, you must do things differently from the crowd.`;
                    return `${name} near ${pricePosition?.toFixed(0)}% of 52-week highs with RSI ${rsi?.toFixed(0)} - this is optimism, not pessimism. I search the world for maximum pessimism. This is the opposite. Markets die on euphoria. I wait for genuine fear.`;
                },
                fisher: () => {
                    if (verdict === 'buy') return `${name} shows the hallmarks of an outstanding company. ${roe?.toFixed(1)}% ROE indicates capable management. I'd want to do scuttlebutt - talk to customers, competitors, suppliers. But the numbers suggest quality. I hold these for years, through thick and thin.`;
                    if (verdict === 'hold') return `${name} has potential but needs more research. ${roe?.toFixed(1)}% ROE is acceptable. I don't want many good investments - I want a few outstanding ones. More scuttlebutt needed. Is management truly excellent? Is R&D producing results?`;
                    return `${name} doesn't look outstanding. ${roe?.toFixed(1)}% ROE, ${sector} sector - where's the exceptional quality? The stock market is filled with people who know the price of everything but the value of nothing. This doesn't have the value I seek.`;
                },
                tudor: () => {
                    if (verdict === 'buy') return `${name} above its moving averages, RSI ${rsi?.toFixed(0)} confirming - the 200-day average is my religion, and price is respecting it. Trend is UP. Don't focus on making money, focus on protecting what you have - tight stop here, let it run.`;
                    if (verdict === 'hold') return `${name} is chopping around. RSI ${rsi?.toFixed(0)}, no clear trend. The best money is made at market turns - we're not at a turn yet. I get cautious when numbers are mixed. Stay flat or small until the trend declares itself.`;
                    return `${name} breaking below key averages. The whole trick in investing is: how do I keep from losing everything? Answer: don't fight the trend. This trend is down. I'm either short or flat. No longs in a downtrend. Capital preservation comes first.`;
                }
            };

            const template = adviceTemplates[investorId];
            return template ? template() : null;
        }

        async function generateInvestorAdvice(investorId) {
            if (!currentAnalysisData || !legendaryInvestors[investorId]) return;
            const investor = legendaryInvestors[investorId];
            const advice = investor.analyze(currentAnalysisData);
            const randomQuote = investor.quotes[Math.floor(Math.random() * investor.quotes.length)];

            // Show loading state if API key exists
            const hasKey = hasOpenAIKey();
            if (hasKey) {
                document.getElementById('investorAdviceContainer').innerHTML = `
                    <div class="investor-advice-card visible">
                        <div class="investor-card-header">
                            <div class="investor-avatar-large">${investor.avatar}</div>
                            <div class="investor-card-info">
                                <h4>${investor.name}</h4>
                                <span>${investor.title} ‚Ä¢ ${investor.style}</span>
                            </div>
                        </div>
                        <div class="investor-verdict hold">ü§ñ GENERATING AI ADVICE...</div>
                        <div class="investor-advice-text" style="text-align: center; padding: 30px;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: var(--gold);"></i>
                            <p style="margin-top: 10px; color: var(--text-secondary);">ChatGPT is channeling ${investor.name}'s wisdom...</p>
                        </div>
                    </div>
                `;
            }

            // Get personalized template advice as fallback
            const personalizedAdvice = getPersonalizedAdvice(investorId, currentAnalysisData, advice.verdict);

            // Try to get dynamic AI advice from ChatGPT
            let aiAdvice = null;
            if (hasKey) {
                aiAdvice = await generateAIInvestorAdvice(investorId, currentAnalysisData, advice.verdictText);
            }

            const finalAdvice = aiAdvice || personalizedAdvice || advice.summary;
            const isAIGenerated = !!aiAdvice;

            document.getElementById('investorAdviceContainer').innerHTML = `
                <div class="investor-advice-card visible">
                    <div class="investor-card-header">
                        <div class="investor-avatar-large">${investor.avatar}</div>
                        <div class="investor-card-info">
                            <h4>${investor.name}</h4>
                            <span>${investor.title} ‚Ä¢ ${investor.style}</span>
                        </div>
                        ${isAIGenerated ? '<div class="ai-badge" style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 600;"><i class="fas fa-robot"></i> GPT-4 Generated</div>' : ''}
                    </div>
                    <div class="investor-verdict ${advice.verdict}">${advice.verdictText}</div>
                    <div class="investor-advice-text" style="font-style: italic; line-height: 1.8; padding: 15px 0; border-left: 3px solid var(--gold); padding-left: 20px; margin: 15px 0; background: rgba(201,162,39,0.05); border-radius: 0 8px 8px 0;">
                        "${finalAdvice}"
                    </div>
                    <div style="margin: 20px 0; padding: 15px; background: rgba(40,40,40,0.4); border-radius: 12px;">
                        <div style="font-size: 0.8rem; color: var(--text-tertiary); margin-bottom: 10px; text-transform: uppercase; letter-spacing: 0.5px;">üìä Key Analysis Points</div>
                        <div style="color: var(--text-secondary); line-height: 1.8; font-size: 0.9rem;">${advice.analysis}</div>
                    </div>
                    <div class="investor-key-metrics">
                        ${advice.keyMetrics.map(m => `<div class="investor-metric"><div class="investor-metric-label">${m.label}</div><div class="investor-metric-value ${m.class}">${m.value}</div></div>`).join('')}
                    </div>
                    <div class="investor-quote">"${randomQuote}"<cite>‚Äî ${investor.name}</cite></div>
                    <div style="margin-top: 15px; text-align: center;">
                        <span style="color: var(--text-tertiary); font-size: 0.75rem;"><i class="fas fa-magic"></i> Powered by GPT-4</span>
                    </div>
                </div>
            `;
            document.getElementById('noInvestorMessage').style.display = 'none';
        }

        function updateInvestorInsights(stockData, fundamentals, score, techScore, fundScore, rsi, pricePosition, volumeRatio, ema20, sma50, beta, volatility, sharpe, maxDrawdown) {
            currentAnalysisData = {
                symbol: stockData.symbol || document.getElementById('stockInput').value.toUpperCase(),
                name: stockData.name, sector: stockData.sector, price: stockData.price, change: stockData.change,
                pe: fundamentals.pe, pb: fundamentals.pb, roe: fundamentals.roe, debtEquity: fundamentals.debtEquity,
                divYield: fundamentals.divYield, beta: fundamentals.beta || beta, marketCap: stockData.marketCap,
                score, techScore, fundScore, rsi, pricePosition, volumeRatio, ema20, sma50, volatility, sharpe, maxDrawdown
            };
            document.getElementById('investorInsightsSection').style.display = 'block';
            generateInvestorAdvice(currentSelectedInvestor);
        }

        function shareTwitter() {
            window.open('https://twitter.com/intent/tweet?text=üìä Free Stock Analysis Tool with Technical Analysis (RSI, MACD) and Fundamental Analysis (PE Ratio, ROE). Analyze NSE/BSE stocks:&url=https://brobillionaire.com/tool-ai-stock-analyzer.html&hashtags=StockAnalysis,TechnicalAnalysis,FundamentalAnalysis,Trading', '_blank');
        }

        function shareWhatsApp() {
            window.open('https://wa.me/?text=üìä Free Stock Analysis Tool - Technical Analysis (RSI, MACD, Bollinger Bands) and Fundamental Analysis (PE Ratio, ROE, EPS) for NSE/BSE stocks. Educational tool: https://brobillionaire.com/tool-ai-stock-analyzer.html', '_blank');
        }

        function shareLinkedIn() {
            window.open('https://www.linkedin.com/sharing/share-offsite/?url=https://brobillionaire.com/tool-ai-stock-analyzer.html', '_blank');
        }

        function copyLink() {
            navigator.clipboard.writeText('https://brobillionaire.com/tool-ai-stock-analyzer.html');
            const btn = event.target;
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚úÖ Copied!';
            setTimeout(() => btn.innerHTML = originalText, 2000);
        }

        // =============================================
        // TYPEAHEAD AUTOCOMPLETE FUNCTIONALITY
        // =============================================

        // Initialize after DOM is ready
        (function initAutocomplete() {
            const stockInput = document.getElementById('stockInput');
            const autocompleteDropdown = document.getElementById('autocompleteDropdown');
            let selectedIndex = -1;
            let filteredStocks = [];

            // Debug: Check if elements exist
            console.log('Autocomplete init:', { stockInput: !!stockInput, autocompleteDropdown: !!autocompleteDropdown });

            if (!stockInput || !autocompleteDropdown) {
                console.error('Autocomplete elements not found!');
                return;
            }

            // Build alias map: alias symbol -> primary symbol
            const aliasMap = {};
            Object.entries(stockMetadata).forEach(([symbol, data]) => {
                if (data.yahooSymbol) {
                    // This is an alias, map it to the primary symbol
                    aliasMap[symbol.toLowerCase()] = data.yahooSymbol;
                }
            });

            // Build searchable stock list - exclude aliases (entries with yahooSymbol)
            // Also collect alias keywords for each primary stock
            const stockList = Object.entries(stockMetadata)
                .filter(([symbol, data]) => !data.yahooSymbol) // Exclude aliases
                .map(([symbol, data]) => {
                    // Find all aliases that point to this symbol
                    const aliases = Object.entries(stockMetadata)
                        .filter(([aliasSymbol, aliasData]) => aliasData.yahooSymbol === symbol)
                        .map(([aliasSymbol]) => aliasSymbol);

                    return {
                        symbol: symbol,
                        name: data.name,
                        sector: data.sector,
                        aliases: aliases // For search matching
                    };
                });

            console.log('Stock list built:', stockList.length, 'stocks');

            // Update stock count in badge
            const stockCountBadge = document.querySelector('.stock-count-badge');
            if (stockCountBadge) {
                stockCountBadge.innerHTML = '<i class="fas fa-database"></i> ' + stockList.length + '+ NSE Stocks Available';
            }

            // Filter stocks based on input (searches symbol, name, sector, and aliases)
            function filterStocks(query) {
                if (!query || query.length < 1) return [];

                const q = query.toLowerCase();
                return stockList.filter(stock =>
                    stock.symbol.toLowerCase().includes(q) ||
                    stock.name.toLowerCase().includes(q) ||
                    stock.sector.toLowerCase().includes(q) ||
                    (stock.aliases && stock.aliases.some(alias => alias.toLowerCase().includes(q)))
                ).slice(0, 10);
            }

            // Render autocomplete dropdown
            function renderDropdown(stocks) {
                if (stocks.length === 0) {
                    autocompleteDropdown.style.display = 'none';
                    return;
                }

                autocompleteDropdown.innerHTML = stocks.map((stock, index) => `
                    <div class="autocomplete-item ${index === selectedIndex ? 'selected' : ''}" 
                         data-symbol="${stock.symbol}">
                        <span class="autocomplete-symbol">${stock.symbol}</span>
                        <span class="autocomplete-name">${stock.name}</span>
                        <span class="autocomplete-sector">${stock.sector}</span>
                    </div>
                `).join('');

                autocompleteDropdown.style.display = 'block';
                console.log('Dropdown rendered with', stocks.length, 'items');
            }

            // Make selectStock global for onclick handlers
            window.selectStock = function (symbol) {
                console.log('selectStock called:', symbol);
                stockInput.value = symbol;
                autocompleteDropdown.style.display = 'none';
                selectedIndex = -1;
                stockInput.focus();
                analyzeStock();
            };

            // Event delegation for autocomplete clicks
            autocompleteDropdown.addEventListener('click', function (e) {
                e.stopPropagation();
                const item = e.target.closest('.autocomplete-item');
                if (item) {
                    const symbol = item.getAttribute('data-symbol');
                    console.log('Autocomplete item clicked:', symbol);
                    if (symbol) {
                        window.selectStock(symbol);
                    }
                }
            });

            // Handle input events
            stockInput.addEventListener('input', function (e) {
                const query = e.target.value.trim();
                console.log('Input event:', query);
                filteredStocks = filterStocks(query);
                selectedIndex = -1;
                renderDropdown(filteredStocks);
            });

            // Handle keyboard navigation
            stockInput.addEventListener('keydown', function (e) {
                if (!filteredStocks.length) return;

                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    selectedIndex = Math.min(selectedIndex + 1, filteredStocks.length - 1);
                    renderDropdown(filteredStocks);
                    const selected = autocompleteDropdown.querySelector('.autocomplete-item.selected');
                    if (selected) selected.scrollIntoView({ block: 'nearest' });
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    selectedIndex = Math.max(selectedIndex - 1, 0);
                    renderDropdown(filteredStocks);
                    const selected = autocompleteDropdown.querySelector('.autocomplete-item.selected');
                    if (selected) selected.scrollIntoView({ block: 'nearest' });
                } else if (e.key === 'Enter' && selectedIndex >= 0) {
                    e.preventDefault();
                    window.selectStock(filteredStocks[selectedIndex].symbol);
                } else if (e.key === 'Escape') {
                    autocompleteDropdown.style.display = 'none';
                    selectedIndex = -1;
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function (e) {
                if (!e.target.closest('.search-container') && !e.target.closest('.autocomplete-dropdown')) {
                    autocompleteDropdown.style.display = 'none';
                    selectedIndex = -1;
                }
            });

            // Show dropdown on focus if there's text
            stockInput.addEventListener('focus', function () {
                if (stockInput.value.trim()) {
                    filteredStocks = filterStocks(stockInput.value.trim());
                    renderDropdown(filteredStocks);
                }
            });

            // Enter key support (when no autocomplete selection)
            stockInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter' && selectedIndex < 0) {
                    analyzeStock();
                }
            });

            console.log('Autocomplete initialized successfully');
        })();

        // Auto-focus on load and initialize FAQ
        window.addEventListener('load', function () {
            document.getElementById('stockInput').focus();

            // FAQ Toggle functionality
            document.querySelectorAll('.faq-question').forEach(function (question) {
                question.addEventListener('click', function () {
                    const faqItem = this.parentElement;
                    faqItem.classList.toggle('active');
                });
            });
            console.log('FAQ initialized');
        });
    </script>
    <script src="common-footer.js" defer></script>
    <script src="faq-toggle.js"></script>
</body>

</html>