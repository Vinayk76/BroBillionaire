<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N0Y2LBMRSW"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-N0Y2LBMRSW');
    </script>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon-96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">

    <title>Bro Billionaire Basket Live Tracker - The Magnificent 7 Real-Time Stock Dashboard</title>
    <meta name="description" content="Track the official Bro Billionaire basket live - The Magnificent 7 stocks (NVDA, TSLA, PLTR, MSFT, META, AMZN, AAPL). Real-time prices, charts, and billionaire insights.">
    <meta name="keywords" content="bro billionaire stocks live, magnificent 7 stocks, NVDA TSLA PLTR live, tech stocks dashboard, billionaire portfolio tracker, AI stocks live prices">
    <link rel="canonical" href="https://brobillionaire.com/dashboard-bro-basket-live.html">

    <!-- Open Graph -->
    <meta property="og:title" content="Bro Billionaire Basket Live Tracker - The Magnificent 7">
    <meta property="og:description" content="Track the official Bro Billionaire basket live: NVDA, TSLA, PLTR, MSFT, META, AMZN, AAPL with real-time prices and billionaire insights.">
    <meta property="og:url" content="https://brobillionaire.com/dashboard-bro-basket-live.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="BroBillionaire">

    <!-- Fonts -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Bro Billionaire Basket Live Tracker",
        "description": "Real-time performance dashboard for elite billionaire stock holdings with live prices, charts, and analytics",
        "url": "https://brobillionaire.com/dashboard-bro-basket-live.html",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Any",
        "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
        "creator": { "@type": "Organization", "name": "BroBillionaire" },
        "featureList": "Live stock prices, Interactive charts, Billionaire insights, Portfolio analytics"
    }
    </script>

    <style>
        :root {
            --gold: #C9A227;
            --gold-light: #E8D5A3;
            --gold-dark: #A68B1E;
            --gold-glow: rgba(201, 162, 39, 0.3);
            --bg-dark: #0a0a0a;
            --bg-card: #111111;
            --bg-card-hover: #1a1a1a;
            --bg-input: #0d0d0d;
            --green: #22c55e;
            --green-light: #4ade80;
            --red: #ef4444;
            --red-light: #f87171;
            --orange: #f59e0b;
            --blue: #3b82f6;
            --purple: #8b5cf6;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-muted: #666666;
            --border-color: #222222;
            --border-gold: rgba(201, 162, 39, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--gold-dark); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--gold); }

        /* Loading */
        .loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-dark); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 9999;
            transition: opacity 0.5s ease;
        }
        .loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .loader {
            width: 60px; height: 60px; border: 3px solid var(--border-color);
            border-top-color: var(--gold); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .loading-text { margin-top: 20px; color: var(--gold); font-weight: 600; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Header */
        .dashboard-header {
            background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-dark) 100%);
            border-bottom: 1px solid var(--border-gold);
            padding: 20px 30px;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(20px);
        }

        .logo-section { display: flex; align-items: center; gap: 15px; }

        .logo-icon {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-size: 24px; box-shadow: 0 4px 20px var(--gold-glow);
        }

        .logo-text h1 {
            font-family: 'Playfair Display', serif; font-size: 1.5rem; font-weight: 700;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 50%, var(--gold) 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .logo-text span { font-size: 0.75rem; color: var(--text-secondary); letter-spacing: 2px; }

        .header-controls { display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }

        .live-indicator {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 18px; background: rgba(34, 197, 94, 0.1);
            border: 1px solid var(--green); border-radius: 20px;
            font-size: 0.9rem; font-weight: 600;
        }
        .live-dot {
            width: 10px; height: 10px; background: var(--green); border-radius: 50%;
            animation: pulse-dot 1.5s ease-in-out infinite; box-shadow: 0 0 10px var(--green);
        }
        @keyframes pulse-dot { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }

        .market-status {
            font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; color: var(--gold);
            background: rgba(201, 162, 39, 0.1); padding: 8px 16px;
            border-radius: 8px; border: 1px solid var(--border-gold);
        }

        .back-btn {
            padding: 10px 20px; background: transparent;
            border: 1px solid var(--border-gold); border-radius: 8px;
            color: var(--gold); font-weight: 600; cursor: pointer;
            transition: all 0.3s ease; text-decoration: none;
        }
        .back-btn:hover { background: var(--gold); color: #000; }

        /* Container */
        .container { max-width: 1400px; margin: 0 auto; padding: 30px 20px; }

        /* Summary Cards */
        .summary-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px; margin-bottom: 40px;
        }

        .summary-card {
            background: linear-gradient(145deg, var(--bg-card) 0%, #0d0d0d 100%);
            border: 2px solid var(--border-gold);
            border-radius: 16px; padding: 24px;
            position: relative; overflow: hidden;
        }
        .summary-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, var(--gold), var(--gold-light), var(--gold));
        }

        .summary-card h3 {
            font-size: 0.85rem; color: var(--text-secondary);
            text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;
        }
        .summary-card .value {
            font-size: 2rem; font-weight: 700; color: var(--text-primary);
            margin-bottom: 8px;
        }
        .summary-card .change {
            font-size: 0.9rem; font-weight: 600;
        }
        .summary-card .change.positive { color: var(--green); }
        .summary-card .change.negative { color: var(--red); }

        /* Stock Grid */
        .stock-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px; margin-bottom: 40px;
        }

        .stock-card {
            background: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 100%);
            border: 2px solid rgba(201, 162, 39, 0.2);
            border-radius: 20px; padding: 24px;
            position: relative; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        .stock-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, var(--gold), var(--gold-light), var(--gold));
        }
        .stock-card:hover {
            transform: translateY(-5px);
            border-color: var(--gold);
            box-shadow: 0 20px 60px rgba(201, 162, 39, 0.25);
        }

        .stock-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 20px;
        }
        .stock-symbol {
            font-size: 1.5rem; font-weight: 700; color: var(--gold);
        }
        .stock-name {
            font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px;
        }
        .billionaire-badge {
            font-size: 0.7rem; padding: 4px 10px;
            background: rgba(201, 162, 39, 0.1);
            border: 1px solid var(--border-gold);
            border-radius: 12px; color: var(--gold);
        }

        .stock-price {
            font-size: 2.5rem; font-weight: 700; color: var(--text-primary);
            margin-bottom: 12px; transition: all 0.3s ease;
        }

        .stock-change {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 6px 12px; border-radius: 8px;
            font-weight: 600; margin-bottom: 20px;
        }
        .stock-change.positive { background: rgba(34, 197, 94, 0.1); color: var(--green); }
        .stock-change.negative { background: rgba(239, 68, 68, 0.1); color: var(--red); }

        .day-range {
            margin: 20px 0;
        }
        .day-range-label {
            font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 8px;
        }
        .range-bar {
            height: 6px; background: var(--border-color); border-radius: 3px;
            position: relative; overflow: hidden;
        }
        .range-fill {
            height: 100%; background: linear-gradient(90deg, var(--red), var(--orange), var(--green));
            border-radius: 3px; transition: width 0.5s ease;
        }
        .range-marker {
            width: 12px; height: 12px; background: var(--gold);
            border-radius: 50%; position: absolute; top: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 10px var(--gold-glow);
            transition: left 0.5s ease;
        }
        .range-values {
            display: flex; justify-content: space-between; margin-top: 6px;
            font-size: 0.75rem; color: var(--text-muted);
        }

        .stock-stats {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
            margin-top: 20px; padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        .stat-item {
            display: flex; flex-direction: column;
        }
        .stat-label {
            font-size: 0.75rem; color: var(--text-secondary);
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .stat-value {
            font-size: 1rem; font-weight: 600; color: var(--text-primary);
            margin-top: 4px;
        }

        /* Flash Animations */
        @keyframes flash-green {
            0%, 100% { background: transparent; }
            50% {
                background: rgba(74, 222, 128, 0.2);
                box-shadow: 0 0 20px rgba(74, 222, 128, 0.3);
            }
        }
        @keyframes flash-red {
            0%, 100% { background: transparent; }
            50% {
                background: rgba(239, 68, 68, 0.2);
                box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
            }
        }
        .flash-green { animation: flash-green 1s ease; }
        .flash-red { animation: flash-red 1s ease; }

        /* Charts Section */
        .charts-section {
            margin: 40px 0;
        }
        .charts-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
        }
        .chart-container {
            background: var(--bg-card); border: 1px solid var(--border-gold);
            border-radius: 16px; padding: 30px;
        }
        .chart-title {
            font-size: 1.2rem; font-weight: 600; color: var(--gold);
            margin-bottom: 20px;
        }

        /* Billionaire Insights */
        .insights-section {
            background: var(--bg-card); border: 1px solid var(--border-gold);
            border-radius: 16px; padding: 40px; margin: 40px 0;
        }
        .insights-title {
            font-size: 1.8rem; font-weight: 700; color: var(--gold);
            margin-bottom: 30px; text-align: center;
        }
        .insights-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }
        .insight-card {
            background: rgba(201, 162, 39, 0.05); border: 1px solid var(--border-gold);
            border-radius: 12px; padding: 20px;
        }
        .insight-card h4 {
            color: var(--gold); font-size: 1.1rem; margin-bottom: 10px;
        }
        .insight-card p {
            color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6;
        }

        /* Error/Offline Banners */
        .banner {
            padding: 12px 20px; border-radius: 8px; margin: 20px 0;
            display: none; align-items: center; gap: 12px;
        }
        .banner.show { display: flex; }
        .banner.error { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--red); color: var(--red); }
        .banner.offline { background: rgba(249, 115, 22, 0.1); border: 1px solid var(--orange); color: var(--orange); }

        /* Footer */
        .footer {
            background: var(--bg-card); border-top: 1px solid var(--border-gold);
            padding: 40px 20px; margin-top: 60px; text-align: center;
        }
        .footer-links {
            display: flex; justify-content: center; gap: 30px;
            margin: 20px 0; flex-wrap: wrap;
        }
        .footer-link {
            color: var(--gold); text-decoration: none;
            transition: color 0.3s ease;
        }
        .footer-link:hover { color: var(--gold-light); }
        .disclaimer {
            color: var(--text-muted); font-size: 0.85rem;
            max-width: 800px; margin: 20px auto;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-header { flex-direction: column; gap: 15px; }
            .header-controls { width: 100%; justify-content: center; }
            .summary-grid { grid-template-columns: repeat(2, 1fr); }
            .stock-grid { grid-template-columns: 1fr; }
            .charts-grid { grid-template-columns: 1fr; }
            .logo-text h1 { font-size: 1.2rem; }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"></div>
        <div class="loading-text">Loading Bro Billionaire Basket...</div>
    </div>

    <!-- Header -->
    <header class="dashboard-header">
        <div class="logo-section">
            <div class="logo-icon">üí∞</div>
            <div class="logo-text">
                <h1>Bro Billionaire Live Tracker</h1>
                <span>THE MAGNIFICENT 7 ‚Ä¢ LIVE DASHBOARD</span>
            </div>
        </div>
        <div class="header-controls">
            <div class="live-indicator">
                <div class="live-dot"></div>
                <span>LIVE</span>
            </div>
            <div class="market-status" id="marketStatus">Loading...</div>
            <a href="index.html" class="back-btn">‚Üê Home</a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Error/Offline Banners -->
        <div class="banner error" id="errorBanner">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="errorMessage">Live data temporarily unavailable. Showing cached prices.</span>
        </div>
        <div class="banner offline" id="offlineBanner">
            <i class="fas fa-wifi"></i>
            <span>You are offline. Data updates are paused.</span>
        </div>

        <!-- Summary Cards -->
        <section class="summary-grid" id="summaryGrid">
            <div class="summary-card">
                <h3>Total Market Cap</h3>
                <div class="value" id="totalMarketCap">Loading...</div>
            </div>
            <div class="summary-card">
                <h3>Portfolio Value</h3>
                <div class="value" id="portfolioValue">$10,000</div>
                <div class="change" id="portfolioChange">--</div>
            </div>
            <div class="summary-card">
                <h3>Avg Daily Change</h3>
                <div class="value change" id="avgChange">--</div>
            </div>
            <div class="summary-card">
                <h3>Top Performer</h3>
                <div class="value" id="topPerformer">--</div>
                <div class="change positive" id="topPerformerChange">--</div>
            </div>
        </section>

        <!-- Stock Cards Grid -->
        <section class="stock-grid" id="stockGrid">
            <!-- Stock cards will be dynamically inserted here -->
        </section>

        <!-- Charts Section -->
        <section class="charts-section">
            <div class="charts-grid">
                <div class="chart-container">
                    <h3 class="chart-title">Daily Performance</h3>
                    <canvas id="performanceChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3 class="chart-title">Market Cap Distribution</h3>
                    <canvas id="marketCapChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Billionaire Insights -->
        <section class="insights-section">
            <h2 class="insights-title">The Magnificent 7: What Makes Them Bro Billionaire Stocks</h2>
            <div class="insights-grid">
                <div class="insight-card">
                    <h4>üöÄ NVIDIA - The AI King (EXTREME Conviction)</h4>
                    <p>Jensen Huang's 97% concentrated bet dominates AI chip supremacy. +2,400% returns in 5 years. CUDA software moat makes NVDA the indispensable backbone of every AI model training operation globally.</p>
                </div>
                <div class="insight-card">
                    <h4>‚ö° TESLA - EV + AI Robotics (EXTREME Conviction)</h4>
                    <p>Elon Musk keeps 76% of wealth in TSLA. +1,200% in 5 years. Not just EVs - Full Self-Driving software, Optimus robots, and energy storage. The ultimate billionaire momentum play.</p>
                </div>
                <div class="insight-card">
                    <h4>üîÆ PALANTIR - AI Software Platform (VERY HIGH Conviction)</h4>
                    <p>Peter Thiel's secretive data analytics empire. +950% in 3 years. Government contracts and enterprise AI integration make PLTR the insider's choice for AI deployment at scale.</p>
                </div>
                <div class="insight-card">
                    <h4>üíº MICROSOFT - Enterprise AI Giant (HIGH Conviction)</h4>
                    <p>Bill Gates' legacy play with +280% in 5 years. Azure cloud + OpenAI integration through Copilot AI makes MSFT the safe mega-cap AI exposure for institutional billionaires.</p>
                </div>
                <div class="insight-card">
                    <h4>üì± META - Social + AI (HIGH Conviction)</h4>
                    <p>Zuckerberg maintains 96% concentration. 3.2B users across Facebook, Instagram, WhatsApp. AI-powered ad targeting generates massive cash flow. +315% in 5 years.</p>
                </div>
                <div class="insight-card">
                    <h4>üì¶ AMAZON - Cloud + Everything (MODERATE-HIGH Conviction)</h4>
                    <p>Bezos' 87% allocation. AWS dominates with 32% cloud market share. E-commerce monopoly + Prime ecosystem + advertising growth. The diversified billionaire staple. +190% in 5 years.</p>
                </div>
                <div class="insight-card">
                    <h4>üçé APPLE - Ecosystem King (MODERATE Conviction)</h4>
                    <p>Buffett's $150B+ megaposition. 2.2B active devices creating the ultimate moat. Services revenue hit $85B. Vision Pro entering spatial computing. +320% in 5 years.</p>
                </div>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <a href="article-bro-billionaire-stocks-2026.html" class="back-btn" style="display: inline-block; text-decoration: none;">
                    üìä Read Full Bro Billionaire Stocks Analysis
                </a>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-links">
            <a href="article-bro-billionaire-stocks-2026.html" class="footer-link">Bro Billionaire Stocks Guide</a>
            <a href="article-celebrity-portfolios-2026.html" class="footer-link">Celebrity Portfolios</a>
            <a href="articles.html" class="footer-link">All Articles</a>
            <a href="index.html" class="footer-link">Home</a>
        </div>
        <p class="disclaimer">
            Data provided for informational purposes only. Stock prices update every 8 seconds during market hours via Yahoo Finance.
            The Bro Billionaire Basket tracks The Magnificent 7: NVDA, TSLA, PLTR, MSFT, META, AMZN, AAPL.
            Not financial advice. Past performance doesn't guarantee future results.
            These are high-risk, high-reward momentum stocks with extreme volatility.
        </p>
        <p style="color: var(--text-muted); font-size: 0.8rem; margin-top: 20px;">
            ¬© 2026 BroBillionaire. Premium Stock Intelligence.
        </p>
    </footer>

    <script>
        // =========================
        // CONFIGURATION
        // =========================
        // THE OFFICIAL BRO BILLIONAIRE BASKET - THE MAGNIFICENT SEVEN
        const BASKET_STOCKS = [
            { symbol: 'NVDA', name: 'NVIDIA Corp.', billionaire: 'Jensen Huang 97%', allocation: 0.20, estMarketCap: 2900000000000, convictionLevel: 'EXTREME', category: 'AI King' },
            { symbol: 'TSLA', name: 'Tesla Inc.', billionaire: 'Elon Musk 76%', allocation: 0.18, estMarketCap: 1100000000000, convictionLevel: 'EXTREME', category: 'EV + AI Robotics' },
            { symbol: 'PLTR', name: 'Palantir Technologies', billionaire: 'Peter Thiel', allocation: 0.10, estMarketCap: 180000000000, convictionLevel: 'VERY HIGH', category: 'AI Software' },
            { symbol: 'MSFT', name: 'Microsoft Corp.', billionaire: 'Bill Gates 30%', allocation: 0.18, estMarketCap: 3100000000000, convictionLevel: 'HIGH', category: 'Enterprise AI Giant' },
            { symbol: 'META', name: 'Meta Platforms', billionaire: 'Zuckerberg 96%', allocation: 0.12, estMarketCap: 1500000000000, convictionLevel: 'HIGH', category: 'Social + AI' },
            { symbol: 'AMZN', name: 'Amazon.com', billionaire: 'Bezos 87%', allocation: 0.12, estMarketCap: 2200000000000, convictionLevel: 'MODERATE-HIGH', category: 'Cloud + Everything' },
            { symbol: 'AAPL', name: 'Apple Inc.', billionaire: 'Buffett $150B+', allocation: 0.10, estMarketCap: 3500000000000, convictionLevel: 'MODERATE', category: 'Ecosystem King' }
        ];

        // State
        const state = {
            stocks: [],
            lastUpdate: null,
            isLive: true,
            pollInterval: 8000,
            errorCount: 0,
            charts: {}
        };

        // =========================
        // MARKET HOURS DETECTION
        // =========================
        function isMarketOpen() {
            const now = new Date();
            const etTime = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
            const hour = etTime.getHours();
            const day = etTime.getDay();
            const minutes = etTime.getMinutes();

            if (day === 0 || day === 6) return false; // Weekend
            if (hour < 9 || (hour === 9 && minutes < 30)) return false; // Before 9:30 AM
            if (hour >= 16) return false; // After 4 PM
            return true;
        }

        function updateMarketStatus() {
            const marketOpen = isMarketOpen();
            const statusEl = document.getElementById('marketStatus');
            const oldInterval = state.pollInterval;

            if (marketOpen) {
                statusEl.textContent = 'Market OPEN';
                statusEl.style.color = 'var(--green)';
                statusEl.style.borderColor = 'var(--green)';
                state.pollInterval = 8000;
            } else {
                statusEl.textContent = 'Market CLOSED';
                statusEl.style.color = 'var(--text-muted)';
                statusEl.style.borderColor = 'var(--border-color)';
                state.pollInterval = 30000;
            }

            // Restart polling if interval changed
            if (oldInterval !== state.pollInterval && state.isLive) {
                restartPolling();
            }
        }

        // =========================
        // DATA FETCHING
        // =========================
        async function fetchStockData() {
            const symbols = BASKET_STOCKS.map(s => s.symbol).join(',');
            const response = await fetch(`/api/stock/quotes?symbols=${symbols}`);

            if (!response.ok) {
                throw new Error('Failed to fetch stock data');
            }

            const data = await response.json();
            return data;
        }

        async function refreshData() {
            try {
                const data = await fetchStockData();

                // Merge with basket config
                state.stocks = data.quotes.map(quote => {
                    const config = BASKET_STOCKS.find(s => s.symbol === quote.symbol);
                    return { ...quote, ...config };
                });

                state.lastUpdate = new Date();
                state.errorCount = 0;

                // Cache data
                localStorage.setItem('bro-basket-cache', JSON.stringify({
                    stocks: state.stocks,
                    timestamp: state.lastUpdate.toISOString()
                }));

                // Hide error banners
                document.getElementById('errorBanner').classList.remove('show');

                // Update UI
                renderStockCards();
                updateSummaryCards();
                updateCharts();

            } catch (error) {
                console.error('Error fetching data:', error);
                state.errorCount++;

                if (state.errorCount >= 3) {
                    state.pollInterval = 60000; // Backoff to 60s
                }

                // Try loading from cache
                const cached = localStorage.getItem('bro-basket-cache');
                if (cached) {
                    const { stocks } = JSON.parse(cached);
                    state.stocks = stocks;
                    renderStockCards();
                    updateSummaryCards();
                    updateCharts();
                }

                // Show error banner
                document.getElementById('errorBanner').classList.add('show');
            }
        }

        // =========================
        // UI RENDERING
        // =========================
        function formatVolume(num) {
            if (num >= 1e9) return `${(num / 1e9).toFixed(2)}B`;
            if (num >= 1e6) return `${(num / 1e6).toFixed(2)}M`;
            if (num >= 1e3) return `${(num / 1e3).toFixed(2)}K`;
            return num.toString();
        }

        function formatMarketCap(num) {
            if (num >= 1e12) return `$${(num / 1e12).toFixed(2)}T`;
            if (num >= 1e9) return `$${(num / 1e9).toFixed(2)}B`;
            if (num >= 1e6) return `$${(num / 1e6).toFixed(2)}M`;
            return `$${num.toFixed(2)}`;
        }

        function renderStockCards() {
            const grid = document.getElementById('stockGrid');

            grid.innerHTML = state.stocks.map(stock => {
                const changePercent = stock.changePercent || 0;
                const change = stock.change || 0;
                const isPositive = change >= 0;
                const rangePercent = ((stock.price - stock.dayLow) / (stock.dayHigh - stock.dayLow)) * 100;
                const marketCap = stock.marketCap || stock.estMarketCap || 0;
                const volume = stock.volume || 0;

                return `
                    <div class="stock-card" data-symbol="${stock.symbol}">
                        <div class="stock-header">
                            <div>
                                <div class="stock-symbol">${stock.symbol}</div>
                                <div class="stock-name">${stock.name}</div>
                            </div>
                            <div class="billionaire-badge">${stock.billionaire}</div>
                        </div>

                        <div class="stock-price" id="price-${stock.symbol}">
                            $${stock.price.toFixed(2)}
                        </div>

                        <div class="stock-change ${isPositive ? 'positive' : 'negative'}">
                            ${isPositive ? '‚Üë' : '‚Üì'} $${Math.abs(change).toFixed(2)} (${changePercent.toFixed(2)}%)
                        </div>

                        <div class="day-range">
                            <div class="day-range-label">Day Range</div>
                            <div class="range-bar">
                                <div class="range-fill" style="width: ${rangePercent}%"></div>
                                <div class="range-marker" style="left: ${rangePercent}%"></div>
                            </div>
                            <div class="range-values">
                                <span>$${stock.dayLow.toFixed(2)}</span>
                                <span>$${stock.dayHigh.toFixed(2)}</span>
                            </div>
                        </div>

                        <div class="stock-stats">
                            <div class="stat-item">
                                <div class="stat-label">Volume</div>
                                <div class="stat-value">${formatVolume(volume)}</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Market Cap</div>
                                <div class="stat-value">${formatMarketCap(marketCap)}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateSummaryCards() {
            if (state.stocks.length === 0) return;

            // Calculate total market cap
            const totalMarketCap = state.stocks.reduce((sum, stock) => {
                const marketCap = stock.marketCap || stock.estMarketCap || 0;
                return sum + marketCap;
            }, 0);

            // Format market cap
            const formatMarketCap = (value) => {
                if (value >= 1e12) return `$${(value / 1e12).toFixed(2)}T`;
                if (value >= 1e9) return `$${(value / 1e9).toFixed(2)}B`;
                if (value >= 1e6) return `$${(value / 1e6).toFixed(2)}M`;
                return `$${value.toFixed(2)}`;
            };

            document.getElementById('totalMarketCap').textContent = formatMarketCap(totalMarketCap);

            // Calculate total portfolio value from $10k investment
            let portfolioValue = 0;
            state.stocks.forEach(stock => {
                const invested = 10000 * stock.allocation;
                const shares = invested / stock.previousClose;
                const currentValue = shares * stock.price;
                portfolioValue += currentValue;
            });

            const portfolioChange = portfolioValue - 10000;
            const portfolioChangePercent = (portfolioChange / 10000) * 100;

            // Average change
            const avgChange = state.stocks.reduce((sum, s) => sum + s.changePercent, 0) / state.stocks.length;

            // Top performer
            const topPerformer = state.stocks.reduce((max, s) =>
                s.changePercent > max.changePercent ? s : max
            );

            // Update UI
            document.getElementById('portfolioValue').textContent = `$${portfolioValue.toFixed(2)}`;

            const portfolioChangeEl = document.getElementById('portfolioChange');
            portfolioChangeEl.textContent = `${portfolioChange >= 0 ? '+' : ''}$${portfolioChange.toFixed(2)} (${portfolioChangePercent.toFixed(2)}%)`;
            portfolioChangeEl.className = portfolioChange >= 0 ? 'change positive' : 'change negative';

            const avgChangeEl = document.getElementById('avgChange');
            avgChangeEl.textContent = `${avgChange >= 0 ? '+' : ''}${avgChange.toFixed(2)}%`;
            avgChangeEl.className = avgChange >= 0 ? 'value change positive' : 'value change negative';

            document.getElementById('topPerformer').textContent = topPerformer.symbol;
            document.getElementById('topPerformerChange').textContent = `+${topPerformer.changePercent.toFixed(2)}%`;
        }

        // =========================
        // CHARTS
        // =========================
        function updateCharts() {
            if (state.stocks.length === 0) return;

            // Performance Chart
            if (state.charts.performance) {
                state.charts.performance.destroy();
            }

            const perfCtx = document.getElementById('performanceChart').getContext('2d');
            state.charts.performance = new Chart(perfCtx, {
                type: 'bar',
                data: {
                    labels: state.stocks.map(s => s.symbol),
                    datasets: [{
                        label: 'Daily Change %',
                        data: state.stocks.map(s => s.changePercent),
                        backgroundColor: state.stocks.map(s =>
                            s.change >= 0 ? 'rgba(74,222,128,0.8)' : 'rgba(239,68,68,0.8)'
                        ),
                        borderColor: state.stocks.map(s =>
                            s.change >= 0 ? 'rgba(74,222,128,1)' : 'rgba(239,68,68,1)'
                        ),
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: '#1a1a1a',
                            titleColor: '#C9A227',
                            bodyColor: '#ffffff',
                            borderColor: '#C9A227',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: (ctx) => `${ctx.parsed.y.toFixed(2)}%`
                            }
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: '#222222' },
                            ticks: { color: '#a0a0a0' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#a0a0a0' }
                        }
                    }
                }
            });

            // Market Cap Chart (mock data for visualization)
            if (state.charts.marketCap) {
                state.charts.marketCap.destroy();
            }

            const mcCtx = document.getElementById('marketCapChart').getContext('2d');
            state.charts.marketCap = new Chart(mcCtx, {
                type: 'doughnut',
                data: {
                    labels: state.stocks.map(s => s.symbol),
                    datasets: [{
                        data: state.stocks.map(s => s.allocation * 100),
                        backgroundColor: [
                            '#C9A227', '#E8D5A3', '#A68B1E', '#D4AF37',
                            '#4ade80', '#3b82f6', '#8b5cf6', '#f59e0b',
                            '#ef4444', '#10b981', '#6366f1'
                        ],
                        borderColor: '#0d0d0d',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: { color: '#a0a0a0', padding: 15 }
                        },
                        tooltip: {
                            backgroundColor: '#1a1a1a',
                            titleColor: '#C9A227',
                            bodyColor: '#ffffff',
                            borderColor: '#C9A227',
                            borderWidth: 1,
                            callbacks: {
                                label: (ctx) => `${ctx.label}: ${ctx.parsed.toFixed(1)}%`
                            }
                        }
                    }
                }
            });
        }

        // =========================
        // POLLING SYSTEM
        // =========================
        let pollTimer;

        function startPolling() {
            // Clear any existing timer
            if (pollTimer) {
                clearInterval(pollTimer);
            }

            state.isLive = true;

            // Start polling with current interval
            pollTimer = setInterval(() => {
                refreshData();
                updateMarketStatus();
            }, state.pollInterval);

            console.log(`Polling started: ${state.pollInterval}ms interval`);
        }

        function stopPolling() {
            state.isLive = false;
            if (pollTimer) {
                clearInterval(pollTimer);
            }
            console.log('Polling stopped');
        }

        function restartPolling() {
            stopPolling();
            startPolling();
        }

        // =========================
        // OFFLINE DETECTION
        // =========================
        window.addEventListener('offline', () => {
            document.getElementById('offlineBanner').classList.add('show');
            stopPolling();
        });

        window.addEventListener('online', () => {
            document.getElementById('offlineBanner').classList.remove('show');
            refreshData();
            startPolling();
        });

        // =========================
        // INITIALIZATION
        // =========================
        async function init() {
            updateMarketStatus();
            await refreshData();
            startPolling();

            // Hide loading overlay
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // Start the dashboard
        init();
    </script>
</body>
</html>
