<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N0Y2LBMRSW"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-N0Y2LBMRSW');
    </script>
    <meta charset="UTF-8">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="96x96" href="favicon-96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    
    <!-- Primary Meta Tags -->
    <title>FREE Crypto Correlation Heatmap 2026 - Multi-Asset Correlations | BroBillionaire</title>
    <meta name="title" content="FREE Crypto Correlation Heatmap - Live Asset Correlations 2026">
    <meta name="description" content="üî• FREE Correlation Heatmap - See which cryptos move together! Live correlation matrix for Bitcoin, Ethereum, altcoins. Perfect for portfolio diversification & risk management!">
    <meta name="keywords" content="crypto correlation, correlation heatmap, bitcoin correlation, ethereum correlation, portfolio diversification, crypto correlation matrix, altcoin correlation, asset correlation, crypto risk management, btc eth correlation, trading correlations">
    <meta name="author" content="BroBillionaire">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <link rel="canonical" href="https://brobillionaire.com/tool-correlation-heatmap.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://brobillionaire.com/tool-correlation-heatmap.html">
    <meta property="og:title" content="FREE Crypto Correlation Heatmap 2026">
    <meta property="og:description" content="See which cryptos move together! Live correlation matrix for portfolio diversification.">
    <meta property="og:image" content="https://brobillionaire.com/og-image.jpg">
    <meta property="og:site_name" content="BroBillionaire">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://brobillionaire.com/tool-correlation-heatmap.html">
    <meta name="twitter:title" content="FREE Crypto Correlation Heatmap">
    <meta name="twitter:description" content="Live crypto correlations for smarter portfolio diversification!">
    <meta name="twitter:image" content="https://brobillionaire.com/og-image.jpg">
    
    <!-- WebApplication Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Crypto Correlation Heatmap - BroBillionaire",
        "description": "Free cryptocurrency correlation heatmap showing live correlations between Bitcoin, Ethereum and top altcoins for portfolio diversification",
        "url": "https://brobillionaire.com/tool-correlation-heatmap.html",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "INR"
        }
    }
    </script>

    <!-- BreadcrumbList Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {"@type": "ListItem", "position": 1, "name": "Home", "item": "https://brobillionaire.com/"},
            {"@type": "ListItem", "position": 2, "name": "Tools", "item": "https://brobillionaire.com/tools.html"},
            {"@type": "ListItem", "position": 3, "name": "Correlation Heatmap"}
        ]
    }
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%); color: #e0e0e0; line-height: 1.6; min-height: 100vh; }
        .container { max-width: 1400px; margin: 0 auto; padding: 1.5rem; }
        
        .premium-badge { display: inline-flex; align-items: center; gap: 0.5rem; background: linear-gradient(135deg, #C9A227 0%, #ffd700 100%); color: #000; padding: 0.5rem 1rem; border-radius: 50px; font-weight: 700; font-size: 0.85rem; margin-bottom: 1rem; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        
        .header { text-align: center; padding: 2rem 1.5rem; background: linear-gradient(135deg, #1e1e2f 0%, #2a2a4a 100%); border-radius: 20px; margin-bottom: 1.5rem; border: 2px solid #C9A227; }
        .header h1 { font-size: 2.5rem; background: linear-gradient(135deg, #C9A227 0%, #ffd700 50%, #C9A227 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 0.5rem; }
        .header p { font-size: 1.1rem; color: #a0a0b0; }
        
        .live-badge { display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.85rem; font-weight: 600; margin-top: 0.5rem; }
        .live-dot { width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: livePulse 1.5s infinite; }
        @keyframes livePulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        
        /* Controls */
        .controls { display: flex; gap: 1rem; flex-wrap: wrap; justify-content: center; margin-bottom: 1.5rem; }
        .control-group { display: flex; align-items: center; gap: 0.5rem; }
        .control-label { color: #888; font-size: 0.9rem; }
        .control-select { background: #1e1e2f; border: 1px solid #333; color: #fff; padding: 0.6rem 1rem; border-radius: 10px; cursor: pointer; font-size: 0.9rem; }
        .control-select:focus { border-color: #C9A227; outline: none; }
        
        /* Legend */
        .legend { display: flex; justify-content: center; align-items: center; gap: 0.5rem; margin-bottom: 1.5rem; padding: 1rem; background: #1e1e2f; border-radius: 12px; }
        .legend-gradient { width: 200px; height: 20px; background: linear-gradient(90deg, #ef4444, #fbbf24, #22c55e); border-radius: 5px; }
        .legend-labels { display: flex; justify-content: space-between; width: 200px; font-size: 0.8rem; color: #888; margin-top: 0.3rem; }
        .legend-text { color: #888; font-size: 0.85rem; margin: 0 1rem; }
        
        /* Heatmap Container */
        .heatmap-wrapper { overflow-x: auto; margin-bottom: 1.5rem; }
        .heatmap-container { background: #1e1e2f; border-radius: 20px; padding: 1.5rem; border: 1px solid #333; min-width: 700px; }
        
        /* Heatmap Grid */
        .heatmap-grid { display: grid; gap: 3px; }
        .heatmap-row { display: contents; }
        
        .heatmap-header { background: transparent; padding: 0.5rem; font-weight: 600; font-size: 0.75rem; color: #C9A227; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 0.2rem; }
        .header-icon { font-size: 1.2rem; }
        
        .heatmap-label { background: transparent; padding: 0.5rem; font-weight: 600; font-size: 0.75rem; color: #C9A227; display: flex; align-items: center; gap: 0.5rem; justify-content: flex-end; }
        .label-icon { font-size: 1.2rem; }
        
        .heatmap-cell { padding: 0.8rem 0.5rem; text-align: center; font-weight: 700; font-size: 0.85rem; border-radius: 8px; cursor: pointer; transition: all 0.3s; position: relative; }
        .heatmap-cell:hover { transform: scale(1.1); z-index: 10; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        .heatmap-cell.diagonal { background: #333 !important; color: #666 !important; }
        
        /* Tooltip */
        .tooltip { position: fixed; background: #2a2a4a; border: 1px solid #C9A227; border-radius: 10px; padding: 1rem; z-index: 1000; pointer-events: none; opacity: 0; transition: opacity 0.2s; max-width: 280px; }
        .tooltip.visible { opacity: 1; }
        .tooltip-header { font-weight: 700; color: #C9A227; margin-bottom: 0.5rem; font-size: 0.95rem; }
        .tooltip-value { font-size: 1.5rem; font-weight: 800; margin-bottom: 0.5rem; }
        .tooltip-meaning { font-size: 0.85rem; color: #a0a0b0; line-height: 1.5; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-card { background: linear-gradient(135deg, #1e1e2f 0%, #16161f 100%); border-radius: 15px; padding: 1.5rem; border: 1px solid #333; }
        .stat-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .stat-card-title { color: #C9A227; font-size: 1rem; font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
        .stat-card-badge { background: rgba(201, 162, 39, 0.15); color: #C9A227; padding: 0.2rem 0.6rem; border-radius: 10px; font-size: 0.75rem; font-weight: 600; }
        
        .correlation-pair { display: flex; align-items: center; gap: 0.8rem; padding: 0.8rem; background: #16161f; border-radius: 10px; margin-bottom: 0.5rem; }
        .pair-icons { display: flex; gap: -0.5rem; }
        .pair-icon { width: 28px; height: 28px; border-radius: 50%; border: 2px solid #1e1e2f; }
        .pair-names { flex: 1; font-weight: 600; font-size: 0.9rem; }
        .pair-value { font-weight: 800; font-size: 1.1rem; }
        .pair-value.high-positive { color: #22c55e; }
        .pair-value.low-positive { color: #84cc16; }
        .pair-value.neutral { color: #fbbf24; }
        .pair-value.negative { color: #ef4444; }
        
        /* Diversification Score */
        .diversification-card { background: linear-gradient(135deg, #1e1e2f 0%, #2a2a4a 100%); border: 2px solid #C9A227; border-radius: 20px; padding: 2rem; text-align: center; margin-bottom: 1.5rem; }
        .diversification-score { font-size: 4rem; font-weight: 800; background: linear-gradient(135deg, #C9A227, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .diversification-label { color: #888; font-size: 1rem; margin-bottom: 0.5rem; }
        .diversification-grade { font-size: 1.5rem; font-weight: 700; margin-top: 0.5rem; }
        .grade-excellent { color: #22c55e; }
        .grade-good { color: #84cc16; }
        .grade-fair { color: #fbbf24; }
        .grade-poor { color: #ef4444; }
        
        .score-bar { height: 12px; background: #2a2a4a; border-radius: 10px; overflow: hidden; margin: 1rem auto; max-width: 300px; }
        .score-fill { height: 100%; border-radius: 10px; transition: width 1s ease-out; }
        
        /* AI Analysis */
        .ai-analysis { background: linear-gradient(135deg, #1e1e2f 0%, #2a2a4a 100%); border-radius: 15px; padding: 1.5rem; border: 2px solid #C9A227; position: relative; }
        .ai-analysis::before { content: 'üß†'; position: absolute; top: 1rem; right: 1rem; font-size: 2.5rem; opacity: 0.15; }
        .ai-title { font-size: 1.2rem; color: #C9A227; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .ai-content { color: #d0d0e0; font-size: 1rem; line-height: 1.8; }
        .ai-recommendations { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .recommendation { background: rgba(201, 162, 39, 0.1); border-radius: 10px; padding: 1rem; border: 1px solid rgba(201, 162, 39, 0.3); }
        .recommendation-title { font-weight: 700; color: #C9A227; font-size: 0.95rem; margin-bottom: 0.3rem; }
        .recommendation-text { font-size: 0.85rem; color: #a0a0b0; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .heatmap-cell { padding: 0.5rem 0.3rem; font-size: 0.7rem; }
            .heatmap-header, .heatmap-label { font-size: 0.65rem; }
            .diversification-score { font-size: 3rem; }
        }
        
        /* Loading */
        .skeleton { background: linear-gradient(90deg, #2a2a4a 0%, #3a3a5a 50%, #2a2a4a 100%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 8px; }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="premium-badge">‚ö° LIVE CORRELATION DATA - 100% FREE</div>
            <h1>üî• Crypto Correlation Heatmap</h1>
            <p>See Which Assets Move Together ‚Ä¢ Smart Diversification ‚Ä¢ Risk Management</p>
            <div class="live-badge">
                <span class="live-dot"></span>
                LIVE - Based on 30-day price data
            </div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="control-group">
                <span class="control-label">Timeframe:</span>
                <select class="control-select" id="timeframe" onchange="updateCorrelations()">
                    <option value="7">7 Days</option>
                    <option value="30" selected>30 Days</option>
                    <option value="90">90 Days</option>
                </select>
            </div>
            <div class="control-group">
                <span class="control-label">Assets:</span>
                <select class="control-select" id="assetCount" onchange="updateCorrelations()">
                    <option value="8">Top 8</option>
                    <option value="10" selected>Top 10</option>
                    <option value="12">Top 12</option>
                </select>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <span class="legend-text">Negative Correlation</span>
            <div>
                <div class="legend-gradient"></div>
                <div class="legend-labels">
                    <span>-1.0</span>
                    <span>0</span>
                    <span>+1.0</span>
                </div>
            </div>
            <span class="legend-text">Positive Correlation</span>
        </div>

        <!-- Diversification Score -->
        <div class="diversification-card">
            <div class="diversification-label">Portfolio Diversification Score</div>
            <div class="diversification-score" id="diversificationScore">--</div>
            <div class="score-bar">
                <div class="score-fill" id="scoreFill" style="width: 0%; background: linear-gradient(90deg, #ef4444, #fbbf24, #22c55e);"></div>
            </div>
            <div class="diversification-grade" id="diversificationGrade">Calculating...</div>
        </div>

        <!-- Heatmap -->
        <div class="heatmap-wrapper">
            <div class="heatmap-container">
                <div class="heatmap-grid" id="heatmapGrid">
                    <div class="skeleton" style="height: 400px; grid-column: span 11;"></div>
                </div>
            </div>
        </div>

        <!-- Tooltip -->
        <div class="tooltip" id="tooltip">
            <div class="tooltip-header" id="tooltipHeader">BTC / ETH</div>
            <div class="tooltip-value" id="tooltipValue">0.85</div>
            <div class="tooltip-meaning" id="tooltipMeaning">High positive correlation</div>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">üîó Highest Correlations</span>
                    <span class="stat-card-badge">Move Together</span>
                </div>
                <div id="highestCorrelations">
                    <div class="skeleton" style="height: 50px; margin-bottom: 0.5rem;"></div>
                    <div class="skeleton" style="height: 50px; margin-bottom: 0.5rem;"></div>
                    <div class="skeleton" style="height: 50px;"></div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">üõ°Ô∏è Lowest Correlations</span>
                    <span class="stat-card-badge">Best for Hedging</span>
                </div>
                <div id="lowestCorrelations">
                    <div class="skeleton" style="height: 50px; margin-bottom: 0.5rem;"></div>
                    <div class="skeleton" style="height: 50px; margin-bottom: 0.5rem;"></div>
                    <div class="skeleton" style="height: 50px;"></div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-card-header">
                    <span class="stat-card-title">üìä Correlation Stats</span>
                    <span class="stat-card-badge">Summary</span>
                </div>
                <div id="correlationStats">
                    <div class="correlation-pair">
                        <div class="pair-names">Average Correlation</div>
                        <div class="pair-value neutral" id="avgCorrelation">--</div>
                    </div>
                    <div class="correlation-pair">
                        <div class="pair-names">Median Correlation</div>
                        <div class="pair-value neutral" id="medianCorrelation">--</div>
                    </div>
                    <div class="correlation-pair">
                        <div class="pair-names">BTC Dominance Impact</div>
                        <div class="pair-value high-positive" id="btcImpact">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Analysis -->
        <div class="ai-analysis">
            <div class="ai-title">üß† AI Diversification Analysis</div>
            <div class="ai-content" id="aiAnalysis">
                Analyzing correlation patterns and diversification opportunities...
            </div>
            <div class="ai-recommendations" id="aiRecommendations">
                <div class="skeleton" style="height: 80px;"></div>
                <div class="skeleton" style="height: 80px;"></div>
                <div class="skeleton" style="height: 80px;"></div>
            </div>
        </div>
    </div>

    <script>
        // API
        const COINGECKO_API = 'https://api.coingecko.com/api/v3';
        
        // Asset data with icons
        const cryptoAssets = [
            { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin', icon: '‚Çø' },
            { id: 'ethereum', symbol: 'ETH', name: 'Ethereum', icon: 'Œû' },
            { id: 'binancecoin', symbol: 'BNB', name: 'BNB', icon: 'üî∂' },
            { id: 'solana', symbol: 'SOL', name: 'Solana', icon: '‚óé' },
            { id: 'ripple', symbol: 'XRP', name: 'XRP', icon: '‚úï' },
            { id: 'cardano', symbol: 'ADA', name: 'Cardano', icon: '‚Ç≥' },
            { id: 'dogecoin', symbol: 'DOGE', name: 'Dogecoin', icon: 'üêï' },
            { id: 'polkadot', symbol: 'DOT', name: 'Polkadot', icon: '‚¨°' },
            { id: 'avalanche-2', symbol: 'AVAX', name: 'Avalanche', icon: 'üî∫' },
            { id: 'chainlink', symbol: 'LINK', name: 'Chainlink', icon: '‚¨°' },
            { id: 'polygon', symbol: 'MATIC', name: 'Polygon', icon: '‚¨°' },
            { id: 'litecoin', symbol: 'LTC', name: 'Litecoin', icon: '≈Å' }
        ];

        let correlationMatrix = [];
        let priceData = {};
        let currentAssets = [];

        // Fetch price history
        async function fetchPriceHistory() {
            const days = parseInt(document.getElementById('timeframe').value);
            const assetCount = parseInt(document.getElementById('assetCount').value);
            currentAssets = cryptoAssets.slice(0, assetCount);
            
            const ids = currentAssets.map(a => a.id).join(',');
            
            try {
                // Fetch market data
                const response = await fetch(`${COINGECKO_API}/coins/markets?vs_currency=usd&ids=${ids}&order=market_cap_desc&sparkline=true&price_change_percentage=24h,7d,30d`);
                const data = await response.json();
                
                // Use sparkline data for correlations
                data.forEach(coin => {
                    priceData[coin.id] = coin.sparkline_in_7d?.price || [];
                });
                
                // Calculate correlations
                calculateCorrelations();
                
            } catch (error) {
                console.error('Error fetching data:', error);
                // Use simulated data on error
                generateSimulatedCorrelations();
            }
        }

        // Calculate Pearson correlation coefficient
        function calculatePearsonCorrelation(x, y) {
            const n = Math.min(x.length, y.length);
            if (n < 2) return 0;
            
            const xSlice = x.slice(-n);
            const ySlice = y.slice(-n);
            
            const sumX = xSlice.reduce((a, b) => a + b, 0);
            const sumY = ySlice.reduce((a, b) => a + b, 0);
            const sumXY = xSlice.reduce((total, xi, i) => total + xi * ySlice[i], 0);
            const sumX2 = xSlice.reduce((total, xi) => total + xi * xi, 0);
            const sumY2 = ySlice.reduce((total, yi) => total + yi * yi, 0);
            
            const numerator = n * sumXY - sumX * sumY;
            const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
            
            if (denominator === 0) return 0;
            return numerator / denominator;
        }

        // Calculate all correlations
        function calculateCorrelations() {
            correlationMatrix = [];
            
            for (let i = 0; i < currentAssets.length; i++) {
                const row = [];
                for (let j = 0; j < currentAssets.length; j++) {
                    if (i === j) {
                        row.push(1);
                    } else {
                        const prices1 = priceData[currentAssets[i].id] || [];
                        const prices2 = priceData[currentAssets[j].id] || [];
                        
                        if (prices1.length > 0 && prices2.length > 0) {
                            const corr = calculatePearsonCorrelation(prices1, prices2);
                            row.push(Math.round(corr * 100) / 100);
                        } else {
                            // Simulated correlation based on asset type
                            row.push(getSimulatedCorrelation(currentAssets[i], currentAssets[j]));
                        }
                    }
                }
                correlationMatrix.push(row);
            }
            
            renderHeatmap();
            renderStats();
            generateAIAnalysis();
        }

        // Simulated correlations (used when API data is limited)
        function getSimulatedCorrelation(asset1, asset2) {
            // BTC correlations
            const btcCorrelations = {
                'ETH': 0.85, 'BNB': 0.78, 'SOL': 0.82, 'XRP': 0.65, 'ADA': 0.75,
                'DOGE': 0.58, 'DOT': 0.72, 'AVAX': 0.79, 'LINK': 0.70, 'MATIC': 0.76, 'LTC': 0.88
            };
            
            if (asset1.symbol === 'BTC') return btcCorrelations[asset2.symbol] || 0.7;
            if (asset2.symbol === 'BTC') return btcCorrelations[asset1.symbol] || 0.7;
            
            // Simulate based on sector similarity
            const layer1s = ['ETH', 'SOL', 'ADA', 'AVAX', 'DOT'];
            const both = layer1s.includes(asset1.symbol) && layer1s.includes(asset2.symbol);
            
            return both ? 0.7 + Math.random() * 0.15 : 0.5 + Math.random() * 0.3;
        }

        function generateSimulatedCorrelations() {
            const assetCount = parseInt(document.getElementById('assetCount').value);
            currentAssets = cryptoAssets.slice(0, assetCount);
            
            correlationMatrix = [];
            for (let i = 0; i < currentAssets.length; i++) {
                const row = [];
                for (let j = 0; j < currentAssets.length; j++) {
                    if (i === j) {
                        row.push(1);
                    } else if (j < i) {
                        row.push(correlationMatrix[j][i]); // Symmetric
                    } else {
                        row.push(getSimulatedCorrelation(currentAssets[i], currentAssets[j]));
                    }
                }
                correlationMatrix.push(row);
            }
            
            renderHeatmap();
            renderStats();
            generateAIAnalysis();
        }

        // Get color for correlation value
        function getCorrelationColor(value) {
            if (value >= 0.7) return { bg: '#166534', text: '#fff' };
            if (value >= 0.4) return { bg: '#65a30d', text: '#fff' };
            if (value >= 0.1) return { bg: '#ca8a04', text: '#000' };
            if (value >= -0.1) return { bg: '#d97706', text: '#000' };
            if (value >= -0.4) return { bg: '#ea580c', text: '#fff' };
            return { bg: '#dc2626', text: '#fff' };
        }

        // Render heatmap
        function renderHeatmap() {
            const grid = document.getElementById('heatmapGrid');
            const n = currentAssets.length;
            
            grid.style.gridTemplateColumns = `80px repeat(${n}, 1fr)`;
            
            let html = '<div class="heatmap-header"></div>';
            
            // Header row
            currentAssets.forEach(asset => {
                html += `<div class="heatmap-header"><span class="header-icon">${asset.icon}</span>${asset.symbol}</div>`;
            });
            
            // Data rows
            for (let i = 0; i < n; i++) {
                html += `<div class="heatmap-label"><span class="label-icon">${currentAssets[i].icon}</span>${currentAssets[i].symbol}</div>`;
                
                for (let j = 0; j < n; j++) {
                    const value = correlationMatrix[i][j];
                    const color = getCorrelationColor(value);
                    const isDiagonal = i === j;
                    
                    html += `
                        <div class="heatmap-cell ${isDiagonal ? 'diagonal' : ''}" 
                             style="background: ${isDiagonal ? '#333' : color.bg}; color: ${isDiagonal ? '#666' : color.text};"
                             data-row="${i}" data-col="${j}" data-value="${value}"
                             onmouseenter="showTooltip(event, ${i}, ${j}, ${value})"
                             onmouseleave="hideTooltip()">
                            ${isDiagonal ? '1.00' : value.toFixed(2)}
                        </div>
                    `;
                }
            }
            
            grid.innerHTML = html;
        }

        // Tooltip functions
        function showTooltip(event, row, col, value) {
            const tooltip = document.getElementById('tooltip');
            const asset1 = currentAssets[row];
            const asset2 = currentAssets[col];
            
            document.getElementById('tooltipHeader').textContent = `${asset1.symbol} / ${asset2.symbol}`;
            document.getElementById('tooltipValue').textContent = value.toFixed(3);
            document.getElementById('tooltipValue').style.color = getCorrelationColor(value).bg;
            
            let meaning = '';
            if (value >= 0.8) meaning = 'üîó Very high positive correlation. These assets move almost identically.';
            else if (value >= 0.5) meaning = 'üìà High positive correlation. Usually move in the same direction.';
            else if (value >= 0.2) meaning = '‚ÜóÔ∏è Moderate positive correlation. Tend to move together.';
            else if (value >= -0.2) meaning = '‚öñÔ∏è Low/No correlation. Good for diversification!';
            else if (value >= -0.5) meaning = '‚ÜòÔ∏è Moderate negative correlation. Often move oppositely.';
            else meaning = 'üõ°Ô∏è High negative correlation. Excellent hedge!';
            
            document.getElementById('tooltipMeaning').textContent = meaning;
            
            tooltip.style.left = event.pageX + 15 + 'px';
            tooltip.style.top = event.pageY + 15 + 'px';
            tooltip.classList.add('visible');
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('visible');
        }

        // Render statistics
        function renderStats() {
            const pairs = [];
            const n = currentAssets.length;
            
            for (let i = 0; i < n; i++) {
                for (let j = i + 1; j < n; j++) {
                    pairs.push({
                        asset1: currentAssets[i],
                        asset2: currentAssets[j],
                        correlation: correlationMatrix[i][j]
                    });
                }
            }
            
            // Sort for highest
            const sortedHigh = [...pairs].sort((a, b) => b.correlation - a.correlation);
            const sortedLow = [...pairs].sort((a, b) => a.correlation - b.correlation);
            
            // Render highest correlations
            document.getElementById('highestCorrelations').innerHTML = sortedHigh.slice(0, 4).map(p => `
                <div class="correlation-pair">
                    <div class="pair-icons">
                        <span style="font-size: 1.2rem;">${p.asset1.icon}</span>
                        <span style="font-size: 1.2rem;">${p.asset2.icon}</span>
                    </div>
                    <div class="pair-names">${p.asset1.symbol}/${p.asset2.symbol}</div>
                    <div class="pair-value high-positive">${p.correlation.toFixed(2)}</div>
                </div>
            `).join('');
            
            // Render lowest correlations
            document.getElementById('lowestCorrelations').innerHTML = sortedLow.slice(0, 4).map(p => `
                <div class="correlation-pair">
                    <div class="pair-icons">
                        <span style="font-size: 1.2rem;">${p.asset1.icon}</span>
                        <span style="font-size: 1.2rem;">${p.asset2.icon}</span>
                    </div>
                    <div class="pair-names">${p.asset1.symbol}/${p.asset2.symbol}</div>
                    <div class="pair-value ${p.correlation < 0.3 ? 'negative' : 'neutral'}">${p.correlation.toFixed(2)}</div>
                </div>
            `).join('');
            
            // Calculate stats
            const correlations = pairs.map(p => p.correlation);
            const avg = correlations.reduce((a, b) => a + b, 0) / correlations.length;
            const sorted = [...correlations].sort((a, b) => a - b);
            const median = sorted[Math.floor(sorted.length / 2)];
            
            document.getElementById('avgCorrelation').textContent = avg.toFixed(2);
            document.getElementById('medianCorrelation').textContent = median.toFixed(2);
            
            // BTC impact (average of BTC correlations)
            const btcCorrs = pairs.filter(p => p.asset1.symbol === 'BTC' || p.asset2.symbol === 'BTC').map(p => p.correlation);
            const btcAvg = btcCorrs.reduce((a, b) => a + b, 0) / btcCorrs.length;
            document.getElementById('btcImpact').textContent = btcAvg.toFixed(2);
            
            // Diversification score (lower avg correlation = better)
            const divScore = Math.round((1 - avg) * 100);
            document.getElementById('diversificationScore').textContent = divScore;
            document.getElementById('scoreFill').style.width = divScore + '%';
            
            let grade, gradeClass;
            if (divScore >= 60) { grade = 'üåü Excellent Diversification'; gradeClass = 'grade-excellent'; }
            else if (divScore >= 40) { grade = '‚úÖ Good Diversification'; gradeClass = 'grade-good'; }
            else if (divScore >= 25) { grade = '‚ö†Ô∏è Fair Diversification'; gradeClass = 'grade-fair'; }
            else { grade = '‚ùå Poor Diversification'; gradeClass = 'grade-poor'; }
            
            const gradeEl = document.getElementById('diversificationGrade');
            gradeEl.textContent = grade;
            gradeEl.className = 'diversification-grade ' + gradeClass;
        }

        // Generate AI Analysis
        function generateAIAnalysis() {
            const pairs = [];
            const n = currentAssets.length;
            
            for (let i = 0; i < n; i++) {
                for (let j = i + 1; j < n; j++) {
                    pairs.push({
                        asset1: currentAssets[i],
                        asset2: currentAssets[j],
                        correlation: correlationMatrix[i][j]
                    });
                }
            }
            
            const correlations = pairs.map(p => p.correlation);
            const avg = correlations.reduce((a, b) => a + b, 0) / correlations.length;
            const lowCorr = pairs.filter(p => p.correlation < 0.5);
            const highCorr = pairs.filter(p => p.correlation > 0.8);
            
            let analysis = '';
            
            if (avg > 0.7) {
                analysis = `<strong>‚ö†Ô∏è High Average Correlation (${avg.toFixed(2)})</strong><br><br>
                    Your portfolio assets are highly correlated, meaning they tend to move together. This increases systemic risk - when one drops, most likely all will drop. 
                    Consider adding assets with lower correlation for better risk management.`;
            } else if (avg > 0.5) {
                analysis = `<strong>üìä Moderate Correlation (${avg.toFixed(2)})</strong><br><br>
                    Your portfolio has moderate diversification. Most crypto assets are correlated due to BTC's market influence. 
                    You have ${lowCorr.length} pairs with low correlation that provide some hedge.`;
            } else {
                analysis = `<strong>‚úÖ Good Diversification (${avg.toFixed(2)})</strong><br><br>
                    Your portfolio shows healthy diversification! Lower correlations mean assets move more independently, 
                    reducing overall portfolio volatility during market swings.`;
            }
            
            document.getElementById('aiAnalysis').innerHTML = analysis;
            
            // Recommendations
            const sortedLow = [...pairs].sort((a, b) => a.correlation - b.correlation);
            const bestHedge = sortedLow[0];
            
            document.getElementById('aiRecommendations').innerHTML = `
                <div class="recommendation">
                    <div class="recommendation-title">üõ°Ô∏è Best Hedge Pair</div>
                    <div class="recommendation-text">${bestHedge.asset1.symbol}/${bestHedge.asset2.symbol} (${bestHedge.correlation.toFixed(2)}) - Holding both reduces portfolio volatility</div>
                </div>
                <div class="recommendation">
                    <div class="recommendation-title">üìà BTC Correlation Insight</div>
                    <div class="recommendation-text">Most alts follow BTC. If bearish on BTC, reduce exposure to high-correlation alts like ETH, LTC</div>
                </div>
                <div class="recommendation">
                    <div class="recommendation-title">‚ö° Volatility Tip</div>
                    <div class="recommendation-text">During market stress, correlations typically increase to ~1.0. Plan exits before, not during crashes</div>
                </div>
            `;
        }

        // Update function
        function updateCorrelations() {
            document.getElementById('heatmapGrid').innerHTML = '<div class="skeleton" style="height: 400px; grid-column: span 11;"></div>';
            fetchPriceHistory();
        }

        // Initialize
        fetchPriceHistory();
    </script>
<script src="common-footer.js" defer></script>
</body>
</html>
